diff --git a/papi.spec b/papi.spec
index 23bb235..b2f6389 100644
--- a/papi.spec
+++ b/papi.spec
@@ -12,7 +12,7 @@ BuildRequires: gcc-gfortran
 BuildRequires: kernel-headers >= 2.6.31
 BuildRequires: chrpath
 #Right now libpfm does not know anything about s390 and will fail
-ExcludeArch: s390, s390x
+ExcludeArch: s390 s390x
 
 %description
 PAPI provides a programmer interface to monitor the performance of
diff --git a/papi400patch3.diff b/papi400patch3.diff
new file mode 100644
index 0000000..a6a198c
--- /dev/null
+++ b/papi400patch3.diff
@@ -0,0 +1,2683 @@
+diff -rupNwB papi400t/papi.spec papi400b/papi.spec
+--- papi400t/papi.spec	2010-01-13 16:00:42.000000000 -0500
++++ papi400b/papi.spec	2010-03-09 16:32:53.000000000 -0500
+@@ -12,7 +12,7 @@ BuildRequires: gcc-gfortran
+ BuildRequires: kernel-headers >= 2.6.31
+ BuildRequires: chrpath
+ #Right now libpfm does not know anything about s390 and will fail
+-ExcludeArch: s390, s390x
++ExcludeArch: s390 s390x
+ 
+ %description
+ PAPI provides a programmer interface to monitor the performance of
+diff -rupNwB papi400t/src/configure papi400b/src/configure
+--- papi400t/src/configure	2010-01-13 11:20:35.000000000 -0500
++++ papi400b/src/configure	2010-04-28 22:32:15.000000000 -0400
+@@ -1981,6 +1981,7 @@ use_shared=yes
+ use_static=yes
+ use_static_tests=no
+ use_x86_cache_info=no
++distributed_build=no
+ { $as_echo "$as_me:$LINENO: checking for architecture" >&5
+ $as_echo_n "checking for architecture... " >&6; }
+ 
+@@ -2093,6 +2094,10 @@ $as_echo_n "checking for CPU type... " >
+ # Check whether --with-CPU was given.
+ if test "${with_CPU+set}" = set; then
+   withval=$with_CPU; CPU=$withval
++             case "$CPU" in
++               core | core2 | i7 | atom | p4 | p3 | opteron | athlon)
++                 use_x86_cache_info=yes;;
++             esac
+ else
+ 
+ 
+@@ -2113,7 +2118,6 @@ case "$OS" in
+            made=GenuineIntel
+            family="`cat /proc/cpuinfo | grep family | cut -d: -f2 | cut -d' ' -f2 | sed '2,$d'`"
+            model="`cat /proc/cpuinfo | grep model | cut -d: -f2 | cut -d' ' -f2 | sed '2,$d'`"
+-           # family 15 is always P4; model 1 is vanilla pre-HT, model 2 is vanilla; model 3 is em64t, 4 is Pentium D, 6 is Xeon D
+            if test "$family" = "6"; then
+              # model 14 is an ancient Core
+              if test "$model" = "14"; then
+@@ -2125,8 +2129,9 @@ case "$OS" in
+                CPU=core2
+                use_x86_cache_info=yes
+              fi
+-             # model 26 is Nehalem
+-             if test "$model" = "26"; then
++             # models 26, 30, 37, 44, 46 are Nehalem variants
++             if (test "$model" = "26" || test "$model" = "30" || test "$model" = "37" ||
++                 test "$model" = "44" || test "$model" = "46"); then
+                CPU=i7
+                use_x86_cache_info=yes
+              fi
+@@ -2135,14 +2140,10 @@ case "$OS" in
+                CPU=atom
+                use_x86_cache_info=yes
+              fi
++           # family 15 is always P4
+            elif test "$family" = "15"; then
+-             if (test "$model" = "3" || test "$model" = "4" || test "$model" = "6"); then
+-               CPU=em64t
+-               use_x86_cache_info=yes
+-             elif (test "$model" = "1" || test "$model" = "2"); then
+                CPU=p4
+                use_x86_cache_info=yes
+-             fi
+            elif test "$family" = "32"; then
+ 	       CPU=montecito
+ 	   elif test "$family" = "31"; then
+@@ -2157,7 +2158,8 @@ case "$OS" in
+              elif test "`cat /proc/cpuinfo | grep -i "Pentium III"`" != ""; then
+                CPU=p3
+                use_x86_cache_info=yes
+-	     else CPU=p3
++	     else
++               CPU=p3
+                use_x86_cache_info=yes
+              fi
+            fi
+@@ -6615,6 +6617,7 @@ if test "x$perfctr" = "x"; then
+ # Check whether --with-perfctr was given.
+ if test "${with_perfctr+set}" = set; then
+   withval=$with_perfctr; perfctr=$withval
++             distributed_build=yes
+ else
+   perfctr="no"
+ if test "$cross_compiling" = "no" ; then
+@@ -6697,6 +6700,7 @@ esac
+ # Check whether --with-perfctr_root was given.
+ if test "${with_perfctr_root+set}" = set; then
+   withval=$with_perfctr_root; perfctr_root=$withval
++             distributed_build=yes
+ else
+   perfctr_root=""
+ 
+@@ -6706,6 +6710,7 @@ fi
+ # Check whether --with-perfctr_prefix was given.
+ if test "${with_perfctr_prefix+set}" = set; then
+   withval=$with_perfctr_prefix; perfctr_prefix=$withval
++             distributed_build=yes
+ else
+   perfctr_prefix=""
+ 
+@@ -6715,6 +6720,7 @@ fi
+ # Check whether --with-perfctr_incdir was given.
+ if test "${with_perfctr_incdir+set}" = set; then
+   withval=$with_perfctr_incdir; perfctr_incdir=$withval
++            distributed_build=yes
+ else
+   perfctr_incdir=""
+ 
+@@ -6724,6 +6730,7 @@ fi
+ # Check whether --with-perfctr_libdir was given.
+ if test "${with_perfctr_libdir+set}" = set; then
+   withval=$with_perfctr_libdir; perfctr_libdir=$withval
++            distributed_build=yes
+ else
+   perfctr_libdir=""
+ 
+@@ -6734,6 +6741,7 @@ fi
+ # Check whether --with-perfmon was given.
+ if test "${with_perfmon+set}" = set; then
+   withval=$with_perfmon; perfmon=$withval
++             distributed_build=yes
+ else
+   perfmon=0
+ 	    if test "$cross_compiling" = "no" ; then
+@@ -6819,6 +6827,7 @@ fi
+ # Check whether --with-pfm_root was given.
+ if test "${with_pfm_root+set}" = set; then
+   withval=$with_pfm_root; pfm_root=$withval
++            distributed_build=yes
+ else
+   pfm_root=""
+ 
+@@ -6828,6 +6837,7 @@ fi
+ # Check whether --with-pfm_prefix was given.
+ if test "${with_pfm_prefix+set}" = set; then
+   withval=$with_pfm_prefix; pfm_prefix=$withval
++            distributed_build=yes
+ else
+   pfm_prefix=""
+ 
+@@ -6837,6 +6847,7 @@ fi
+ # Check whether --with-pfm_incdir was given.
+ if test "${with_pfm_incdir+set}" = set; then
+   withval=$with_pfm_incdir; pfm_incdir=$withval
++            distributed_build=yes
+ else
+   pfm_incdir=""
+ 
+@@ -6846,6 +6857,7 @@ fi
+ # Check whether --with-pfm_libdir was given.
+ if test "${with_pfm_libdir+set}" = set; then
+   withval=$with_pfm_libdir; pfm_libdir=$withval
++            distributed_build=yes
+ else
+   pfm_libdir=""
+ 
+@@ -7019,7 +7031,7 @@ fi
+ fi
+ # Linux perf event end
+ 
+-if test "$perf_events" = "no" -a "$perfctr" = "no" -a "$perfmon" = "0"; then
++if test "$distributed_build" = "no" -a "$perf_events" = "no" -a "$perfctr" = "no" -a "$perfmon" = "0"; then
+   { { $as_echo "$as_me:$LINENO: error: No performance monitoring interface available" >&5
+ $as_echo "$as_me: error: No performance monitoring interface available" >&2;}
+    { (exit 1); exit 1; }; }
+@@ -8668,6 +8680,9 @@ if test "$OS" = "aix"; then
+       power5) PMAPI="/usr/pmapi" ;;
+       power6) PMAPI="/usr/pmapi" ;;
+       esac
++   else
++	PMAPI="$pmapi"
++   fi
+       PMINIT=""
+       LIBS="-L$PMAPI/lib -lpmapi"
+       CPPFLAGS="$CPPFLAGS -I$PMAPI/include"
+@@ -8820,9 +8835,6 @@ fi
+ fi
+ 
+    else
+-	PMAPI="$pmapi"
+-   fi
+-else
+       case "$pmapi" in
+          default) ;;
+          *)
+@@ -9033,7 +9045,7 @@ $as_echo "$as_me: error: The bitmode you
+ 		    else
+ 		    MAKEVER="$OS"-pfm-"$CPU"
+ 		 fi ;;
+-            opteron|core|core2|i7|atom|em64t|p3)
++            opteron|core|core2|i7|atom|p3)
+ 		if test "$arch" = "x86_64"; then
+ 			MAKEVER="$OS"-perfctr-p3
+ 		else
+@@ -9099,7 +9111,6 @@ case "$MAKEVER" in
+     linux-perfctr-athlon);;
+     linux-perfctr-p3);;
+     linux-perfctr-p4);;
+-    linux-perfctr-em64t);;
+     solaris-ultra);;
+     solaris-ultra-64bit);;
+     solaris-niagara2|solaris-niagara2-32bit);;
+@@ -9702,7 +9713,7 @@ elif test "$MAKEVER" = "bgp"; then
+    BGP_SYSDIR=/bgsys/drivers/ppcfloor
+    BGP_GNU_LINUX_PATH='${BGP_SYSDIR}/gnu-linux'
+    LDFLAGS='-L$(BGP_SYSDIR)/runtime/SPI -lSPI.cna'
+-   CFLAGS='-D_BGP -g -gdwarf-2 -O2 -Wall -I. -I$(BGP_SYSDIR)/arch/include -DCOMP_VECTOR=_bgp_vectors'
++   CFLAGS='-g -gdwarf-2 -O2 -Wall -I. -I$(BGP_SYSDIR)/arch/include -DCOMP_VECTOR=_bgp_vectors'
+    # Some nice flags to add to CFLAGS when debugging
+    #CFLAGS='$(CFLAGS) -DDEBUG -DMPX_DEBUG -DMPX_DEBUG_TIMER'
+    FFLAGS='-g -gdwarf-2 -O2 -Wall -I. -Dlinux'
+diff -rupNwB papi400t/src/configure.in papi400b/src/configure.in
+--- papi400t/src/configure.in	2010-01-13 11:03:58.000000000 -0500
++++ papi400b/src/configure.in	2010-04-28 22:32:15.000000000 -0400
+@@ -1,7 +1,7 @@
+ #                   -*- Autoconf -*-
+ # Process this file with autoconf to produce a configure script.
+ # File: configure.in
+-# CVS:  $Id: configure.in,v 1.166 2010/01/13 16:03:58 sbk Exp $
++# CVS:  $Id: configure.in,v 1.166.2.5 2010/04/29 02:32:15 terpstra Exp $
+ 
+ 
+ AC_PREREQ(2.61)
+@@ -88,6 +88,7 @@ use_shared=yes
+ use_static=yes
+ use_static_tests=no
+ use_x86_cache_info=no
++distributed_build=no
+ AC_MSG_CHECKING(for architecture)
+ AC_ARG_WITH(arch,
+ 	   [  --with-arch=<arch>		Specify architecture (uname -m)],
+@@ -179,7 +180,11 @@ AC_MSG_RESULT($OSVER)
+ AC_MSG_CHECKING(for CPU type)
+ AC_ARG_WITH(CPU,
+             [  --with-CPU=<cpu>		Specify CPU type],
+-            [CPU=$withval],
++            [CPU=$withval
++             case "$CPU" in
++               core | core2 | i7 | atom | p4 | p3 | opteron | athlon)      
++                 use_x86_cache_info=yes;;
++             esac],
+ 	    [
+ 
+ #checking for CPU
+@@ -199,7 +204,6 @@ case "$OS" in
+            made=GenuineIntel
+            family="`cat /proc/cpuinfo | grep family | cut -d: -f2 | cut -d' ' -f2 | sed '2,$d'`"
+            model="`cat /proc/cpuinfo | grep model | cut -d: -f2 | cut -d' ' -f2 | sed '2,$d'`"
+-           # family 15 is always P4; model 1 is vanilla pre-HT, model 2 is vanilla; model 3 is em64t, 4 is Pentium D, 6 is Xeon D
+            if test "$family" = "6"; then
+              # model 14 is an ancient Core
+              if test "$model" = "14"; then
+@@ -211,8 +215,9 @@ case "$OS" in
+                CPU=core2
+                use_x86_cache_info=yes
+              fi
+-             # model 26 is Nehalem
+-             if test "$model" = "26"; then
++             # models 26, 30, 37, 44, 46 are Nehalem variants
++             if (test "$model" = "26" || test "$model" = "30" || test "$model" = "37" || 
++                 test "$model" = "44" || test "$model" = "46"); then
+                CPU=i7
+                use_x86_cache_info=yes
+              fi
+@@ -221,14 +226,10 @@ case "$OS" in
+                CPU=atom
+                use_x86_cache_info=yes
+              fi
++           # family 15 is always P4
+            elif test "$family" = "15"; then
+-             if (test "$model" = "3" || test "$model" = "4" || test "$model" = "6"); then
+-               CPU=em64t
+-               use_x86_cache_info=yes
+-             elif (test "$model" = "1" || test "$model" = "2"); then
+                CPU=p4
+                use_x86_cache_info=yes
+-             fi
+            elif test "$family" = "32"; then
+ 	       CPU=montecito
+ 	   elif test "$family" = "31"; then
+@@ -243,7 +244,8 @@ case "$OS" in
+              elif test "`cat /proc/cpuinfo | grep -i "Pentium III"`" != ""; then
+                CPU=p3
+                use_x86_cache_info=yes
+-	     else CPU=p3
++	     else 
++               CPU=p3
+                use_x86_cache_info=yes
+              fi
+            fi 
+@@ -901,7 +903,8 @@ AC_MSG_RESULT($virtualtimer)
+ if test "x$perfctr" = "x"; then
+ AC_ARG_WITH(perfctr,
+             [  --with-perfctr=<5,6,7>	Specify perfctr version number ],
+-            [perfctr=$withval],
++            [perfctr=$withval
++             distributed_build=yes],
+             [perfctr="no"
+ if test "$cross_compiling" = "no" ; then
+ 	    AC_CHECK_FILE(/sys/class/perfctr,[perfctr=7],[AC_CHECK_FILE(/dev/perfctr,[perfctr=6])])
+@@ -933,28 +936,33 @@ esac
+ 
+ AC_ARG_WITH(perfctr_root,
+             [  --with-perfctr-root=<path>	Specify path to source tree (for use by developers only) ],
+-            [perfctr_root=$withval],
++            [perfctr_root=$withval
++             distributed_build=yes],
+             [perfctr_root=""]
+             )
+ AC_ARG_WITH(perfctr_prefix,
+             [  --with-perfctr-prefix=<path>	Specify prefix to installed perfctr distribution ],
+-            [perfctr_prefix=$withval],
++            [perfctr_prefix=$withval
++             distributed_build=yes],
+             [perfctr_prefix=""]
+             )
+ AC_ARG_WITH(perfctr_incdir,
+            [  --with-perfctr-incdir=<path>	Specify directory of perfctr header files in non-standard location ],
+-           [perfctr_incdir=$withval],
++           [perfctr_incdir=$withval
++            distributed_build=yes],
+            [perfctr_incdir=""]
+             )
+ AC_ARG_WITH(perfctr_libdir,
+            [  --with-perfctr-libdir=<path>	Specify directory of perfctr library in non-standard location ],
+-           [perfctr_libdir=$withval],
++           [perfctr_libdir=$withval
++            distributed_build=yes],
+            [perfctr_libdir=""]
+             )
+ 
+ AC_ARG_WITH(perfmon,
+             [  --with-perfmon=<x.y>		Specify perfmon version number ],
+-            [perfmon=$withval],
++            [perfmon=$withval
++             distributed_build=yes],
+             [perfmon=0
+ 	    if test "$cross_compiling" = "no" ; then
+ 	       AC_CHECK_FILE(/sys/kernel/perfmon/version,[
+@@ -987,22 +995,26 @@ fi
+ 
+ AC_ARG_WITH(pfm_root,
+            [  --with-pfm-root=<path>	Specify path to source tree (for use by developers only) ],
+-           [pfm_root=$withval],
++           [pfm_root=$withval
++            distributed_build=yes],
+            [pfm_root=""]
+             )
+ AC_ARG_WITH(pfm_prefix,
+            [  --with-pfm-prefix=<path>	Specify prefix to installed pfm distribution ],
+-           [pfm_prefix=$withval],
++           [pfm_prefix=$withval
++            distributed_build=yes],
+            [pfm_prefix=""]
+             )
+ AC_ARG_WITH(pfm_incdir,
+            [  --with-pfm-incdir=<path>	Specify directory of pfm header files in non-standard location ],
+-           [pfm_incdir=$withval],
++           [pfm_incdir=$withval
++            distributed_build=yes],
+            [pfm_incdir=""]
+             )
+ AC_ARG_WITH(pfm_libdir,
+            [  --with-pfm-libdir=<path>	Specify directory of pfm library in non-standard location ],
+-           [pfm_libdir=$withval],
++           [pfm_libdir=$withval
++            distributed_build=yes],
+            [pfm_libdir=""]
+             )
+ 
+@@ -1068,7 +1080,7 @@ fi
+ fi
+ # Linux perf event end
+ 
+-if test "$perf_events" = "no" -a "$perfctr" = "no" -a "$perfmon" = "0"; then
++if test "$distributed_build" = "no" -a "$perf_events" = "no" -a "$perfctr" = "no" -a "$perfmon" = "0"; then
+   AC_MSG_ERROR([No performance monitoring interface available])
+ fi
+ 
+@@ -1326,6 +1338,9 @@ if test "$OS" = "aix"; then
+       power5) PMAPI="/usr/pmapi" ;;
+       power6) PMAPI="/usr/pmapi" ;;
+       esac
++   else
++	PMAPI="$pmapi"
++   fi
+       PMINIT=""
+       LIBS="-L$PMAPI/lib -lpmapi"
+       CPPFLAGS="$CPPFLAGS -I$PMAPI/include"
+@@ -1336,9 +1351,6 @@ if test "$OS" = "aix"; then
+ 			    AC_MSG_ERROR([libpmapi.a is needed on AIX, please examine config.log and rerun configure with different flags])
+ 			    ])],[])
+    else
+-	PMAPI="$pmapi"
+-   fi
+-else
+       case "$pmapi" in
+          default) ;;
+          *)  
+@@ -1441,7 +1453,7 @@ case "$OS" in
+ 		    else
+ 		    MAKEVER="$OS"-pfm-"$CPU"
+ 		 fi ;;
+-            opteron|core|core2|i7|atom|em64t|p3)
++            opteron|core|core2|i7|atom|p3)
+ 		if test "$arch" = "x86_64"; then
+ 			MAKEVER="$OS"-perfctr-p3
+ 		else
+@@ -1500,7 +1512,6 @@ case "$MAKEVER" in 
+     linux-perfctr-athlon);;
+     linux-perfctr-p3);;
+     linux-perfctr-p4);;
+-    linux-perfctr-em64t);;
+     solaris-ultra);;
+     solaris-ultra-64bit);;
+     solaris-niagara2|solaris-niagara2-32bit);;
+@@ -1832,7 +1843,7 @@ elif test "$MAKEVER" = "bgp"; then
+    BGP_SYSDIR=/bgsys/drivers/ppcfloor
+    BGP_GNU_LINUX_PATH='${BGP_SYSDIR}/gnu-linux'
+    LDFLAGS='-L$(BGP_SYSDIR)/runtime/SPI -lSPI.cna'
+-   CFLAGS='-D_BGP -g -gdwarf-2 -O2 -Wall -I. -I$(BGP_SYSDIR)/arch/include -DCOMP_VECTOR=_bgp_vectors'
++   CFLAGS='-g -gdwarf-2 -O2 -Wall -I. -I$(BGP_SYSDIR)/arch/include -DCOMP_VECTOR=_bgp_vectors'
+    # Some nice flags to add to CFLAGS when debugging 
+    #CFLAGS='$(CFLAGS) -DDEBUG -DMPX_DEBUG -DMPX_DEBUG_TIMER'
+    FFLAGS='-g -gdwarf-2 -O2 -Wall -I. -Dlinux'
+diff -rupNwB papi400t/src/ctests/multiplex1.c papi400b/src/ctests/multiplex1.c
+--- papi400t/src/ctests/multiplex1.c	2009-09-10 16:19:48.000000000 -0400
++++ papi400b/src/ctests/multiplex1.c	2010-04-28 22:30:46.000000000 -0400
+@@ -1,6 +1,6 @@
+ /* 
+ * File:    multiplex.c
+-* CVS:     $Id: multiplex1.c,v 1.50 2009/09/10 20:19:48 terpstra Exp $
++* CVS:     $Id: multiplex1.c,v 1.50.6.1 2010/04/29 02:30:46 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    <your name here>
+@@ -14,20 +14,26 @@
+ 
+ /* Event to use in all cases; initialized in init_papi() */
+ 
+-unsigned int power6_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+-   PAPI_FP_INS, PAPI_TOT_CYC, PAPI_L1_DCM, PAPI_L1_ICM, 0 };
+-unsigned int preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+-   PAPI_FP_INS, PAPI_TOT_INS, PAPI_L1_DCM, PAPI_L1_ICM, 0 };
+-static unsigned int PAPI_events[PAPI_MPX_DEF_DEG] = { 0, };
++int solaris_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
++	PAPI_BR_MSP, PAPI_TOT_CYC, PAPI_L2_TCM, PAPI_L1_ICM, 0
++};
++int power6_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
++	PAPI_FP_INS, PAPI_TOT_CYC, PAPI_L1_DCM, PAPI_L1_ICM, 0
++};
++int preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
++	PAPI_FP_INS, PAPI_TOT_INS, PAPI_L1_DCM, PAPI_L1_ICM, 0
++};
++static int PAPI_events[PAPI_MPX_DEF_DEG] = { 0, };
+ static int PAPI_events_len = 0;
+ 
+ #define CPP_TEST_FAIL(string, retval) test_fail(__FILE__, __LINE__, string, retval)
+ 
+-void init_papi(unsigned int *out_events, int *len)
++void
++init_papi( int *out_events, int *len )
+ {
+    int retval;
+    int i, real_len = 0;
+-   unsigned int *in_events = preset_PAPI_events;
++	int *in_events = preset_PAPI_events;
+    const PAPI_hw_info_t *hw_info;
+ 
+    /* Initialize the library */
+@@ -39,6 +45,10 @@ void init_papi(unsigned int *out_events,
+    if (hw_info == NULL)
+       test_fail(__FILE__, __LINE__, "PAPI_get_hardware_info", 2);
+ 
++	if ( strstr( hw_info->model_string, "UltraSPARC" ) ) {
++		in_events = solaris_preset_PAPI_events;
++	}
++
+    if (strcmp(hw_info->model_string, "POWER6") == 0) {
+       in_events = power6_preset_PAPI_events;
+       retval = PAPI_set_domain(PAPI_DOM_ALL);
+diff -rupNwB papi400t/src/ctests/multiplex1_pthreads.c papi400b/src/ctests/multiplex1_pthreads.c
+--- papi400t/src/ctests/multiplex1_pthreads.c	2009-11-11 13:47:42.000000000 -0500
++++ papi400b/src/ctests/multiplex1_pthreads.c	2010-04-28 22:30:46.000000000 -0400
+@@ -1,6 +1,6 @@
+ /* 
+ * File:    multiplex1_pthreads.c
+-* CVS:     $Id: multiplex1_pthreads.c,v 1.49 2009/11/11 18:47:42 bsheely Exp $
++* CVS:     $Id: multiplex1_pthreads.c,v 1.49.4.1 2010/04/29 02:30:46 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    <your name here>
+@@ -12,20 +12,26 @@
+ #include <pthread.h>
+ #include "papi_test.h"
+ 
+-unsigned int power6_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+-   PAPI_FP_INS, PAPI_TOT_CYC, PAPI_L1_DCM, PAPI_L1_ICM, 0 };
+-unsigned int preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+-   PAPI_FP_INS, PAPI_TOT_INS, PAPI_L1_DCM, PAPI_L1_ICM, 0 };
+-static unsigned int PAPI_events[PAPI_MPX_DEF_DEG] = { 0, };
++int solaris_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
++  PAPI_BR_MSP, PAPI_TOT_CYC, PAPI_L2_TCM, PAPI_L1_ICM, 0
++};
++int power6_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
++	PAPI_FP_INS, PAPI_TOT_CYC, PAPI_L1_DCM, PAPI_L1_ICM, 0
++};
++int preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
++	PAPI_FP_INS, PAPI_TOT_INS, PAPI_L1_DCM, PAPI_L1_ICM, 0
++};
++static int PAPI_events[PAPI_MPX_DEF_DEG] = { 0, };
+ static int PAPI_events_len = 0;
+ 
+ #define CPP_TEST_FAIL(string, retval) test_fail(__FILE__, __LINE__, string, retval)
+ 
+-void init_papi_pthreads(unsigned int *out_events, int *len)
++void
++init_papi_pthreads( int *out_events, int *len )
+ {
+    int retval;
+    int i, real_len = 0;
+-   unsigned int *in_events = preset_PAPI_events;
++	int *in_events = preset_PAPI_events;
+    const PAPI_hw_info_t *hw_info;
+ 
+    /* Initialize the library */
+@@ -34,16 +40,13 @@ void init_papi_pthreads(unsigned int *ou
+       CPP_TEST_FAIL("PAPI_library_init", retval);
+ 
+    hw_info = PAPI_get_hardware_info();
+-
+-   /* Initialize the library */
+-   retval = PAPI_library_init(PAPI_VER_CURRENT);
+-   if (retval != PAPI_VER_CURRENT)
+-      CPP_TEST_FAIL("PAPI_library_init", retval);
+-
+-   hw_info = PAPI_get_hardware_info();
+    if (hw_info == NULL)
+       test_fail(__FILE__, __LINE__, "PAPI_get_hardware_info", 2);
+ 
++	if ( strstr( hw_info->model_string, "UltraSPARC" ) ) {
++	  in_events = solaris_preset_PAPI_events;
++        }
++
+    if (strcmp(hw_info->model_string, "POWER6") == 0) {
+       in_events = power6_preset_PAPI_events;
+       retval = PAPI_set_domain(PAPI_DOM_ALL);
+@@ -108,7 +111,7 @@ int do_pthreads(void *(*fn) (void *))
+       pthread_join(id[i], NULL);
+ 
+    pthread_attr_destroy(&attr);
+-
++	pthread_exit( NULL );
+    return (SUCCESS);
+ }
+ 
+@@ -116,9 +119,13 @@ int do_pthreads(void *(*fn) (void *))
+ 
+ void *case1_pthreads(void *arg)
+ {
++	( void ) arg;			 /*unused */
+    int retval, i, EventSet = PAPI_NULL;
+    long long values[2];
+ 
++	if ( ( retval = PAPI_register_thread(  ) ) != PAPI_OK )
++		test_fail( __FILE__, __LINE__, "PAPI_register_thread", retval );
++
+    if ((retval = PAPI_create_eventset(&EventSet)) != PAPI_OK)
+       test_fail(__FILE__, __LINE__, "PAPI_create_eventset", retval);
+ 
+@@ -153,6 +160,9 @@ void *case1_pthreads(void *arg)
+    if ((retval = PAPI_cleanup_eventset(EventSet)) != PAPI_OK)   /* JT */
+       test_fail(__FILE__, __LINE__, "PAPI_cleanup_eventset", retval);
+ 
++	if ( ( retval = PAPI_unregister_thread(  ) ) != PAPI_OK )
++		test_fail( __FILE__, __LINE__, "PAPI_unregister_thread", retval );
++
+    return ((void *) SUCCESS);
+ }
+ 
+@@ -160,9 +170,13 @@ void *case1_pthreads(void *arg)
+ 
+ void *case2_pthreads(void *arg)
+ {
++	( void ) arg;			 /*unused */
+    int retval, i, EventSet = PAPI_NULL;
+    long long values[2];
+ 
++	if ( ( retval = PAPI_register_thread(  ) ) != PAPI_OK )
++		test_fail( __FILE__, __LINE__, "PAPI_register_thread", retval );
++
+    if ((retval = PAPI_create_eventset(&EventSet)) != PAPI_OK)
+       test_fail(__FILE__, __LINE__, "PAPI_create_eventset", retval);
+ 
+@@ -208,6 +222,9 @@ void *case2_pthreads(void *arg)
+    if ((retval = PAPI_cleanup_eventset(EventSet)) != PAPI_OK)   /* JT */
+       test_fail(__FILE__, __LINE__, "PAPI_cleanup_eventset", retval);
+ 
++	if ( ( retval = PAPI_unregister_thread(  ) ) != PAPI_OK )
++		test_fail( __FILE__, __LINE__, "PAPI_unregister_thread", retval );
++
+    return ((void *) SUCCESS);
+ }
+ 
+@@ -215,9 +232,13 @@ void *case2_pthreads(void *arg)
+ 
+ void *case3_pthreads(void *arg)
+ {
++	( void ) arg;			 /*unused */
+    int retval, i, EventSet = PAPI_NULL;
+    long long values[2];
+ 
++	if ( ( retval = PAPI_register_thread(  ) ) != PAPI_OK )
++		test_fail( __FILE__, __LINE__, "PAPI_register_thread", retval );
++
+    if ((retval = PAPI_create_eventset(&EventSet)) != PAPI_OK)
+       test_fail(__FILE__, __LINE__, "PAPI_create_eventset", retval);
+ 
+@@ -255,6 +276,9 @@ void *case3_pthreads(void *arg)
+    if ((retval = PAPI_cleanup_eventset(EventSet)) != PAPI_OK)   /* JT */
+       test_fail(__FILE__, __LINE__, "PAPI_cleanup_eventset", retval);
+ 
++	if ( ( retval = PAPI_unregister_thread(  ) ) != PAPI_OK )
++		test_fail( __FILE__, __LINE__, "PAPI_unregister_thread", retval );
++
+    return ((void *) SUCCESS);
+ }
+ 
+@@ -262,10 +286,14 @@ void *case3_pthreads(void *arg)
+ 
+ void *case4_pthreads(void *arg)
+ {
++	( void ) arg;			 /*unused */
+    int retval, i, EventSet = PAPI_NULL;
+    long long values[4];
+    char out[PAPI_MAX_STR_LEN];
+ 
++	if ( ( retval = PAPI_register_thread(  ) ) != PAPI_OK )
++		test_fail( __FILE__, __LINE__, "PAPI_register_thread", retval );
++
+    if ((retval = PAPI_create_eventset(&EventSet)) != PAPI_OK)
+       test_fail(__FILE__, __LINE__, "PAPI_create_eventset", retval);
+ 
+@@ -306,6 +334,9 @@ void *case4_pthreads(void *arg)
+    if ((retval = PAPI_cleanup_eventset(EventSet)) != PAPI_OK)   /* JT */
+       test_fail(__FILE__, __LINE__, "PAPI_cleanup_eventset", retval);
+ 
++	if ( ( retval = PAPI_unregister_thread(  ) ) != PAPI_OK )
++		test_fail( __FILE__, __LINE__, "PAPI_unregister_thread", retval );
++
+    return ((void *) SUCCESS);
+ }
+ 
+diff -rupNwB papi400t/src/ctests/native.c papi400b/src/ctests/native.c
+--- papi400t/src/ctests/native.c	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/ctests/native.c	2010-04-28 22:30:46.000000000 -0400
+@@ -86,7 +86,7 @@ extern int TESTS_QUIET;         /* Decla
+ #elif defined(_BGL)
+    static char *native_name[] = { "BGL_UPC_PU0_PREF_STREAM_HIT", "BGL_PAPI_TIMEBASE", "BGL_UPC_PU1_PREF_STREAM_HIT", NULL };
+ 
+-#elif defined(_BGP)
++#elif defined(__bgp__)
+    static char *native_name[] = { "PNE_BGP_PU0_JPIPE_LOGICAL_OPS", "PNE_BGP_PU0_JPIPE_LOGICAL_OPS", "PNE_BGP_PU2_IPIPE_INSTRUCTIONS", NULL };
+ 
+ #else
+diff -rupNwB papi400t/src/ctests/shlib.c papi400b/src/ctests/shlib.c
+--- papi400t/src/ctests/shlib.c	2009-09-10 16:19:49.000000000 -0400
++++ papi400b/src/ctests/shlib.c	2010-01-26 19:27:26.000000000 -0500
+@@ -1,6 +1,6 @@
+ /* 
+ * File:    profile.c
+-* CVS:     $Id: shlib.c,v 1.18 2009/09/10 20:19:49 terpstra Exp $
++* CVS:     $Id: shlib.c,v 1.18.6.2 2010/01/27 00:27:26 jagode Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    <your name here>
+@@ -59,49 +59,25 @@ int main(int argc, char **argv)
+ 
+ #ifndef NO_DLFCN
+    {
+-     char *libname = 
+-     "libpapi.so";
+-     char *libname2 = 
+-     "libpapi64.so";
+-     char *_libname;
++     char *_libname =
++	   "libm.so";
+      void *handle ;
+-/*
+-     void *handle = dlopen("libm.so", RTLD_LAZY);
+-*/
+-     int (*num_hwctrs)(void);
++	 double (*pow)(double,double);
+      int oldcount;
+-     int my_dlerror = 0;
+-
+-RETRY:
+-     if ( !my_dlerror ){
+-        printf("\nLoading %s with dlopen().\n",libname);
+-        _libname = libname;
+-     }
+-     else{
+-        printf("\nLoading %s with dlopen().\n",libname2);
+-        _libname = libname2;
+-     }
+ 
+      handle = dlopen (_libname, RTLD_NOW);
+      if (!handle) {
+ 	 printf("dlopen: %s\n",dlerror());
+-          if ( !my_dlerror ){
+-             my_dlerror = 1;
+-	     printf("Trying again.");
+-             goto RETRY;
+-          }
+           printf("Did you forget to set the environmental variable LIBPATH (in AIX) or LD_LIBRARY_PATH (in linux) ?\n");
+           test_fail(__FILE__, __LINE__, "dlopen", 1);
+      }
+      
+-     printf("Looking up PAPI_num_counters() \n");
+-     num_hwctrs = ( int (*) (void)) dlsym(handle, "PAPI_num_counters");
+-     if (num_hwctrs == NULL)  {
++	 pow = (double(*)(double,double)) dlsym(handle, "pow");
++	 if (pow == NULL) {
+        printf("dlsym: %s \n", dlerror());
+        test_fail(__FILE__, __LINE__, "dlsym", 1);
+      }
+-     
+-     printf ("There are %d hardware counters \n", (*num_hwctrs)());
++	 printf("2^2 = %lf \n",(*pow)(2,2));
+  
+    oldcount = shinfo->count;
+ 
+diff -rupNwB papi400t/src/extras.c papi400b/src/extras.c
+--- papi400t/src/extras.c	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/extras.c	2010-04-28 22:32:15.000000000 -0400
+@@ -4,7 +4,7 @@
+ 
+ /* 
+ * File:    extras.c
+-* CVS:     $Id: extras.c,v 1.159 2009/12/18 20:24:24 terpstra Exp $
++* CVS:     $Id: extras.c,v 1.159.2.3 2010/04/29 02:32:15 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    dan terpstra
+@@ -460,7 +460,7 @@ int _papi_hwi_start_signal(int signal, i
+    action.sa_flags = SA_RESTART;
+    action.sa_sigaction = (void (*)(int, siginfo_t *, void *)) _papi_hwd[cidx]->dispatch_timer;
+    if (need_context)
+-#if (defined(_BGL) /*|| defined (_BGP)*/)
++#if (defined(_BGL) /*|| defined (__bgp__)*/)
+      action.sa_flags |= SIGPWR;
+ #else
+      action.sa_flags |= SA_SIGINFO;
+@@ -562,32 +562,48 @@ int _papi_hwi_native_name_to_code(char *
+ 	char name[PAPI_HUGE_STR_LEN]; /* make sure it's big enough */
+ 	unsigned int i, j;
+ 
+-	for (j=0,i = 0 | PAPI_NATIVE_MASK;j<papi_num_components; j++,i = 0 | PAPI_NATIVE_MASK) {
++	
++	for ( j = 0, i = 0 | PAPI_NATIVE_MASK; j<papi_num_components; j++, i = 0 | PAPI_NATIVE_MASK )
++	{
+ 		/* first check each component for name_to_code */
+ 		if (vector_find_dummy( (void*) _papi_hwd[j]->ntv_name_to_code, NULL) == NULL)
++		{
++			/* if ntv_name_to_code is set and != NULL */
+ 		  retval = _papi_hwd[j]->ntv_name_to_code(in, (unsigned *)out);
+-		else {
++		}
++		else 
++		{
+ 			_papi_hwd[j]->ntv_enum_events(&i, PAPI_ENUM_FIRST);
+ 			_papi_hwi_lock(INTERNAL_LOCK);
+-			do {
++			
++			do 
++			{
+ 				retval = _papi_hwd[j]->ntv_code_to_name(i, name, sizeof(name));
+ /*				printf("name =|%s|\ninput=|%s|\n", name, in); */
+-				if (retval == PAPI_OK) {
+-					if (strcasecmp(name, in) == 0) {
++				if (retval == PAPI_OK) 
++				{
++					if (strcasecmp(name, in) == 0) 
++					{
+ 						*out = i | PAPI_COMPONENT_MASK(j);;
+ 						break;
+-					} else {
++					} 
++					else
+ 						retval = PAPI_ENOEVNT;
+ 					}
+-				} else {
++				else 
++				{
+ 					*out = 0;
+ 					retval = PAPI_ENOEVNT;
+ 					break;
+ 				}
+-			} while ((_papi_hwd[j]->ntv_enum_events(&i, PAPI_ENUM_EVENTS) == PAPI_OK));
++			} 
++			while ( ( _papi_hwd[j]->ntv_enum_events( &i, PAPI_ENUM_EVENTS ) == PAPI_OK ) );
++			
+ 			_papi_hwi_unlock(INTERNAL_LOCK);
+-			if (retval == PAPI_OK) return(retval);
+ 		}
++		
++		if ( retval == PAPI_OK ) 
++			return( retval );
+ 	}
+ 	return (retval);
+ }
+@@ -675,7 +691,7 @@ int _papi_hwi_get_native_event_info(unsi
+ 	return (PAPI_ENOEVNT);
+ }
+ 
+-#if (!defined(HAVE_FFSLL) || defined(_BGP))
++#if (!defined(HAVE_FFSLL) || defined(__bgp__))
+ /* find the first set bit in long long */
+ 
+ int ffsll(long long lli)
+diff -rupNwB papi400t/src/libpfm-3.y/lib/pfmlib_intel_nhm.c papi400b/src/libpfm-3.y/lib/pfmlib_intel_nhm.c
+--- papi400t/src/libpfm-3.y/lib/pfmlib_intel_nhm.c	2010-01-12 22:29:51.000000000 -0500
++++ papi400b/src/libpfm-3.y/lib/pfmlib_intel_nhm.c	2010-02-11 09:21:29.000000000 -0500
+@@ -172,6 +172,9 @@ pfm_nhm_detect(void)
+ 	switch(cpu_model) {
+ 		case 26: /* Nehalem Core i7 */
+ 		case 30: /* Nehalem Core i5 */
++	        case 37:
++	        case 44:
++                case 46:
+ 			  break;
+ 		default:
+ 			return PFMLIB_ERR_NOTSUPP;
+@@ -238,6 +241,9 @@ pfm_nhm_init(void)
+ 	switch(cpu_model) {
+ 	case 26:
+ 	case 30:
++	case 37:
++	case 44:
++        case 46:
+ 		num_pe = PME_COREI7_EVENT_COUNT;
+ 		num_unc_pe = PME_COREI7_UNC_EVENT_COUNT;
+ 		pe = corei7_pe;
+diff -rupNwB papi400t/src/papi.c papi400b/src/papi.c
+--- papi400t/src/papi.c	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/papi.c	2010-04-28 22:32:15.000000000 -0400
+@@ -4,7 +4,7 @@
+ 
+ /* 
+ * File:    papi.c
+-* CVS:     $Id: papi.c,v 1.337 2009/12/18 20:24:24 terpstra Exp $
++* CVS:     $Id: papi.c,v 1.337.2.2 2010/04/29 02:32:15 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    dan terpstra
+@@ -1050,7 +1050,7 @@ int PAPI_reset(int EventSet)
+ 
+       }
+    } else {
+-#ifdef _BGP
++#ifdef __bgp__
+    //  For BG/P, we always want to reset the 'real' hardware counters.  The counters
+    //  can be controlled via multiple interfaces, and we need to ensure that the values
+    //  are truly zero...
+@@ -1349,13 +1349,10 @@ int PAPI_set_multiplex(int EventSet)
+    if (ESI == NULL)
+       papi_return(PAPI_ENOEVST);
+ 
+-   /* if the eventset has no index and no events, return OK
+-      otherwise return NOCMP */
++   /* if the eventset has no index return NOCMP */
+    cidx = valid_ESI_component(ESI);
+-   if (cidx < 0) {
+-       if (ESI->NumberOfEvents) papi_return(cidx);
+-       papi_return(PAPI_OK);
+-   }
++   if (cidx < 0) papi_return(cidx);
++
+    if ((ret = mpx_check(EventSet)) != PAPI_OK)
+ 	papi_return(ret);
+ 
+diff -rupNwB papi400t/src/papi_data.c papi400b/src/papi_data.c
+--- papi400t/src/papi_data.c	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/papi_data.c	2010-04-28 22:32:15.000000000 -0400
+@@ -4,7 +4,7 @@
+ 
+ /* 
+ * File:    papi_data.c
+-* CVS:     $Id: papi_data.c,v 1.35 2009/12/18 20:24:24 terpstra Exp $
++* CVS:     $Id: papi_data.c,v 1.35.2.1 2010/04/29 02:32:15 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    dan terpstra
+@@ -178,7 +178,7 @@ const hwi_preset_info_t _papi_hwi_preset
+    /*109*/ {"PAPI_BGL_TS_FULL", "Torus no token UPC cycles", "BGL special event: Torus no token UPC cycles"}, 
+    /*110*/ {"PAPI_BGL_TR_DPKT", "Tree 256 byte packets", "BGL special event: Tree 256 byte packets"},
+    /*111*/ {"PAPI_BGL_TR_FULL", "UPC cycles (CLOCKx2) tree rcv is full", "BGL special event: UPC cycles (CLOCKx2) tree rcv is full"},
+-#elif defined (_BGP)
++#elif defined (__bgp__)
+    /*107*/ {"PAPI_BGL_TS_32B", "Torus 32B chunks sent", "BGL special event: Torus 32B chunks sent"},
+    /*108*/ {"PAPI_BGL_TR_DPKT", "Tree 256 byte packets", "BGL special event: Tree 256 byte packets"},
+    /*109*/ {NULL, NULL, NULL},
+@@ -324,7 +324,7 @@ const unsigned int _papi_hwi_preset_type
+    /*109: PAPI_BGL_TS_FULL */  PAPI_PRESET_BIT_MSC, 
+    /*110: PAPI_BGL_TR_DPKT */  PAPI_PRESET_BIT_MSC,
+    /*111: PAPI_BGL_TR_FULL */  PAPI_PRESET_BIT_MSC,
+-#elif defined (_BGP)
++#elif defined (__bgp__)
+    /*107: PAPI_BGL_TS_32B */  PAPI_PRESET_BIT_MSC,
+    /*108: PAPI_BGL_TR_DPKT */  PAPI_PRESET_BIT_MSC,
+    /*109*/ 0,
+diff -rupNwB papi400t/src/papi_events.csv papi400b/src/papi_events.csv
+--- papi400t/src/papi_events.csv	2010-01-15 18:36:00.000000000 -0500
++++ papi400b/src/papi_events.csv	2010-04-28 22:32:15.000000000 -0400
+@@ -103,9 +103,29 @@ PRESET,PAPI_FUL_ICY,NOT_DERIVED,CPU_INSD
+ PRESET,PAPI_L2_TCM,NOT_DERIVED,CPU_L2MISSALL
+ PRESET,PAPI_L2_TCA,NOT_DERIVED,CPU_L2REQ
+ #
++CPU,AMD64 (K7)
++PRESET,PAPI_L1_ICM,NOT_DERIVED,INSTRUCTION_CACHE_MISSES
++PRESET,PAPI_L1_ICA,NOT_DERIVED,INSTRUCTION_CACHE_FETCHES
++PRESET,PAPI_L1_ICR,NOT_DERIVED,INSTRUCTION_CACHE_FETCHES
++PRESET,PAPI_L1_DCM,NOT_DERIVED,DATA_CACHE_MISSES
++PRESET,PAPI_L1_DCA,NOT_DERIVED,DATA_CACHE_ACCESSES
++PRESET,PAPI_L1_DCH,DERIVED_SUB,DATA_CACHE_ACCESSES,DATA_CACHE_MISSES
++PRESET,PAPI_L1_TCA,DERIVED_ADD,DATA_CACHE_ACCESSES,INSTRUCTION_CACHE_FETCHES
++PRESET,PAPI_L1_TCM,DERIVED_ADD,INSTRUCTION_CACHE_MISSES,DATA_CACHE_MISSES
++PRESET,PAPI_L1_TCH,DERIVED_POSTFIX,N0|N1|+|N2|-|N3|-|,DATA_CACHE_ACCESSES,INSTRUCTION_CACHE_FETCHES,DATA_CACHE_MISSES,INSTRUCTION_CACHE_MISSES
++#
++PRESET,PAPI_TLB_DM,NOT_DERIVED,L1_DTLB_AND_L2_DTLB_MISS
++PRESET,PAPI_TLB_IM,NOT_DERIVED,L1_ITLB_MISS_AND_L2_ITLB_MISS
++PRESET,PAPI_TLB_TL,DERIVED_ADD,L1_DTLB_AND_L2_DTLB_MISS,L1_ITLB_MISS_AND_L2_ITLB_MISS
++#
++PRESET,PAPI_BR_INS,NOT_DERIVED,RETIRED_BRANCH_INSTRUCTIONS
++PRESET,PAPI_BR_TKN,NOT_DERIVED,RETIRED_TAKEN_BRANCH_INSTRUCTIONS
++PRESET,PAPI_BR_MSP,NOT_DERIVED,RETIRED_MISPREDICTED_BRANCH_INSTRUCTIONS
++#
++PRESET,PAPI_HW_INT,NOT_DERIVED,INTERRUPTS_TAKEN
++#
+ CPU,AMD64
+ CPU,AMD64 (unknown model)
+-CPU,AMD64 (K7)
+ CPU,AMD64 (K8 RevB)
+ CPU,AMD64 (K8 RevC)
+ CPU,AMD64 (K8 RevD)
+@@ -299,7 +319,7 @@ CPU,Intel Nehalem
+ PRESET,PAPI_L1_ICM,NOT_DERIVED,L1I:MISSES
+ PRESET,PAPI_L1_ICA,NOT_DERIVED,L1I:READS
+ PRESET,PAPI_L1_ICH,NOT_DERIVED,L1I:HITS
+-#PRESET,PAPI_L1_DCM,NOT_DERIVED,L1D_REPL
++PRESET,PAPI_L1_DCM,NOT_DERIVED,L1D:REPL
+ PRESET,PAPI_L1_DCA,NOT_DERIVED,L1D_ALL_REF:ANY
+ #PRESET,PAPI_L1_DCH,DERIVED_SUB,L1D_ALL_REF,L1D_REPL
+ #PRESET,PAPI_L1_TCM,NOT_DERIVED,L2_RQSTS:SELF:MESI
+@@ -1023,6 +1043,7 @@ PRESET,PAPI_L2_TCA,NOT_DERIVED,EC_REF
+ PRESET,PAPI_BR_MSP,NOT_DERIVED,DISPATCH0_MISPRED
+ PRESET,PAPI_L1_ICH,NOT_DERIVED,IC_HIT
+ PRESET,PAPI_L2_TCH,NOT_DERIVED,EC_HIT
++PRESET,PAPI_L2_TCM,DERIVED_SUB,EC_REF,EC_HIT
+ #
+ CPU,ultra3
+ CPU,ultra3i
+diff -rupNwB papi400t/src/papi.h papi400b/src/papi.h
+--- papi400t/src/papi.h	2010-01-13 10:40:49.000000000 -0500
++++ papi400b/src/papi.h	2010-04-28 22:32:15.000000000 -0400
+@@ -4,7 +4,7 @@
+ 
+ /* 
+ * File:    papi.h
+-* CVS:     $Id: papi.h,v 1.193 2010/01/13 15:40:49 terpstra Exp $
++* CVS:     $Id: papi.h,v 1.193.2.2 2010/04/29 02:32:15 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    dan terpstra
+@@ -36,8 +36,8 @@
+ #define PAPI_VERSION_INCREMENT(x)((x)          & 0xff)
+ 
+ /* This is the official PAPI version */
+-/* Big increment for PAPI-C technology pre-release */
+-#define PAPI_VERSION  			PAPI_VERSION_NUMBER(4,0,0,0)
++/* The final digit represents the patch count */
++#define PAPI_VERSION  			PAPI_VERSION_NUMBER(4,0,0,3)
+ #define PAPI_VER_CURRENT 		(PAPI_VERSION & 0xffff0000)
+ 
+ #ifdef __cplusplus
+@@ -646,7 +646,7 @@ read the documentation carefully.  */
+ */
+ /* MAX_TERMS is the current max value of MAX_COUNTER_TERMS as defined in SUBSTRATEs */
+ /* This definition also is HORRIBLE and should be replaced by a dynamic value. -pjm */
+-#ifdef _BGP
++#ifdef __bgp__
+ #define PAPI_MAX_INFO_TERMS  19 /* should match PAPI_MAX_COUNTER_TERMS defined in papi_internal.h */
+ #else
+ #define PAPI_MAX_INFO_TERMS 12
+diff -rupNwB papi400t/src/papi_internal.c papi400b/src/papi_internal.c
+--- papi400t/src/papi_internal.c	2010-01-13 13:39:05.000000000 -0500
++++ papi400b/src/papi_internal.c	2010-03-08 17:08:09.000000000 -0500
+@@ -4,7 +4,7 @@
+ 
+ /* 
+ * File:    papi_internal.c
+-* CVS:     $Id: papi_internal.c,v 1.138 2010/01/13 18:39:05 terpstra Exp $
++* CVS:     $Id: papi_internal.c,v 1.138.2.1 2010/03/08 22:08:09 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    dan terpstra
+@@ -580,6 +580,22 @@ static int add_native_fail_clean(EventSe
+    return -1;
+ }
+ 
++/* since update_control_state trashes overflow settings, this puts things
++   back into balance. */
++static int update_overflow(EventSetInfo_t * ESI)
++{
++	int i, retval = PAPI_OK;
++
++	if (ESI->overflow.flags & PAPI_OVERFLOW_HARDWARE) {
++		for (i=0; i<ESI->overflow.event_counter; i++) {
++			retval = _papi_hwd[ESI->CmpIdx]->set_overflow(ESI, 
++				ESI->overflow.EventIndex[i], ESI->overflow.threshold[i]);
++			if (retval != PAPI_OK) break;
++		}
++	}
++	return (retval);
++}
++
+ /* this function is called by _papi_hwi_add_event when adding native events 
+ nix: pointer to array of native event table indexes from the preset entry
+ size: number of native events to add
+@@ -771,6 +787,8 @@ int _papi_hwi_add_event(EventSetInfo_t *
+ 
+    /* Bump the number of events */
+    ESI->NumberOfEvents++;
++	/* reinstate the overflows if any */
++	update_overflow( ESI );
+ 
+    return (retval);
+ }
+@@ -875,14 +893,14 @@ int remove_native_events(EventSetInfo_t 
+    /* If we removed any elements, 
+       clear the now empty slots, reinitialize the index, and update the count.
+       Then send the info down to the substrate to update the hwd control structure. */
++   retval = PAPI_OK;
+    if (zero) {
+       retval = _papi_hwd[ESI->CmpIdx]->update_control_state(ESI->ctl_state, native, ESI->NativeCount,
+ 		ESI->master->context[ESI->CmpIdx]);
+-      if (retval != PAPI_OK)
+-         return (retval);
++      if (retval == PAPI_OK)
++         retval = update_overflow(ESI);
+    }
+-
+-   return (PAPI_OK);
++   return (retval);
+ }
+ 
+ int _papi_hwi_remove_event(EventSetInfo_t * ESI, int EventCode)
+diff -rupNwB papi400t/src/papi_internal.h papi400b/src/papi_internal.h
+--- papi400t/src/papi_internal.h	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/papi_internal.h	2010-04-28 22:32:15.000000000 -0400
+@@ -4,7 +4,7 @@
+ 
+ /* 
+ * File:    papi_internal.h
+-* CVS:     $Id: papi_internal.h,v 1.181 2009/12/18 20:24:24 terpstra Exp $
++* CVS:     $Id: papi_internal.h,v 1.181.2.1 2010/04/29 02:32:15 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    dan terpstra
+@@ -166,7 +166,7 @@ extern int papi_num_components;
+     Now it's defined globally as 8 for everything. Mainly applies to max terms in
+     derived events.
+ */
+-#ifdef _BGP
++#ifdef __bgp__
+ #define PAPI_MAX_COUNTER_TERMS	19
+ #else
+ #define PAPI_MAX_COUNTER_TERMS	8
+diff -rupNwB papi400t/src/papi_preset.h papi400b/src/papi_preset.h
+--- papi400t/src/papi_preset.h	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/papi_preset.h	2010-04-28 22:32:15.000000000 -0400
+@@ -22,7 +22,7 @@ typedef struct hwi_preset_data {  /* pre
+    unsigned int mask;
+    unsigned int count; */
+    int native[PAPI_MAX_COUNTER_TERMS];    /* array of native event code(s) for this preset event */
+-#ifdef _BGP
++#ifdef __bgp__
+    char operation[PAPI_2MAX_STR_LEN]; /* operation string: +,-,*,/,@(number of metrics), $(constant Mhz), %(1000000.0) */
+ #else
+    char operation[PAPI_MIN_STR_LEN]; /* operation string: +,-,*,/,@(number of metrics), $(constant Mhz), %(1000000.0) */
+diff -rupNwB papi400t/src/papi_protos.h papi400b/src/papi_protos.h
+--- papi400t/src/papi_protos.h	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/papi_protos.h	2010-04-28 22:32:15.000000000 -0400
+@@ -7,7 +7,7 @@
+ 
+ /* 
+ * File:    papi_protos.h
+-* CVS:     $Id: papi_protos.h,v 1.69 2009/12/18 20:24:24 terpstra Exp $
++* CVS:     $Id: papi_protos.h,v 1.69.2.1 2010/04/29 02:32:15 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    Haihang You
+@@ -229,7 +229,7 @@ void _papi_hwd_dispatch_timer(int signal
+ /* papi_internal.c global papi error function */
+ void PAPIERROR(char *format, ...);
+ 
+-#if (!defined(HAVE_FFSLL) || defined(_BGP))
++#if (!defined(HAVE_FFSLL) || defined(__bgp__))
+  int ffsll(long long lli);
+ #endif
+ 
+diff -rupNwB papi400t/src/papiStdEventDefs.h papi400b/src/papiStdEventDefs.h
+--- papi400t/src/papiStdEventDefs.h	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/papiStdEventDefs.h	2010-04-28 22:32:15.000000000 -0400
+@@ -172,7 +172,7 @@ enum {
+    PAPI_BGL_TR_DPKT_idx, /*Tree 256 byte packets */
+    PAPI_BGL_TR_FULL_idx,  /*UPC cycles (CLOCKx2) tree rcv is full */
+ #endif
+-#ifdef _BGP
++#ifdef __bgp__
+  /* 0x67 */
+    PAPI_BGP_TS_32B_idx ,  /*Torus 32B chunks sent */
+    PAPI_BGP_TS_DPKT_idx , /*Torus data packets sent */
+@@ -296,7 +296,7 @@ enum {
+ #define PAPI_BGL_TR_FULL (PAPI_BGL_TR_FULL_idx | PAPI_PRESET_MASK)
+ #endif
+ 
+-#ifdef _BGP
++#ifdef __bgp__
+ #define PAPI_BGP_TS_32B (PAPI_BGP_TS_32B_idx | PAPI_PRESET_MASK)
+ #define PAPI_BGP_TS_DPKT (PAPI_BGP_TS_DPKT_idx | PAPI_PRESET_MASK)
+ #endif
+diff -rupNwB papi400t/src/papi_vector.c papi400b/src/papi_vector.c
+--- papi400t/src/papi_vector.c	2009-12-18 15:24:24.000000000 -0500
++++ papi400b/src/papi_vector.c	2010-04-28 22:32:15.000000000 -0400
+@@ -1,6 +1,6 @@
+ /*
+  * File:    linux.c
+- * CVS:     $Id: papi_vector.c,v 1.22 2009/12/18 20:24:24 terpstra Exp $
++ * CVS:     $Id: papi_vector.c,v 1.22.2.1 2010/04/29 02:32:15 terpstra Exp $
+  * Author:  Kevin London
+  *          london@cs.utk.edu
+  * Mods:    Haihang You
+@@ -88,7 +88,7 @@ long long vec_dummy_get_real_cycles (voi
+   return((long long)cyc);
+ }
+ 
+-#if ((defined _BGL) || (defined _BGP))
++#if ((defined _BGL) || (defined __bgp__))
+    #include <stdlib.h>
+    #include <sys/time.h>
+    #include <sys/resource.h>
+@@ -97,7 +97,7 @@ long long vec_dummy_get_real_cycles (voi
+ long long vec_dummy_get_virt_usec (const hwd_context_t *zero)
+ {
+   long long retval;
+-#if ((defined _BGL) || (defined _BGP))
++#if ((defined _BGL) || (defined __bgp__))
+       struct rusage ruse;
+       getrusage(RUSAGE_SELF, &ruse);
+       retval = (long long)(ruse.ru_utime.tv_sec * 1000000 + ruse.ru_utime.tv_usec);
+diff -rupNwB papi400t/src/perf_events.c papi400b/src/perf_events.c
+--- papi400t/src/perf_events.c	2010-01-14 10:48:00.000000000 -0500
++++ papi400b/src/perf_events.c	2010-01-27 17:26:42.000000000 -0500
+@@ -1,6 +1,6 @@
+ /*
+ * File:    perf_events.c
+-* CVS:     $Id: perf_events.c,v 1.18 2010/01/14 15:48:00 terpstra Exp $
++* CVS:     $Id: perf_events.c,v 1.18.2.1 2010/01/27 22:26:42 jagode Exp $
+ * Author:  Corey Ashford
+ *          cjashfor@us.ibm.com
+ *          - based upon perfmon.c written by -
+@@ -76,6 +76,7 @@ extern papi_vector_t _papi_pe_vector;
+ 
+ extern int _papi_pfm_setup_presets(char *name, int type);
+ extern int _papi_pfm_ntv_enum_events(unsigned int *EventCode, int modifier);
++extern int _papi_pfm_ntv_name_to_code(char *ntv_name, unsigned int *EventCode);
+ extern int _papi_pfm_ntv_code_to_name(unsigned int EventCode, char *ntv_name, int len);
+ extern int _papi_pfm_ntv_code_to_descr(unsigned int EventCode, char *ntv_descr, int len);
+ extern int _papi_pfm_ntv_code_to_bits(unsigned int EventCode, hwd_register_t *bits);
+@@ -2014,8 +2015,8 @@ int _papi_pe_init_substrate (int cidx)
+     }
+   SUBDBG ("pfm_get_num_events: %d\n", ncnt);
+   MY_VECTOR.cmp_info.num_native_events = ncnt;
+-  strcpy (MY_VECTOR.cmp_info.name, "$Id: perf_events.c,v 1.18 2010/01/14 15:48:00 terpstra Exp $");
+-  strcpy (MY_VECTOR.cmp_info.version, "$Revision: 1.18 $");
++  strcpy (MY_VECTOR.cmp_info.name, "$Id: perf_events.c,v 1.18.2.1 2010/01/27 22:26:42 jagode Exp $");
++  strcpy (MY_VECTOR.cmp_info.version, "$Revision: 1.18.2.1 $");
+   sprintf (buf, "%08x", version);
+ 
+   pfm_get_num_counters ((unsigned int *) &MY_VECTOR.cmp_info.num_cntrs);
+@@ -3383,6 +3384,7 @@ papi_vector_t _papi_pe_vector = {
+     .allocate_registers =	_papi_pe_allocate_registers,
+     .write =	_papi_pe_write,
+     .ntv_enum_events =	_papi_pfm_ntv_enum_events,
++	.ntv_name_to_code = _papi_pfm_ntv_name_to_code,
+     .ntv_code_to_name =	_papi_pfm_ntv_code_to_name,
+     .ntv_code_to_descr =	_papi_pfm_ntv_code_to_descr,
+     .ntv_code_to_bits =	_papi_pfm_ntv_code_to_bits,
+diff -rupNwB papi400t/src/perfmon.c papi400b/src/perfmon.c
+--- papi400t/src/perfmon.c	2009-11-17 23:37:42.000000000 -0500
++++ papi400b/src/perfmon.c	2010-01-27 17:26:42.000000000 -0500
+@@ -1,6 +1,6 @@
+ /*
+ * File:    perfmon.c
+-* CVS:     $Id: perfmon.c,v 1.97 2009/11/18 04:37:42 mucci Exp $
++* CVS:     $Id: perfmon.c,v 1.97.4.1 2010/01/27 22:26:42 jagode Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    Brian Sheely
+@@ -42,6 +42,7 @@ extern int get_cpu_info(PAPI_hw_info_t *
+ extern papi_vector_t _papi_pfm_vector;
+ extern int _papi_pfm_setup_presets(char *name, int type);
+ extern int _papi_pfm_ntv_enum_events(unsigned int *EventCode, int modifier);
++extern int _papi_pfm_ntv_name_to_code(char *ntv_name, unsigned int *EventCode);
+ extern int _papi_pfm_ntv_code_to_name(unsigned int EventCode, char *ntv_name, int len);
+ extern int _papi_pfm_ntv_code_to_descr(unsigned int EventCode, char *ntv_descr, int len);
+ extern int _papi_pfm_ntv_code_to_bits(unsigned int EventCode, hwd_register_t *bits);
+@@ -2216,8 +2217,8 @@ int _papi_pfm_init_substrate(int cidx)
+     }
+   SUBDBG("pfm_get_num_events: %d\n", ncnt);
+   MY_VECTOR.cmp_info.num_native_events = ncnt;
+-  strcpy(MY_VECTOR.cmp_info.name, "$Id: perfmon.c,v 1.97 2009/11/18 04:37:42 mucci Exp $");          
+-  strcpy(MY_VECTOR.cmp_info.version, "$Revision: 1.97 $");  
++  strcpy(MY_VECTOR.cmp_info.name, "$Id: perfmon.c,v 1.97.4.1 2010/01/27 22:26:42 jagode Exp $");          
++  strcpy(MY_VECTOR.cmp_info.version, "$Revision: 1.97.4.1 $");  
+   sprintf(buf,"%08x",version);
+ 
+   pfm_get_num_counters((unsigned int *)&MY_VECTOR.cmp_info.num_cntrs);
+@@ -3764,6 +3765,7 @@ papi_vector_t _papi_pfm_vector = {
+     .allocate_registers =	_papi_pfm_allocate_registers,
+     .write =	_papi_pfm_write,
+     .ntv_enum_events =	_papi_pfm_ntv_enum_events,
++	.ntv_name_to_code = _papi_pfm_ntv_name_to_code,
+     .ntv_code_to_name =	_papi_pfm_ntv_code_to_name,
+     .ntv_code_to_descr =	_papi_pfm_ntv_code_to_descr,
+     .ntv_code_to_bits =	_papi_pfm_ntv_code_to_bits,
+diff -rupNwB papi400t/src/solaris-memory.c papi400b/src/solaris-memory.c
+--- papi400t/src/solaris-memory.c	2006-11-16 19:39:20.000000000 -0500
++++ papi400b/src/solaris-memory.c	2010-04-28 22:32:15.000000000 -0400
+@@ -5,24 +5,111 @@
+ *
+ * Mods:    Philip J. Mucci
+ *          mucci@cs.utk.edu
++*
++* Mods:    Vince Weaver
++*          vweaver1@eecs.utk.edu
+ */
+ 
+ #include "papi.h"
+ #include "papi_internal.h"
+ 
+-int get_memory_info(PAPI_hw_info_t * mem_info)
++
++int
++_solaris_get_memory_info( PAPI_hw_info_t * hw, int id )
+ {
++        FILE *pipe;
++        char line[BUFSIZ];
++
++	PAPI_mh_level_t *mem = hw->mem_hierarchy.level;
++
++	pipe=popen("prtconf -pv","r");
++        if (pipe==NULL) {
++	   return PAPI_ESYS;
++	}
++
++	while(1) {
++
++	   if (fgets(line,BUFSIZ,pipe)==NULL) break;
++
++           if (strstr(line,"icache-size:")) {
++	      sscanf(line,"%*s %x",&mem[0].cache[0].size);
++	   }
++           if (strstr(line,"icache-line-size:")) {
++	      sscanf(line,"%*s %x",&mem[0].cache[0].line_size);
++	   }
++           if (strstr(line,"icache-associativity:")) {
++	      sscanf(line,"%*s %x",&mem[0].cache[0].associativity);
++	   }
++
++           if (strstr(line,"dcache-size:")) {
++	      sscanf(line,"%*s %x",&mem[0].cache[1].size);
++	   }
++           if (strstr(line,"dcache-line-size:")) {
++	      sscanf(line,"%*s %x",&mem[0].cache[1].line_size);
++	   }
++           if (strstr(line,"dcache-associativity:")) {
++	      sscanf(line,"%*s %x",&mem[0].cache[1].associativity);
++	   }
++
++           if (strstr(line,"ecache-size:")) {
++	      sscanf(line,"%*s %x",&mem[1].cache[0].size);
++	   }
++           if (strstr(line,"ecache-line-size:")) {
++	      sscanf(line,"%*s %x",&mem[1].cache[0].line_size);
++	   }
++           if (strstr(line,"ecache-associativity:")) {
++	      sscanf(line,"%*s %x",&mem[1].cache[0].associativity);
++	   }
++
++           if (strstr(line,"#itlb-entries:")) {
++	      sscanf(line,"%*s %x",&mem[0].tlb[0].num_entries);
++	   }
++           if (strstr(line,"#dtlb-entries:")) {
++	      sscanf(line,"%*s %x",&mem[0].tlb[1].num_entries);
++	   }
++
++	}
++       
++
++        pclose(pipe);
++
++	/* I-Cache -> L1$ instruction */
++	mem[0].cache[0].type = PAPI_MH_TYPE_INST;
++	if (mem[0].cache[0].line_size!=0) mem[0].cache[0].num_lines =
++		mem[0].cache[0].size / mem[0].cache[0].line_size;
++
++	/* D-Cache -> L1$ data */
++	mem[0].cache[1].type =
++		PAPI_MH_TYPE_DATA | PAPI_MH_TYPE_WT | PAPI_MH_TYPE_LRU;
++	if (mem[0].cache[1].line_size!=0) mem[0].cache[1].num_lines =
++		mem[0].cache[1].size / mem[0].cache[1].line_size;
++
++
++	/* ITLB -> TLB instruction */
++	mem[0].tlb[0].type = PAPI_MH_TYPE_INST | PAPI_MH_TYPE_PSEUDO_LRU;
++        /* assume fully associative */
++	mem[0].tlb[0].associativity = mem[0].tlb[0].num_entries;
++
++	/* DTLB -> TLB data */
++	mem[0].tlb[1].type = PAPI_MH_TYPE_DATA | PAPI_MH_TYPE_PSEUDO_LRU;
++        /* assume fully associative */
++	mem[0].tlb[1].associativity = mem[0].tlb[1].num_entries;
++
++	/* L2$ unified */
++	mem[1].cache[0].type = PAPI_MH_TYPE_UNIFIED | PAPI_MH_TYPE_WB
++		| PAPI_MH_TYPE_PSEUDO_LRU;
++	if (mem[1].cache[0].line_size!=0) mem[1].cache[0].num_lines =
++		mem[1].cache[0].size / mem[1].cache[0].line_size;
++
++	/* Indicate we have two levels filled in the hierarchy */
++	hw->mem_hierarchy.levels = 2;
++
+    return PAPI_OK;
+ }
+ 
+-int _papi_hwd_get_dmem_info(PAPI_dmem_info_t *d)
++int
++_solaris_get_dmem_info( PAPI_dmem_info_t * d )
+ {
+-	/* This function has been reimplemented 
+-		to conform to current interface.
+-		It has not been tested.
+-		Nor has it been confirmed for completeness.
+-		dkt 05-10-06
+-	*/
+ 
+    FILE *fd;
+    struct psinfo psi;
+@@ -35,8 +122,8 @@ int _papi_hwd_get_dmem_info(PAPI_dmem_in
+    fread((void *) &psi, sizeof(struct psinfo), 1, fd);
+    fclose(fd);
+ 
+-   d->pagesize = getpagesize();
+-   d->size = ((1024 * psi.pr_rssize) / d->pagesize);
++	d->pagesize = sysconf( _SC_PAGESIZE );
++	d->size = d->pagesize * sysconf( _SC_PHYS_PAGES );
+    d->resident = ((1024 * psi.pr_size) / d->pagesize);
+    d->high_water_mark = PAPI_EINVAL;
+    d->shared = PAPI_EINVAL;
+@@ -48,30 +135,4 @@ int _papi_hwd_get_dmem_info(PAPI_dmem_in
+ 
+    return (PAPI_OK);
+ 
+-/*  Depending on OS we may need this, so going to leave
+- *  the code here for now. -KSL
+-   pid_t pid = getpid();
+-   psinfo_t info;
+-   char pfile[256];
+-   long pgsz=getpagesize();
+-   int fd;
+-
+-   sprintf(pfile, "/proc/%05d", pid);
+-   if((fd=open(pfile,O_RDONLY)) <0 ) {
+-        SUBDBG((stderr,"PAPI_get_dmem_info can't open /proc/%d\n",pid));
+-        return(PAPI_ESYS);
+-   }
+-   if(ioctl(fd, PIOCPSINFO,  &info)<0){
+-        return(PAPI_ESYS);
+-   }
+-   close(fd);
+- switch(option){
+-   case PAPI_GET_RESSIZE:
+-        return(((1024*info.pr_rssize)/pgsz));
+-   case PAPI_GET_SIZE:
+-        return(((1024*info.pr_size)/pgsz));
+-   default:
+-        return(PAPI_EINVAL);
+-  }
+-  */
+ }
+diff -rupNwB papi400t/src/solaris-ultra.c papi400b/src/solaris-ultra.c
+--- papi400t/src/solaris-ultra.c	2009-11-23 14:24:42.000000000 -0500
++++ papi400b/src/solaris-ultra.c	2010-04-28 22:32:15.000000000 -0400
+@@ -1,6 +1,6 @@
+ /* 
+ * File:    solaris-ultra.c
+-* CVS:     $Id: solaris-ultra.c,v 1.125 2009/11/23 19:24:42 bsheely Exp $
++* CVS:     $Id: solaris-ultra.c,v 1.125.4.1 2010/04/29 02:32:15 terpstra Exp $
+ * Author:  Philip Mucci
+ *          mucci@cs.utk.edu
+ * Mods:    Kevin London
+@@ -10,7 +10,8 @@
+ * Mods:    Larry Meadows(helped us to build the native table dynamically) 
+ * Mods:    Brian Sheely
+ *          bsheely@eecs.utk.edu 
+-*              
++* Mods:    Vince Weaver
++*          vweaver1@eecs.utk.edu 
+ */
+ 
+ /* to understand this program, first you should read the user's manual
+@@ -34,13 +35,15 @@
+ static void action(void *arg, int regno, const char *name, uint8_t bits);
+ 
+ /* Probably could dispense with this and just use native_table */
+-typedef struct ctr_info {
++typedef struct ctr_info
++{
+     char *name;	/* Counter name */
+     int bits[2];	/* bits for register */
+     int bitmask; /* 1 = pic0; 2 = pic1; 3 = both */
+ } ctr_info_t;
+ 
+-typedef struct einfo {
++typedef struct einfo
++{
+     unsigned int papi_event;
+     char *event_str;
+ } einfo_t;
+@@ -91,6 +94,8 @@ static einfo_t us2info[] = {
+    {PAPI_L2_TCA, "EC_ref"},
+ };
+ 
++papi_vector_t _solaris_vector;
++
+ static native_info_t *native_table;
+ static hwi_search_t *preset_table;
+ 
+@@ -106,22 +111,26 @@ static int cpuver;
+ static int pcr_shift[2];
+ 
+ extern papi_mdi_t _papi_hwi_system_info;
++extern int _solaris_get_memory_info( PAPI_hw_info_t * hw, int id );
++extern int _solaris_get_dmem_info( PAPI_dmem_info_t * d );
+ 
+ hwi_search_t *preset_search_map;
+-/*static native_info_t *native_table;*/
+ 
+ #ifdef DEBUG
+-static void dump_cmd(papi_cpc_event_t * t)
++static void
++dump_cmd( papi_cpc_event_t * t )
+ {
+    SUBDBG("cpc_event_t.ce_cpuver %d\n", t->cmd.ce_cpuver);
+    SUBDBG("ce_tick %llu\n", t->cmd.ce_tick);
+-   SUBDBG("ce_pic[0] %llu ce_pic[1] %llu\n", t->cmd.ce_pic[0], t->cmd.ce_pic[1]);
++	SUBDBG( "ce_pic[0] %llu ce_pic[1] %llu\n", t->cmd.ce_pic[0],
++			t->cmd.ce_pic[1] );
+    SUBDBG("ce_pcr 0x%llx\n", t->cmd.ce_pcr);
+    SUBDBG("flags %x\n", t->flags);
+ }
+ #endif
+ 
+-static void dispatch_emt(int signal, siginfo_t * sip, void *arg)
++static void
++dispatch_emt( int signal, siginfo_t * sip, void *arg )
+ {
+    int event_counter;
+    _papi_hwi_context_t ctx;
+@@ -140,15 +149,15 @@ static void dispatch_emt(int signal, sig
+       ESI = (EventSetInfo_t *) thread->running_eventset;
+       int cidx = ESI->CmpIdx;
+ 
+-      if ((ESI == NULL) || ((ESI->state & PAPI_OVERFLOWING) == 0))
+-	{
++		if ( ( ESI == NULL ) || ( ( ESI->state & PAPI_OVERFLOWING ) == 0 ) ) {
+ 	  OVFDBG("Either no eventset or eventset not set to overflow.\n");
+ 	  return;
+ 	}
+ 
+-      if (ESI->master != thread)
+-	{
+-	  PAPIERROR("eventset->thread 0x%lx vs. current thread 0x%lx mismatch",ESI->master,thread);
++		if ( ESI->master != thread ) {
++			PAPIERROR
++				( "eventset->thread 0x%lx vs. current thread 0x%lx mismatch",
++				  ESI->master, thread );
+ 	  return;
+ 	}
+ 
+@@ -187,9 +196,11 @@ static void dispatch_emt(int signal, sig
+             overflow_vector = 1;
+             /* reset the threshold */
+             if (t == 0)
+-               sample->cmd.ce_pic[0] = UINT64_MAX - ESI->overflow.threshold[0];
++					sample->cmd.ce_pic[0] =
++						UINT64_MAX - ESI->overflow.threshold[0];
+             else
+-               sample->cmd.ce_pic[0] = UINT64_MAX - ESI->overflow.threshold[1];
++					sample->cmd.ce_pic[0] =
++						UINT64_MAX - ESI->overflow.threshold[1];
+          }
+          readvalue = sample->cmd.ce_pic[1];
+          if (readvalue >= 0) {
+@@ -199,25 +210,28 @@ static void dispatch_emt(int signal, sig
+             overflow_vector ^= 1 << 1;
+             /* reset the threshold */
+             if (t == 0)
+-               sample->cmd.ce_pic[1] = UINT64_MAX - ESI->overflow.threshold[1];
++					sample->cmd.ce_pic[1] =
++						UINT64_MAX - ESI->overflow.threshold[1];
+             else
+-               sample->cmd.ce_pic[1] = UINT64_MAX - ESI->overflow.threshold[0];
++					sample->cmd.ce_pic[1] =
++						UINT64_MAX - ESI->overflow.threshold[0];
+          }
+          SUBDBG("overflow_vector, = %d\n", overflow_vector);
+          /* something is wrong here */
+-         if (overflow_vector == 0)
+-	   {
++			if ( overflow_vector == 0 ) {
+ 	     PAPIERROR("BUG! overflow_vector is 0, dropping interrupt");
+ 	     return;
+ 	   }
+       }
+ 
+       /* Call the regular overflow function in extras.c */
+-      if (thread->running_eventset[cidx]->overflow.flags & PAPI_OVERFLOW_FORCE_SW) {
++		if ( thread->running_eventset[cidx]->overflow.
++			 flags & PAPI_OVERFLOW_FORCE_SW ) {
+ 	//address = GET_OVERFLOW_ADDRESS(ctx);
+-         _papi_hwi_dispatch_overflow_signal((void*)&ctx, address, NULL, overflow_vector, 0, &thread, cidx);
+-      }
+-      else {
++			_papi_hwi_dispatch_overflow_signal( ( void * ) &ctx, address, NULL,
++												overflow_vector, 0, &thread,
++												cidx );
++		} else {
+ 	PAPIERROR("Additional implementation needed in dispatch_emt!");
+       }
+ 
+@@ -233,7 +247,8 @@ static void dispatch_emt(int signal, sig
+    }
+ }
+ 
+-static int scan_prtconf(char *cpuname, int len_cpuname, int *hz, int *ver)
++static int
++scan_prtconf( char *cpuname, int len_cpuname, int *hz, int *ver )
+ {
+    /* This code courtesy of our friends in Germany. Thanks Rudolph Berrendorf! */
+    /* See the PCL home page for the German version of PAPI. */
+@@ -290,7 +305,8 @@ static int scan_prtconf(char *cpuname, i
+                     (sscanf(line, "%s %x", cmd, &ihz) == 2)) {
+             matched |= 0x4;
+             SUBDBG("Found ihz=%d. (0x%2.2x)\n", ihz,matched);
+-         } else if (!strcmp(cmd, "name:") && (sscanf(line, "%s %s", cmd, name) == 2)) {
++			} else if ( !strcmp( cmd, "name:" ) &&
++						( sscanf( line, "%s %s", cmd, name ) == 2 ) ) {
+             matched |= 0x8;
+             SUBDBG("Found name: %s. (0x%2.2x)\n", name,matched); 
+          }
+@@ -298,7 +314,8 @@ static int scan_prtconf(char *cpuname, i
+       if ((matched & 0xF) == 0xF)
+          break;
+    }
+-   SUBDBG("Parsing found name=%s, speed=%dHz, version=%d\n", name, ihz, version);
++	SUBDBG( "Parsing found name=%s, speed=%dHz, version=%d\n", name, ihz,
++			version );
+ 
+    if (matched ^ 0x0F)
+       ihz = -1;
+@@ -313,7 +330,8 @@ static int scan_prtconf(char *cpuname, i
+    /* End stolen code */
+ }
+ 
+-static int set_domain(hwd_control_state_t * this_state, int domain)
++static int
++set_domain( hwd_control_state_t * this_state, int domain )
+ {
+    papi_cpc_event_t *command = &this_state->counter_cmd;
+    cpc_event_t *event = &command->cmd;
+@@ -339,7 +357,8 @@ static int set_domain(hwd_control_state_
+    return (PAPI_OK);
+ }
+ 
+-static int set_granularity(hwd_control_state_t * this_state, int domain)
++static int
++set_granularity( hwd_control_state_t * this_state, int domain )
+ {
+    switch (domain) {
+    case PAPI_GRN_PROCG:
+@@ -358,12 +377,14 @@ static int set_granularity(hwd_control_s
+ /* Utility functions */
+ 
+ /* This is a wrapper arount fprintf(stderr,...) for cpc_walk_events() */
+-void print_walk_names(void *arg, int regno, const char *name, uint8_t bits)
++void
++print_walk_names( void *arg, int regno, const char *name, uint8_t bits )
+ {
+    SUBDBG(arg, regno, name, bits);
+ }
+ 
+-static int get_system_info(void)
++static int
++get_system_info( void )
+ {
+    int retval;
+    pid_t pid;
+@@ -403,7 +424,8 @@ static int get_system_info(void)
+ 
+          for (i = 0; i < cpc_getnpic(cpuver); i++) {
+ 	   SUBDBG("\n%6s %-40s %8s\n", "Reg", "Symbolic name", "Code");
+-            cpc_walk_names(cpuver, i, "%6d %-40s %02x\n", print_walk_names);
++				cpc_walk_names( cpuver, i, "%6d %-40s %02x\n",
++								print_walk_names );
+          }
+          SUBDBG("\n");
+       }
+@@ -416,11 +438,6 @@ static int get_system_info(void)
+    if ((retval = build_tables()) != PAPI_OK)
+       return retval;
+ 
+-   ThreadInfo_t *thread = _papi_hwi_lookup_thread();
+-   EventSetInfo_t *ESI = (EventSetInfo_t *)thread->running_eventset;
+-
+-   /****** NOTE: The use of _papi_hwd[ESI->CmpIdx] in the following code may not be the correct implementation *****/
+-
+    preset_search_map = preset_table;
+    if (cpuver <= CPC_ULTRA2) {
+       SUBDBG("cpuver (==%d) <= CPC_ULTRA2 (==%d)\n", cpuver, CPC_ULTRA2);
+@@ -430,8 +447,8 @@ static int get_system_info(void)
+       SUBDBG("cpuver (==%d) <= CPC_ULTRA3x (==%d)\n", cpuver, LASTULTRA3);
+       pcr_shift[0] = CPC_ULTRA_PCR_PIC0_SHIFT;
+       pcr_shift[1] = CPC_ULTRA_PCR_PIC1_SHIFT;
+-      _papi_hwd[ESI->CmpIdx]->cmp_info.hardware_intr = 1;
+-      _papi_hwd[ESI->CmpIdx]->cmp_info.hardware_intr_sig = SIGEMT;
++		_solaris_vector.cmp_info.hardware_intr = 1;
++		_solaris_vector.cmp_info.hardware_intr_sig = SIGEMT;
+    } else
+       return (PAPI_ESBSTR);
+ 
+@@ -448,7 +465,8 @@ static int get_system_info(void)
+       return (PAPI_ESYS);
+    {
+       int retval;
+-      struct {
++		struct
++		{
+          long cmd;
+          long flags;
+       } cmd;
+@@ -478,18 +496,22 @@ static int get_system_info(void)
+    }
+ 
+    if (realpath(psi.pr_psargs,pname))
+-     strncpy(_papi_hwi_system_info.exe_info.fullname, pname, PAPI_HUGE_STR_LEN);
++		strncpy( _papi_hwi_system_info.exe_info.fullname, pname,
++				 PAPI_HUGE_STR_LEN );
+    else
+-     strncpy(_papi_hwi_system_info.exe_info.fullname, psi.pr_psargs, PAPI_HUGE_STR_LEN);
++		strncpy( _papi_hwi_system_info.exe_info.fullname, psi.pr_psargs,
++				 PAPI_HUGE_STR_LEN );
+ 
+    /* please don't use pr_fname here, because it can only store less that 
+       16 characters */
+-   strcpy(_papi_hwi_system_info.exe_info.address_info.name,basename(_papi_hwi_system_info.exe_info.fullname));
++	strcpy( _papi_hwi_system_info.exe_info.address_info.name,
++			basename( _papi_hwi_system_info.exe_info.fullname ) );
+ 
+-   SUBDBG("Full Executable is %s\n", _papi_hwi_system_info.exe_info.fullname);
++	SUBDBG( "Full Executable is %s\n",
++			_papi_hwi_system_info.exe_info.fullname );
+ 
+    /* Executable regions, reading /proc/pid/maps file */
+-   retval = _papi_hwd_update_shlib_info();
++	retval = _ultra_hwd_update_shlib_info(  );
+ 
+    /* Hardware info */
+ 
+@@ -501,7 +523,8 @@ static int get_system_info(void)
+    if (retval == -1)
+       return (PAPI_ESBSTR);
+ 
+-   strcpy(_papi_hwi_system_info.hw_info.model_string, cpc_getcciname(cpuver));
++	strcpy( _papi_hwi_system_info.hw_info.model_string,
++			cpc_getcciname( cpuver ) );
+    _papi_hwi_system_info.hw_info.model = cpuver;
+    strcpy(_papi_hwi_system_info.hw_info.vendor_string, "SUN");
+    _papi_hwi_system_info.hw_info.vendor = PAPI_VENDOR_SUN;
+@@ -516,11 +539,12 @@ static int get_system_info(void)
+    if (retval < 0)
+       return (PAPI_ESBSTR);
+ 
+-   _papi_hwd[ESI->CmpIdx]->cmp_info.num_cntrs = retval;
+-   _papi_hwd[ESI->CmpIdx]->cmp_info.fast_real_timer = 1;
+-   _papi_hwd[ESI->CmpIdx]->cmp_info.fast_virtual_timer = 1;
+-   _papi_hwd[ESI->CmpIdx]->cmp_info.default_domain = PAPI_DOM_USER;
+-   _papi_hwd[ESI->CmpIdx]->cmp_info.available_domains = PAPI_DOM_USER|PAPI_DOM_KERNEL;
++	_solaris_vector.cmp_info.num_cntrs = retval;
++	_solaris_vector.cmp_info.fast_real_timer = 1;
++	_solaris_vector.cmp_info.fast_virtual_timer = 1;
++	_solaris_vector.cmp_info.default_domain = PAPI_DOM_USER;
++	_solaris_vector.cmp_info.available_domains =
++		PAPI_DOM_USER | PAPI_DOM_KERNEL;
+ 
+    /* Setup presets */
+ 
+@@ -560,12 +583,13 @@ build_tables(void)
+     if (ISLEVEL(DEBUG_SUBSTRATE)) {
+     for (i = 0; i < nctrs; ++i) {
+ 	SUBDBG("%s: bits (%x,%x) pics %x\n", ctrs[i].name, ctrs[i].bits[0],
+-	    ctrs[i].bits[1],
+-	    ctrs[i].bitmask);
+-    } }
++					ctrs[i].bits[1], ctrs[i].bitmask );
++		}
++	}
+ #endif
+     /* Build the native event table */
+-    if ((native_table = papi_malloc(nctrs*sizeof(native_info_t))) == 0) {
++	if ( ( native_table =
++		   papi_malloc( nctrs * sizeof ( native_info_t ) ) ) == 0 ) {
+ 	papi_free(ctrs);
+ 	return PAPI_ENOMEM;
+     }
+@@ -587,12 +611,10 @@ build_tables(void)
+     if (cpuver <= CPC_ULTRA2) {
+ 	n = sizeof(us2info) / sizeof(einfo_t);
+ 	ep = us2info;
+-    }
+-    else if (cpuver <= LASTULTRA3) {
++	} else if ( cpuver <= LASTULTRA3 ) {
+ 	n = sizeof(us3info) / sizeof(einfo_t);
+ 	ep = us3info;
+-    }
+-    else
++	} else
+ 	return PAPI_ESBSTR;
+     preset_table = papi_malloc((n+1)*sizeof(hwi_search_t));
+     npresets = 0;
+@@ -615,8 +637,12 @@ build_tables(void)
+ 		preset_table[i].data.derived,
+ 		preset_table[i].data.native[0],
+ 		preset_table[i].data.native[1]);
+-    } }
++		}
++	}
+ #endif
++
++	_solaris_vector.cmp_info.num_native_events = nctrs;
++
+     return PAPI_OK;
+ }
+ 
+@@ -634,6 +660,8 @@ srch_event(char *e1)
+     return i;
+ }
+ 
++/* we should read from the CSV file and make this all unnecessary */
++
+ static void
+ add_preset(hwi_search_t *tab, int *np, einfo_t e)
+ {
+@@ -654,7 +682,8 @@ add_preset(hwi_search_t *tab, int *np, e
+      * native events, or the difference of two native events.
+      * This could be extended with a real parser (hint).
+      */
+-    while (isspace(*p)) ++p;
++	while ( isspace( *p ) )
++		++p;
+     q = p;
+     i = 0;
+     while (isalnum(*p) || (*p == '_')) {
+@@ -668,7 +697,8 @@ add_preset(hwi_search_t *tab, int *np, e
+ 	op = *p++;
+     else
+ 	op = 0;
+-    while (isspace(*p)) ++p;
++	while ( isspace( *p ) )
++		++p;
+     q = p;
+     i = 0;
+     while (isalnum(*p) || (*p == '_')) {
+@@ -690,7 +720,8 @@ add_preset(hwi_search_t *tab, int *np, e
+ 	tab[*np].data.derived = 0;
+ 	tab[*np].data.native[0] = PAPI_NATIVE_MASK | ne;
+ 	tab[*np].data.native[1] = PAPI_NULL;
+-	memset(tab[*np].data.operation, 0, sizeof(tab[*np].data.operation));
++		memset( tab[*np].data.operation, 0,
++				sizeof ( tab[*np].data.operation ) );
+ 	++*np;
+ 	return;
+     }
+@@ -702,6 +733,7 @@ add_preset(hwi_search_t *tab, int *np, e
+     tab[*np].data.derived = (op == '-') ? DERIVED_SUB : DERIVED_ADD;
+     tab[*np].data.native[0] = PAPI_NATIVE_MASK | ne;
+     tab[*np].data.native[1] = PAPI_NATIVE_MASK | ne2;
++	tab[*np].data.native[2] = PAPI_NULL;
+     memset(tab[*np].data.operation, 0, sizeof(tab[*np].data.operation));
+     ++*np;
+ }
+@@ -734,7 +766,8 @@ action(void *arg, int regno, const char 
+    inherit performance register information and propagate the values up
+    upon child exit and parent wait. */
+ 
+-static int set_inherit(EventSetInfo_t * global, int arg)
++static int
++set_inherit( EventSetInfo_t * global, int arg )
+ {
+    return (PAPI_ESBSTR);
+ 
+@@ -758,7 +791,8 @@ static int set_inherit(EventSetInfo_t * 
+ #endif
+ }
+ 
+-static int set_default_domain(hwd_control_state_t * ctrl_state, int domain)
++static int
++set_default_domain( hwd_control_state_t * ctrl_state, int domain )
+ {
+    /* This doesn't exist on this platform */
+ 
+@@ -768,80 +802,30 @@ static int set_default_domain(hwd_contro
+    return (set_domain(ctrl_state, domain));
+ }
+ 
+-static int set_default_granularity(hwd_control_state_t * current_state, int granularity)
++static int
++set_default_granularity( hwd_control_state_t * current_state, int granularity )
+ {
+    return (set_granularity(current_state, granularity));
+ }
+ 
+ rwlock_t lock[PAPI_MAX_LOCK];
+ 
+-static void lock_init(void)
++static void
++lock_init( void )
+ {
+   memset(lock,0x0,sizeof(rwlock_t)*PAPI_MAX_LOCK);
+ }
+ 
+-int _papi_hwd_shutdown_substrate(void)
++int
++_ultra_hwd_shutdown_substrate( void )
+ {
+    (void) cpc_rele();
+    return (PAPI_OK);
+ }
+ 
+-/* This implementation may not be correct */
+-papi_vector_t _solaris_vector = {
+-	.cmp_info = {
+-		/* default component information (unspecified values are initialized to 0) */
+-		.num_cntrs = MAX_COUNTERS, /* Number of counters the substrate supports */
+-		.num_mpx_cntrs = PAPI_MPX_DEF_DEG,
+-		.default_domain = PAPI_DOM_USER,
+-		.available_domains = PAPI_DOM_USER|PAPI_DOM_KERNEL,
+-		.default_granularity = PAPI_GRN_THR,
+-		.available_granularities = PAPI_GRN_THR,
+-		.hardware_intr_sig = PAPI_INT_SIGNAL,
+-
+-		/* component specific cmp_info initializations */
+-		.fast_real_timer = 1,
+-		.fast_virtual_timer = 1,
+-		.attach = 1,
+-		.attach_must_ptrace = 1,
+-	},
+-
+-	/* sizes of framework-opaque component-private structures */
+-	.size = {
+-		.context = sizeof(hwd_context_t),
+-		.control_state = sizeof(hwd_control_state_t),
+-		.reg_value = sizeof(hwd_register_t),
+-		.reg_alloc = sizeof(hwd_reg_alloc_t),
+-	},
+-
+-	/* function pointers in this component */
+-	.init_control_state = _papi_hwd_init_control_state,
+-	.start = _papi_hwd_start,
+-	.stop =	_papi_hwd_stop,
+-	.read =	_papi_hwd_read,
+-	.shutdown_substrate = _papi_hwd_shutdown_substrate,
+-	.ctl = _papi_hwd_ctl,
+-	.update_control_state =	_papi_hwd_update_control_state,
+-	.reset = _papi_hwd_reset,
+-	.set_overflow =	_papi_hwd_set_overflow,
+-	/*.stop_profiling = _papi_hwd_stop_profiling,*/
+-	.ntv_enum_events = _papi_hwd_ntv_enum_events,
+-	.ntv_code_to_name = _papi_hwd_ntv_code_to_name,
+-	.ntv_code_to_descr = _papi_hwd_ntv_code_to_descr,
+-	.ntv_code_to_bits = _papi_hwd_ntv_code_to_bits,
+-	.ntv_bits_to_info = _papi_hwd_ntv_bits_to_info,
+-	.init_substrate = _papi_hwd_init_substrate,
+-	.dispatch_timer = _papi_hwd_dispatch_timer,
+-	.get_real_usec = _papi_hwd_get_real_usec,
+-	.get_real_cycles = _papi_hwd_get_real_cycles,
+-	.get_virt_cycles = _papi_hwd_get_virt_cycles,
+-	.get_virt_usec = _papi_hwd_get_virt_usec,
+-
+-	/* OS dependent local routines */
+-	.update_shlib_info = _papi_hwd_update_shlib_info,
+-	.get_system_info = get_system_info
+-};
+ 
+-int _papi_hwd_init_substrate(int cidx)
++int
++_ultra_hwd_init_substrate( int cidx )
+ {
+    int retval;
+ 
+@@ -855,18 +839,28 @@ int _papi_hwd_init_substrate(int cidx)
+    if (retval)
+       return (retval);
+ 
++	/* Setup memory info */
++        retval =
++	  MY_VECTOR.get_memory_info( &_papi_hwi_system_info.hw_info,
++				     0 );
++        if ( retval )
++	  return ( retval );
++
++
+    lock_init();
+ 
+    SUBDBG("Found %d %s %s CPU's at %f Mhz.\n",
+           _papi_hwi_system_info.hw_info.totalcpus,
+           _papi_hwi_system_info.hw_info.vendor_string,
+-          _papi_hwi_system_info.hw_info.model_string, _papi_hwi_system_info.hw_info.mhz);
++			_papi_hwi_system_info.hw_info.model_string,
++			_papi_hwi_system_info.hw_info.mhz );
+ 
+    return (PAPI_OK);
+ }
+ 
+ /* reset the hardware counter */
+-int _papi_hwd_reset(hwd_context_t * ctx, hwd_control_state_t * ctrl)
++int
++_ultra_hwd_reset( hwd_context_t * ctx, hwd_control_state_t * ctrl )
+ {
+    int retval;
+ 
+@@ -882,7 +876,9 @@ int _papi_hwd_reset(hwd_context_t * ctx,
+ }
+ 
+ 
+-int _papi_hwd_read(hwd_context_t * ctx, hwd_control_state_t * ctrl, long long ** events, int flags)
++int
++_ultra_hwd_read( hwd_context_t * ctx, hwd_control_state_t * ctrl,
++				long long **events, int flags )
+ {
+    int retval;
+ 
+@@ -895,60 +891,111 @@ int _papi_hwd_read(hwd_context_t * ctx, 
+    return PAPI_OK;
+ }
+ 
+-int _papi_hwd_ctl(hwd_context_t * ctx, int code, _papi_int_option_t * option)
++int
++_ultra_hwd_ctl( hwd_context_t * ctx, int code, _papi_int_option_t * option )
+ {
+ 
+    switch (code) {
+    case PAPI_DEFDOM:
+-      return (set_default_domain(option->domain.ESI->ctl_state, option->domain.domain));
++		return ( set_default_domain
++				 ( option->domain.ESI->ctl_state, option->domain.domain ) );
+    case PAPI_DOMAIN:
+-      return (set_domain(option->domain.ESI->ctl_state, option->domain.domain));
++		return ( set_domain
++				 ( option->domain.ESI->ctl_state, option->domain.domain ) );
+    case PAPI_DEFGRN:
+       return (set_default_granularity
+-              (option->domain.ESI->ctl_state, option->granularity.granularity));
++				 ( option->domain.ESI->ctl_state,
++				   option->granularity.granularity ) );
+    case PAPI_GRANUL:
+       return (set_granularity
+-              (option->granularity.ESI->ctl_state, option->granularity.granularity));
++				 ( option->granularity.ESI->ctl_state,
++				   option->granularity.granularity ) );
+    default:
+       return (PAPI_EINVAL);
+    }
+ }
+ 
+-void _papi_hwd_dispatch_timer(int signal, siginfo_t * si, void *info)
++void
++_ultra_hwd_dispatch_timer( int signal, siginfo_t * si, void *context )
+ {
++
+    _papi_hwi_context_t ctx;
+-   ThreadInfo_t *t = _papi_hwi_lookup_thread();
++  ThreadInfo_t *master = NULL;
++  int isHardware = 0;
+    caddr_t address;
++  int cidx = MY_VECTOR.cmp_info.CmpIdx;
++
+    ctx.si = si;
+-   ctx.ucontext = (hwd_ucontext_t *)info;
+-   int cidx;//HACK this needs to be set
+-   int fd = si->si_fd;
++  ctx.ucontext = ( ucontext_t * ) context;
+ 
+-   if (t == NULL) {
+-      PAPIERROR("t == NULL in _papi_hwd_dispatch_timer for fd %d!", fd);
+-      return;
++  _papi_hwi_dispatch_overflow_signal( ( void * ) &ctx, address, &isHardware,
++				      0, 0, &master,
++				      MY_VECTOR.cmp_info.CmpIdx );
++
++  /* We are done, resume interrupting counters */
++  if ( isHardware ) {
++    //    errno = vperfctr_iresume( master->context[cidx]->perfctr );
++    //if ( errno < 0 ) {
++    //  PAPIERROR( "vperfctr_iresume errno %d", errno );
++    //}
+     }
+ 
+-   if (t->running_eventset[cidx] == NULL) {
+-      PAPIERROR("t->running_eventset == NULL in _papi_hwd_dispatch_timer for fd %d!", fd);
++
++#if 0
++        EventSetInfo_t *ESI = NULL;
++        ThreadInfo_t *thread = NULL;
++        int overflow_vector = 0;
++        hwd_control_state_t *ctrl = NULL;
++        long_long results[MAX_COUNTERS];
++        int i;
++        _papi_hwi_context_t ctx;
++	caddr_t address;
++	int cidx = _solaris_vector.cmp_info.CmpIdx;
++
++        ctx.si = si;
++        ctx.ucontext = ( hwd_ucontext_t * ) info;
++
++	thread = _papi_hwi_lookup_thread(  );
++
++	if ( thread == NULL ) {
++		PAPIERROR( "thread == NULL in _papi_hwd_dispatch_timer");
+       return;
+     }
+ 
+-   if (t->running_eventset[cidx]->overflow.flags == 0) {
+-      PAPIERROR("t->running_eventset->overflow.flags == 0 in _papi_hwd_dispatch_timer for fd %d!", fd);
+-      return;
++        ESI = ( EventSetInfo_t * ) thread->running_eventset[cidx];
++
++
++	if ( ESI == NULL || ESI->master != thread || ESI->ctl_state == NULL ||
++	     ( ( ESI->state & PAPI_OVERFLOWING ) == 0 ) ) {
++
++	  if ( ESI == NULL )
++	     PAPIERROR( "ESI is NULL\n");
++
++	  if ( ESI->master != thread )
++	     PAPIERROR( "Thread mismatch, ESI->master=%x thread=%x\n",
++		        ESI->master, thread );
++
++	  if ( ESI->ctl_state == NULL )
++	     PAPIERROR( "Counter state invalid\n");
++
++	  if ( ( ( ESI->state & PAPI_OVERFLOWING ) == 0 ) )
++	    PAPIERROR( "Overflow flag missing");
+     }
+ 
+-   if (t->running_eventset[cidx]->overflow.flags & PAPI_OVERFLOW_FORCE_SW) {
++	ctrl = ESI->ctl_state;
++
++	if ( thread->running_eventset[cidx]->overflow.flags & PAPI_OVERFLOW_FORCE_SW ) {
+       address = GET_OVERFLOW_ADDRESS(ctx);
+-      _papi_hwi_dispatch_overflow_signal((void *)&ctx, address, NULL, 0, 0, &t, cidx);
+-   }
+-   else {
++		_papi_hwi_dispatch_overflow_signal( ( void * ) &ctx, address, NULL, 0,
++											0, &thread, cidx );
++       } else {
+      PAPIERROR("Need to implement additional code in _papi_hwd_dispatch_timer!");
+    }
++#endif
+ }
+ 
+-int _papi_hwd_set_overflow(EventSetInfo_t * ESI, int EventIndex, int threshold)
++int
++_ultra_hwd_set_overflow( EventSetInfo_t * ESI, int EventIndex, int threshold )
+ {
+    hwd_control_state_t *this_state = ESI->ctl_state;
+    papi_cpc_event_t *arg = &this_state->counter_cmd;
+@@ -957,10 +1004,13 @@ int _papi_hwd_set_overflow(EventSetInfo_
+    if (threshold == 0) {
+       if (this_state->overflow_num == 1) {
+          arg->flags ^= CPC_BIND_EMT_OVF;
+-   if (sigaction(_papi_hwd[ESI->CmpIdx]->cmp_info.hardware_intr_sig, NULL, NULL) == -1)
++			if ( sigaction
++				 ( _solaris_vector.cmp_info.hardware_intr_sig, NULL,
++				   NULL ) == -1 )
+             return (PAPI_ESYS);
+          this_state->overflow_num = 0;
+-      } else this_state->overflow_num--;
++		} else
++			this_state->overflow_num--;
+ 
+    } else {
+       struct sigaction act;
+@@ -970,7 +1020,9 @@ int _papi_hwd_set_overflow(EventSetInfo_
+       act.sa_sigaction = dispatch_emt;
+       memset(&act.sa_mask, 0x0, sizeof(act.sa_mask));
+       act.sa_flags = SA_RESTART | SA_SIGINFO;
+-      if (sigaction(_papi_hwd[ESI->CmpIdx]->cmp_info.hardware_intr_sig, &act, NULL) == -1)
++		if ( sigaction
++			 ( _solaris_vector.cmp_info.hardware_intr_sig, &act,
++			   NULL ) == -1 )
+          return (PAPI_ESYS);
+ 
+       arg->flags |= CPC_BIND_EMT_OVF;
+@@ -984,6 +1036,14 @@ int _papi_hwd_set_overflow(EventSetInfo_
+    return (PAPI_OK);
+ }
+ 
++
++_ultra_shutdown( hwd_context_t * ctx )
++{
++
++  return PAPI_OK;
++}
++
++
+ /*
+ int _papi_hwd_stop_profiling(ThreadInfo_t * master, EventSetInfo_t * ESI)
+ {
+@@ -992,7 +1052,8 @@ int _papi_hwd_stop_profiling(ThreadInfo_
+ }
+ */
+ 
+-void *_papi_hwd_get_overflow_address(void *context)
++void *
++_ultra_hwd_get_overflow_address( void *context )
+ {
+    void *location;
+    ucontext_t *info = (ucontext_t *) context;
+@@ -1001,13 +1062,13 @@ void *_papi_hwd_get_overflow_address(voi
+    return (location);
+ }
+ 
+-int _papi_hwd_start(hwd_context_t * ctx, hwd_control_state_t * ctrl)
++int
++_ultra_hwd_start( hwd_context_t * ctx, hwd_control_state_t * ctrl )
+ {
+    int retval;
+ 
+    /* reset the hardware counter */
+-   if (ctrl->overflow_num==0)
+-   {
++	if ( ctrl->overflow_num == 0 ) {
+       ctrl->counter_cmd.cmd.ce_pic[0] = 0;
+       ctrl->counter_cmd.cmd.ce_pic[1] = 0;
+    }
+@@ -1019,27 +1080,37 @@ int _papi_hwd_start(hwd_context_t * ctx,
+    return (PAPI_OK);
+ }
+ 
+-int _papi_hwd_stop(hwd_context_t * ctx, hwd_control_state_t * ctrl)
++int
++_ultra_hwd_stop( hwd_context_t * ctx, hwd_control_state_t * ctrl )
+ {
+    cpc_bind_event(NULL, 0);
+    return PAPI_OK;
+ }
+ 
+-int _papi_hwd_remove_event(hwd_register_map_t * chosen, unsigned int hardware_index,
+-                           hwd_control_state_t * out)
++int
++_ultra_hwd_remove_event( hwd_register_map_t * chosen,
++						unsigned int hardware_index, hwd_control_state_t * out )
+ {
+    return PAPI_OK;
+ }
+ 
+-int _papi_hwd_encode_native(char *name, int *code)
++int
++_ultra_hwd_encode_native( char *name, int *code )
+ {
+    return (PAPI_OK);
+ }
+ 
+-int _papi_hwd_ntv_enum_events(unsigned int *EventCode, int modifer)
++int
++_ultra_hwd_ntv_enum_events( unsigned int *EventCode, int modifier )
+ {
+    int index = *EventCode & PAPI_NATIVE_AND_MASK;
+ 
++	if ( modifier == PAPI_ENUM_FIRST ) {
++	   *EventCode = PAPI_NATIVE_MASK + 1;
++
++	   return PAPI_OK;
++	}
++
+    if (cpuver <= CPC_ULTRA2) {
+       if (index < MAX_NATIVE_EVENT_USII - 1) {
+          *EventCode = *EventCode + 1;
+@@ -1056,41 +1127,51 @@ int _papi_hwd_ntv_enum_events(unsigned i
+    return (PAPI_ENOEVNT);
+ }
+ 
+-int _papi_hwd_ntv_code_to_name(unsigned int EventCode, char *hwd_name, int len)
++int
++_ultra_hwd_ntv_code_to_name( unsigned int EventCode, char *ntv_name, int len )
+ {
+-  /* HACK This implementation probably isn't correct! */
+-   int nidx;
+ 
+-   nidx = EventCode ^ PAPI_NATIVE_MASK;
+-   if (nidx >= 0 && nidx < PAPI_MAX_NATIVE_EVENTS)
+-     return (native_table[nidx].encoding[0]);
++        int event_code = EventCode & PAPI_NATIVE_AND_MASK;
+ 
+-   return -1;
++	if ( event_code >= 0 && event_code < nctrs ) {
++	  strlcpy( ntv_name, native_table[event_code].name, len );
++	  return PAPI_OK;
++	}
++	return PAPI_ENOEVNT;
+ }
+ 
+-int _papi_hwd_ntv_code_to_descr(unsigned int EventCode, char *hwd_descr, int len)
++
++int
++_ultra_hwd_ntv_code_to_descr( unsigned int EventCode, char *hwd_descr, int len )
+ {
+-  return (_papi_hwd_ntv_code_to_name(EventCode, hwd_descr, len));
++	return ( _ultra_hwd_ntv_code_to_name( EventCode, hwd_descr, len ) );
+ }
+ 
+-static void copy_value(unsigned int val, char *nam, char *names, unsigned int *values, int len)
++static void
++copy_value( unsigned int val, char *nam, char *names, unsigned int *values,
++			int len )
+ {
+    *values = val;
+    strncpy(names, nam, len);
+    names[len-1] = 0;
+ }
+ 
+-int _papi_hwd_ntv_bits_to_info(hwd_register_t *bits, char *names,
++int
++_ultra_hwd_ntv_bits_to_info( hwd_register_t * bits, char *names,
+                                unsigned int *values, int name_len, int count)
+ {
+    int i = 0;
+-   copy_value(bits->event[0], "US Ctr 0", &names[i*name_len], &values[i], name_len);
+-   if (++i == count) return(i);
+-   copy_value(bits->event[1], "US Ctr 1", &names[i*name_len], &values[i], name_len);
++	copy_value( bits->event[0], "US Ctr 0", &names[i * name_len], &values[i],
++				name_len );
++	if ( ++i == count )
++		return ( i );
++	copy_value( bits->event[1], "US Ctr 1", &names[i * name_len], &values[i],
++				name_len );
+    return(++i);
+ }
+ 
+-int _papi_hwd_ntv_code_to_bits(unsigned int EventCode, hwd_register_t * bits)
++int
++_ultra_hwd_ntv_code_to_bits( unsigned int EventCode, hwd_register_t * bits )
+ {
+    int index = EventCode & PAPI_NATIVE_AND_MASK;
+ 
+@@ -1102,14 +1183,16 @@ int _papi_hwd_ntv_code_to_bits(unsigned 
+       if(index >= MAX_NATIVE_EVENT) {
+          return(PAPI_ENOEVNT);
+       }
+-   } else return(PAPI_ENOEVNT);
++	} else
++		return ( PAPI_ENOEVNT );
+ 
+    bits->event[0] = native_table[index].encoding[0];
+    bits->event[1] = native_table[index].encoding[1];
+    return(PAPI_OK);
+ }
+ 
+-int _papi_hwd_init_control_state(hwd_control_state_t * ptr)
++int
++_ultra_hwd_init_control_state( hwd_control_state_t * ptr )
+ {
+    ptr->counter_cmd.flags = 0x0;
+    ptr->counter_cmd.cmd.ce_cpuver = cpuver;
+@@ -1117,15 +1200,15 @@ int _papi_hwd_init_control_state(hwd_con
+    ptr->counter_cmd.cmd.ce_pic[0] = 0;
+    ptr->counter_cmd.cmd.ce_pic[1] = 0;
+ 
+-   ThreadInfo_t *thread = _papi_hwi_lookup_thread();
+-   EventSetInfo_t *ESI = (EventSetInfo_t *) thread->running_eventset;
+-   set_domain(ptr, _papi_hwd[ESI->CmpIdx]->cmp_info.default_domain);
+-   set_granularity(ptr, _papi_hwd[ESI->CmpIdx]->cmp_info.default_granularity);
++	set_domain( ptr, _solaris_vector.cmp_info.default_domain );
++	set_granularity( ptr, _solaris_vector.cmp_info.default_granularity );
+    return PAPI_OK;
+ }
+ 
+-int _papi_hwd_update_control_state(hwd_control_state_t * this_state,
+-                    NativeInfo_t * native, int count, hwd_context_t * zero)
++int
++_ultra_hwd_update_control_state( hwd_control_state_t * this_state,
++								NativeInfo_t * native, int count,
++								hwd_context_t * zero )
+ {
+    int nidx1, nidx2, hwcntr;
+    uint64_t tmp, cmd0, cmd1, pcr;
+@@ -1215,27 +1298,34 @@ int _papi_hwd_update_control_state(hwd_c
+    return (PAPI_OK);
+ }
+ 
+-long long _papi_hwd_get_real_usec(void)
++long long
++_ultra_hwd_get_real_usec( void )
+ {
+    return ((long long) gethrtime() / (long long) 1000);
+ }
+ 
+-long long _papi_hwd_get_real_cycles(void)
++long long
++_ultra_hwd_get_real_cycles( void )
+ {
+-   return(_papi_hwd_get_real_usec() * (long long) _papi_hwi_system_info.hw_info.mhz);
++	return ( _ultra_hwd_get_real_usec(  ) *
++			 ( long long ) _papi_hwi_system_info.hw_info.mhz );
+ }
+ 
+-long long _papi_hwd_get_virt_usec(const hwd_context_t * zero)
++long long
++_ultra_hwd_get_virt_usec( const hwd_context_t * zero )
+ {
+    return ((long long) gethrvtime() / (long long) 1000);
+ }
+ 
+-long long _papi_hwd_get_virt_cycles(const hwd_context_t * zero)
++long long
++_ultra_hwd_get_virt_cycles( const hwd_context_t * zero )
+ {
+-   return (((long long) gethrvtime() / (long long) 1000) * (long long) _papi_hwi_system_info.hw_info.mhz);
++	return ( ( ( long long ) gethrvtime(  ) / ( long long ) 1000 ) *
++			 ( long long ) _papi_hwi_system_info.hw_info.mhz );
+ }
+ 
+-int _papi_hwd_update_shlib_info(void)
++int
++_ultra_hwd_update_shlib_info( void )
+ {
+    /*??? system call takes very long */
+ 
+@@ -1246,7 +1336,8 @@ int _papi_hwd_update_shlib_info(void)
+ 
+    FILE *f=NULL;
+    int t_index=0, i;
+-   struct map_record {
++	struct map_record
++	{
+       long address;
+       int size;
+       int flags;
+@@ -1259,7 +1350,8 @@ int _papi_hwd_update_shlib_info(void)
+ 
+    sprintf(cmd_line, "/bin/pmap %d > %s",(int)getpid(), fname);
+    if (system(cmd_line) != 0) {
+-      PAPIERROR("Could not run %s to get shared library address map",cmd_line);
++		PAPIERROR( "Could not run %s to get shared library address map",
++				   cmd_line );
+       return(PAPI_OK);
+    }
+ 
+@@ -1275,13 +1367,14 @@ int _papi_hwd_update_shlib_info(void)
+    head = curr = NULL;
+    while (fgets(line, 256, f) != NULL) {
+       /* discard the last line */
+-      if (strncmp(line, " total", 6) != 0 )
+-      {
++		if ( strncmp( line, " total", 6 ) != 0 ) {
+          sscanf(line, "%s %s %s %s", address, size, flags, objname);
+-         if (objname[0] == '/' )  
+-         {
+-            tmpr = (struct map_record *)papi_malloc(sizeof(struct map_record));
+-            if (tmpr==NULL) return(-1);
++			if ( objname[0] == '/' ) {
++				tmpr =
++					( struct map_record * )
++					papi_malloc( sizeof ( struct map_record ) );
++				if ( tmpr == NULL )
++					return ( -1 );
+             tmpr->next = NULL;
+             if (curr ) {
+                curr->next = tmpr;
+@@ -1293,10 +1386,9 @@ int _papi_hwd_update_shlib_info(void)
+ 
+             SUBDBG("%s\n", objname);
+ 
+-            if ( (strstr(flags, "read") && strstr(flags, "exec")) || (strstr(flags, "r") && strstr(flags, "x")) )
+-            {
+-              if ( !(strstr(flags, "write")||strstr(flags, "w")) )  /* text segment */
+-               { 
++				if ( ( strstr( flags, "read" ) && strstr( flags, "exec" ) ) ||
++					 ( strstr( flags, "r" ) && strstr( flags, "x" ) ) ) {
++					if ( !( strstr( flags, "write" ) || strstr( flags, "w" ) ) ) {	/* text segment */
+                   t_index++;
+                   tmpr->flags =1;
+                } else {
+@@ -1312,21 +1404,22 @@ int _papi_hwd_update_shlib_info(void)
+          
+       }
+    }
+-   tmp = (PAPI_address_map_t *) papi_calloc(t_index-1, sizeof(PAPI_address_map_t));
+-
+-   if (tmp == NULL)
+-     { PAPIERROR("Error allocating shared library address map"); return(PAPI_ENOMEM); }
++	tmp =
++		( PAPI_address_map_t * ) papi_calloc( t_index - 1,
++											  sizeof ( PAPI_address_map_t ) );
++
++	if ( tmp == NULL ) {
++		PAPIERROR( "Error allocating shared library address map" );
++		return ( PAPI_ENOMEM );
++	}
+    
+    t_index = -1;
+    tmpr = curr = head;
+    i=0;
+-   while (curr != NULL )
+-   {
++	while ( curr != NULL ) {
+       if (strcmp(_papi_hwi_system_info.exe_info.address_info.name,
+-                          basename(curr->objname))== 0 )
+-      {
+-         if ( curr->flags ) 
+-         {
++					 basename( curr->objname ) ) == 0 ) {
++			if ( curr->flags ) {
+             _papi_hwi_system_info.exe_info.address_info.text_start =
+                                       (caddr_t) curr->address;
+             _papi_hwi_system_info.exe_info.address_info.text_end =
+@@ -1338,17 +1431,20 @@ int _papi_hwd_update_shlib_info(void)
+                                       (caddr_t) (curr->address + curr->size);
+          }
+       } else {
+-         if ( curr->flags ) 
+-         {
++			if ( curr->flags ) {
+             t_index++;
+             tmp[t_index].text_start = (caddr_t) curr->address;
+-            tmp[t_index].text_end =(caddr_t) (curr->address+curr->size);
+-               strncpy(tmp[t_index].name, curr->objname,PAPI_HUGE_STR_LEN-1 );
++				tmp[t_index].text_end =
++					( caddr_t ) ( curr->address + curr->size );
++				strncpy( tmp[t_index].name, curr->objname,
++						 PAPI_HUGE_STR_LEN - 1 );
+                tmp[t_index].name[PAPI_HUGE_STR_LEN-1]='\0';
+          } else {
+-               if (t_index <0 )  continue;
++				if ( t_index < 0 )
++					continue;
+                tmp[t_index].data_start = (caddr_t) curr->address;
+-               tmp[t_index].data_end = (caddr_t) (curr->address+ curr->size);
++				tmp[t_index].data_end =
++					( caddr_t ) ( curr->address + curr->size );
+          }
+       }
+       tmpr = curr->next;
+@@ -1371,7 +1467,8 @@ int _papi_hwd_update_shlib_info(void)
+ #if 0
+ /* once the bug in dladdr is fixed by SUN, (now dladdr caused deadlock when
+    used with pthreads) this function can be used again */
+-int _papi_hwd_update_shlib_info(void)
++int
++_papi_hwd_update_shlib_info( void )
+ {
+    char fname[80], name[PAPI_HUGE_STR_LEN];
+    prmap_t newp;
+@@ -1383,8 +1480,7 @@ int _papi_hwd_update_shlib_info(void)
+ 
+    sprintf(fname, "/proc/%d/map", getpid());
+    map_f = fopen(fname, "r");
+-   if (!map_f)
+-     { 
++	if ( !map_f ) {
+ 	 PAPIERROR("fopen(%s) returned < 0", fname); 
+ 	 return(PAPI_OK); 
+      }
+@@ -1403,7 +1499,8 @@ int _papi_hwd_update_shlib_info(void)
+          strcpy(name,dlip.dli_fname);
+          if (strcmp(_papi_hwi_system_info.exe_info.address_info.name, 
+                           basename(name))== 0 ) {
+-            if ((newp.pr_mflags & MA_EXEC) && (newp.pr_mflags & MA_READ) ) {
++				if ( ( newp.pr_mflags & MA_EXEC ) &&
++					 ( newp.pr_mflags & MA_READ ) ) {
+                if ( !(newp.pr_mflags & MA_WRITE)) {
+                   _papi_hwi_system_info.exe_info.address_info.text_start = 
+                                       (caddr_t) newp.pr_vaddr;
+@@ -1421,10 +1518,14 @@ int _papi_hwd_update_shlib_info(void)
+ 
+    }
+    rewind(map_f);
+-   tmp = (PAPI_address_map_t *) papi_calloc(t_index-1, sizeof(PAPI_address_map_t));
+-
+-   if (tmp == NULL)
+-     { PAPIERROR("Error allocating shared library address map"); return(PAPI_ENOMEM); }
++	tmp =
++		( PAPI_address_map_t * ) papi_calloc( t_index - 1,
++											  sizeof ( PAPI_address_map_t ) );
++
++	if ( tmp == NULL ) {
++		PAPIERROR( "Error allocating shared library address map" );
++		return ( PAPI_ENOMEM );
++	}
+    t_index=-1;
+    while ( fread(&newp, sizeof(prmap_t), 1, map_f) > 0 ) {
+       vaddr = (void*)(1+(newp.pr_vaddr)); // map base address
+@@ -1437,13 +1538,17 @@ int _papi_hwd_update_shlib_info(void)
+             if ( !(newp.pr_mflags & MA_WRITE)) {
+                t_index++;
+                tmp[t_index].text_start = (caddr_t) newp.pr_vaddr;
+-               tmp[t_index].text_end =(caddr_t) (newp.pr_vaddr+newp.pr_size);
+-               strncpy(tmp[t_index].name, dlip.dli_fname,PAPI_HUGE_STR_LEN-1 );
++					tmp[t_index].text_end =
++						( caddr_t ) ( newp.pr_vaddr + newp.pr_size );
++					strncpy( tmp[t_index].name, dlip.dli_fname,
++							 PAPI_HUGE_STR_LEN - 1 );
+                tmp[t_index].name[PAPI_HUGE_STR_LEN-1]='\0';
+             } else {
+-               if (t_index <0 )  continue;
++					if ( t_index < 0 )
++						continue;
+                tmp[t_index].data_start = (caddr_t) newp.pr_vaddr;
+-               tmp[t_index].data_end = (caddr_t) (newp.pr_vaddr+newp.pr_size);
++					tmp[t_index].data_end =
++						( caddr_t ) ( newp.pr_vaddr + newp.pr_size );
+             }
+          }
+       }
+@@ -1459,3 +1564,79 @@ int _papi_hwd_update_shlib_info(void)
+    return(PAPI_OK);
+ }
+ #endif
++
++
++papi_vector_t _solaris_vector = {
++	.cmp_info = {
++				 .num_cntrs = MAX_COUNTERS,
++				 .num_mpx_cntrs = PAPI_MPX_DEF_DEG,
++				 .default_domain = PAPI_DOM_USER,
++				 .available_domains = PAPI_DOM_USER | PAPI_DOM_KERNEL,
++				 .default_granularity = PAPI_GRN_THR,
++				 .available_granularities = PAPI_GRN_THR,
++				 .fast_real_timer = 1,
++				 .fast_virtual_timer = 1,
++				 .attach = 1,
++				 .attach_must_ptrace = 1,
++				 .itimer_sig = PAPI_INT_MPX_SIGNAL,
++                                 .itimer_num = PAPI_INT_ITIMER,
++                                 .itimer_ns = PAPI_INT_MPX_DEF_US * 1000,
++                                 .itimer_res_ns = 1,
++				 .hardware_intr = 0,
++				 .hardware_intr_sig = PAPI_INT_SIGNAL,
++				 .precise_intr = 0,
++				 }
++	,
++
++	/* substrate data structure sizes */
++	.size = {
++			 .context = sizeof ( hwd_context_t ),
++			 .control_state = sizeof ( hwd_control_state_t ),
++			 .reg_value = sizeof ( hwd_register_t ),
++			 .reg_alloc = sizeof ( hwd_reg_alloc_t ),
++			 }
++	,
++
++	/* substrate interface functions */
++	.init_control_state = _ultra_hwd_init_control_state,
++	.start = _ultra_hwd_start,
++	.stop = _ultra_hwd_stop,
++	.read = _ultra_hwd_read,
++        /* .write */
++        .shutdown = _ultra_shutdown,
++	.shutdown_substrate = _ultra_hwd_shutdown_substrate,
++	.ctl = _ultra_hwd_ctl,
++        /* .bpt_map_set        */
++        /* .bpt_map_avail      */
++        /* .bpt_map_exclusive  */
++        /* .bpt_map_shared     */
++        /* .bpt_map_preempt    */
++        /* .bpt_map_update     */
++	/* .allocate_registers */
++	.update_control_state = _ultra_hwd_update_control_state,
++        /* .set_domain */
++	.reset = _ultra_hwd_reset,
++	.set_overflow = _ultra_hwd_set_overflow,
++	/* .set_profile */
++	/* .stop_profiling = _papi_hwd_stop_profiling, */
++        /* .add_prog_event */
++	.ntv_enum_events = _ultra_hwd_ntv_enum_events,
++        /* .ntv_name_to_code */
++	.ntv_code_to_name = _ultra_hwd_ntv_code_to_name,
++	.ntv_code_to_descr = _ultra_hwd_ntv_code_to_descr,
++	.ntv_code_to_bits = _ultra_hwd_ntv_code_to_bits,
++	.ntv_bits_to_info = _ultra_hwd_ntv_bits_to_info,
++	.init_substrate = _ultra_hwd_init_substrate,
++	.dispatch_timer = _ultra_hwd_dispatch_timer,
++	.get_real_usec = _ultra_hwd_get_real_usec,
++	.get_real_cycles = _ultra_hwd_get_real_cycles,
++	.get_virt_cycles = _ultra_hwd_get_virt_cycles,
++	.get_virt_usec = _ultra_hwd_get_virt_usec,
++
++	/* OS dependent local routines */
++        .get_memory_info = _solaris_get_memory_info,
++        .get_dmem_info = _solaris_get_dmem_info,
++	.update_shlib_info = _ultra_hwd_update_shlib_info,
++	.get_system_info = get_system_info
++};
++
+diff -rupNwB papi400t/src/utils/native_avail.c papi400b/src/utils/native_avail.c
+--- papi400t/src/utils/native_avail.c	2009-11-02 10:55:21.000000000 -0500
++++ papi400b/src/utils/native_avail.c	2010-04-28 22:30:17.000000000 -0400
+@@ -124,7 +124,7 @@ static void space_pad(char *str, int spa
+ }
+ 
+ static void print_event(PAPI_event_info_t *info, int offset) {
+-	int i, j = 0;
++	unsigned int i, j = 0;
+ 	char str[EVT_LINE + EVT_LINE];
+ 
+ 	/* indent by offset */
+@@ -139,13 +139,13 @@ static void print_event(PAPI_event_info_
+ 
+ 	while (j <= strlen(info->long_descr))
+ 	{
+-		i = EVT_LINE - strlen(str) - 2;
++		i = EVT_LINE - (unsigned int)strlen(str) - 2;
+ 		if (i > 0)
+ 		{
+ 			strncat(str, &info->long_descr[j], i);
+ 			j +=i;
+-			i = strlen(str);
+-			space_pad(str, EVT_LINE - i - 1);
++			i = (unsigned int)strlen(str);
++			space_pad(str, EVT_LINE - (int)i - 1);
+ 			strcat(str, "|");
+ 		}
+ 		printf("%s\n",str);
+@@ -233,10 +233,12 @@ int main(int argc, char **argv)
+ 				}
+ 			}
+ 		}
+-		else printf("Sorry, an event by the name '%s' could not be found.\n Is it typed correctly?\n\n",flags.name);
++		else {
++			printf("Sorry, an event by the name '%s' could not be found.\n Is it typed correctly?\n\n",flags.name);
+ 		exit(1);
+ 	}
+-
++	}
++	else {
+ 	printf("%-12s %s  | %s |\n","Event Code","Symbol","Long Description");
+ 	printf
+ 		("--------------------------------------------------------------------------------\n");
+@@ -312,6 +313,7 @@ int main(int argc, char **argv)
+ 
+ 	printf ("--------------------------------------------------------------------------------\n");
+ 	printf("Total events reported: %d\n", j);
++	}
+ 	test_pass(__FILE__, NULL, 0);
+ 	exit(0);
+ }
diff --git a/src/config.h.in b/src/config.h.in
index c128589..b6c41f0 100644
--- a/src/config.h.in
+++ b/src/config.h.in
@@ -123,6 +123,9 @@
 /* Define to the one symbol short name of this package. */
 #undef PACKAGE_TARNAME
 
+/* Define to the home page for this package. */
+#undef PACKAGE_URL
+
 /* Define to the version of this package. */
 #undef PACKAGE_VERSION
 
@@ -141,7 +144,34 @@
 /* Use semaphores for locking */
 #undef USE_SEMAPHORES
 
+/* Enable extensions on AIX 3, Interix.  */
+#ifndef _ALL_SOURCE
+# undef _ALL_SOURCE
+#endif
 /* Enable GNU extensions on systems that have them.  */
 #ifndef _GNU_SOURCE
 # undef _GNU_SOURCE
 #endif
+/* Enable threading extensions on Solaris.  */
+#ifndef _POSIX_PTHREAD_SEMANTICS
+# undef _POSIX_PTHREAD_SEMANTICS
+#endif
+/* Enable extensions on HP NonStop.  */
+#ifndef _TANDEM_SOURCE
+# undef _TANDEM_SOURCE
+#endif
+/* Enable general extensions on Solaris.  */
+#ifndef __EXTENSIONS__
+# undef __EXTENSIONS__
+#endif
+
+
+/* Define to 1 if on MINIX. */
+#undef _MINIX
+
+/* Define to 2 if the system does not provide POSIX.1 features except with
+   this defined. */
+#undef _POSIX_1_SOURCE
+
+/* Define to 1 if you need to in order for `stat' and other things to work. */
+#undef _POSIX_SOURCE
diff --git a/src/configure b/src/configure
index 9472331..a7bc01c 100755
--- a/src/configure
+++ b/src/configure
@@ -1,20 +1,24 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.63 for PAPI 4.0.0.
+# Generated by GNU Autoconf 2.68 for PAPI 4.0.0.
 #
 # Report bugs to <ptools-perfapi@eecs.utk.edu>.
 #
+#
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
+# Foundation, Inc.
+#
+#
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
 # Be more Bourne compatible
 DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
@@ -22,23 +26,15 @@ if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
 esac
-
 fi
 
 
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
 as_nl='
 '
 export as_nl
@@ -46,7 +42,13 @@ export as_nl
 as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
   as_echo='printf %s\n'
   as_echo_n='printf %s'
 else
@@ -57,7 +59,7 @@ else
     as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
     as_echo_n_body='eval
       arg=$1;
-      case $arg in
+      case $arg in #(
       *"$as_nl"*)
 	expr "X$arg" : "X\\(.*\\)$as_nl";
 	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
@@ -80,13 +82,6 @@ if test "${PATH_SEPARATOR+set}" != set; then
   }
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
 
 # IFS
 # We need space, tab and new line, in precisely that order.  Quoting is
@@ -96,15 +91,16 @@ fi
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+as_myself=
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -116,12 +112,16 @@ if test "x$as_myself" = x; then
 fi
 if test ! -f "$as_myself"; then
   $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
@@ -133,7 +133,256 @@ export LC_ALL
 LANGUAGE=C
 export LANGUAGE
 
-# Required to use basename.
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+if test "x$CONFIG_SHELL" = x; then
+  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
+  emulate sh
+  NULLCMD=:
+  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '\${1+\"\$@\"}'='\"\$@\"'
+  setopt NO_GLOB_SUBST
+else
+  case \`(set -o) 2>/dev/null\` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
+fi
+"
+  as_required="as_fn_return () { (exit \$1); }
+as_fn_success () { as_fn_return 0; }
+as_fn_failure () { as_fn_return 1; }
+as_fn_ret_success () { return 0; }
+as_fn_ret_failure () { return 1; }
+
+exitcode=0
+as_fn_success || { exitcode=1; echo as_fn_success failed.; }
+as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
+as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
+as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
+if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
+
+else
+  exitcode=1; echo positional parameters were not saved.
+fi
+test x\$exitcode = x0 || exit 1"
+  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
+  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
+  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
+  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
+test \$(( 1 + 1 )) = 2 || exit 1"
+  if (eval "$as_required") 2>/dev/null; then :
+  as_have_required=yes
+else
+  as_have_required=no
+fi
+  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :
+
+else
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_found=false
+for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  as_found=:
+  case $as_dir in #(
+	 /*)
+	   for as_base in sh bash ksh sh5; do
+	     # Try only shells that exist, to save several forks.
+	     as_shell=$as_dir/$as_base
+	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
+		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  CONFIG_SHELL=$as_shell as_have_required=yes
+		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  break 2
+fi
+fi
+	   done;;
+       esac
+  as_found=false
+done
+$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
+	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
+  CONFIG_SHELL=$SHELL as_have_required=yes
+fi; }
+IFS=$as_save_IFS
+
+
+      if test "x$CONFIG_SHELL" != x; then :
+  # We cannot yet assume a decent shell, so we have to provide a
+	# neutralization value for shells without unset; and this also
+	# works around shells that cannot unset nonexistent variables.
+	# Preserve -v and -x to the replacement shell.
+	BASH_ENV=/dev/null
+	ENV=/dev/null
+	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+	export CONFIG_SHELL
+	case $- in # ((((
+	  *v*x* | *x*v* ) as_opts=-vx ;;
+	  *v* ) as_opts=-v ;;
+	  *x* ) as_opts=-x ;;
+	  * ) as_opts= ;;
+	esac
+	exec "$CONFIG_SHELL" $as_opts "$as_myself" ${1+"$@"}
+fi
+
+    if test x$as_have_required = xno; then :
+  $as_echo "$0: This script requires a shell more modern than all"
+  $as_echo "$0: the shells that I found on your system."
+  if test x${ZSH_VERSION+set} = xset ; then
+    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
+    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
+  else
+    $as_echo "$0: Please tell bug-autoconf@gnu.org and
+$0: ptools-perfapi@eecs.utk.edu about your system,
+$0: including any error possibly output before this
+$0: message. Then install a modern shell, or manually run
+$0: the script under such a shell if you do have one."
+  fi
+  exit 1
+fi
+fi
+fi
+SHELL=${CONFIG_SHELL-/bin/sh}
+export SHELL
+# Unset more variables known to interfere with behavior of common tools.
+CLICOLOR_FORCE= GREP_OPTIONS=
+unset CLICOLOR_FORCE GREP_OPTIONS
+
+## --------------------- ##
+## M4sh Shell Functions. ##
+## --------------------- ##
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
+
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
+
+
+} # as_fn_mkdir_p
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
+
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
+
+
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
 if expr a : '\(a\)' >/dev/null 2>&1 &&
    test "X`expr 00001 : '.*\(...\)'`" = X001; then
   as_expr=expr
@@ -147,8 +396,12 @@ else
   as_basename=false
 fi
 
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
 
-# Name of the executable.
 as_me=`$as_basename -- "$0" ||
 $as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
 	 X"$0" : 'X\(//\)$' \| \
@@ -168,415 +421,127 @@ $as_echo X/"$0" |
 	  }
 	  s/.*/./; q'`
 
-# CDPATH.
-$as_unset CDPATH
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 
-if test "x$CONFIG_SHELL" = x; then
-  if (eval ":") 2>/dev/null; then
-  as_have_required=yes
-else
-  as_have_required=no
-fi
+  as_lineno_1=$LINENO as_lineno_1a=$LINENO
+  as_lineno_2=$LINENO as_lineno_2a=$LINENO
+  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
+  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
+  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
+  sed -n '
+    p
+    /[$]LINENO/=
+  ' <$as_myself |
+    sed '
+      s/[$]LINENO.*/&-/
+      t lineno
+      b
+      :lineno
+      N
+      :loop
+      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
+      t loop
+      s/-\n.*//
+    ' >$as_me.lineno &&
+  chmod +x "$as_me.lineno" ||
+    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
-  if test $as_have_required = yes &&	 (eval ":
-(as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
+  # Don't try to exec as it changes $[0], causing all sort of problems
+  # (the dirname of $[0] is not the place where we might find the
+  # original and so on.  Autoconf is especially sensitive to this).
+  . "./$as_me.lineno"
+  # Exit status is that of the last command.
+  exit
 }
 
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
+ECHO_C= ECHO_N= ECHO_T=
+case `echo -n x` in #(((((
+-n*)
+  case `echo 'xy\c'` in
+  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
+  esac;;
+*)
+  ECHO_N='-n';;
+esac
 
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
+rm -f conf$$ conf$$.exe conf$$.file
+if test -d conf$$.dir; then
+  rm -f conf$$.dir/conf$$.file
+else
+  rm -f conf$$.dir
+  mkdir conf$$.dir 2>/dev/null
 fi
-
-if as_func_ret_success; then
-  :
+if (echo >conf$$.file) 2>/dev/null; then
+  if ln -s conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s='ln -s'
+    # ... but there are two gotchas:
+    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
+    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
+    # In both cases, we have to default to `cp -p'.
+    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
+      as_ln_s='cp -p'
+  elif ln conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s=ln
+  else
+    as_ln_s='cp -p'
+  fi
 else
-  exitcode=1
-  echo as_func_ret_success failed.
+  as_ln_s='cp -p'
 fi
+rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
+rmdir conf$$.dir 2>/dev/null
 
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
+if mkdir -p . 2>/dev/null; then
+  as_mkdir_p='mkdir -p "$as_dir"'
+else
+  test -d ./-p && rmdir ./-p
+  as_mkdir_p=false
 fi
 
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
+if test -x / >/dev/null 2>&1; then
+  as_test_x='test -x'
 else
-  exitcode=1
-  echo positional parameters were not saved.
+  if ls -dL / >/dev/null 2>&1; then
+    as_ls_L_option=L
+  else
+    as_ls_L_option=
+  fi
+  as_test_x='
+    eval sh -c '\''
+      if test -d "$1"; then
+	test -d "$1/.";
+      else
+	case $1 in #(
+	-*)set "./$1";;
+	esac;
+	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
+	???[sx]*):;;*)false;;esac;fi
+    '\'' sh
+  '
 fi
+as_executable_p=$as_test_x
 
-test \$exitcode = 0) || { (exit 1); exit 1; }
+# Sed expression to map a string onto a valid CPP name.
+as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
 
-(
-  as_lineno_1=\$LINENO
-  as_lineno_2=\$LINENO
-  test \"x\$as_lineno_1\" != \"x\$as_lineno_2\" &&
-  test \"x\`expr \$as_lineno_1 + 1\`\" = \"x\$as_lineno_2\") || { (exit 1); exit 1; }
-") 2> /dev/null; then
-  :
-else
-  as_candidate_shells=
-    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  case $as_dir in
-	 /*)
-	   for as_base in sh bash ksh sh5; do
-	     as_candidate_shells="$as_candidate_shells $as_dir/$as_base"
-	   done;;
-       esac
-done
-IFS=$as_save_IFS
+# Sed expression to map a string onto a valid variable name.
+as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
 
 
-      for as_shell in $as_candidate_shells $SHELL; do
-	 # Try only shells that exist, to save several forks.
-	 if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
-		{ ("$as_shell") 2> /dev/null <<\_ASEOF
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
-fi
-
-
-:
-_ASEOF
-}; then
-  CONFIG_SHELL=$as_shell
-	       as_have_required=yes
-	       if { "$as_shell" 2> /dev/null <<\_ASEOF
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
-  emulate sh
-  NULLCMD=:
-  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
-  # is contrary to our usage.  Disable this feature.
-  alias -g '${1+"$@"}'='"$@"'
-  setopt NO_GLOB_SUBST
-else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
-esac
-
-fi
-
-
-:
-(as_func_return () {
-  (exit $1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
-
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y && test x = "$1" ); then
-  :
-else
-  exitcode=1
-  echo positional parameters were not saved.
-fi
-
-test $exitcode = 0) || { (exit 1); exit 1; }
-
-(
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2") || { (exit 1); exit 1; }
-
-_ASEOF
-}; then
-  break
-fi
-
-fi
-
-      done
-
-      if test "x$CONFIG_SHELL" != x; then
-  for as_var in BASH_ENV ENV
-	do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
-	done
-	export CONFIG_SHELL
-	exec "$CONFIG_SHELL" "$as_myself" ${1+"$@"}
-fi
-
-
-    if test $as_have_required = no; then
-  echo This script requires a shell more modern than all the
-      echo shells that I found on your system.  Please install a
-      echo modern shell, or manually run the script under such a
-      echo shell if you do have one.
-      { (exit 1); exit 1; }
-fi
-
-
-fi
-
-fi
-
-
-
-(eval "as_func_return () {
-  (exit \$1)
-}
-as_func_success () {
-  as_func_return 0
-}
-as_func_failure () {
-  as_func_return 1
-}
-as_func_ret_success () {
-  return 0
-}
-as_func_ret_failure () {
-  return 1
-}
-
-exitcode=0
-if as_func_success; then
-  :
-else
-  exitcode=1
-  echo as_func_success failed.
-fi
-
-if as_func_failure; then
-  exitcode=1
-  echo as_func_failure succeeded.
-fi
-
-if as_func_ret_success; then
-  :
-else
-  exitcode=1
-  echo as_func_ret_success failed.
-fi
-
-if as_func_ret_failure; then
-  exitcode=1
-  echo as_func_ret_failure succeeded.
-fi
-
-if ( set x; as_func_ret_success y && test x = \"\$1\" ); then
-  :
-else
-  exitcode=1
-  echo positional parameters were not saved.
-fi
-
-test \$exitcode = 0") || {
-  echo No shell found that supports shell functions.
-  echo Please tell bug-autoconf@gnu.org about your system,
-  echo including any error possibly output before this message.
-  echo This can help us improve future autoconf versions.
-  echo Configuration will now proceed without shell functions.
-}
-
-
-
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' <$as_myself |
-    sed '
-      s/[$]LINENO.*/&-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' >$as_me.lineno &&
-  chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
-
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . "./$as_me.lineno"
-  # Exit status is that of the last command.
-  exit
-}
-
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
-
-ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
--n*)
-  case `echo 'x\c'` in
-  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
-  esac;;
-*)
-  ECHO_N='-n';;
-esac
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
-
-rm -f conf$$ conf$$.exe conf$$.file
-if test -d conf$$.dir; then
-  rm -f conf$$.dir/conf$$.file
-else
-  rm -f conf$$.dir
-  mkdir conf$$.dir 2>/dev/null
-fi
-if (echo >conf$$.file) 2>/dev/null; then
-  if ln -s conf$$.file conf$$ 2>/dev/null; then
-    as_ln_s='ln -s'
-    # ... but there are two gotchas:
-    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
-    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
-    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
-  elif ln conf$$.file conf$$ 2>/dev/null; then
-    as_ln_s=ln
-  else
-    as_ln_s='cp -p'
-  fi
-else
-  as_ln_s='cp -p'
-fi
-rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
-rmdir conf$$.dir 2>/dev/null
-
-if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
-else
-  test -d ./-p && rmdir ./-p
-  as_mkdir_p=false
-fi
-
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
-
-# Sed expression to map a string onto a valid CPP name.
-as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
-
-# Sed expression to map a string onto a valid variable name.
-as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
-
-
-
-exec 7<&0 </dev/null 6>&1
+test -n "$DJDIR" || exec 7<&0 </dev/null
+exec 6>&1
 
 # Name of the host.
-# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
+# hostname on some systems (SVR3.2, old GNU/Linux) returns a bogus exit status,
 # so uname gets run too.
 ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
 
@@ -591,7 +556,6 @@ cross_compiling=no
 subdirs=
 MFLAGS=
 MAKEFLAGS=
-SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
 PACKAGE_NAME='PAPI'
@@ -599,6 +563,7 @@ PACKAGE_TARNAME='papi'
 PACKAGE_VERSION='4.0.0'
 PACKAGE_STRING='PAPI 4.0.0'
 PACKAGE_BUGREPORT='ptools-perfapi@eecs.utk.edu'
+PACKAGE_URL=''
 
 ac_unique_file="papi.c"
 # Factoring default headers for most tests.
@@ -751,6 +716,7 @@ bindir
 program_transform_name
 prefix
 exec_prefix
+PACKAGE_URL
 PACKAGE_BUGREPORT
 PACKAGE_STRING
 PACKAGE_VERSION
@@ -873,8 +839,9 @@ do
   fi
 
   case $ac_option in
-  *=*)	ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
-  *)	ac_optarg=yes ;;
+  *=?*) ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
+  *=)   ac_optarg= ;;
+  *)    ac_optarg=yes ;;
   esac
 
   # Accept the important Cygnus configure options, so we can diagnose typos.
@@ -919,8 +886,7 @@ do
     ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid feature name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -946,8 +912,7 @@ do
     ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid feature name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1151,8 +1116,7 @@ do
     ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid package name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1168,8 +1132,7 @@ do
     ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid package name: $ac_useropt" >&2
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1199,17 +1162,17 @@ do
   | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
     x_libraries=$ac_optarg ;;
 
-  -*) { $as_echo "$as_me: error: unrecognized option: $ac_option
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; }
+  -*) as_fn_error $? "unrecognized option: \`$ac_option'
+Try \`$0 --help' for more information"
     ;;
 
   *=*)
     ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
     # Reject names that are not valid shell variable names.
-    expr "x$ac_envvar" : ".*[^_$as_cr_alnum]" >/dev/null &&
-      { $as_echo "$as_me: error: invalid variable name: $ac_envvar" >&2
-   { (exit 1); exit 1; }; }
+    case $ac_envvar in #(
+      '' | [0-9]* | *[!_$as_cr_alnum]* )
+      as_fn_error $? "invalid variable name: \`$ac_envvar'" ;;
+    esac
     eval $ac_envvar=\$ac_optarg
     export $ac_envvar ;;
 
@@ -1218,7 +1181,7 @@ Try \`$0 --help' for more information." >&2
     $as_echo "$as_me: WARNING: you should use --build, --host, --target" >&2
     expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
       $as_echo "$as_me: WARNING: invalid host type: $ac_option" >&2
-    : ${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}
+    : "${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}"
     ;;
 
   esac
@@ -1226,15 +1189,13 @@ done
 
 if test -n "$ac_prev"; then
   ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  { $as_echo "$as_me: error: missing argument to $ac_option" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "missing argument to $ac_option"
 fi
 
 if test -n "$ac_unrecognized_opts"; then
   case $enable_option_checking in
     no) ;;
-    fatal) { $as_echo "$as_me: error: unrecognized options: $ac_unrecognized_opts" >&2
-   { (exit 1); exit 1; }; } ;;
+    fatal) as_fn_error $? "unrecognized options: $ac_unrecognized_opts" ;;
     *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
   esac
 fi
@@ -1257,8 +1218,7 @@ do
     [\\/$]* | ?:[\\/]* )  continue;;
     NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
   esac
-  { $as_echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "expected an absolute directory name for --$ac_var: $ac_val"
 done
 
 # There might be people who depend on the old broken behavior: `$host'
@@ -1272,8 +1232,8 @@ target=$target_alias
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: If you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used." >&2
+    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
+    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1288,11 +1248,9 @@ test "$silent" = yes && exec 6>/dev/null
 ac_pwd=`pwd` && test -n "$ac_pwd" &&
 ac_ls_di=`ls -di .` &&
 ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
-  { $as_echo "$as_me: error: working directory cannot be determined" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "working directory cannot be determined"
 test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
-  { $as_echo "$as_me: error: pwd does not report name of working directory" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "pwd does not report name of working directory"
 
 
 # Find the source files, if location was not specified.
@@ -1331,13 +1289,11 @@ else
 fi
 if test ! -r "$srcdir/$ac_unique_file"; then
   test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
-  { $as_echo "$as_me: error: cannot find sources ($ac_unique_file) in $srcdir" >&2
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot find sources ($ac_unique_file) in $srcdir"
 fi
 ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
 ac_abs_confdir=`(
-	cd "$srcdir" && test -r "./$ac_unique_file" || { $as_echo "$as_me: error: $ac_msg" >&2
-   { (exit 1); exit 1; }; }
+	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error $? "$ac_msg"
 	pwd)`
 # When building in place, set srcdir=.
 if test "$ac_abs_confdir" = "$ac_pwd"; then
@@ -1377,7 +1333,7 @@ Configuration:
       --help=short        display options specific to this package
       --help=recursive    display the short help of all the included packages
   -V, --version           display version information and exit
-  -q, --quiet, --silent   do not print \`checking...' messages
+  -q, --quiet, --silent   do not print \`checking ...' messages
       --cache-file=FILE   cache test results in FILE [disabled]
   -C, --config-cache      alias for \`--cache-file=config.cache'
   -n, --no-create         do not create output files
@@ -1481,7 +1437,7 @@ Some influential environment variables:
   LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
               nonstandard directory <lib dir>
   LIBS        libraries to pass to the linker, e.g. -l<library>
-  CPPFLAGS    C/C++/Objective C preprocessor flags, e.g. -I<include dir> if
+  CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
               you have headers in a nonstandard directory <include dir>
   F77         Fortran 77 compiler command
   FFLAGS      Fortran 77 compiler flags
@@ -1554,58 +1510,508 @@ test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
 PAPI configure 4.0.0
-generated by GNU Autoconf 2.63
+generated by GNU Autoconf 2.68
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.
+Copyright (C) 2010 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
   exit
 fi
-cat >config.log <<_ACEOF
-This file contains any messages produced by compilers while
-running configure, to aid debugging if configure makes a mistake.
-
-It was created by PAPI $as_me 4.0.0, which was
-generated by GNU Autoconf 2.63.  Invocation command line was
 
-  $ $0 $@
+## ------------------------ ##
+## Autoconf initialization. ##
+## ------------------------ ##
 
-_ACEOF
-exec 5>>config.log
+# ac_fn_c_try_compile LINENO
+# --------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_compile ()
 {
-cat <<_ASUNAME
-## --------- ##
-## Platform. ##
-## --------- ##
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
-uname -m = `(uname -m) 2>/dev/null || echo unknown`
-uname -r = `(uname -r) 2>/dev/null || echo unknown`
-uname -s = `(uname -s) 2>/dev/null || echo unknown`
-uname -v = `(uname -v) 2>/dev/null || echo unknown`
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
-/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+} # ac_fn_c_try_compile
 
-/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
-/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
-/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
-/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
-/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
-/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
-/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+# ac_fn_f77_try_compile LINENO
+# ----------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_f77_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_f77_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-_ASUNAME
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
 
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
+} # ac_fn_f77_try_compile
+
+# ac_fn_c_try_cpp LINENO
+# ----------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_cpp
+
+# ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists, giving a warning if it cannot be compiled using
+# the include files in INCLUDES and setting the cache variable VAR
+# accordingly.
+ac_fn_c_check_header_mongrel ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if eval \${$3+:} false; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+else
+  # Is the header compilable?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 usability" >&5
+$as_echo_n "checking $2 usability... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_header_compiler=yes
+else
+  ac_header_compiler=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler" >&5
+$as_echo "$ac_header_compiler" >&6; }
+
+# Is the header present?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 presence" >&5
+$as_echo_n "checking $2 presence... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <$2>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  ac_header_preproc=yes
+else
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
+$as_echo "$ac_header_preproc" >&6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in #((
+  yes:no: )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&5
+$as_echo "$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+  no:yes:* )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled" >&5
+$as_echo "$as_me: WARNING: $2: present but cannot be compiled" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?" >&5
+$as_echo "$as_me: WARNING: $2:     check for missing prerequisite headers?" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation" >&5
+$as_echo "$as_me: WARNING: $2: see the Autoconf documentation" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&5
+$as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+( $as_echo "## ------------------------------------------ ##
+## Report this to ptools-perfapi@eecs.utk.edu ##
+## ------------------------------------------ ##"
+     ) | sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=\$ac_header_compiler"
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_header_mongrel
+
+# ac_fn_c_try_run LINENO
+# ----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes
+# that executables *can* be run.
+ac_fn_c_try_run ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: program exited with status $ac_status" >&5
+       $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+       ac_retval=$ac_status
+fi
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_run
+
+# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists and can be compiled using the include files in
+# INCLUDES, setting the cache variable VAR accordingly.
+ac_fn_c_check_header_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_header_compile
+
+# ac_fn_c_try_link LINENO
+# -----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 $as_test_x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_link
+
+# ac_fn_c_check_func LINENO FUNC VAR
+# ----------------------------------
+# Tests whether FUNC exists, setting the cache variable VAR accordingly
+ac_fn_c_check_func ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+/* Define $2 to an innocuous variant, in case <limits.h> declares $2.
+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
+#define $2 innocuous_$2
+
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $2 (); below.
+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+    <limits.h> exists even on freestanding compilers.  */
+
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+
+#undef $2
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char $2 ();
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined __stub_$2 || defined __stub___$2
+choke me
+#endif
+
+int
+main ()
+{
+return $2 ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_func
+
+# ac_fn_c_check_member LINENO AGGR MEMBER VAR INCLUDES
+# ----------------------------------------------------
+# Tries to find if the field MEMBER exists in type AGGR, after including
+# INCLUDES, setting cache variable VAR accordingly.
+ac_fn_c_check_member ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2.$3" >&5
+$as_echo_n "checking for $2.$3... " >&6; }
+if eval \${$4+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$5
+int
+main ()
+{
+static $2 ac_aggr;
+if (ac_aggr.$3)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$4=yes"
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$5
+int
+main ()
+{
+static $2 ac_aggr;
+if (sizeof ac_aggr.$3)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$4=yes"
+else
+  eval "$4=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$4
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_member
+cat >config.log <<_ACEOF
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
+
+It was created by PAPI $as_me 4.0.0, which was
+generated by GNU Autoconf 2.68.  Invocation command line was
+
+  $ $0 $@
+
+_ACEOF
+exec 5>>config.log
+{
+cat <<_ASUNAME
+## --------- ##
+## Platform. ##
+## --------- ##
+
+hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
+
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+
+/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
+/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
+/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
+/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+
+_ASUNAME
+
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  $as_echo "PATH: $as_dir"
-done
+    $as_echo "PATH: $as_dir"
+  done
 IFS=$as_save_IFS
 
 } >&5
@@ -1642,9 +2048,9 @@ do
       ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
     esac
     case $ac_pass in
-    1) ac_configure_args0="$ac_configure_args0 '$ac_arg'" ;;
+    1) as_fn_append ac_configure_args0 " '$ac_arg'" ;;
     2)
-      ac_configure_args1="$ac_configure_args1 '$ac_arg'"
+      as_fn_append ac_configure_args1 " '$ac_arg'"
       if test $ac_must_keep_next = true; then
 	ac_must_keep_next=false # Got value, back to normal.
       else
@@ -1660,13 +2066,13 @@ do
 	  -* ) ac_must_keep_next=true ;;
 	esac
       fi
-      ac_configure_args="$ac_configure_args '$ac_arg'"
+      as_fn_append ac_configure_args " '$ac_arg'"
       ;;
     esac
   done
 done
-$as_unset ac_configure_args0 || test "${ac_configure_args0+set}" != set || { ac_configure_args0=; export ac_configure_args0; }
-$as_unset ac_configure_args1 || test "${ac_configure_args1+set}" != set || { ac_configure_args1=; export ac_configure_args1; }
+{ ac_configure_args0=; unset ac_configure_args0;}
+{ ac_configure_args1=; unset ac_configure_args1;}
 
 # When interrupted or exit'd, cleanup temporary files, and complete
 # config.log.  We remove comments because anyway the quotes in there
@@ -1678,11 +2084,9 @@ trap 'exit_status=$?
   {
     echo
 
-    cat <<\_ASBOX
-## ---------------- ##
+    $as_echo "## ---------------- ##
 ## Cache variables. ##
-## ---------------- ##
-_ASBOX
+## ---------------- ##"
     echo
     # The following way of writing the cache mishandles newlines in values,
 (
@@ -1691,13 +2095,13 @@ _ASBOX
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -1716,11 +2120,9 @@ $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
 )
     echo
 
-    cat <<\_ASBOX
-## ----------------- ##
+    $as_echo "## ----------------- ##
 ## Output variables. ##
-## ----------------- ##
-_ASBOX
+## ----------------- ##"
     echo
     for ac_var in $ac_subst_vars
     do
@@ -1733,11 +2135,9 @@ _ASBOX
     echo
 
     if test -n "$ac_subst_files"; then
-      cat <<\_ASBOX
-## ------------------- ##
+      $as_echo "## ------------------- ##
 ## File substitutions. ##
-## ------------------- ##
-_ASBOX
+## ------------------- ##"
       echo
       for ac_var in $ac_subst_files
       do
@@ -1751,11 +2151,9 @@ _ASBOX
     fi
 
     if test -s confdefs.h; then
-      cat <<\_ASBOX
-## ----------- ##
+      $as_echo "## ----------- ##
 ## confdefs.h. ##
-## ----------- ##
-_ASBOX
+## ----------- ##"
       echo
       cat confdefs.h
       echo
@@ -1769,46 +2167,53 @@ _ASBOX
     exit $exit_status
 ' 0
 for ac_signal in 1 2 13 15; do
-  trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
+  trap 'ac_signal='$ac_signal'; as_fn_exit 1' $ac_signal
 done
 ac_signal=0
 
 # confdefs.h avoids OS command line length limits that DEFS can exceed.
 rm -f -r conftest* confdefs.h
 
+$as_echo "/* confdefs.h */" > confdefs.h
+
 # Predefined preprocessor variables.
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_NAME "$PACKAGE_NAME"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_TARNAME "$PACKAGE_TARNAME"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_VERSION "$PACKAGE_VERSION"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_STRING "$PACKAGE_STRING"
 _ACEOF
 
-
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
 _ACEOF
 
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_URL "$PACKAGE_URL"
+_ACEOF
+
 
 # Let the site file select an alternate cache file if it wants to.
 # Prefer an explicitly selected file to automatically selected ones.
 ac_site_file1=NONE
 ac_site_file2=NONE
 if test -n "$CONFIG_SITE"; then
-  ac_site_file1=$CONFIG_SITE
+  # We do not want a PATH search for config.site.
+  case $CONFIG_SITE in #((
+    -*)  ac_site_file1=./$CONFIG_SITE;;
+    */*) ac_site_file1=$CONFIG_SITE;;
+    *)   ac_site_file1=./$CONFIG_SITE;;
+  esac
 elif test "x$prefix" != xNONE; then
   ac_site_file1=$prefix/share/config.site
   ac_site_file2=$prefix/etc/config.site
@@ -1819,19 +2224,23 @@ fi
 for ac_site_file in "$ac_site_file1" "$ac_site_file2"
 do
   test "x$ac_site_file" = xNONE && continue
-  if test -r "$ac_site_file"; then
-    { $as_echo "$as_me:$LINENO: loading site script $ac_site_file" >&5
+  if test /dev/null != "$ac_site_file" && test -r "$ac_site_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
 $as_echo "$as_me: loading site script $ac_site_file" >&6;}
     sed 's/^/| /' "$ac_site_file" >&5
-    . "$ac_site_file"
+    . "$ac_site_file" \
+      || { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "failed to load site script $ac_site_file
+See \`config.log' for more details" "$LINENO" 5; }
   fi
 done
 
 if test -r "$cache_file"; then
-  # Some versions of bash will fail to source /dev/null (special
-  # files actually), so we avoid doing that.
-  if test -f "$cache_file"; then
-    { $as_echo "$as_me:$LINENO: loading cache $cache_file" >&5
+  # Some versions of bash will fail to source /dev/null (special files
+  # actually), so we avoid doing that.  DJGPP emulates it as a regular file.
+  if test /dev/null != "$cache_file" && test -f "$cache_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading cache $cache_file" >&5
 $as_echo "$as_me: loading cache $cache_file" >&6;}
     case $cache_file in
       [\\/]* | ?:[\\/]* ) . "$cache_file";;
@@ -1839,7 +2248,7 @@ $as_echo "$as_me: loading cache $cache_file" >&6;}
     esac
   fi
 else
-  { $as_echo "$as_me:$LINENO: creating cache $cache_file" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: creating cache $cache_file" >&5
 $as_echo "$as_me: creating cache $cache_file" >&6;}
   >$cache_file
 fi
@@ -1854,11 +2263,11 @@ for ac_var in $ac_precious_vars; do
   eval ac_new_val=\$ac_env_${ac_var}_value
   case $ac_old_set,$ac_new_set in
     set,)
-      { $as_echo "$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
 $as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
       ac_cache_corrupted=: ;;
     ,set)
-      { $as_echo "$as_me:$LINENO: error: \`$ac_var' was not set in the previous run" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was not set in the previous run" >&5
 $as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
       ac_cache_corrupted=: ;;
     ,);;
@@ -1868,17 +2277,17 @@ $as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
 	ac_old_val_w=`echo x $ac_old_val`
 	ac_new_val_w=`echo x $ac_new_val`
 	if test "$ac_old_val_w" != "$ac_new_val_w"; then
-	  { $as_echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' has changed since the previous run:" >&5
 $as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
 	  ac_cache_corrupted=:
 	else
-	  { $as_echo "$as_me:$LINENO: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
 $as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
 	  eval $ac_var=\$ac_old_val
 	fi
-	{ $as_echo "$as_me:$LINENO:   former value:  \`$ac_old_val'" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   former value:  \`$ac_old_val'" >&5
 $as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
-	{ $as_echo "$as_me:$LINENO:   current value: \`$ac_new_val'" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   current value: \`$ac_new_val'" >&5
 $as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
       fi;;
   esac
@@ -1890,43 +2299,20 @@ $as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
     esac
     case " $ac_configure_args " in
       *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
-      *) ac_configure_args="$ac_configure_args '$ac_arg'" ;;
+      *) as_fn_append ac_configure_args " '$ac_arg'" ;;
     esac
   fi
 done
 if $ac_cache_corrupted; then
-  { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-  { $as_echo "$as_me:$LINENO: error: changes in the environment can compromise the build" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
 $as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  { { $as_echo "$as_me:$LINENO: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
-$as_echo "$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
 fi
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
+## -------------------- ##
+## Main body of script. ##
+## -------------------- ##
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -1981,27 +2367,28 @@ use_shared=yes
 use_static=yes
 use_static_tests=no
 use_x86_cache_info=no
-{ $as_echo "$as_me:$LINENO: checking for architecture" >&5
+distributed_build=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for architecture" >&5
 $as_echo_n "checking for architecture... " >&6; }
 
 # Check whether --with-arch was given.
-if test "${with_arch+set}" = set; then
+if test "${with_arch+set}" = set; then :
   withval=$with_arch; arch=$withval
 else
   arch=`uname -m`
 fi
 
-{ $as_echo "$as_me:$LINENO: result: $arch" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $arch" >&5
 $as_echo "$arch" >&6; }
 
 #
 #checking for OS
 #
-{ $as_echo "$as_me:$LINENO: checking for OS" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for OS" >&5
 $as_echo_n "checking for OS... " >&6; }
 
 # Check whether --with-OS was given.
-if test "${with_OS+set}" = set; then
+if test "${with_OS+set}" = set; then :
   withval=$with_OS; OS=$withval
 else
 
@@ -2027,7 +2414,7 @@ fi
 
 fi
 
-{ $as_echo "$as_me:$LINENO: result: $OS" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $OS" >&5
 $as_echo "$OS" >&6; }
 if test "$OS" = "bgl"; then
    if test "x$CC" = "x"; then
@@ -2065,11 +2452,11 @@ fi
 #
 #checking for OS version number
 #
-{ $as_echo "$as_me:$LINENO: checking for OS version" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for OS version" >&5
 $as_echo_n "checking for OS version... " >&6; }
 
 # Check whether --with-OSVER was given.
-if test "${with_OSVER+set}" = set; then
+if test "${with_OSVER+set}" = set; then :
   withval=$with_OSVER; OSVER=$withval
 else
 
@@ -2081,18 +2468,22 @@ esac
 
 fi
 
-{ $as_echo "$as_me:$LINENO: result: $OSVER" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $OSVER" >&5
 $as_echo "$OSVER" >&6; }
 
 #
 # checking for CPU type
 #
-{ $as_echo "$as_me:$LINENO: checking for CPU type" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for CPU type" >&5
 $as_echo_n "checking for CPU type... " >&6; }
 
 # Check whether --with-CPU was given.
-if test "${with_CPU+set}" = set; then
+if test "${with_CPU+set}" = set; then :
   withval=$with_CPU; CPU=$withval
+             case "$CPU" in
+               core | core2 | i7 | atom | p4 | p3 | opteron | athlon)
+                 use_x86_cache_info=yes;;
+             esac
 else
 
 
@@ -2113,7 +2504,6 @@ case "$OS" in
            made=GenuineIntel
            family="`cat /proc/cpuinfo | grep family | cut -d: -f2 | cut -d' ' -f2 | sed '2,$d'`"
            model="`cat /proc/cpuinfo | grep model | cut -d: -f2 | cut -d' ' -f2 | sed '2,$d'`"
-           # family 15 is always P4; model 1 is vanilla pre-HT, model 2 is vanilla; model 3 is em64t, 4 is Pentium D, 6 is Xeon D
            if test "$family" = "6"; then
              # model 14 is an ancient Core
              if test "$model" = "14"; then
@@ -2125,8 +2515,9 @@ case "$OS" in
                CPU=core2
                use_x86_cache_info=yes
              fi
-             # model 26 is Nehalem
-             if test "$model" = "26"; then
+             # models 26, 30, 37, 44, 46 are Nehalem variants
+             if (test "$model" = "26" || test "$model" = "30" || test "$model" = "37" ||
+                 test "$model" = "44" || test "$model" = "46"); then
                CPU=i7
                use_x86_cache_info=yes
              fi
@@ -2135,14 +2526,10 @@ case "$OS" in
                CPU=atom
                use_x86_cache_info=yes
              fi
+           # family 15 is always P4
            elif test "$family" = "15"; then
-             if (test "$model" = "3" || test "$model" = "4" || test "$model" = "6"); then
-               CPU=em64t
-               use_x86_cache_info=yes
-             elif (test "$model" = "1" || test "$model" = "2"); then
                CPU=p4
                use_x86_cache_info=yes
-             fi
            elif test "$family" = "32"; then
 	       CPU=montecito
 	   elif test "$family" = "31"; then
@@ -2157,7 +2544,8 @@ case "$OS" in
              elif test "`cat /proc/cpuinfo | grep -i "Pentium III"`" != ""; then
                CPU=p3
                use_x86_cache_info=yes
-	     else CPU=p3
+	     else
+               CPU=p3
                use_x86_cache_info=yes
              fi
            fi
@@ -2220,15 +2608,11 @@ case "$OS" in
                     CPU=niagara2
                     ;;
                 *)
-                    { { $as_echo "$as_me:$LINENO: error: Sorry, machine type ($machinetype) not supported" >&5
-$as_echo "$as_me: error: Sorry, machine type ($machinetype) not supported" >&2;}
-   { (exit 1); exit 1; }; }
+                    as_fn_error $? "Sorry, machine type ($machinetype) not supported" "$LINENO" 5
                     ;;
            esac
          else
-            { { $as_echo "$as_me:$LINENO: error: Sorry, only SPARC-machines on Solaris are supported." >&5
-$as_echo "$as_me: error: Sorry, only SPARC-machines on Solaris are supported." >&2;}
-   { (exit 1); exit 1; }; }
+            as_fn_error $? "Sorry, only SPARC-machines on Solaris are supported." "$LINENO" 5
          fi
          ;;
   bgl)
@@ -2241,7 +2625,7 @@ esac
 
 fi
 
-{ $as_echo "$as_me:$LINENO: result: $CPU" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPU" >&5
 $as_echo "$CPU" >&6; }
 
 cat >>confdefs.h <<_ACEOF
@@ -2249,39 +2633,37 @@ cat >>confdefs.h <<_ACEOF
 _ACEOF
 
 if test "$cross_compiling" = "no" -a "$OS" = "linux" -a "$CPU" = "mips"; then
-	  { $as_echo "$as_me:$LINENO: checking for /etc/sicortex-release" >&5
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for /etc/sicortex-release" >&5
 $as_echo_n "checking for /etc/sicortex-release... " >&6; }
-if test "${ac_cv_file__etc_sicortex_release+set}" = set; then
+if ${ac_cv_file__etc_sicortex_release+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "/etc/sicortex-release"; then
   ac_cv_file__etc_sicortex_release=yes
 else
   ac_cv_file__etc_sicortex_release=no
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_file__etc_sicortex_release" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_file__etc_sicortex_release" >&5
 $as_echo "$ac_cv_file__etc_sicortex_release" >&6; }
-if test "x$ac_cv_file__etc_sicortex_release" = x""yes; then
+if test "x$ac_cv_file__etc_sicortex_release" = xyes; then :
   CPU=sicortex
 fi
 
 	  if test "$CPU" = "sicortex"; then
    	     F77=pathf95
 # V2.3 R81 has a good cycle timer, everything else is broken
-             { $as_echo "$as_me:$LINENO: checking for working cycle fast trap" >&5
+             { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working cycle fast trap" >&5
 $as_echo_n "checking for working cycle fast trap... " >&6; }
 	     hasgoodcycletimer=`cat /etc/sicortex-release | grep "V2.[23]"`
 	     if test "x$hasgoodcycletimer" != "x"; then
 		walltimer=cycle
-		{ $as_echo "$as_me:$LINENO: result: yes" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	     else
-		{ $as_echo "$as_me:$LINENO: result: no" >&5
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	     fi
 	  fi
@@ -2304,12 +2686,12 @@ fi
 #
 # Check for bitmode, this sucks and needs to be redone
 #
-{ $as_echo "$as_me:$LINENO: checking for 32 or 64 bit mode" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for 32 or 64 bit mode" >&5
 $as_echo_n "checking for 32 or 64 bit mode... " >&6; }
 if test "x$bitmode" = "x"; then
 
 # Check whether --with-bitmode was given.
-if test "${with_bitmode+set}" = set; then
+if test "${with_bitmode+set}" = set; then :
   withval=$with_bitmode; bitmode=$withval
 else
   bitmode=default
@@ -2326,13 +2708,11 @@ case "$bitmode" in
       bitmode=""
       BM="";;
     *)
-      { { $as_echo "$as_me:$LINENO: error: The bitmode you specified is not supported" >&5
-$as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "The bitmode you specified is not supported" "$LINENO" 5
       ;;
 esac
 fi
-{ $as_echo "$as_me:$LINENO: result: $bitmode" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $bitmode" >&5
 $as_echo "$bitmode" >&6; }
 
 # Set FFLAGS to null to prevent AC_PROG_F77 from defaulting it to -g -O2
@@ -2346,9 +2726,9 @@ for ac_prog in gawk mawk nawk awk
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_AWK+set}" = set; then
+if ${ac_cv_prog_AWK+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$AWK"; then
@@ -2359,24 +2739,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_AWK="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 AWK=$ac_cv_prog_AWK
 if test -n "$AWK"; then
-  { $as_echo "$as_me:$LINENO: result: $AWK" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AWK" >&5
 $as_echo "$AWK" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2394,9 +2774,9 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -2407,24 +2787,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2434,9 +2814,9 @@ if test -z "$ac_cv_prog_CC"; then
   ac_ct_CC=$CC
   # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -2447,24 +2827,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CC="gcc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2473,7 +2853,7 @@ fi
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -2487,9 +2867,9 @@ if test -z "$CC"; then
           if test -n "$ac_tool_prefix"; then
     # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -2500,24 +2880,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2527,9 +2907,9 @@ fi
 if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -2541,18 +2921,18 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
      fi
     ac_cv_prog_CC="cc"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 if test $ac_prog_rejected = yes; then
@@ -2571,10 +2951,10 @@ fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2586,9 +2966,9 @@ if test -z "$CC"; then
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -2599,24 +2979,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2630,9 +3010,9 @@ if test -z "$CC"; then
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -2643,24 +3023,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -2673,7 +3053,7 @@ done
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -2684,57 +3064,37 @@ fi
 fi
 
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
 
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -2750,8 +3110,8 @@ ac_clean_files="$ac_clean_files a.out a.out.dSYM a.exe b.out"
 # Try to create an executable without -o first, disregard a.out.
 # It will help us diagnose broken compilers, and finding out an intuition
 # of exeext.
-{ $as_echo "$as_me:$LINENO: checking for C compiler default output file name" >&5
-$as_echo_n "checking for C compiler default output file name... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler works" >&5
+$as_echo_n "checking whether the C compiler works... " >&6; }
 ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
 
 # The possible output files:
@@ -2767,17 +3127,17 @@ do
 done
 rm -f $ac_rmfiles
 
-if { (ac_try="$ac_link_default"
+if { { ac_try="$ac_link_default"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_link_default") 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
   # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
 # So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
 # in a Makefile.  We should not override ac_cv_exeext if it was cached,
@@ -2794,7 +3154,7 @@ do
 	# certainly right.
 	break;;
     *.* )
-        if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
+	if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
 	then :; else
 	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
 	fi
@@ -2813,84 +3173,41 @@ test "$ac_cv_exeext" = no && ac_cv_exeext=
 else
   ac_file=''
 fi
-
-{ $as_echo "$as_me:$LINENO: result: $ac_file" >&5
-$as_echo "$ac_file" >&6; }
-if test -z "$ac_file"; then
-  $as_echo "$as_me: failed program was:" >&5
+if test -z "$ac_file"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+$as_echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: C compiler cannot create executables
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: C compiler cannot create executables
-See \`config.log' for more details." >&2;}
-   { (exit 77); exit 77; }; }; }
+as_fn_error 77 "C compiler cannot create executables
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 fi
-
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler default output file name" >&5
+$as_echo_n "checking for C compiler default output file name... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_file" >&5
+$as_echo "$ac_file" >&6; }
 ac_exeext=$ac_cv_exeext
 
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:$LINENO: checking whether the C compiler works" >&5
-$as_echo_n "checking whether the C compiler works... " >&6; }
-# FIXME: These cross compiler hacks should be removed for Autoconf 3.0
-# If not cross compiling, check that we can run a simple program.
-if test "$cross_compiling" != yes; then
-  if { ac_try='./$ac_file'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-    cross_compiling=no
-  else
-    if test "$cross_compiling" = maybe; then
-	cross_compiling=yes
-    else
-	{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run C compiled programs.
-If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-    fi
-  fi
-fi
-{ $as_echo "$as_me:$LINENO: result: yes" >&5
-$as_echo "yes" >&6; }
-
 rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
 ac_clean_files=$ac_clean_files_save
-# Check that the compiler produces executables we can run.  If not, either
-# the compiler is broken, or we cross compile.
-{ $as_echo "$as_me:$LINENO: checking whether we are cross compiling" >&5
-$as_echo_n "checking whether we are cross compiling... " >&6; }
-{ $as_echo "$as_me:$LINENO: result: $cross_compiling" >&5
-$as_echo "$cross_compiling" >&6; }
-
-{ $as_echo "$as_me:$LINENO: checking for suffix of executables" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of executables" >&5
 $as_echo_n "checking for suffix of executables... " >&6; }
-if { (ac_try="$ac_link"
+if { { ac_try="$ac_link"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_link") 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
   # If both `conftest.exe' and `conftest' are `present' (well, observable)
 # catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
 # work properly (i.e., refer to `conftest.exe'), while it won't with
@@ -2905,32 +3222,83 @@ for ac_file in conftest.exe conftest conftest.*; do
   esac
 done
 else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details" "$LINENO" 5; }
 fi
-
-rm -f conftest$ac_cv_exeext
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_exeext" >&5
+rm -f conftest conftest$ac_cv_exeext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
 $as_echo "$ac_cv_exeext" >&6; }
 
 rm -f conftest.$ac_ext
 EXEEXT=$ac_cv_exeext
 ac_exeext=$EXEEXT
-{ $as_echo "$as_me:$LINENO: checking for suffix of object files" >&5
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+FILE *f = fopen ("conftest.out", "w");
+ return ferror (f) || fclose (f) != 0;
+
+  ;
+  return 0;
+}
+_ACEOF
+ac_clean_files="$ac_clean_files conftest.out"
+# Check that the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are cross compiling" >&5
+$as_echo_n "checking whether we are cross compiling... " >&6; }
+if test "$cross_compiling" != yes; then
+  { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+  if { ac_try='./conftest$ac_cv_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then
+    cross_compiling=no
+  else
+    if test "$cross_compiling" = maybe; then
+	cross_compiling=yes
+    else
+	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run C compiled programs.
+If you meant to cross compile, use \`--host'.
+See \`config.log' for more details" "$LINENO" 5; }
+    fi
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cross_compiling" >&5
+$as_echo "$cross_compiling" >&6; }
+
+rm -f conftest.$ac_ext conftest$ac_cv_exeext conftest.out
+ac_clean_files=$ac_clean_files_save
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of object files" >&5
 $as_echo_n "checking for suffix of object files... " >&6; }
-if test "${ac_cv_objext+set}" = set; then
+if ${ac_cv_objext+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -2942,17 +3310,17 @@ main ()
 }
 _ACEOF
 rm -f conftest.o conftest.obj
-if { (ac_try="$ac_compile"
+if { { ac_try="$ac_compile"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
   (eval "$ac_compile") 2>&5
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; then
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
   for ac_file in conftest.o conftest.obj conftest.*; do
   test -f "$ac_file" || continue;
   case $ac_file in
@@ -2965,31 +3333,23 @@ else
   $as_echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-{ { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "cannot compute suffix of object files: cannot compile
+See \`config.log' for more details" "$LINENO" 5; }
 fi
-
 rm -f conftest.$ac_cv_objext conftest.$ac_ext
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_objext" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_objext" >&5
 $as_echo "$ac_cv_objext" >&6; }
 OBJEXT=$ac_cv_objext
 ac_objext=$OBJEXT
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
 $as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
+if ${ac_cv_c_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3003,37 +3363,16 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
 $as_echo "$ac_cv_c_compiler_gnu" >&6; }
 if test $ac_compiler_gnu = yes; then
   GCC=yes
@@ -3042,20 +3381,16 @@ else
 fi
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
 $as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
+if ${ac_cv_prog_cc_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_c_werror_flag=$ac_c_werror_flag
    ac_c_werror_flag=yes
    ac_cv_prog_cc_g=no
    CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3066,35 +3401,11 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3105,36 +3416,12 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_compile "$LINENO"; then :
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
 	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3145,42 +3432,17 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_c_werror_flag=$ac_save_c_werror_flag
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
 $as_echo "$ac_cv_prog_cc_g" >&6; }
 if test "$ac_test_CFLAGS" = set; then
   CFLAGS=$ac_save_CFLAGS
@@ -3197,18 +3459,14 @@ else
     CFLAGS=
   fi
 fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
 $as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
+if ${ac_cv_prog_cc_c89+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_prog_cc_c89=no
 ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
@@ -3265,32 +3523,9 @@ for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
 	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
   CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+  if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext
   test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
@@ -3301,17 +3536,19 @@ fi
 # AC_CACHE_VAL
 case "x$ac_cv_prog_cc_c89" in
   x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
 $as_echo "none needed" >&6; } ;;
   xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
 $as_echo "unsupported" >&6; } ;;
   *)
     CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
 $as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
 esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
 
+fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -3327,13 +3564,13 @@ ac_compile='$F77 -c $FFLAGS conftest.$ac_ext >&5'
 ac_link='$F77 -o conftest$ac_exeext $FFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_f77_compiler_gnu
 if test -n "$ac_tool_prefix"; then
-  for ac_prog in g77 xlf f77 frt pgf77 cf77 fort77 fl32 af77 xlf90 f90 pgf90 pghpf epcf90 gfortran g95 xlf95 f95 fort ifort ifc efc pgf95 lf95 ftn
+  for ac_prog in g77 xlf f77 frt pgf77 cf77 fort77 fl32 af77 xlf90 f90 pgf90 pghpf epcf90 gfortran g95 xlf95 f95 fort ifort ifc efc pgfortran pgf95 lf95 ftn
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_F77+set}" = set; then
+if ${ac_cv_prog_F77+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$F77"; then
@@ -3344,24 +3581,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_F77="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 F77=$ac_cv_prog_F77
 if test -n "$F77"; then
-  { $as_echo "$as_me:$LINENO: result: $F77" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $F77" >&5
 $as_echo "$F77" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3371,13 +3608,13 @@ fi
 fi
 if test -z "$F77"; then
   ac_ct_F77=$F77
-  for ac_prog in g77 xlf f77 frt pgf77 cf77 fort77 fl32 af77 xlf90 f90 pgf90 pghpf epcf90 gfortran g95 xlf95 f95 fort ifort ifc efc pgf95 lf95 ftn
+  for ac_prog in g77 xlf f77 frt pgf77 cf77 fort77 fl32 af77 xlf90 f90 pgf90 pghpf epcf90 gfortran g95 xlf95 f95 fort ifort ifc efc pgfortran pgf95 lf95 ftn
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_F77+set}" = set; then
+if ${ac_cv_prog_ac_ct_F77+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_F77"; then
@@ -3388,24 +3625,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_F77="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_F77=$ac_cv_prog_ac_ct_F77
 if test -n "$ac_ct_F77"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_F77" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_F77" >&5
 $as_echo "$ac_ct_F77" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3418,7 +3655,7 @@ done
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -3428,54 +3665,41 @@ fi
 
 
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for Fortran 77 compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for Fortran 77 compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 rm -f a.out
 
 # If we don't use `.F' as extension, the preprocessor is not run on the
 # input file.  (Note that this only needs to work for GNU compilers.)
 ac_save_ext=$ac_ext
 ac_ext=F
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU Fortran 77 compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU Fortran 77 compiler" >&5
 $as_echo_n "checking whether we are using the GNU Fortran 77 compiler... " >&6; }
-if test "${ac_cv_f77_compiler_gnu+set}" = set; then
+if ${ac_cv_f77_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
+  cat > conftest.$ac_ext <<_ACEOF
       program main
 #ifndef __GNUC__
        choke me
@@ -3483,83 +3707,41 @@ else
 
       end
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_f77_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_f77_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_f77_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_f77_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_f77_compiler_gnu" >&5
 $as_echo "$ac_cv_f77_compiler_gnu" >&6; }
 ac_ext=$ac_save_ext
 ac_test_FFLAGS=${FFLAGS+set}
 ac_save_FFLAGS=$FFLAGS
 FFLAGS=
-{ $as_echo "$as_me:$LINENO: checking whether $F77 accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $F77 accepts -g" >&5
 $as_echo_n "checking whether $F77 accepts -g... " >&6; }
-if test "${ac_cv_prog_f77_g+set}" = set; then
+if ${ac_cv_prog_f77_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   FFLAGS=-g
-cat >conftest.$ac_ext <<_ACEOF
+cat > conftest.$ac_ext <<_ACEOF
       program main
 
       end
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_f77_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_f77_try_compile "$LINENO"; then :
   ac_cv_prog_f77_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_prog_f77_g=no
+  ac_cv_prog_f77_g=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_f77_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_f77_g" >&5
 $as_echo "$ac_cv_prog_f77_g" >&6; }
 if test "$ac_test_FFLAGS" = set; then
   FFLAGS=$ac_save_FFLAGS
@@ -3602,9 +3784,9 @@ if test -n "$ac_tool_prefix"; then
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_CC+set}" = set; then
+if ${ac_cv_prog_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$CC"; then
@@ -3615,24 +3797,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  { $as_echo "$as_me:$LINENO: result: $CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
 $as_echo "$CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3646,9 +3828,9 @@ if test -z "$CC"; then
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_CC"; then
@@ -3659,24 +3841,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
 $as_echo "$ac_ct_CC" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -3689,7 +3871,7 @@ done
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -3698,62 +3880,42 @@ esac
 fi
 
 
-test -z "$CC" && { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
 
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for C compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
 $as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if test "${ac_cv_c_compiler_gnu+set}" = set; then
+if ${ac_cv_c_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3767,37 +3929,16 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
 $as_echo "$ac_cv_c_compiler_gnu" >&6; }
 if test $ac_compiler_gnu = yes; then
   GCC=yes
@@ -3806,20 +3947,16 @@ else
 fi
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
 $as_echo_n "checking whether $CC accepts -g... " >&6; }
-if test "${ac_cv_prog_cc_g+set}" = set; then
+if ${ac_cv_prog_cc_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_save_c_werror_flag=$ac_c_werror_flag
    ac_c_werror_flag=yes
    ac_cv_prog_cc_g=no
    CFLAGS="-g"
-   cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3830,35 +3967,11 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	CFLAGS=""
-      cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3869,36 +3982,12 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_compile "$LINENO"; then :
 
-	ac_c_werror_flag=$ac_save_c_werror_flag
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
 	 CFLAGS="-g"
-	 cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -3909,42 +3998,17 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_g=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
    ac_c_werror_flag=$ac_save_c_werror_flag
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
 $as_echo "$ac_cv_prog_cc_g" >&6; }
 if test "$ac_test_CFLAGS" = set; then
   CFLAGS=$ac_save_CFLAGS
@@ -3961,18 +4025,14 @@ else
     CFLAGS=
   fi
 fi
-{ $as_echo "$as_me:$LINENO: checking for $CC option to accept ISO C89" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
 $as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if test "${ac_cv_prog_cc_c89+set}" = set; then
+if ${ac_cv_prog_cc_c89+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_cv_prog_cc_c89=no
 ac_save_CC=$CC
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
@@ -4029,32 +4089,9 @@ for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
 	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
   CC="$ac_save_CC $ac_arg"
-  rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+  if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_prog_cc_c89=$ac_arg
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-
 fi
-
 rm -f core conftest.err conftest.$ac_objext
   test "x$ac_cv_prog_cc_c89" != "xno" && break
 done
@@ -4065,17 +4102,19 @@ fi
 # AC_CACHE_VAL
 case "x$ac_cv_prog_cc_c89" in
   x)
-    { $as_echo "$as_me:$LINENO: result: none needed" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
 $as_echo "none needed" >&6; } ;;
   xno)
-    { $as_echo "$as_me:$LINENO: result: unsupported" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
 $as_echo "unsupported" >&6; } ;;
   *)
     CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:$LINENO: result: $ac_cv_prog_cc_c89" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
 $as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
 esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
 
+fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -4092,9 +4131,9 @@ if test -n "$ac_tool_prefix"; then
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_F77+set}" = set; then
+if ${ac_cv_prog_F77+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$F77"; then
@@ -4105,24 +4144,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_F77="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 F77=$ac_cv_prog_F77
 if test -n "$F77"; then
-  { $as_echo "$as_me:$LINENO: result: $F77" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $F77" >&5
 $as_echo "$F77" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4136,9 +4175,9 @@ if test -z "$F77"; then
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_F77+set}" = set; then
+if ${ac_cv_prog_ac_ct_F77+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_F77"; then
@@ -4149,24 +4188,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_F77="$ac_prog"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_F77=$ac_cv_prog_ac_ct_F77
 if test -n "$ac_ct_F77"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_F77" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_F77" >&5
 $as_echo "$ac_ct_F77" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4179,7 +4218,7 @@ done
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -4189,54 +4228,41 @@ fi
 
 
 # Provide some information about the compiler.
-$as_echo "$as_me:$LINENO: checking for Fortran 77 compiler version" >&5
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for Fortran 77 compiler version" >&5
 set X $ac_compile
 ac_compiler=$2
-{ (ac_try="$ac_compiler --version >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler --version >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -v >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -v >&5") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
-{ (ac_try="$ac_compiler -V >&5"
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compiler -V >&5") 2>&5
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
   ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 rm -f a.out
 
 # If we don't use `.F' as extension, the preprocessor is not run on the
 # input file.  (Note that this only needs to work for GNU compilers.)
 ac_save_ext=$ac_ext
 ac_ext=F
-{ $as_echo "$as_me:$LINENO: checking whether we are using the GNU Fortran 77 compiler" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU Fortran 77 compiler" >&5
 $as_echo_n "checking whether we are using the GNU Fortran 77 compiler... " >&6; }
-if test "${ac_cv_f77_compiler_gnu+set}" = set; then
+if ${ac_cv_f77_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
+  cat > conftest.$ac_ext <<_ACEOF
       program main
 #ifndef __GNUC__
        choke me
@@ -4244,83 +4270,41 @@ else
 
       end
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_f77_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_f77_try_compile "$LINENO"; then :
   ac_compiler_gnu=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_compiler_gnu=no
+  ac_compiler_gnu=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 ac_cv_f77_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_f77_compiler_gnu" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_f77_compiler_gnu" >&5
 $as_echo "$ac_cv_f77_compiler_gnu" >&6; }
 ac_ext=$ac_save_ext
 ac_test_FFLAGS=${FFLAGS+set}
 ac_save_FFLAGS=$FFLAGS
 FFLAGS=
-{ $as_echo "$as_me:$LINENO: checking whether $F77 accepts -g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $F77 accepts -g" >&5
 $as_echo_n "checking whether $F77 accepts -g... " >&6; }
-if test "${ac_cv_prog_f77_g+set}" = set; then
+if ${ac_cv_prog_f77_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   FFLAGS=-g
-cat >conftest.$ac_ext <<_ACEOF
+cat > conftest.$ac_ext <<_ACEOF
       program main
 
       end
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_f77_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_f77_try_compile "$LINENO"; then :
   ac_cv_prog_f77_g=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_prog_f77_g=no
+  ac_cv_prog_f77_g=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_prog_f77_g" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_f77_g" >&5
 $as_echo "$ac_cv_prog_f77_g" >&6; }
 if test "$ac_test_FFLAGS" = set; then
   FFLAGS=$ac_save_FFLAGS
@@ -4355,14 +4339,14 @@ ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ $as_echo "$as_me:$LINENO: checking how to run the C preprocessor" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
 $as_echo_n "checking how to run the C preprocessor... " >&6; }
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
 fi
 if test -z "$CPP"; then
-  if test "${ac_cv_prog_CPP+set}" = set; then
+  if ${ac_cv_prog_CPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
       # Double quotes because CPP needs to be expanded
@@ -4377,11 +4361,7 @@ do
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -4390,78 +4370,34 @@ cat >>conftest.$ac_ext <<_ACEOF
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
+if ac_fn_c_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
   break
 fi
 
@@ -4473,7 +4409,7 @@ fi
 else
   ac_cv_prog_CPP=$CPP
 fi
-{ $as_echo "$as_me:$LINENO: result: $CPP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
 $as_echo "$CPP" >&6; }
 ac_preproc_ok=false
 for ac_c_preproc_warn_flag in '' yes
@@ -4484,11 +4420,7 @@ do
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #ifdef __STDC__
 # include <limits.h>
@@ -4497,87 +4429,40 @@ cat >>conftest.$ac_ext <<_ACEOF
 #endif
 		     Syntax error
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  :
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_cpp "$LINENO"; then :
 
+else
   # Broken: fails on valid input.
 continue
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
+if ac_fn_c_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
   # Passes both tests.
 ac_preproc_ok=:
 break
 fi
-
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then
-  :
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
 else
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=c
@@ -4586,22 +4471,22 @@ ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-{ $as_echo "$as_me:$LINENO: checking whether ln -s works" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
 $as_echo_n "checking whether ln -s works... " >&6; }
 LN_S=$as_ln_s
 if test "$LN_S" = "ln -s"; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no, using $LN_S" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
 $as_echo "no, using $LN_S" >&6; }
 fi
 
-{ $as_echo "$as_me:$LINENO: checking whether ${MAKE-make} sets \$(MAKE)" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ${MAKE-make} sets \$(MAKE)" >&5
 $as_echo_n "checking whether ${MAKE-make} sets \$(MAKE)... " >&6; }
 set x ${MAKE-make}
 ac_make=`$as_echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
-if { as_var=ac_cv_prog_make_${ac_make}_set; eval "test \"\${$as_var+set}\" = set"; }; then
+if eval \${ac_cv_prog_make_${ac_make}_set+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   cat >conftest.make <<\_ACEOF
@@ -4609,7 +4494,7 @@ SHELL = /bin/sh
 all:
 	@echo '@@@%%%=$(MAKE)=@@@%%%'
 _ACEOF
-# GNU make sometimes prints "make[1]: Entering...", which would confuse us.
+# GNU make sometimes prints "make[1]: Entering ...", which would confuse us.
 case `${MAKE-make} -f conftest.make 2>/dev/null` in
   *@@@%%%=?*=@@@%%%*)
     eval ac_cv_prog_make_${ac_make}_set=yes;;
@@ -4619,11 +4504,11 @@ esac
 rm -f conftest.make
 fi
 if eval test \$ac_cv_prog_make_${ac_make}_set = yes; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
   SET_MAKE=
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
   SET_MAKE="MAKE=${MAKE-make}"
 fi
@@ -4631,9 +4516,9 @@ fi
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_RANLIB+set}" = set; then
+if ${ac_cv_prog_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$RANLIB"; then
@@ -4644,24 +4529,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 RANLIB=$ac_cv_prog_RANLIB
 if test -n "$RANLIB"; then
-  { $as_echo "$as_me:$LINENO: result: $RANLIB" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RANLIB" >&5
 $as_echo "$RANLIB" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4671,9 +4556,9 @@ if test -z "$ac_cv_prog_RANLIB"; then
   ac_ct_RANLIB=$RANLIB
   # Extract the first word of "ranlib", so it can be a program name with args.
 set dummy ranlib; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
+if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -n "$ac_ct_RANLIB"; then
@@ -4684,24 +4569,24 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
 fi
 fi
 ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
 if test -n "$ac_ct_RANLIB"; then
-  { $as_echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RANLIB" >&5
 $as_echo "$ac_ct_RANLIB" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -4710,7 +4595,7 @@ fi
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
-{ $as_echo "$as_me:$LINENO: WARNING: using cross tools not prefixed with host triplet" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
@@ -4721,11 +4606,11 @@ else
 fi
 
 
-{ $as_echo "$as_me:$LINENO: checking for debug build" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for debug build" >&5
 $as_echo_n "checking for debug build... " >&6; }
 
 # Check whether --with-debug was given.
-if test "${with_debug+set}" = set; then
+if test "${with_debug+set}" = set; then :
   withval=$with_debug; debug=$withval
 else
   debug=no
@@ -4744,20 +4629,18 @@ case "$debug" in
    no)
       DEBUGFLAGS="-DPAPI_NO_MEMORY_MANAGEMENT" ;;
    *)
-      { { $as_echo "$as_me:$LINENO: error: The debug option you specified is not supported" >&5
-$as_echo "$as_me: error: The debug option you specified is not supported" >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "The debug option you specified is not supported" "$LINENO" 5
       ;;
 esac
-{ $as_echo "$as_me:$LINENO: result: $debug" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $debug" >&5
 $as_echo "$debug" >&6; }
 
 # Check for GNU extensions
 
 
-{ $as_echo "$as_me:$LINENO: checking for grep that handles long lines and -e" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e" >&5
 $as_echo_n "checking for grep that handles long lines and -e... " >&6; }
-if test "${ac_cv_path_GREP+set}" = set; then
+if ${ac_cv_path_GREP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$GREP"; then
@@ -4768,7 +4651,7 @@ for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in grep ggrep; do
+    for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
       { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
@@ -4788,7 +4671,7 @@ case `"$ac_path_GREP" --version 2>&1` in
     $as_echo 'GREP' >> "conftest.nl"
     "$ac_path_GREP" -e 'GREP$' -e '-(cannot match)-' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_GREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_GREP="$ac_path_GREP"
@@ -4803,26 +4686,24 @@ esac
       $ac_path_GREP_found && break 3
     done
   done
-done
+  done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_GREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_GREP=$GREP
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_GREP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP" >&5
 $as_echo "$ac_cv_path_GREP" >&6; }
  GREP="$ac_cv_path_GREP"
 
 
-{ $as_echo "$as_me:$LINENO: checking for egrep" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
 $as_echo_n "checking for egrep... " >&6; }
-if test "${ac_cv_path_EGREP+set}" = set; then
+if ${ac_cv_path_EGREP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
@@ -4836,7 +4717,7 @@ for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_prog in egrep; do
+    for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
       { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
@@ -4856,7 +4737,7 @@ case `"$ac_path_EGREP" --version 2>&1` in
     $as_echo 'EGREP' >> "conftest.nl"
     "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
     diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    ac_count=`expr $ac_count + 1`
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
     if test $ac_count -gt ${ac_path_EGREP_max-0}; then
       # Best one so far, save it but keep looking for a better one
       ac_cv_path_EGREP="$ac_path_EGREP"
@@ -4871,12 +4752,10 @@ esac
       $ac_path_EGREP_found && break 3
     done
   done
-done
+  done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_EGREP"; then
-    { { $as_echo "$as_me:$LINENO: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&5
-$as_echo "$as_me: error: no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_EGREP=$EGREP
@@ -4884,21 +4763,17 @@ fi
 
    fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_path_EGREP" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
 $as_echo "$ac_cv_path_EGREP" >&6; }
  EGREP="$ac_cv_path_EGREP"
 
 
-{ $as_echo "$as_me:$LINENO: checking for ANSI C header files" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
+if ${ac_cv_header_stdc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 #include <stdarg.h>
@@ -4913,48 +4788,23 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_header_stdc=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_header_stdc=no
+  ac_cv_header_stdc=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <string.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -4964,18 +4814,14 @@ fi
 
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
+  $EGREP "free" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -4985,14 +4831,10 @@ fi
 
 if test $ac_cv_header_stdc = yes; then
   # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
   :
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ctype.h>
 #include <stdlib.h>
@@ -5019,372 +4861,111 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_run "$LINENO"; then :
 
-( exit $ac_status )
-ac_cv_header_stdc=no
+else
+  ac_cv_header_stdc=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
 $as_echo "$ac_cv_header_stdc" >&6; }
 if test $ac_cv_header_stdc = yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
 fi
 
 # On IRIX 5.3, sys/types and inttypes.h are conflicting.
+for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
+		  inttypes.h stdint.h unistd.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
+"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
 
+done
 
 
 
+  ac_fn_c_check_header_mongrel "$LINENO" "minix/config.h" "ac_cv_header_minix_config_h" "$ac_includes_default"
+if test "x$ac_cv_header_minix_config_h" = xyes; then :
+  MINIX=yes
+else
+  MINIX=
+fi
 
 
+  if test "$MINIX" = yes; then
 
+$as_echo "#define _POSIX_SOURCE 1" >>confdefs.h
 
 
-for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
-		  inttypes.h stdint.h unistd.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
+$as_echo "#define _POSIX_1_SOURCE 2" >>confdefs.h
+
+
+$as_echo "#define _MINIX 1" >>confdefs.h
+
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether it is safe to define __EXTENSIONS__" >&5
+$as_echo_n "checking whether it is safe to define __EXTENSIONS__... " >&6; }
+if ${ac_cv_safe_to_define___extensions__+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
 
-#include <$ac_header>
+#	  define __EXTENSIONS__ 1
+	  $ac_includes_default
+int
+main ()
+{
+
+  ;
+  return 0;
+}
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  eval "$as_ac_Header=yes"
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_safe_to_define___extensions__=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	eval "$as_ac_Header=no"
+  ac_cv_safe_to_define___extensions__=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_safe_to_define___extensions__" >&5
+$as_echo "$ac_cv_safe_to_define___extensions__" >&6; }
+  test $ac_cv_safe_to_define___extensions__ = yes &&
+    $as_echo "#define __EXTENSIONS__ 1" >>confdefs.h
 
-fi
+  $as_echo "#define _ALL_SOURCE 1" >>confdefs.h
 
-done
+  $as_echo "#define _GNU_SOURCE 1" >>confdefs.h
 
+  $as_echo "#define _POSIX_PTHREAD_SEMANTICS 1" >>confdefs.h
 
+  $as_echo "#define _TANDEM_SOURCE 1" >>confdefs.h
 
-  if test "${ac_cv_header_minix_config_h+set}" = set; then
-  { $as_echo "$as_me:$LINENO: checking for minix/config.h" >&5
-$as_echo_n "checking for minix/config.h... " >&6; }
-if test "${ac_cv_header_minix_config_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_minix_config_h" >&5
-$as_echo "$ac_cv_header_minix_config_h" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking minix/config.h usability" >&5
-$as_echo_n "checking minix/config.h usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <minix/config.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking minix/config.h presence" >&5
-$as_echo_n "checking minix/config.h presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <minix/config.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: minix/config.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: minix/config.h: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: minix/config.h: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: minix/config.h:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: minix/config.h: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: minix/config.h:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: minix/config.h: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: minix/config.h: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: minix/config.h: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ------------------------------------------ ##
-## Report this to ptools-perfapi@eecs.utk.edu ##
-## ------------------------------------------ ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for minix/config.h" >&5
-$as_echo_n "checking for minix/config.h... " >&6; }
-if test "${ac_cv_header_minix_config_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_header_minix_config_h=$ac_header_preproc
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_minix_config_h" >&5
-$as_echo "$ac_cv_header_minix_config_h" >&6; }
-
-fi
-if test "x$ac_cv_header_minix_config_h" = x""yes; then
-  MINIX=yes
-else
-  MINIX=
-fi
-
-
-  if test "$MINIX" = yes; then
-
-cat >>confdefs.h <<\_ACEOF
-#define _POSIX_SOURCE 1
-_ACEOF
-
-
-cat >>confdefs.h <<\_ACEOF
-#define _POSIX_1_SOURCE 2
-_ACEOF
-
-
-cat >>confdefs.h <<\_ACEOF
-#define _MINIX 1
-_ACEOF
-
-  fi
-
-
-
-  { $as_echo "$as_me:$LINENO: checking whether it is safe to define __EXTENSIONS__" >&5
-$as_echo_n "checking whether it is safe to define __EXTENSIONS__... " >&6; }
-if test "${ac_cv_safe_to_define___extensions__+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-#	  define __EXTENSIONS__ 1
-	  $ac_includes_default
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_safe_to_define___extensions__=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_safe_to_define___extensions__=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_safe_to_define___extensions__" >&5
-$as_echo "$ac_cv_safe_to_define___extensions__" >&6; }
-  test $ac_cv_safe_to_define___extensions__ = yes &&
-    cat >>confdefs.h <<\_ACEOF
-#define __EXTENSIONS__ 1
-_ACEOF
-
-  cat >>confdefs.h <<\_ACEOF
-#define _ALL_SOURCE 1
-_ACEOF
-
-  cat >>confdefs.h <<\_ACEOF
-#define _GNU_SOURCE 1
-_ACEOF
-
-  cat >>confdefs.h <<\_ACEOF
-#define _POSIX_PTHREAD_SEMANTICS 1
-_ACEOF
-
-  cat >>confdefs.h <<\_ACEOF
-#define _TANDEM_SOURCE 1
-_ACEOF
 
 
 # Check for standard headers
-{ $as_echo "$as_me:$LINENO: checking for ANSI C header files" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
 $as_echo_n "checking for ANSI C header files... " >&6; }
-if test "${ac_cv_header_stdc+set}" = set; then
+if ${ac_cv_header_stdc+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 #include <stdarg.h>
@@ -5399,48 +4980,23 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
+if ac_fn_c_try_compile "$LINENO"; then :
   ac_cv_header_stdc=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_header_stdc=no
+  ac_cv_header_stdc=no
 fi
-
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <string.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then
-  :
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -5450,18 +5006,14 @@ fi
 
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdlib.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then
-  :
+  $EGREP "free" >/dev/null 2>&1; then :
+
 else
   ac_cv_header_stdc=no
 fi
@@ -5471,14 +5023,10 @@ fi
 
 if test $ac_cv_header_stdc = yes; then
   # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then
+  if test "$cross_compiling" = yes; then :
   :
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ctype.h>
 #include <stdlib.h>
@@ -5505,51 +5053,22 @@ main ()
   return 0;
 }
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  :
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+if ac_fn_c_try_run "$LINENO"; then :
 
-( exit $ac_status )
-ac_cv_header_stdc=no
+else
+  ac_cv_header_stdc=no
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
 $as_echo "$ac_cv_header_stdc" >&6; }
 if test $ac_cv_header_stdc = yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define STDC_HEADERS 1
-_ACEOF
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
 fi
 
@@ -5564,102 +5083,16 @@ didcheck=0
 if test "x$ffsll" = "x"; then
 
 # Check whether --with-ffsll was given.
-if test "${with_ffsll+set}" = set; then
+if test "${with_ffsll+set}" = set; then :
   withval=$with_ffsll; ffsll=$withval
 else
   ffsll=""
 if test "$cross_compiling" = "yes" ; then
-   { { $as_echo "$as_me:$LINENO: error: ffsll must be specified for cross compile." >&5
-$as_echo "$as_me: error: ffsll must be specified for cross compile." >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "ffsll must be specified for cross compile." "$LINENO" 5
 		  fi
 didcheck=1
-{ $as_echo "$as_me:$LINENO: checking for ffsll" >&5
-$as_echo_n "checking for ffsll... " >&6; }
-if test "${ac_cv_func_ffsll+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define ffsll to an innocuous variant, in case <limits.h> declares ffsll.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define ffsll innocuous_ffsll
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char ffsll (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef ffsll
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char ffsll ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_ffsll || defined __stub___ffsll
-choke me
-#endif
-
-int
-main ()
-{
-return ffsll ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_func_ffsll=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_func_ffsll=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_func_ffsll" >&5
-$as_echo "$ac_cv_func_ffsll" >&6; }
-if test "x$ac_cv_func_ffsll" = x""yes; then
+ac_fn_c_check_func "$LINENO" "ffsll" "ac_cv_func_ffsll"
+if test "x$ac_cv_func_ffsll" = xyes; then :
   ffsll=yes
 else
   ffsll=no
@@ -5670,128 +5103,72 @@ fi
 
 fi
 if test $didcheck = 0; then
-{ $as_echo "$as_me:$LINENO: checking for ffsll" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ffsll" >&5
 $as_echo_n "checking for ffsll... " >&6; }
 case "$ffsll" in
    yes)
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_FFSLL 1
-_ACEOF
+$as_echo "#define HAVE_FFSLL 1" >>confdefs.h
 
 		  ;;
    no)
       ;;
    *)
-     { { $as_echo "$as_me:$LINENO: error: Unknown value for ffsll" >&5
-$as_echo "$as_me: error: Unknown value for ffsll" >&2;}
-   { (exit 1); exit 1; }; }
+     as_fn_error $? "Unknown value for ffsll" "$LINENO" 5
       ;;
 esac
-{ $as_echo "$as_me:$LINENO: result: $ffsll" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ffsll" >&5
 $as_echo "$ffsll" >&6; }
 fi
 
 #
 # Look for working gettid
 #
-{ $as_echo "$as_me:$LINENO: checking for working gettid" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for working gettid" >&5
 $as_echo_n "checking for working gettid... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
 #include <sys/types.h>
 main() { pid_t a = gettid(); }
 
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_GETTID 1
-_ACEOF
+$as_echo "#define HAVE_GETTID 1" >>confdefs.h
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-
-{ $as_echo "$as_me:$LINENO: result: no" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-{ $as_echo "$as_me:$LINENO: checking for working syscall(SYS_gettid)" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for working syscall(SYS_gettid)" >&5
 $as_echo_n "checking for working syscall(SYS_gettid)... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
 #include <sys/types.h>
 #include <sys/syscall.h>
 main() { pid_t a = syscall(SYS_gettid); }
 
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  { $as_echo "$as_me:$LINENO: result: yes" >&5
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_SYSCALL_GETTID 1
-_ACEOF
+$as_echo "#define HAVE_SYSCALL_GETTID 1" >>confdefs.h
 
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
 
-{ $as_echo "$as_me:$LINENO: result: no" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
 #
 # Look for good real time clocks
@@ -5799,31 +5176,22 @@ rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
 if test "x$walltimer" = "x"; then
 
 # Check whether --with-walltimer was given.
-if test "${with_walltimer+set}" = set; then
+if test "${with_walltimer+set}" = set; then :
   withval=$with_walltimer; walltimer=$withval
 else
   walltimer=""
 if test "$cross_compiling" = "yes" ; then
-   { { $as_echo "$as_me:$LINENO: error: walltimer must be specified for cross compile." >&5
-$as_echo "$as_me: error: walltimer must be specified for cross compile." >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "walltimer must be specified for cross compile." "$LINENO" 5
          fi
-{ $as_echo "$as_me:$LINENO: checking for working MMTIMER" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for working MMTIMER" >&5
 $as_echo_n "checking for working MMTIMER... " >&6; }
-if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <unistd.h>
@@ -5852,58 +5220,25 @@ int main()
 }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
 
 	walltimer="mmtimer"
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-( exit $ac_status )
-
-{ $as_echo "$as_me:$LINENO: result: no" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-{ $as_echo "$as_me:$LINENO: checking for working CLOCK_REALTIME_HR POSIX 1b timer" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for working CLOCK_REALTIME_HR POSIX 1b timer" >&5
 $as_echo_n "checking for working CLOCK_REALTIME_HR POSIX 1b timer... " >&6; }
-if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <unistd.h>
@@ -5928,58 +5263,25 @@ main()
 }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
 
 	walltimer="clock_realtime_hr"
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
 
-{ $as_echo "$as_me:$LINENO: result: no" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-{ $as_echo "$as_me:$LINENO: checking for working CLOCK_REALTIME POSIX 1b timer" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for working CLOCK_REALTIME POSIX 1b timer" >&5
 $as_echo_n "checking for working CLOCK_REALTIME POSIX 1b timer... " >&6; }
-if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <unistd.h>
@@ -6004,103 +5306,62 @@ main()
 }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
 
 	walltimer="clock_realtime"
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
 
 	walltimer="cycle"
-	{ $as_echo "$as_me:$LINENO: result: no" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 
          fi
-{ $as_echo "$as_me:$LINENO: checking for real time clock or cycle counter" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for real time clock or cycle counter" >&5
 $as_echo_n "checking for real time clock or cycle counter... " >&6; }
 if test "$walltimer" = "gettimeofday"; then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_GETTIMEOFDAY 1
-_ACEOF
+$as_echo "#define HAVE_GETTIMEOFDAY 1" >>confdefs.h
 
 elif test "$walltimer" = "mmtimer"; then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_MMTIMER 1
-_ACEOF
+$as_echo "#define HAVE_MMTIMER 1" >>confdefs.h
 
    altix="-DALTIX"
 elif test "$walltimer" = "clock_realtime_hr"; then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_CLOCK_GETTIME_REALTIME CLOCK_REALTIME_HR
-_ACEOF
+$as_echo "#define HAVE_CLOCK_GETTIME_REALTIME CLOCK_REALTIME_HR" >>confdefs.h
 
 elif test "$walltimer" = "clock_realtime"; then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_CLOCK_GETTIME_REALTIME CLOCK_REALTIME
-_ACEOF
+$as_echo "#define HAVE_CLOCK_GETTIME_REALTIME CLOCK_REALTIME" >>confdefs.h
 
 elif test "$walltimer" = "cycle"; then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_CYCLE 1
-_ACEOF
+$as_echo "#define HAVE_CYCLE 1" >>confdefs.h
 
 else
-   { { $as_echo "$as_me:$LINENO: error: Unknown value for walltimer" >&5
-$as_echo "$as_me: error: Unknown value for walltimer" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "Unknown value for walltimer" "$LINENO" 5
 fi
-{ $as_echo "$as_me:$LINENO: result: $walltimer" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $walltimer" >&5
 $as_echo "$walltimer" >&6; }
 
 #
@@ -6119,32 +5380,23 @@ OLDLIBS=$LIBS
 if test "x$tls" = "x"; then
 
 # Check whether --with-tls was given.
-if test "${with_tls+set}" = set; then
+if test "${with_tls+set}" = set; then :
   withval=$with_tls; tls=$withval
 else
 
 if test "$cross_compiling" = "yes" ; then
-   { { $as_echo "$as_me:$LINENO: error: tls must be specified for cross compile." >&5
-$as_echo "$as_me: error: tls must be specified for cross compile." >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "tls must be specified for cross compile." "$LINENO" 5
 fi
-      { $as_echo "$as_me:$LINENO: checking for working __thread" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working __thread" >&5
 $as_echo_n "checking for working __thread... " >&6; }
       #echo $with_tls
-      if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+      if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
              #include <pthread.h>
@@ -6180,50 +5432,23 @@ cat >>conftest.$ac_ext <<_ACEOF
              }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
 
-            { $as_echo "$as_me:$LINENO: result: yes" >&5
+            { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	    tls="__thread"
 
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
 
-            { $as_echo "$as_me:$LINENO: result: no" >&5
+            { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
             tls="no"
 
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
      #if test "x$TARGET" = "xAMD64" -o "x$TARGET" = "xX86"; then
      if test "$OS" = "linux"; then
         if test "x$tls" = "x__thread"; then
@@ -6237,7 +5462,7 @@ fi
                 gcc -fPIC --shared -o conftest.so conftest.c > /dev/null 2>&1
                 gcc -o conftest conftest.so > /dev/null 2>&1
                 if test ! -f conftest; then
-                   { $as_echo "$as_me:$LINENO: WARNING: Disabling usage of __thread." >&5
+                   { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Disabling usage of __thread." >&5
 $as_echo "$as_me: WARNING: Disabling usage of __thread." >&2;};
                    tls="no"
                 fi
@@ -6248,7 +5473,7 @@ $as_echo "$as_me: WARNING: Disabling usage of __thread." >&2;};
 fi
 
 fi
-{ $as_echo "$as_me:$LINENO: checking for high performance thread local storage" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for high performance thread local storage" >&5
 $as_echo_n "checking for high performance thread local storage... " >&6; }
 if test "$tls" = "no"; then
         NOTLS="-DNO_TLS"
@@ -6263,17 +5488,15 @@ cat >>confdefs.h <<_ACEOF
 _ACEOF
 
 fi
-{ $as_echo "$as_me:$LINENO: result: $tls" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $tls" >&5
 $as_echo "$tls" >&6; }
 
 # Check whether --enable-papi-vector was given.
-if test "${enable_papi_vector+set}" = set; then
+if test "${enable_papi_vector+set}" = set; then :
   enableval=$enable_papi_vector;
 	if test "$enableval" != "yes" ; then
 
-cat >>confdefs.h <<\_ACEOF
-#define PAPI_NO_VECTOR 1
-_ACEOF
+$as_echo "#define PAPI_NO_VECTOR 1" >>confdefs.h
 
 	fi
 fi
@@ -6282,31 +5505,22 @@ fi
 if test "x$virtualtimer" = "x"; then
 
 # Check whether --with-virtualtimer was given.
-if test "${with_virtualtimer+set}" = set; then
+if test "${with_virtualtimer+set}" = set; then :
   withval=$with_virtualtimer; virtualtimer=$withval
 else
 
 if test "$cross_compiling" = "yes" ; then
-   { { $as_echo "$as_me:$LINENO: error: virtualtimer must be specified for cross compile." >&5
-$as_echo "$as_me: error: virtualtimer must be specified for cross compile." >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "virtualtimer must be specified for cross compile." "$LINENO" 5
 fi
-{ $as_echo "$as_me:$LINENO: checking for working CLOCK_THREAD_CPUTIME_ID POSIX 1b timer" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for working CLOCK_THREAD_CPUTIME_ID POSIX 1b timer" >&5
 $as_echo_n "checking for working CLOCK_THREAD_CPUTIME_ID POSIX 1b timer... " >&6; }
-      if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+      if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
         #include <pthread.h>
@@ -6385,59 +5599,26 @@ void *doThreadTwo( void * v ) {
         }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
 
-            { $as_echo "$as_me:$LINENO: result: yes" >&5
+            { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
     virtualtimer="clock_thread_cputime_id"
 
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-( exit $ac_status )
-
-      { $as_echo "$as_me:$LINENO: result: no" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
       #       NOTLS="" ;;
-                        { $as_echo "$as_me:$LINENO: checking for working per-thread times() timer" >&5
+                        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working per-thread times() timer" >&5
 $as_echo_n "checking for working per-thread times() timer... " >&6; }
-if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <pthread.h>
@@ -6512,56 +5693,28 @@ int main( int argc, char ** argv ) {
         }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
 
-	{ $as_echo "$as_me:$LINENO: result: yes" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	virtualtimer="times"
 
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
 
-        { $as_echo "$as_me:$LINENO: result: no" >&5
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 	virtualtimer="default"
 
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 fi
 
 fi
@@ -6570,92 +5723,79 @@ LDFLAGS=$OLDLDFLAGS
 CFLAGS=$OLDCFLAGS
 LIBS=$OLDLIBS
 
-{ $as_echo "$as_me:$LINENO: checking for thread virtual clock or cycle counter" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for thread virtual clock or cycle counter" >&5
 $as_echo_n "checking for thread virtual clock or cycle counter... " >&6; }
 case "$virtualtimer" in
    times)
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PER_THREAD_TIMES 1
-_ACEOF
+$as_echo "#define HAVE_PER_THREAD_TIMES 1" >>confdefs.h
 
    ;;
    getrusage)
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PER_THREAD_GETRUSAGE 1
-_ACEOF
+$as_echo "#define HAVE_PER_THREAD_GETRUSAGE 1" >>confdefs.h
 
    ;;
    clock_thread_cputime_id)
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_CLOCK_GETTIME_THREAD CLOCK_THREAD_CPUTIME_ID
-_ACEOF
+$as_echo "#define HAVE_CLOCK_GETTIME_THREAD CLOCK_THREAD_CPUTIME_ID" >>confdefs.h
 
    ;;
    proc|default|perfctr)
 
-cat >>confdefs.h <<\_ACEOF
-#define USE_PROC_PTTIMER 1
-_ACEOF
+$as_echo "#define USE_PROC_PTTIMER 1" >>confdefs.h
 
 
-cat >>confdefs.h <<\_ACEOF
-#define USE_PERFCTR_PTTIMER 1
-_ACEOF
+$as_echo "#define USE_PERFCTR_PTTIMER 1" >>confdefs.h
 
    ;;
 esac
-{ $as_echo "$as_me:$LINENO: result: $virtualtimer" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $virtualtimer" >&5
 $as_echo "$virtualtimer" >&6; }
 
 if test "x$perfctr" = "x"; then
 
 # Check whether --with-perfctr was given.
-if test "${with_perfctr+set}" = set; then
+if test "${with_perfctr+set}" = set; then :
   withval=$with_perfctr; perfctr=$withval
+             distributed_build=yes
 else
   perfctr="no"
 if test "$cross_compiling" = "no" ; then
-	    { $as_echo "$as_me:$LINENO: checking for /sys/class/perfctr" >&5
+	    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for /sys/class/perfctr" >&5
 $as_echo_n "checking for /sys/class/perfctr... " >&6; }
-if test "${ac_cv_file__sys_class_perfctr+set}" = set; then
+if ${ac_cv_file__sys_class_perfctr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "/sys/class/perfctr"; then
   ac_cv_file__sys_class_perfctr=yes
 else
   ac_cv_file__sys_class_perfctr=no
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_file__sys_class_perfctr" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_file__sys_class_perfctr" >&5
 $as_echo "$ac_cv_file__sys_class_perfctr" >&6; }
-if test "x$ac_cv_file__sys_class_perfctr" = x""yes; then
+if test "x$ac_cv_file__sys_class_perfctr" = xyes; then :
   perfctr=7
 else
-  { $as_echo "$as_me:$LINENO: checking for /dev/perfctr" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for /dev/perfctr" >&5
 $as_echo_n "checking for /dev/perfctr... " >&6; }
-if test "${ac_cv_file__dev_perfctr+set}" = set; then
+if ${ac_cv_file__dev_perfctr+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "/dev/perfctr"; then
   ac_cv_file__dev_perfctr=yes
 else
   ac_cv_file__dev_perfctr=no
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_file__dev_perfctr" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_file__dev_perfctr" >&5
 $as_echo "$ac_cv_file__dev_perfctr" >&6; }
-if test "x$ac_cv_file__dev_perfctr" = x""yes; then
+if test "x$ac_cv_file__dev_perfctr" = xyes; then :
   perfctr=6
 fi
 
@@ -6675,16 +5815,12 @@ case "$perfctr" in
    fi ;;
    7)
    if test "$arch" != "ppc64"; then
-   	{ { $as_echo "$as_me:$LINENO: error: Perfctr 2.7.x is only supported on PPC64 systems" >&5
-$as_echo "$as_me: error: Perfctr 2.7.x is only supported on PPC64 systems" >&2;}
-   { (exit 1); exit 1; }; }
+   	as_fn_error $? "Perfctr 2.7.x is only supported on PPC64 systems" "$LINENO" 5
    fi ;;
    6|no)
       ;;
    *)
-      { { $as_echo "$as_me:$LINENO: error: The perfctr option you specified is not supported" >&5
-$as_echo "$as_me: error: The perfctr option you specified is not supported" >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "The perfctr option you specified is not supported" "$LINENO" 5
       ;;
 esac
 
@@ -6695,8 +5831,9 @@ esac
 
 
 # Check whether --with-perfctr_root was given.
-if test "${with_perfctr_root+set}" = set; then
+if test "${with_perfctr_root+set}" = set; then :
   withval=$with_perfctr_root; perfctr_root=$withval
+             distributed_build=yes
 else
   perfctr_root=""
 
@@ -6704,8 +5841,9 @@ fi
 
 
 # Check whether --with-perfctr_prefix was given.
-if test "${with_perfctr_prefix+set}" = set; then
+if test "${with_perfctr_prefix+set}" = set; then :
   withval=$with_perfctr_prefix; perfctr_prefix=$withval
+             distributed_build=yes
 else
   perfctr_prefix=""
 
@@ -6713,8 +5851,9 @@ fi
 
 
 # Check whether --with-perfctr_incdir was given.
-if test "${with_perfctr_incdir+set}" = set; then
+if test "${with_perfctr_incdir+set}" = set; then :
   withval=$with_perfctr_incdir; perfctr_incdir=$withval
+            distributed_build=yes
 else
   perfctr_incdir=""
 
@@ -6722,8 +5861,9 @@ fi
 
 
 # Check whether --with-perfctr_libdir was given.
-if test "${with_perfctr_libdir+set}" = set; then
+if test "${with_perfctr_libdir+set}" = set; then :
   withval=$with_perfctr_libdir; perfctr_libdir=$withval
+            distributed_build=yes
 else
   perfctr_libdir=""
 
@@ -6732,51 +5872,48 @@ fi
 
 
 # Check whether --with-perfmon was given.
-if test "${with_perfmon+set}" = set; then
+if test "${with_perfmon+set}" = set; then :
   withval=$with_perfmon; perfmon=$withval
+             distributed_build=yes
 else
   perfmon=0
 	    if test "$cross_compiling" = "no" ; then
-	       { $as_echo "$as_me:$LINENO: checking for /sys/kernel/perfmon/version" >&5
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: checking for /sys/kernel/perfmon/version" >&5
 $as_echo_n "checking for /sys/kernel/perfmon/version... " >&6; }
-if test "${ac_cv_file__sys_kernel_perfmon_version+set}" = set; then
+if ${ac_cv_file__sys_kernel_perfmon_version+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "/sys/kernel/perfmon/version"; then
   ac_cv_file__sys_kernel_perfmon_version=yes
 else
   ac_cv_file__sys_kernel_perfmon_version=no
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_file__sys_kernel_perfmon_version" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_file__sys_kernel_perfmon_version" >&5
 $as_echo "$ac_cv_file__sys_kernel_perfmon_version" >&6; }
-if test "x$ac_cv_file__sys_kernel_perfmon_version" = x""yes; then
+if test "x$ac_cv_file__sys_kernel_perfmon_version" = xyes; then :
 
 	       perfmon=`cat /sys/kernel/perfmon/version`
 
 else
-  { $as_echo "$as_me:$LINENO: checking for /proc/perfmon" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for /proc/perfmon" >&5
 $as_echo_n "checking for /proc/perfmon... " >&6; }
-if test "${ac_cv_file__proc_perfmon+set}" = set; then
+if ${ac_cv_file__proc_perfmon+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "/proc/perfmon"; then
   ac_cv_file__proc_perfmon=yes
 else
   ac_cv_file__proc_perfmon=no
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_file__proc_perfmon" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_file__proc_perfmon" >&5
 $as_echo "$ac_cv_file__proc_perfmon" >&6; }
-if test "x$ac_cv_file__proc_perfmon" = x""yes; then
+if test "x$ac_cv_file__proc_perfmon" = xyes; then :
 
 	       perfmon=`cat /proc/perfmon | grep version | cut -d: -f2`
 
@@ -6792,7 +5929,7 @@ fi
 
 
 if test "$perfmon" != 0; then
-   { $as_echo "$as_me:$LINENO: checking for perfmon version" >&5
+   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for perfmon version" >&5
 $as_echo_n "checking for perfmon version... " >&6; }
 #   AC_MSG_RESULT("x${perfmon}x")
    perfmon=`echo ${perfmon} | sed 's/^ \t*//;s/ \t*$//'`
@@ -6800,12 +5937,10 @@ $as_echo_n "checking for perfmon version... " >&6; }
    perfmon=`echo ${perfmon} | grep -e '[1-9]\.[0-9][0-9]*'`
 #   AC_MSG_RESULT($perfmon)
    if test "x$perfmon" = "x"; then
-      { { $as_echo "$as_me:$LINENO: error: \"Badly formed perfmon version string\"" >&5
-$as_echo "$as_me: error: \"Badly formed perfmon version string\"" >&2;}
-   { (exit 1); exit 1; }; }
+      as_fn_error $? "\"Badly formed perfmon version string\"" "$LINENO" 5
       perfmon=0
    fi
-   { $as_echo "$as_me:$LINENO: result: $perfmon" >&5
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $perfmon" >&5
 $as_echo "$perfmon" >&6; }
    perfmon=`echo ${perfmon} | sed 's/\.//'`
 fi
@@ -6817,8 +5952,9 @@ fi
 
 
 # Check whether --with-pfm_root was given.
-if test "${with_pfm_root+set}" = set; then
+if test "${with_pfm_root+set}" = set; then :
   withval=$with_pfm_root; pfm_root=$withval
+            distributed_build=yes
 else
   pfm_root=""
 
@@ -6826,8 +5962,9 @@ fi
 
 
 # Check whether --with-pfm_prefix was given.
-if test "${with_pfm_prefix+set}" = set; then
+if test "${with_pfm_prefix+set}" = set; then :
   withval=$with_pfm_prefix; pfm_prefix=$withval
+            distributed_build=yes
 else
   pfm_prefix=""
 
@@ -6835,8 +5972,9 @@ fi
 
 
 # Check whether --with-pfm_incdir was given.
-if test "${with_pfm_incdir+set}" = set; then
+if test "${with_pfm_incdir+set}" = set; then :
   withval=$with_pfm_incdir; pfm_incdir=$withval
+            distributed_build=yes
 else
   pfm_incdir=""
 
@@ -6844,8 +5982,9 @@ fi
 
 
 # Check whether --with-pfm_libdir was given.
-if test "${with_pfm_libdir+set}" = set; then
+if test "${with_pfm_libdir+set}" = set; then :
   withval=$with_pfm_libdir; pfm_libdir=$withval
+            distributed_build=yes
 else
   pfm_libdir=""
 
@@ -6868,11 +6007,9 @@ fi
 # Look for perf_event.h or perf_counter.h in user specified path else default to /usr/include/linux
 
 # Check whether --with-pe_incdir was given.
-if test "${with_pe_incdir+set}" = set; then
+if test "${with_pe_incdir+set}" = set; then :
   withval=$with_pe_incdir; case "$with_pe_incdir" in
-               yes|''|no) { { $as_echo "$as_me:$LINENO: error: --with-pe-incdir requires a path" >&5
-$as_echo "$as_me: error: --with-pe-incdir requires a path" >&2;}
-   { (exit 1); exit 1; }; } ;;
+               yes|''|no) as_fn_error $? "--with-pe-incdir requires a path" "$LINENO" 5 ;;
                *) pe_incdir=$with_pe_incdir
                   perf_events="yes" ;;
             esac
@@ -6883,28 +6020,23 @@ fi
 
 # Linux 2.6.32 and newer check
 as_ac_File=`$as_echo "ac_cv_file_$pe_incdir/perf_event.h" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $pe_incdir/perf_event.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $pe_incdir/perf_event.h" >&5
 $as_echo_n "checking for $pe_incdir/perf_event.h... " >&6; }
-if { as_var=$as_ac_File; eval "test \"\${$as_var+set}\" = set"; }; then
+if eval \${$as_ac_File+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "$pe_incdir/perf_event.h"; then
   eval "$as_ac_File=yes"
 else
   eval "$as_ac_File=no"
 fi
 fi
-ac_res=`eval 'as_val=${'$as_ac_File'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
+eval ac_res=\$$as_ac_File
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_File'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+if eval test \"x\$"$as_ac_File"\" = x"yes"; then :
   PEPATH="$pe_incdir/perf_event.h"
 fi
 
@@ -6912,28 +6044,23 @@ fi
 # Linux 2.6.31 check
 if test "x$PEPATH" = "x"; then
 as_ac_File=`$as_echo "ac_cv_file_$pe_incdir/perf_counter.h" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $pe_incdir/perf_counter.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $pe_incdir/perf_counter.h" >&5
 $as_echo_n "checking for $pe_incdir/perf_counter.h... " >&6; }
-if { as_var=$as_ac_File; eval "test \"\${$as_var+set}\" = set"; }; then
+if eval \${$as_ac_File+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "$pe_incdir/perf_counter.h"; then
   eval "$as_ac_File=yes"
 else
   eval "$as_ac_File=no"
 fi
 fi
-ac_res=`eval 'as_val=${'$as_ac_File'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
+eval ac_res=\$$as_ac_File
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_File'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+if eval test \"x\$"$as_ac_File"\" = x"yes"; then :
   PEPATH="$pe_incdir/perf_counter.h"
 	   CFLAGS="$CFLAGS -DKERNEL31"
 fi
@@ -6942,7 +6069,7 @@ fi
 
 
 # Check whether --with-perf_events was given.
-if test "${with_perf_events+set}" = set; then
+if test "${with_perf_events+set}" = set; then :
   withval=$with_perf_events; perf_events=$withval
 fi
 
@@ -6953,28 +6080,23 @@ pe_incdir="/lib/modules/$OSVER/source/include/linux"
 
 # Linux 2.6.32 and newer check
 as_ac_File=`$as_echo "ac_cv_file_$pe_incdir/perf_event.h" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $pe_incdir/perf_event.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $pe_incdir/perf_event.h" >&5
 $as_echo_n "checking for $pe_incdir/perf_event.h... " >&6; }
-if { as_var=$as_ac_File; eval "test \"\${$as_var+set}\" = set"; }; then
+if eval \${$as_ac_File+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "$pe_incdir/perf_event.h"; then
   eval "$as_ac_File=yes"
 else
   eval "$as_ac_File=no"
 fi
 fi
-ac_res=`eval 'as_val=${'$as_ac_File'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
+eval ac_res=\$$as_ac_File
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_File'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+if eval test \"x\$"$as_ac_File"\" = x"yes"; then :
   PEPATH="$pe_incdir/perf_event.h"
 fi
 
@@ -6982,28 +6104,23 @@ fi
 # Linux 2.6.31 check
 if test "x$PEPATH" = "x"; then
 as_ac_File=`$as_echo "ac_cv_file_$pe_incdir/perf_counter.h" | $as_tr_sh`
-{ $as_echo "$as_me:$LINENO: checking for $pe_incdir/perf_counter.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $pe_incdir/perf_counter.h" >&5
 $as_echo_n "checking for $pe_incdir/perf_counter.h... " >&6; }
-if { as_var=$as_ac_File; eval "test \"\${$as_var+set}\" = set"; }; then
+if eval \${$as_ac_File+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   test "$cross_compiling" = yes &&
-  { { $as_echo "$as_me:$LINENO: error: cannot check for file existence when cross compiling" >&5
-$as_echo "$as_me: error: cannot check for file existence when cross compiling" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "cannot check for file existence when cross compiling" "$LINENO" 5
 if test -r "$pe_incdir/perf_counter.h"; then
   eval "$as_ac_File=yes"
 else
   eval "$as_ac_File=no"
 fi
 fi
-ac_res=`eval 'as_val=${'$as_ac_File'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
+eval ac_res=\$$as_ac_File
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
-as_val=`eval 'as_val=${'$as_ac_File'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
+if eval test \"x\$"$as_ac_File"\" = x"yes"; then :
   PEPATH="$pe_incdir/perf_counter.h"
 	   CFLAGS="$CFLAGS -DKERNEL31"
 fi
@@ -7019,15 +6136,13 @@ fi
 fi
 # Linux perf event end
 
-if test "$perf_events" = "no" -a "$perfctr" = "no" -a "$perfmon" = "0"; then
-  { { $as_echo "$as_me:$LINENO: error: No performance monitoring interface available" >&5
-$as_echo "$as_me: error: No performance monitoring interface available" >&2;}
-   { (exit 1); exit 1; }; }
+if test "$distributed_build" = "no" -a "$perf_events" = "no" -a "$perfctr" = "no" -a "$perfmon" = "0"; then
+  as_fn_error $? "No performance monitoring interface available" "$LINENO" 5
 fi
 
 
 # Check whether --with-pmapi was given.
-if test "${with_pmapi+set}" = set; then
+if test "${with_pmapi+set}" = set; then :
   withval=$with_pmapi; pmapi=$withval
 else
   pmapi=default
@@ -7037,7 +6152,7 @@ fi
 if test "x$papi_events" = "x"; then
 
 # Check whether --with-papi_events was given.
-if test "${with_papi_events+set}" = set; then
+if test "${with_papi_events+set}" = set; then :
   withval=$with_papi_events; papi_events=$withval
 else
   papi_events="static"
@@ -7049,7 +6164,7 @@ fi
 # Old IA64 substrate can use semaphores
 
 # Check whether --with-with-semaphores was given.
-if test "${with_with_semaphores+set}" = set; then
+if test "${with_with_semaphores+set}" = set; then :
   withval=$with_with_semaphores; with_semaphores=$withval
 else
   with_semaphores="no"
@@ -7060,7 +6175,7 @@ fi
 if test "x$tests" = "x"; then
 
 # Check whether --with-tests was given.
-if test "${with_tests+set}" = set; then
+if test "${with_tests+set}" = set; then :
   withval=$with_tests; tests=$withval
 else
   tests="ctests ftests"
@@ -7072,7 +6187,7 @@ fi
 if test "$papi_events" = "static"; then
    papi_events_table="papi_events_table.h"
    CFLAGS="$CFLAGS -DSTATIC_PAPI_EVENTS_TABLE"
-{ $as_echo "$as_me:$LINENO: Generating papi_events_table.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: Generating papi_events_table.h" >&5
 $as_echo "$as_me: Generating papi_events_table.h" >&6;}
 sh papi_events_table.sh > papi_events_table.h
 fi
@@ -7087,14 +6202,14 @@ fi
 #
 # Static tests
 #
-{ $as_echo "$as_me:$LINENO: checking for building tests static" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for building tests static" >&5
 $as_echo_n "checking for building tests static... " >&6; }
 # Check whether --enable-static-tests was given.
-if test "${enable_static_tests+set}" = set; then
+if test "${enable_static_tests+set}" = set; then :
   enableval=$enable_static_tests; use_static_tests=$enableval
 fi
 
-{ $as_echo "$as_me:$LINENO: result: $use_static_tests" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $use_static_tests" >&5
 $as_echo "$use_static_tests" >&6; }
 #
 # Fix up: modify LDPATH for static linking if specified
@@ -7107,15 +6222,15 @@ fi
 #
 # Shared and Static Lib options
 #
-{ $as_echo "$as_me:$LINENO: checking for which libraries to build" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for which libraries to build" >&5
 $as_echo_n "checking for which libraries to build... " >&6; }
 # Check whether --enable-shared was given.
-if test "${enable_shared+set}" = set; then
+if test "${enable_shared+set}" = set; then :
   enableval=$enable_shared; use_shared=$enableval
 fi
 
 # Check whether --enable-static was given.
-if test "${enable_static+set}" = set; then
+if test "${enable_static+set}" = set; then :
   enableval=$enable_static; use_static=$enableval
 fi
 
@@ -7127,184 +6242,44 @@ if test "$use_static" = "yes"; then
    papiLIBS="$papiLIBS static"
 fi
 if test "$use_static" = "no" -a "$use_shared" = "no"; then
-   { { $as_echo "$as_me:$LINENO: error: you can't disable both shared and static libs" >&5
-$as_echo "$as_me: error: you can't disable both shared and static libs" >&2;}
-   { (exit 1); exit 1; }; }
+   as_fn_error $? "you can't disable both shared and static libs" "$LINENO" 5
 else
 # Override architectural defaults
-  { $as_echo "$as_me:$LINENO: result: $papiLIBS" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $papiLIBS" >&5
 $as_echo "$papiLIBS" >&6; }
 fi
 #
 #
 #
 if test "$cross_compiling" = "yes" ; then
-{ $as_echo "$as_me:$LINENO: checking for native compiler for header generation" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for native compiler for header generation" >&5
 $as_echo_n "checking for native compiler for header generation... " >&6; }
 
 # Check whether --with-nativecc was given.
-if test "${with_nativecc+set}" = set; then
+if test "${with_nativecc+set}" = set; then :
   withval=$with_nativecc; nativecc=$withval
 else
   nativecc=gcc
 
 fi
 
-{ $as_echo "$as_me:$LINENO: result: $nativecc" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $nativecc" >&5
 $as_echo "$nativecc" >&6; }
 fi
 
 # Checks for libraries.
 if test "$OS" = "solaris"; then
-   if test "${ac_cv_header_libcpc_h+set}" = set; then
-  { $as_echo "$as_me:$LINENO: checking for libcpc.h" >&5
-$as_echo_n "checking for libcpc.h... " >&6; }
-if test "${ac_cv_header_libcpc_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_libcpc_h" >&5
-$as_echo "$ac_cv_header_libcpc_h" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking libcpc.h usability" >&5
-$as_echo_n "checking libcpc.h usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <libcpc.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking libcpc.h presence" >&5
-$as_echo_n "checking libcpc.h presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <libcpc.h>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: libcpc.h: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: libcpc.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: libcpc.h: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: libcpc.h: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: libcpc.h: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: libcpc.h: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: libcpc.h:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: libcpc.h:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: libcpc.h: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: libcpc.h: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: libcpc.h:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: libcpc.h:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: libcpc.h: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: libcpc.h: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: libcpc.h: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: libcpc.h: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ------------------------------------------ ##
-## Report this to ptools-perfapi@eecs.utk.edu ##
-## ------------------------------------------ ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for libcpc.h" >&5
-$as_echo_n "checking for libcpc.h... " >&6; }
-if test "${ac_cv_header_libcpc_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_header_libcpc_h=$ac_header_preproc
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_libcpc_h" >&5
-$as_echo "$ac_cv_header_libcpc_h" >&6; }
-
-fi
-if test "x$ac_cv_header_libcpc_h" = x""yes; then
+   ac_fn_c_check_header_mongrel "$LINENO" "libcpc.h" "ac_cv_header_libcpc_h" "$ac_includes_default"
+if test "x$ac_cv_header_libcpc_h" = xyes; then :
 
                                 CFLAGS="$CFLAGS -lcpc"
-        if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+        if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
         #include <stdlib.h>
@@ -7316,52 +6291,27 @@ cat >>conftest.$ac_ext <<_ACEOF
             if(CPC_VER_CURRENT == 2)
             {
                 exit(0);
+            }else
+            {
+                // Also accept libcpc 3 (Solaris 11.2)
+                exit(0);
             }
 
             exit(1);
         }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
   cpc_version=2
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-cpc_version=0
+  cpc_version=0
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-
 else
-  { { $as_echo "$as_me:$LINENO: error: libcpc is needed for running PAPI on Solaris" >&5
-$as_echo "$as_me: error: libcpc is needed for running PAPI on Solaris" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "libcpc is needed for running PAPI on Solaris" "$LINENO" 5
 
 fi
 
@@ -7382,24 +6332,17 @@ fi
     then
         if test "$cpc_version" != "2"
         then
-            { { $as_echo "$as_me:$LINENO: error: libcpc2 needed for Niagara 2" >&5
-$as_echo "$as_me: error: libcpc2 needed for Niagara 2" >&2;}
-   { (exit 1); exit 1; }; }
+            as_fn_error $? "libcpc2 needed for Niagara 2" "$LINENO" 5
         fi
     else
-
-{ $as_echo "$as_me:$LINENO: checking for cpc_take_sample in -lcpc" >&5
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for cpc_take_sample in -lcpc" >&5
 $as_echo_n "checking for cpc_take_sample in -lcpc... " >&6; }
-if test "${ac_cv_lib_cpc_cpc_take_sample+set}" = set; then
+if ${ac_cv_lib_cpc_cpc_take_sample+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lcpc  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -7417,43 +6360,18 @@ return cpc_take_sample ();
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_cpc_cpc_take_sample=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_cpc_cpc_take_sample=no
+  ac_cv_lib_cpc_cpc_take_sample=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_cpc_cpc_take_sample" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_cpc_cpc_take_sample" >&5
 $as_echo "$ac_cv_lib_cpc_cpc_take_sample" >&6; }
-if test "x$ac_cv_lib_cpc_cpc_take_sample" = x""yes; then
+if test "x$ac_cv_lib_cpc_cpc_take_sample" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_LIBCPC 1
 _ACEOF
@@ -7462,9 +6380,7 @@ _ACEOF
 
 else
 
-              { { $as_echo "$as_me:$LINENO: error: libcpc.a is needed on Solaris, install SUNWcpc" >&5
-$as_echo "$as_me: error: libcpc.a is needed on Solaris, install SUNWcpc" >&2;}
-   { (exit 1); exit 1; }; }
+              as_fn_error $? "libcpc.a is needed on Solaris, install SUNWcpc" "$LINENO" 5
 
 fi
 
@@ -7494,1171 +6410,265 @@ else
    fi
 fi
 if test "$dotest" = 1; then
-{ $as_echo "$as_me:$LINENO: checking for vperfctr_open in -lperfctr" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for vperfctr_open in -lperfctr" >&5
 $as_echo_n "checking for vperfctr_open in -lperfctr... " >&6; }
-if test "${ac_cv_lib_perfctr_vperfctr_open+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lperfctr  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char vperfctr_open ();
-int
-main ()
-{
-return vperfctr_open ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_perfctr_vperfctr_open=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_perfctr_vperfctr_open=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_perfctr_vperfctr_open" >&5
-$as_echo "$ac_cv_lib_perfctr_vperfctr_open" >&6; }
-if test "x$ac_cv_lib_perfctr_vperfctr_open" = x""yes; then
-
-
-for ac_header in libperfctr.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
+if ${ac_cv_lib_perfctr_vperfctr_open+:} false; then :
   $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
 else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ------------------------------------------ ##
-## Report this to ptools-perfapi@eecs.utk.edu ##
-## ------------------------------------------ ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-
-fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-	oCFLAGS=$CFLAGS
-	CFLAGS="$CFLAGS -static"
-	if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-	#include <stdlib.h>
-	#include "libperfctr.h"
-	int main()
-	{
-		if ((PERFCTR_ABI_VERSION >> 24) != 5) { exit(1); }
-       exit(0);
-	}
-
-_ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  perfctr=6
-else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
-perfctr=7
-fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
-fi
-
-
-	CFLAGS=$oCFLAGS
-
-else
-
-	{ { $as_echo "$as_me:$LINENO: error: libperfctr.h could not be found, please examine config.log and rerun configure with different flags" >&5
-$as_echo "$as_me: error: libperfctr.h could not be found, please examine config.log and rerun configure with different flags" >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
-done
-
-else
-
-{ { $as_echo "$as_me:$LINENO: error: libperfctr.a could not be found, please examine config.log and rerun configure with different flags" >&5
-$as_echo "$as_me: error: libperfctr.a could not be found, please examine config.log and rerun configure with different flags" >&2;}
-   { (exit 1); exit 1; }; }
-
-fi
-
-    else
-
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_LIBPERFCTR_H 1
-_ACEOF
-
-fi
-fi
-
-{ $as_echo "$as_me:$LINENO: checking for perfctr version" >&5
-$as_echo_n "checking for perfctr version... " >&6; }
-if test "$perfctr" = "no"; then
-   { $as_echo "$as_me:$LINENO: result: none" >&5
-$as_echo "none" >&6; }
-else
-   { $as_echo "$as_me:$LINENO: result: 2.$perfctr" >&5
-$as_echo "2.$perfctr" >&6; }
-fi
-
-if test "$perfctr" = 7 -a "$arch" != "ppc64"; then
-   { { $as_echo "$as_me:$LINENO: error: Perfctr 2.7.x only works on PPC64 machines. Please repatch your kernel with 2.6.x." >&5
-$as_echo "$as_me: error: Perfctr 2.7.x only works on PPC64 machines. Please repatch your kernel with 2.6.x." >&2;}
-   { (exit 1); exit 1; }; }
-fi
-
-if test "$perfmon" != "0" -o "$perf_events" = "yes"; then
-      dotest=0
-   if test "$pfm_root" != ""; then
-      LIBS="-L$pfm_root/lib -lpfm"
-      CPPFLAGS="-I$pfm_root/include"
-      dotest=1
-   elif test "$pfm_prefix" != ""; then
-      LIBS="-L$pfm_prefix/lib -lpfm"
-      CPPFLAGS="-I$pfm_prefix/include"
-      if test "$pfm_libdir" = ""; then
-         pfm_libdir="$pfm_prefix/lib"
-      fi
-      if test "$pfm_prefix" = ""; then
-         pfm_incdir="$pfm_prefix/include"
-      fi
-      dotest=1
-   else
-      if test "$pfm_libdir" != ""; then
-         LIBS="-L$pfm_libdir -lpfm"
-         dotest=1
-      fi
-      if test "$pfm_incdir" != ""; then
-         CPPFLAGS="-I$pfm_incdir"
-         dotest=1
-      fi
-   fi
-   if test "$dotest" = 1; then
-   { $as_echo "$as_me:$LINENO: checking for pfm_initialize in -lpfm" >&5
-$as_echo_n "checking for pfm_initialize in -lpfm... " >&6; }
-if test "${ac_cv_lib_pfm_pfm_initialize+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lpfm  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char pfm_initialize ();
-int
-main ()
-{
-return pfm_initialize ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_lib_pfm_pfm_initialize=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_pfm_pfm_initialize=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_pfm_pfm_initialize" >&5
-$as_echo "$ac_cv_lib_pfm_pfm_initialize" >&6; }
-if test "x$ac_cv_lib_pfm_pfm_initialize" = x""yes; then
-
-
-for ac_header in perfmon/pfmlib.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ------------------------------------------ ##
-## Report this to ptools-perfapi@eecs.utk.edu ##
-## ------------------------------------------ ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-
-fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-   	if test "$arch" = "ia64"; then
-
-for ac_header in perfmon/pfmlib_montecito.h
-do
-as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  { $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-else
-  # Is the header compilable?
-{ $as_echo "$as_me:$LINENO: checking $ac_header usability" >&5
-$as_echo_n "checking $ac_header usability... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-$ac_includes_default
-#include <$ac_header>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_header_compiler=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_header_compiler=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-$as_echo "$ac_header_compiler" >&6; }
-
-# Is the header present?
-{ $as_echo "$as_me:$LINENO: checking $ac_header presence" >&5
-$as_echo_n "checking $ac_header presence... " >&6; }
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <$ac_header>
-_ACEOF
-if { (ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null && {
-	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       }; then
-  ac_header_preproc=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-  ac_header_preproc=no
-fi
-
-rm -f conftest.err conftest.$ac_ext
-{ $as_echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-$as_echo "$ac_header_preproc" >&6; }
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-$as_echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-$as_echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-$as_echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-$as_echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-$as_echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-$as_echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { $as_echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-$as_echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    ( cat <<\_ASBOX
-## ------------------------------------------ ##
-## Report this to ptools-perfapi@eecs.utk.edu ##
-## ------------------------------------------ ##
-_ASBOX
-     ) | sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-{ $as_echo "$as_me:$LINENO: checking for $ac_header" >&5
-$as_echo_n "checking for $ac_header... " >&6; }
-if { as_var=$as_ac_Header; eval "test \"\${$as_var+set}\" = set"; }; then
-  $as_echo_n "(cached) " >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
-fi
-ac_res=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-	       { $as_echo "$as_me:$LINENO: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-
-fi
-as_val=`eval 'as_val=${'$as_ac_Header'}
-		 $as_echo "$as_val"'`
-   if test "x$as_val" = x""yes; then
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-fi
-
-done
-
-           fi
-   	{ $as_echo "$as_me:$LINENO: checking for pfm_get_event_description" >&5
-$as_echo_n "checking for pfm_get_event_description... " >&6; }
-if test "${ac_cv_func_pfm_get_event_description+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-/* Define pfm_get_event_description to an innocuous variant, in case <limits.h> declares pfm_get_event_description.
-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
-#define pfm_get_event_description innocuous_pfm_get_event_description
-
-/* System header to define __stub macros and hopefully few prototypes,
-    which can conflict with char pfm_get_event_description (); below.
-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-    <limits.h> exists even on freestanding compilers.  */
-
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-
-#undef pfm_get_event_description
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char pfm_get_event_description ();
-/* The GNU C library defines this for functions which it implements
-    to always fail with ENOSYS.  Some functions are actually named
-    something starting with __ and the normal name is an alias.  */
-#if defined __stub_pfm_get_event_description || defined __stub___pfm_get_event_description
-choke me
-#endif
-
-int
-main ()
-{
-return pfm_get_event_description ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
-  ac_cv_func_pfm_get_event_description=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_func_pfm_get_event_description=no
-fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_func_pfm_get_event_description" >&5
-$as_echo "$ac_cv_func_pfm_get_event_description" >&6; }
-if test "x$ac_cv_func_pfm_get_event_description" = x""yes; then
-
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PFM_GET_EVENT_DESCRIPTION 1
-_ACEOF
-
-fi
-
-   	{ $as_echo "$as_me:$LINENO: checking for pfmlib_reg_t.reg_evt_idx" >&5
-$as_echo_n "checking for pfmlib_reg_t.reg_evt_idx... " >&6; }
-if test "${ac_cv_member_pfmlib_reg_t_reg_evt_idx+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "perfmon/pfmlib.h"
-
-int
-main ()
-{
-static pfmlib_reg_t ac_aggr;
-if (ac_aggr.reg_evt_idx)
-return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_member_pfmlib_reg_t_reg_evt_idx=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lperfctr  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include "perfmon/pfmlib.h"
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char vperfctr_open ();
 int
 main ()
 {
-static pfmlib_reg_t ac_aggr;
-if (sizeof ac_aggr.reg_evt_idx)
-return 0;
+return vperfctr_open ();
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_member_pfmlib_reg_t_reg_evt_idx=yes
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_perfctr_vperfctr_open=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_member_pfmlib_reg_t_reg_evt_idx=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  ac_cv_lib_perfctr_vperfctr_open=no
 fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_member_pfmlib_reg_t_reg_evt_idx" >&5
-$as_echo "$ac_cv_member_pfmlib_reg_t_reg_evt_idx" >&6; }
-if test "x$ac_cv_member_pfmlib_reg_t_reg_evt_idx" = x""yes; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_perfctr_vperfctr_open" >&5
+$as_echo "$ac_cv_lib_perfctr_vperfctr_open" >&6; }
+if test "x$ac_cv_lib_perfctr_vperfctr_open" = xyes; then :
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PFM_REG_EVT_IDX 1
+	for ac_header in libperfctr.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "libperfctr.h" "ac_cv_header_libperfctr_h" "$ac_includes_default"
+if test "x$ac_cv_header_libperfctr_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBPERFCTR_H 1
 _ACEOF
 
-fi
-
-   	{ $as_echo "$as_me:$LINENO: checking for pfmlib_output_param_t.pfp_pmd_count" >&5
-$as_echo_n "checking for pfmlib_output_param_t.pfp_pmd_count... " >&6; }
-if test "${ac_cv_member_pfmlib_output_param_t_pfp_pmd_count+set}" = set; then
-  $as_echo_n "(cached) " >&6
+	oCFLAGS=$CFLAGS
+	CFLAGS="$CFLAGS -static"
+	if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include "perfmon/pfmlib.h"
 
-int
-main ()
-{
-static pfmlib_output_param_t ac_aggr;
-if (ac_aggr.pfp_pmd_count)
-return 0;
-  ;
-  return 0;
-}
+	#include <stdlib.h>
+	#include "libperfctr.h"
+	int main()
+	{
+		if ((PERFCTR_ABI_VERSION >> 24) != 5) { exit(1); }
+       exit(0);
+	}
+
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_member_pfmlib_output_param_t_pfp_pmd_count=yes
+if ac_fn_c_try_run "$LINENO"; then :
+  perfctr=6
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  perfctr=7
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "perfmon/pfmlib.h"
+	CFLAGS=$oCFLAGS
 
-int
-main ()
-{
-static pfmlib_output_param_t ac_aggr;
-if (sizeof ac_aggr.pfp_pmd_count)
-return 0;
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_member_pfmlib_output_param_t_pfp_pmd_count=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_member_pfmlib_output_param_t_pfp_pmd_count=no
+	as_fn_error $? "libperfctr.h could not be found, please examine config.log and rerun configure with different flags" "$LINENO" 5
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+
+else
+
+as_fn_error $? "libperfctr.a could not be found, please examine config.log and rerun configure with different flags" "$LINENO" 5
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+    else
+
+$as_echo "#define HAVE_LIBPERFCTR_H 1" >>confdefs.h
+
+fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_member_pfmlib_output_param_t_pfp_pmd_count" >&5
-$as_echo "$ac_cv_member_pfmlib_output_param_t_pfp_pmd_count" >&6; }
-if test "x$ac_cv_member_pfmlib_output_param_t_pfp_pmd_count" = x""yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PFMLIB_OUTPUT_PFP_PMD_COUNT 1
-_ACEOF
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for perfctr version" >&5
+$as_echo_n "checking for perfctr version... " >&6; }
+if test "$perfctr" = "no"; then
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: none" >&5
+$as_echo "none" >&6; }
+else
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: 2.$perfctr" >&5
+$as_echo "2.$perfctr" >&6; }
+fi
 
+if test "$perfctr" = 7 -a "$arch" != "ppc64"; then
+   as_fn_error $? "Perfctr 2.7.x only works on PPC64 machines. Please repatch your kernel with 2.6.x." "$LINENO" 5
 fi
 
-   	{ $as_echo "$as_me:$LINENO: checking for pfm_msg_t.type" >&5
-$as_echo_n "checking for pfm_msg_t.type... " >&6; }
-if test "${ac_cv_member_pfm_msg_t_type+set}" = set; then
+if test "$perfmon" != "0" -o "$perf_events" = "yes"; then
+      dotest=0
+   if test "$pfm_root" != ""; then
+      LIBS="-L$pfm_root/lib -lpfm"
+      CPPFLAGS="-I$pfm_root/include"
+      dotest=1
+   elif test "$pfm_prefix" != ""; then
+      LIBS="-L$pfm_prefix/lib -lpfm"
+      CPPFLAGS="-I$pfm_prefix/include"
+      if test "$pfm_libdir" = ""; then
+         pfm_libdir="$pfm_prefix/lib"
+      fi
+      if test "$pfm_prefix" = ""; then
+         pfm_incdir="$pfm_prefix/include"
+      fi
+      dotest=1
+   else
+      if test "$pfm_libdir" != ""; then
+         LIBS="-L$pfm_libdir -lpfm"
+         dotest=1
+      fi
+      if test "$pfm_incdir" != ""; then
+         CPPFLAGS="-I$pfm_incdir"
+         dotest=1
+      fi
+   fi
+   if test "$dotest" = 1; then
+   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pfm_initialize in -lpfm" >&5
+$as_echo_n "checking for pfm_initialize in -lpfm... " >&6; }
+if ${ac_cv_lib_pfm_pfm_initialize+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lpfm  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include "perfmon/perfmon.h"
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char pfm_initialize ();
 int
 main ()
 {
-static pfm_msg_t ac_aggr;
-if (ac_aggr.type)
-return 0;
+return pfm_initialize ();
   ;
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_member_pfm_msg_t_type=yes
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_pfm_pfm_initialize=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
+  ac_cv_lib_pfm_pfm_initialize=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pfm_pfm_initialize" >&5
+$as_echo "$ac_cv_lib_pfm_pfm_initialize" >&6; }
+if test "x$ac_cv_lib_pfm_pfm_initialize" = xyes; then :
 
-	cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
+   	for ac_header in perfmon/pfmlib.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "perfmon/pfmlib.h" "ac_cv_header_perfmon_pfmlib_h" "$ac_includes_default"
+if test "x$ac_cv_header_perfmon_pfmlib_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_PERFMON_PFMLIB_H 1
 _ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include "perfmon/perfmon.h"
 
-int
-main ()
-{
-static pfm_msg_t ac_aggr;
-if (sizeof ac_aggr.type)
-return 0;
-  ;
-  return 0;
-}
+   	if test "$arch" = "ia64"; then
+   		for ac_header in perfmon/pfmlib_montecito.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "perfmon/pfmlib_montecito.h" "ac_cv_header_perfmon_pfmlib_montecito_h" "$ac_includes_default"
+if test "x$ac_cv_header_perfmon_pfmlib_montecito_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_PERFMON_PFMLIB_MONTECITO_H 1
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_member_pfm_msg_t_type=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
 
-	ac_cv_member_pfm_msg_t_type=no
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+
+           fi
+   	ac_fn_c_check_func "$LINENO" "pfm_get_event_description" "ac_cv_func_pfm_get_event_description"
+if test "x$ac_cv_func_pfm_get_event_description" = xyes; then :
+
+$as_echo "#define HAVE_PFM_GET_EVENT_DESCRIPTION 1" >>confdefs.h
+
 fi
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   	ac_fn_c_check_member "$LINENO" "pfmlib_reg_t" "reg_evt_idx" "ac_cv_member_pfmlib_reg_t_reg_evt_idx" "#include \"perfmon/pfmlib.h\"
+"
+if test "x$ac_cv_member_pfmlib_reg_t_reg_evt_idx" = xyes; then :
+
+$as_echo "#define HAVE_PFM_REG_EVT_IDX 1" >>confdefs.h
+
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_member_pfm_msg_t_type" >&5
-$as_echo "$ac_cv_member_pfm_msg_t_type" >&6; }
-if test "x$ac_cv_member_pfm_msg_t_type" = x""yes; then
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PFM_MSG_TYPE 1
-_ACEOF
+   	ac_fn_c_check_member "$LINENO" "pfmlib_output_param_t" "pfp_pmd_count" "ac_cv_member_pfmlib_output_param_t_pfp_pmd_count" "#include \"perfmon/pfmlib.h\"
+"
+if test "x$ac_cv_member_pfmlib_output_param_t_pfp_pmd_count" = xyes; then :
+
+$as_echo "#define HAVE_PFMLIB_OUTPUT_PFP_PMD_COUNT 1" >>confdefs.h
+
+fi
+
+   	ac_fn_c_check_member "$LINENO" "pfm_msg_t" "type" "ac_cv_member_pfm_msg_t_type" "#include \"perfmon/perfmon.h\"
+"
+if test "x$ac_cv_member_pfm_msg_t_type" = xyes; then :
+
+$as_echo "#define HAVE_PFM_MSG_TYPE 1" >>confdefs.h
 
 fi
 
 
 else
-  { { $as_echo "$as_me:$LINENO: error: perfmon/pfmlib.h could not be found, please examine config.log and rerun configure with different flags" >&5
-$as_echo "$as_me: error: perfmon/pfmlib.h could not be found, please examine config.log and rerun configure with different flags" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "perfmon/pfmlib.h could not be found, please examine config.log and rerun configure with different flags" "$LINENO" 5
 fi
 
 done
 
 else
 
-   	{ { $as_echo "$as_me:$LINENO: error: libpfm.a could not be found, please examine config.log and rerun configure with different flags" >&5
-$as_echo "$as_me: error: libpfm.a could not be found, please examine config.log and rerun configure with different flags" >&2;}
-   { (exit 1); exit 1; }; }
+   	as_fn_error $? "libpfm.a could not be found, please examine config.log and rerun configure with different flags" "$LINENO" 5
 
 fi
 
    else
    # included snapshots have this function
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PERFMON_PFMLIB_MONTECITO_H 1
-_ACEOF
+$as_echo "#define HAVE_PERFMON_PFMLIB_MONTECITO_H 1" >>confdefs.h
 
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PFM_GET_EVENT_DESCRIPTION 1
-_ACEOF
+$as_echo "#define HAVE_PFM_GET_EVENT_DESCRIPTION 1" >>confdefs.h
 
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_PFMLIB_OUTPUT_PFP_PMD_COUNT 1
-_ACEOF
+$as_echo "#define HAVE_PFMLIB_OUTPUT_PFP_PMD_COUNT 1" >>confdefs.h
 
    fi
 fi
 
 if test "$with_semaphores" != "no"; then
 
-cat >>confdefs.h <<\_ACEOF
-#define USE_SEMAPHORES 1
-_ACEOF
+$as_echo "#define USE_SEMAPHORES 1" >>confdefs.h
 
 fi
 
@@ -8668,21 +6678,20 @@ if test "$OS" = "aix"; then
       power5) PMAPI="/usr/pmapi" ;;
       power6) PMAPI="/usr/pmapi" ;;
       esac
+   else
+	PMAPI="$pmapi"
+   fi
       PMINIT=""
       LIBS="-L$PMAPI/lib -lpmapi"
       CPPFLAGS="$CPPFLAGS -I$PMAPI/include"
-      { $as_echo "$as_me:$LINENO: checking for pm_initialize in -lpmapi" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pm_initialize in -lpmapi" >&5
 $as_echo_n "checking for pm_initialize in -lpmapi... " >&6; }
-if test "${ac_cv_lib_pmapi_pm_initialize+set}" = set; then
+if ${ac_cv_lib_pmapi_pm_initialize+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lpmapi  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -8700,59 +6709,30 @@ return pm_initialize ();
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_pmapi_pm_initialize=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_pmapi_pm_initialize=no
+  ac_cv_lib_pmapi_pm_initialize=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_pmapi_pm_initialize" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pmapi_pm_initialize" >&5
 $as_echo "$ac_cv_lib_pmapi_pm_initialize" >&6; }
-if test "x$ac_cv_lib_pmapi_pm_initialize" = x""yes; then
+if test "x$ac_cv_lib_pmapi_pm_initialize" = xyes; then :
 
 			    PMINIT="-DPM_INITIALIZE"
 else
 
-			    { $as_echo "$as_me:$LINENO: checking for pm_init in -lpmapi" >&5
+			    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pm_init in -lpmapi" >&5
 $as_echo_n "checking for pm_init in -lpmapi... " >&6; }
-if test "${ac_cv_lib_pmapi_pm_init+set}" = set; then
+if ${ac_cv_lib_pmapi_pm_init+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lpmapi  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -8770,70 +6750,38 @@ return pm_init ();
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_pmapi_pm_init=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_pmapi_pm_init=no
+  ac_cv_lib_pmapi_pm_init=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_pmapi_pm_init" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pmapi_pm_init" >&5
 $as_echo "$ac_cv_lib_pmapi_pm_init" >&6; }
-if test "x$ac_cv_lib_pmapi_pm_init" = x""yes; then
+if test "x$ac_cv_lib_pmapi_pm_init" = xyes; then :
 
 			    PMINIT="-DPM_INIT"
 else
 
-			    { { $as_echo "$as_me:$LINENO: error: libpmapi.a is needed on AIX, please examine config.log and rerun configure with different flags" >&5
-$as_echo "$as_me: error: libpmapi.a is needed on AIX, please examine config.log and rerun configure with different flags" >&2;}
-   { (exit 1); exit 1; }; }
+			    as_fn_error $? "libpmapi.a is needed on AIX, please examine config.log and rerun configure with different flags" "$LINENO" 5
 
 fi
 
 fi
 
    else
-	PMAPI="$pmapi"
-   fi
-else
       case "$pmapi" in
          default) ;;
          *)
-	 { { $as_echo "$as_me:$LINENO: error: pmapi is not needed on this platform" >&5
-$as_echo "$as_me: error: pmapi is not needed on this platform" >&2;}
-   { (exit 1); exit 1; }; }
+	 as_fn_error $? "pmapi is not needed on this platform" "$LINENO" 5
 	     ;;
       esac
 fi
 
-{ $as_echo "$as_me:$LINENO: checking for platform description used to generate Makefile" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for platform description used to generate Makefile" >&5
 $as_echo_n "checking for platform description used to generate Makefile... " >&6; }
 if test "x$MAKEVER" = "x"; then
 case "$OS" in
@@ -8844,17 +6792,13 @@ case "$OS" in
        # HWPMC driver is available for FreeBSD >= 6
        FREEBSD_VERSION=`uname -r | cut -c 1`
        if test "${FREEBSD_VERSION}" -lt 6 ; then
-          { { $as_echo "$as_me:$LINENO: error: PAPI requires at least FreeBSD 6 to work" >&5
-$as_echo "$as_me: error: PAPI requires at least FreeBSD 6 to work" >&2;}
-   { (exit 1); exit 1; }; }
+          as_fn_error $? "PAPI requires at least FreeBSD 6 to work" "$LINENO" 5
        fi
 
        # Determine if HWPMC module is on the kernel
        dmesg | grep hwpmc 2> /dev/null > /dev/null
        if test "$?" != "0" ; then
-          { { $as_echo "$as_me:$LINENO: error: Error! HWPMC module seems not to be on the kernel. Have you compiled the kernel with HWPMC? (see INSTALL.TXT" >&5
-$as_echo "$as_me: error: Error! HWPMC module seems not to be on the kernel. Have you compiled the kernel with HWPMC? (see INSTALL.TXT" >&2;}
-   { (exit 1); exit 1; }; }
+          as_fn_error $? "Error! HWPMC module seems not to be on the kernel. Have you compiled the kernel with HWPMC? (see INSTALL.TXT" "$LINENO" 5
        fi
 
        # Determine the number of counters
@@ -8863,11 +6807,7 @@ $as_echo "$as_me: error: Error! HWPMC module seems not to be on the kernel. Have
        echo "#define _FREEBSD_CONFIG_H_" >> freebsd-config.h
        echo "" >> freebsd-config.h
 
-       cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+       cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <unistd.h>
         #include <pmc.h>
@@ -8879,59 +6819,25 @@ int i = pmc_init();
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   pmc_pmc_init_linked="yes"
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	pmc_pmc_init_linked="no"
+  pmc_pmc_init_linked="no"
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
        if test "${pmc_init_linked}" = "no" ; then
-          { { $as_echo "$as_me:$LINENO: error: Failed to link hwpmc example" >&5
-$as_echo "$as_me: error: Failed to link hwpmc example" >&2;}
-   { (exit 1); exit 1; }; }
+          as_fn_error $? "Failed to link hwpmc example" "$LINENO" 5
        fi
 
-       if test "$cross_compiling" = yes; then
-  { { $as_echo "$as_me:$LINENO: error: in \`$ac_pwd':" >&5
+       if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ { $as_echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-$as_echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
-   { (exit 1); exit 1; }; }; }
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
  #include <unistd.h>
          #include <pmc.h>
@@ -8944,47 +6850,18 @@ cat >>conftest.$ac_ext <<_ACEOF
          }
 
 _ACEOF
-rm -f conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_try") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+if ac_fn_c_try_run "$LINENO"; then :
    num_counters="0"
 else
-  $as_echo "$as_me: program exited with status $ac_status" >&5
-$as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-( exit $ac_status )
- num_counters="$?"
+   num_counters="$?"
 fi
-rm -rf conftest.dSYM
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
 
-
        if test "${num_counters}" = "0" ; then
-          { { $as_echo "$as_me:$LINENO: error: pmc_npmc info returned 0. Please check you have HWPMC module loaded into the kernel (see hwpmc(4))" >&5
-$as_echo "$as_me: error: pmc_npmc info returned 0. Please check you have HWPMC module loaded into the kernel (see hwpmc(4))" >&2;}
-   { (exit 1); exit 1; }; }
+          as_fn_error $? "pmc_npmc info returned 0. Please check you have HWPMC module loaded into the kernel (see hwpmc(4))" "$LINENO" 5
        fi
 
        echo "#define HWPMC_NUM_COUNTERS ${num_counters}" >> freebsd-config.h
@@ -9007,9 +6884,7 @@ $as_echo "$as_me: error: pmc_npmc info returned 0. Please check you have HWPMC m
    solaris|sunos)
        if test "${bitmode}" = "64"; then
           if test "`isainfo -v | grep "64"`" = ""; then
-             { { $as_echo "$as_me:$LINENO: error: The bitmode you specified is not supported" >&5
-$as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
-   { (exit 1); exit 1; }; }
+             as_fn_error $? "The bitmode you specified is not supported" "$LINENO" 5
           fi
        fi
        MAKEVER="$OS"-"$CPU""$BM"
@@ -9024,23 +6899,19 @@ $as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
        case "$CPU" in
             itanium2|montecito)
                  if test "${with_bitmode}" = "32"; then
-                   { { $as_echo "$as_me:$LINENO: error: The bitmode you specified is not supported" >&5
-$as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
-   { (exit 1); exit 1; }; }
+                   as_fn_error $? "The bitmode you specified is not supported" "$LINENO" 5
                  fi
 		 if test "$CPU" = "montecito"; then
 		    MAKEVER="$OS"-pfm-itanium3
 		    else
 		    MAKEVER="$OS"-pfm-"$CPU"
 		 fi ;;
-            opteron|core|core2|i7|atom|em64t|p3)
+            opteron|core|core2|i7|atom|p3)
 		if test "$arch" = "x86_64"; then
 			MAKEVER="$OS"-perfctr-p3
 		else
 			if test "${bitmode}" = "64"; then
-				{ { $as_echo "$as_me:$LINENO: error: The bitmode you specified is not supported" >&5
-$as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
-   { (exit 1); exit 1; }; }
+				as_fn_error $? "The bitmode you specified is not supported" "$LINENO" 5
 			fi
 			MAKEVER="$OS"-perfctr-p3
 		fi
@@ -9050,18 +6921,14 @@ $as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
 			MAKEVER="$OS"-perfctr-"$CPU"
 		else
 			if test "${bitmode}" = "64"; then
-				{ { $as_echo "$as_me:$LINENO: error: The bitmode you specified is not supported" >&5
-$as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
-   { (exit 1); exit 1; }; }
+				as_fn_error $? "The bitmode you specified is not supported" "$LINENO" 5
 			fi
 			MAKEVER="$OS"-perfctr-"$CPU"
 		fi
 		 ;;
             PPC32)
                  if test "${bitmode}" = "64"; then
-                   { { $as_echo "$as_me:$LINENO: error: The bitmode you specified is not supported" >&5
-$as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
-   { (exit 1); exit 1; }; }
+                   as_fn_error $? "The bitmode you specified is not supported" "$LINENO" 5
                  fi
                  MAKEVER="$OS"-perfctr-"$CPU" ;;
             POWER5|POWER5+|POWER6|PPC970)
@@ -9080,7 +6947,7 @@ $as_echo "$as_me: error: The bitmode you specified is not supported" >&2;}
                  MAKEVER="$OS"-"$CPU" ;;
 esac
 fi
-{ $as_echo "$as_me:$LINENO: result: $MAKEVER" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAKEVER" >&5
 $as_echo "$MAKEVER" >&6; }
 
 #echo $MAKEVER
@@ -9099,7 +6966,6 @@ case "$MAKEVER" in
     linux-perfctr-athlon);;
     linux-perfctr-p3);;
     linux-perfctr-p4);;
-    linux-perfctr-em64t);;
     solaris-ultra);;
     solaris-ultra-64bit);;
     solaris-niagara2|solaris-niagara2-32bit);;
@@ -9122,7 +6988,7 @@ esac
 #echo $compnts
 
 # Check whether --with-mx was given.
-if test "${with_mx+set}" = set; then
+if test "${with_mx+set}" = set; then :
   withval=$with_mx; mx=$withval
 else
   mx=no
@@ -9134,9 +7000,9 @@ case "$mx" in
       MXPATH=""
       # Extract the first word of "mx_counters", so it can be a program name with args.
 set dummy mx_counters; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_MXPATH+set}" = set; then
+if ${ac_cv_path_MXPATH+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $MXPATH in
@@ -9149,14 +7015,14 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_path_MXPATH="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
   ;;
@@ -9164,10 +7030,10 @@ esac
 fi
 MXPATH=$ac_cv_path_MXPATH
 if test -n "$MXPATH"; then
-  { $as_echo "$as_me:$LINENO: result: $MXPATH" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MXPATH" >&5
 $as_echo "$MXPATH" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -9188,16 +7054,14 @@ _ACEOF
       comphdrs="${comphdrs} linux-mx.h"
       compobjs="${compobjs} linux-mx.o"
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_MX 1
-_ACEOF
+$as_echo "#define HAVE_MX 1" >>confdefs.h
 
       ;;
 esac
 
 
 # Check whether --with-net was given.
-if test "${with_net+set}" = set; then
+if test "${with_net+set}" = set; then :
   withval=$with_net; net=$withval
 else
   net=no
@@ -9209,9 +7073,9 @@ case "$net" in
       NETPATH=""
       # Extract the first word of "ifconfig", so it can be a program name with args.
 set dummy ifconfig; ac_word=$2
-{ $as_echo "$as_me:$LINENO: checking for $ac_word" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_NETPATH+set}" = set; then
+if ${ac_cv_path_NETPATH+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   case $NETPATH in
@@ -9224,14 +7088,14 @@ for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
   if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
     ac_cv_path_NETPATH="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
-done
+  done
 IFS=$as_save_IFS
 
   ;;
@@ -9239,10 +7103,10 @@ esac
 fi
 NETPATH=$ac_cv_path_NETPATH
 if test -n "$NETPATH"; then
-  { $as_echo "$as_me:$LINENO: result: $NETPATH" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $NETPATH" >&5
 $as_echo "$NETPATH" >&6; }
 else
-  { $as_echo "$as_me:$LINENO: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
@@ -9263,9 +7127,7 @@ _ACEOF
       comphdrs="${comphdrs} linux-net.h"
       compobjs="${compobjs} linux-net.o"
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_NET 1
-_ACEOF
+$as_echo "#define HAVE_NET 1" >>confdefs.h
 
       ;;
 esac
@@ -9273,7 +7135,7 @@ esac
 
 
 # Check whether --with-acpi was given.
-if test "${with_acpi+set}" = set; then
+if test "${with_acpi+set}" = set; then :
   withval=$with_acpi; acpi=$withval
 else
   acpi=no
@@ -9288,9 +7150,7 @@ case "$acpi" in
       comphdrs="${comphdrs} linux-acpi.h"
       compobjs="${compobjs} linux-acpi.o"
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_ACPI 1
-_ACEOF
+$as_echo "#define HAVE_ACPI 1" >>confdefs.h
 
       ;;
    no)
@@ -9300,7 +7160,7 @@ esac
 
 
 # Check whether --with-lmsensors was given.
-if test "${with_lmsensors+set}" = set; then
+if test "${with_lmsensors+set}" = set; then :
   withval=$with_lmsensors; lmsensors=$withval
 else
   lmsensors=no
@@ -9316,81 +7176,30 @@ case "$lmsensors" in
       compobjs="${compobjs} linux-lmsensors.o"
 
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_LMSENSORS 1
-_ACEOF
+$as_echo "#define HAVE_LMSENSORS 1" >>confdefs.h
 
 
 # looking for lm-sensors header files
 
 # Check whether --with-sensors_incdir was given.
-if test "${with_sensors_incdir+set}" = set; then
+if test "${with_sensors_incdir+set}" = set; then :
   withval=$with_sensors_incdir; sensors_incdir=$withval
 else
-  { { $as_echo "$as_me:$LINENO: error: sensors.h could not be found. See --with-sensors_incdir " >&5
-$as_echo "$as_me: error: sensors.h could not be found. See --with-sensors_incdir " >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "sensors.h could not be found. See --with-sensors_incdir " "$LINENO" 5
 
 fi
 
 
       if test "$sensors_incdir" != ""; then
 	     CFLAGS="$CFLAGS -I$sensors_incdir"
-         { $as_echo "$as_me:$LINENO: checking for sensors.h" >&5
-$as_echo_n "checking for sensors.h... " >&6; }
-if test "${ac_cv_header_sensors_h+set}" = set; then
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#include <sensors.h>
-
-#include <sensors.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest.$ac_objext; then
-  ac_cv_header_sensors_h=yes
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_header_sensors_h=no
-fi
-
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_header_sensors_h" >&5
-$as_echo "$ac_cv_header_sensors_h" >&6; }
-if test "x$ac_cv_header_sensors_h" = x""yes; then
+         ac_fn_c_check_header_compile "$LINENO" "sensors.h" "ac_cv_header_sensors_h" "#include <sensors.h>
+"
+if test "x$ac_cv_header_sensors_h" = xyes; then :
 
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_SENSORS_H 1
-_ACEOF
+$as_echo "#define HAVE_SENSORS_H 1" >>confdefs.h
 
 else
-  { { $as_echo "$as_me:$LINENO: error: sensors.h could not be found. " >&5
-$as_echo "$as_me: error: sensors.h could not be found. " >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "sensors.h could not be found. " "$LINENO" 5
 fi
 
 
@@ -9399,31 +7208,24 @@ fi
 # looking for lm-sensors lib
 
 # Check whether --with-sensors_libdir was given.
-if test "${with_sensors_libdir+set}" = set; then
+if test "${with_sensors_libdir+set}" = set; then :
   withval=$with_sensors_libdir; sensors_libdir=$withval
 else
-  { { $as_echo "$as_me:$LINENO: error: libsensors.a is needed for the PAPI lm-sensors component. See --with-sensors_libdir " >&5
-$as_echo "$as_me: error: libsensors.a is needed for the PAPI lm-sensors component. See --with-sensors_libdir " >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "libsensors.a is needed for the PAPI lm-sensors component. See --with-sensors_libdir " "$LINENO" 5
 
 fi
 
 
       if test "$sensors_libdir" != ""; then
          LDFLAGS="$LDFLAGS -L$sensors_libdir -lsensors"
-
-{ $as_echo "$as_me:$LINENO: checking for sensors_init in -lsensors" >&5
+	     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sensors_init in -lsensors" >&5
 $as_echo_n "checking for sensors_init in -lsensors... " >&6; }
-if test "${ac_cv_lib_sensors_sensors_init+set}" = set; then
+if ${ac_cv_lib_sensors_sensors_init+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lsensors  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -9441,43 +7243,18 @@ return sensors_init ();
   return 0;
 }
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:$LINENO: $ac_try_echo\""
-$as_echo "$ac_try_echo") >&5
-  (eval "$ac_link") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  $as_echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } && {
-	 test -z "$ac_c_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then
+if ac_fn_c_try_link "$LINENO"; then :
   ac_cv_lib_sensors_sensors_init=yes
 else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_cv_lib_sensors_sensors_init=no
+  ac_cv_lib_sensors_sensors_init=no
 fi
-
-rm -rf conftest.dSYM
-rm -f core conftest.err conftest.$ac_objext conftest_ipa8_conftest.oo \
-      conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:$LINENO: result: $ac_cv_lib_sensors_sensors_init" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sensors_sensors_init" >&5
 $as_echo "$ac_cv_lib_sensors_sensors_init" >&6; }
-if test "x$ac_cv_lib_sensors_sensors_init" = x""yes; then
+if test "x$ac_cv_lib_sensors_sensors_init" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_LIBSENSORS 1
 _ACEOF
@@ -9485,9 +7262,7 @@ _ACEOF
   LIBS="-lsensors $LIBS"
 
 else
-  { { $as_echo "$as_me:$LINENO: error: libsensors.a is needed for the PAPI lm-sensors component" >&5
-$as_echo "$as_me: error: libsensors.a is needed for the PAPI lm-sensors component" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "libsensors.a is needed for the PAPI lm-sensors component" "$LINENO" 5
 fi
 
 
@@ -9535,11 +7310,11 @@ if test "$OS" = "linux" -a "$bitmode" = "64"; then
 fi
 
 #AC_DEFINE_UNQUOTED(PAPI_DATADIR, "$PAPI_DATADIR", [package data directory])
-{ $as_echo "$as_me:$LINENO: checking for link test cases with shared library" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for link test cases with shared library" >&5
 $as_echo_n "checking for link test cases with shared library... " >&6; }
 
 # Check whether --with-shlib was given.
-if test "${with_shlib+set}" = set; then
+if test "${with_shlib+set}" = set; then :
   withval=$with_shlib; shlib=$withval
 else
   shlib=either
@@ -9560,20 +7335,16 @@ if test "$papiLIBS" != "shared static"; then
 if test "$shlib" = "yes"; then
 #AC_MSG_RESULT(papiLIBS $papiLIBS shlib $shlib)
    if echo "x$papiLIBS" | grep static > /dev/null; then
-                         { { $as_echo "$as_me:$LINENO: error: Sorry, building static but specified shared linking" >&5
-$as_echo "$as_me: error: Sorry, building static but specified shared linking" >&2;}
-   { (exit 1); exit 1; }; }
+                         as_fn_error $? "Sorry, building static but specified shared linking" "$LINENO" 5
    fi
 fi
 if test "$shlib" = "no"; then
    if echo "x$papiLIBS" | grep shared > /dev/null; then
-                         { { $as_echo "$as_me:$LINENO: error: Sorry, building shared but specified static linking" >&5
-$as_echo "$as_me: error: Sorry, building shared but specified static linking" >&2;}
-   { (exit 1); exit 1; }; }
+                         as_fn_error $? "Sorry, building shared but specified static linking" "$LINENO" 5
    fi
 fi
 fi
-{ $as_echo "$as_me:$LINENO: result: $shlib" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $shlib" >&5
 $as_echo "$shlib" >&6; }
 if test "$shlib" = "yes"; then
 	SETPATH='export LD_LIBRARY_PATH=$(PWD):$(PWD)/libpfm-3.y/lib:$(PWD)/libpfm-2.x/libpfm;export LIBPATH=.:./libpfm-3.y/lib:./libpfm-2.x/libpfm;'
@@ -9702,7 +7473,7 @@ elif test "$MAKEVER" = "bgp"; then
    BGP_SYSDIR=/bgsys/drivers/ppcfloor
    BGP_GNU_LINUX_PATH='${BGP_SYSDIR}/gnu-linux'
    LDFLAGS='-L$(BGP_SYSDIR)/runtime/SPI -lSPI.cna'
-   CFLAGS='-D_BGP -g -gdwarf-2 -O2 -Wall -I. -I$(BGP_SYSDIR)/arch/include -DCOMP_VECTOR=_bgp_vectors'
+   CFLAGS='-g -gdwarf-2 -O2 -Wall -I. -I$(BGP_SYSDIR)/arch/include -DCOMP_VECTOR=_bgp_vectors'
    # Some nice flags to add to CFLAGS when debugging
    #CFLAGS='$(CFLAGS) -DDEBUG -DMPX_DEBUG -DMPX_DEBUG_TIMER'
    FFLAGS='-g -gdwarf-2 -O2 -Wall -I. -Dlinux'
@@ -9995,27 +7766,27 @@ fi
 
 
 if test "$cross_compiling" = "yes" ; then
-   { $as_echo "$as_me:$LINENO: Compiling genpapifdef with $nativecc because cross compiling" >&5
+   { $as_echo "$as_me:${as_lineno-$LINENO}: Compiling genpapifdef with $nativecc because cross compiling" >&5
 $as_echo "$as_me: Compiling genpapifdef with $nativecc because cross compiling" >&6;}
    $nativecc -I. genpapifdef.c -o genpapifdef
 else
-   { $as_echo "$as_me:$LINENO: Compiling genpapifdef with $CC" >&5
+   { $as_echo "$as_me:${as_lineno-$LINENO}: Compiling genpapifdef with $CC" >&5
 $as_echo "$as_me: Compiling genpapifdef with $CC" >&6;}
    $CC -I. genpapifdef.c -o genpapifdef
 fi
 
-{ $as_echo "$as_me:$LINENO: Generating fpapi.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: Generating fpapi.h" >&5
 $as_echo "$as_me: Generating fpapi.h" >&6;}
 ./genpapifdef -c > fpapi.h
-{ $as_echo "$as_me:$LINENO: Generating f77papi.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: Generating f77papi.h" >&5
 $as_echo "$as_me: Generating f77papi.h" >&6;}
 ./genpapifdef -f77 > f77papi.h
-{ $as_echo "$as_me:$LINENO: Generating f90papi.h" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: Generating f90papi.h" >&5
 $as_echo "$as_me: Generating f90papi.h" >&6;}
 ./genpapifdef -f90 > f90papi.h
 
 if test "$FILENAME" != "NO_INCLUDE_FILE" ; then
-   { $as_echo "$as_me:$LINENO: $FILENAME will be included in the generated Makefile" >&5
+   { $as_echo "$as_me:${as_lineno-$LINENO}: $FILENAME will be included in the generated Makefile" >&5
 $as_echo "$as_me: $FILENAME will be included in the generated Makefile" >&6;}
 fi
 
@@ -10048,13 +7819,13 @@ _ACEOF
     case $ac_val in #(
     *${as_nl}*)
       case $ac_var in #(
-      *_cv_*) { $as_echo "$as_me:$LINENO: WARNING: cache variable $ac_var contains a newline" >&5
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
 $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
       esac
       case $ac_var in #(
       _ | IFS | as_nl) ;; #(
       BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
-      *) $as_unset $ac_var ;;
+      *) { eval $ac_var=; unset $ac_var;} ;;
       esac ;;
     esac
   done
@@ -10062,8 +7833,8 @@ $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
   (set) 2>&1 |
     case $as_nl`(ac_space=' '; set) 2>&1` in #(
     *${as_nl}ac_space=\ *)
-      # `set' does not quote correctly, so add quotes (double-quote
-      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
       sed -n \
 	"s/'/'\\\\''/g;
 	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
@@ -10085,12 +7856,23 @@ $as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
      :end' >>confcache
 if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
   if test -w "$cache_file"; then
-    test "x$cache_file" != "x/dev/null" &&
-      { $as_echo "$as_me:$LINENO: updating cache $cache_file" >&5
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
 $as_echo "$as_me: updating cache $cache_file" >&6;}
-    cat confcache >$cache_file
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
   else
-    { $as_echo "$as_me:$LINENO: not updating unwritable cache $cache_file" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
 $as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
   fi
 fi
@@ -10104,14 +7886,15 @@ DEFS=-DHAVE_CONFIG_H
 
 ac_libobjs=
 ac_ltlibobjs=
+U=
 for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
   # 1. Remove the extension, and $U if already installed.
   ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
   ac_i=`$as_echo "$ac_i" | sed "$ac_script"`
   # 2. Prepend LIBOBJDIR.  When used with automake>=1.10 LIBOBJDIR
   #    will be set to the directory where LIBOBJS objects are built.
-  ac_libobjs="$ac_libobjs \${LIBOBJDIR}$ac_i\$U.$ac_objext"
-  ac_ltlibobjs="$ac_ltlibobjs \${LIBOBJDIR}$ac_i"'$U.lo'
+  as_fn_append ac_libobjs " \${LIBOBJDIR}$ac_i\$U.$ac_objext"
+  as_fn_append ac_ltlibobjs " \${LIBOBJDIR}$ac_i"'$U.lo'
 done
 LIBOBJS=$ac_libobjs
 
@@ -10119,13 +7902,14 @@ LTLIBOBJS=$ac_ltlibobjs
 
 
 
-: ${CONFIG_STATUS=./config.status}
+: "${CONFIG_STATUS=./config.status}"
 ac_write_fail=0
 ac_clean_files_save=$ac_clean_files
 ac_clean_files="$ac_clean_files $CONFIG_STATUS"
-{ $as_echo "$as_me:$LINENO: creating $CONFIG_STATUS" >&5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: creating $CONFIG_STATUS" >&5
 $as_echo "$as_me: creating $CONFIG_STATUS" >&6;}
-cat >$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+as_write_fail=0
+cat >$CONFIG_STATUS <<_ASEOF || as_write_fail=1
 #! $SHELL
 # Generated by $as_me.
 # Run this file to recreate the current configuration.
@@ -10135,17 +7919,18 @@ cat >$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 debug=false
 ac_cs_recheck=false
 ac_cs_silent=false
-SHELL=\${CONFIG_SHELL-$SHELL}
-_ACEOF
 
-cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-## --------------------- ##
-## M4sh Initialization.  ##
-## --------------------- ##
+SHELL=\${CONFIG_SHELL-$SHELL}
+export SHELL
+_ASEOF
+cat >>$CONFIG_STATUS <<\_ASEOF || as_write_fail=1
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
 
 # Be more Bourne compatible
 DUALCASE=1; export DUALCASE # for MKS sh
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
   # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
@@ -10153,23 +7938,15 @@ if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in
-  *posix*) set -o posix ;;
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
 esac
-
 fi
 
 
-
-
-# PATH needs CR
-# Avoid depending upon Character Ranges.
-as_cr_letters='abcdefghijklmnopqrstuvwxyz'
-as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
-as_cr_Letters=$as_cr_letters$as_cr_LETTERS
-as_cr_digits='0123456789'
-as_cr_alnum=$as_cr_Letters$as_cr_digits
-
 as_nl='
 '
 export as_nl
@@ -10177,7 +7954,13 @@ export as_nl
 as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
 as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
-if (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
   as_echo='printf %s\n'
   as_echo_n='printf %s'
 else
@@ -10188,7 +7971,7 @@ else
     as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
     as_echo_n_body='eval
       arg=$1;
-      case $arg in
+      case $arg in #(
       *"$as_nl"*)
 	expr "X$arg" : "X\\(.*\\)$as_nl";
 	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
@@ -10211,13 +7994,6 @@ if test "${PATH_SEPARATOR+set}" != set; then
   }
 fi
 
-# Support unset when possible.
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
-  as_unset=unset
-else
-  as_unset=false
-fi
-
 
 # IFS
 # We need space, tab and new line, in precisely that order.  Quoting is
@@ -10227,15 +8003,16 @@ fi
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
-case $0 in
+as_myself=
+case $0 in #((
   *[\\/]* ) as_myself=$0 ;;
   *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
-  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
-done
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
 IFS=$as_save_IFS
 
      ;;
@@ -10247,12 +8024,16 @@ if test "x$as_myself" = x; then
 fi
 if test ! -f "$as_myself"; then
   $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
-  { (exit 1); exit 1; }
+  exit 1
 fi
 
-# Work around bugs in pre-3.0 UWIN ksh.
-for as_var in ENV MAIL MAILPATH
-do ($as_unset $as_var) >/dev/null 2>&1 && $as_unset $as_var
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
 done
 PS1='$ '
 PS2='> '
@@ -10264,7 +8045,89 @@ export LC_ALL
 LANGUAGE=C
 export LANGUAGE
 
-# Required to use basename.
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
+
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
+
+
 if expr a : '\(a\)' >/dev/null 2>&1 &&
    test "X`expr 00001 : '.*\(...\)'`" = X001; then
   as_expr=expr
@@ -10278,8 +8141,12 @@ else
   as_basename=false
 fi
 
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
 
-# Name of the executable.
 as_me=`$as_basename -- "$0" ||
 $as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
 	 X"$0" : 'X\(//\)$' \| \
@@ -10299,76 +8166,25 @@ $as_echo X/"$0" |
 	  }
 	  s/.*/./; q'`
 
-# CDPATH.
-$as_unset CDPATH
-
-
-
-  as_lineno_1=$LINENO
-  as_lineno_2=$LINENO
-  test "x$as_lineno_1" != "x$as_lineno_2" &&
-  test "x`expr $as_lineno_1 + 1`" = "x$as_lineno_2" || {
-
-  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
-  # uniformly replaced by the line number.  The first 'sed' inserts a
-  # line-number line after each line using $LINENO; the second 'sed'
-  # does the real work.  The second script uses 'N' to pair each
-  # line-number line with the line containing $LINENO, and appends
-  # trailing '-' during substitution so that $LINENO is not a special
-  # case at line end.
-  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
-  # scripts with optimization help from Paolo Bonzini.  Blame Lee
-  # E. McMahon (1931-1989) for sed's syntax.  :-)
-  sed -n '
-    p
-    /[$]LINENO/=
-  ' <$as_myself |
-    sed '
-      s/[$]LINENO.*/&-/
-      t lineno
-      b
-      :lineno
-      N
-      :loop
-      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
-      t loop
-      s/-\n.*//
-    ' >$as_me.lineno &&
-  chmod +x "$as_me.lineno" ||
-    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
-   { (exit 1); exit 1; }; }
-
-  # Don't try to exec as it changes $[0], causing all sort of problems
-  # (the dirname of $[0] is not the place where we might find the
-  # original and so on.  Autoconf is especially sensitive to this).
-  . "./$as_me.lineno"
-  # Exit status is that of the last command.
-  exit
-}
-
-
-if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
-  as_dirname=dirname
-else
-  as_dirname=false
-fi
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
 
 ECHO_C= ECHO_N= ECHO_T=
-case `echo -n x` in
+case `echo -n x` in #(((((
 -n*)
-  case `echo 'x\c'` in
+  case `echo 'xy\c'` in
   *c*) ECHO_T='	';;	# ECHO_T is single tab character.
-  *)   ECHO_C='\c';;
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
   esac;;
 *)
   ECHO_N='-n';;
 esac
-if expr a : '\(a\)' >/dev/null 2>&1 &&
-   test "X`expr 00001 : '.*\(...\)'`" = X001; then
-  as_expr=expr
-else
-  as_expr=false
-fi
 
 rm -f conf$$ conf$$.exe conf$$.file
 if test -d conf$$.dir; then
@@ -10397,8 +8213,56 @@ fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
 
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
+
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
+
+
+} # as_fn_mkdir_p
 if mkdir -p . 2>/dev/null; then
-  as_mkdir_p=:
+  as_mkdir_p='mkdir -p "$as_dir"'
 else
   test -d ./-p && rmdir ./-p
   as_mkdir_p=false
@@ -10417,10 +8281,10 @@ else
       if test -d "$1"; then
 	test -d "$1/.";
       else
-	case $1 in
+	case $1 in #(
 	-*)set "./$1";;
 	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in
+	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
 	???[sx]*):;;*)false;;esac;fi
     '\'' sh
   '
@@ -10435,13 +8299,19 @@ as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
 
 
 exec 6>&1
+## ----------------------------------- ##
+## Main body of $CONFIG_STATUS script. ##
+## ----------------------------------- ##
+_ASEOF
+test $as_write_fail = 0 && chmod +x $CONFIG_STATUS || ac_write_fail=1
 
-# Save the log message, to keep $[0] and so on meaningful, and to
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# Save the log message, to keep $0 and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
 This file was extended by PAPI $as_me 4.0.0, which was
-generated by GNU Autoconf 2.63.  Invocation command line was
+generated by GNU Autoconf 2.68.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -10472,13 +8342,15 @@ _ACEOF
 
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 ac_cs_usage="\
-\`$as_me' instantiates files from templates according to the
-current configuration.
+\`$as_me' instantiates files and other configuration actions
+from templates according to the current configuration.  Unless the files
+and actions are specified as TAGs, all are instantiated by default.
 
-Usage: $0 [OPTION]... [FILE]...
+Usage: $0 [OPTION]... [TAG]...
 
   -h, --help       print this help, then exit
   -V, --version    print version number and configuration settings, then exit
+      --config     print configuration, then exit
   -q, --quiet, --silent
                    do not print progress messages
   -d, --debug      don't remove temporary files
@@ -10494,16 +8366,17 @@ $config_files
 Configuration headers:
 $config_headers
 
-Report bugs to <bug-autoconf@gnu.org>."
+Report bugs to <ptools-perfapi@eecs.utk.edu>."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
 PAPI config.status 4.0.0
-configured by $0, generated by GNU Autoconf 2.63,
-  with options \\"`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
+configured by $0, generated by GNU Autoconf 2.68,
+  with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2008 Free Software Foundation, Inc.
+Copyright (C) 2010 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -10519,11 +8392,16 @@ ac_need_defaults=:
 while test $# != 0
 do
   case $1 in
-  --*=*)
+  --*=?*)
     ac_option=`expr "X$1" : 'X\([^=]*\)='`
     ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
     ac_shift=:
     ;;
+  --*=)
+    ac_option=`expr "X$1" : 'X\([^=]*\)='`
+    ac_optarg=
+    ac_shift=:
+    ;;
   *)
     ac_option=$1
     ac_optarg=$2
@@ -10537,27 +8415,29 @@ do
     ac_cs_recheck=: ;;
   --version | --versio | --versi | --vers | --ver | --ve | --v | -V )
     $as_echo "$ac_cs_version"; exit ;;
+  --config | --confi | --conf | --con | --co | --c )
+    $as_echo "$ac_cs_config"; exit ;;
   --debug | --debu | --deb | --de | --d | -d )
     debug=: ;;
   --file | --fil | --fi | --f )
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    '') as_fn_error $? "missing file argument" ;;
     esac
-    CONFIG_FILES="$CONFIG_FILES '$ac_optarg'"
+    as_fn_append CONFIG_FILES " '$ac_optarg'"
     ac_need_defaults=false;;
   --header | --heade | --head | --hea )
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
     esac
-    CONFIG_HEADERS="$CONFIG_HEADERS '$ac_optarg'"
+    as_fn_append CONFIG_HEADERS " '$ac_optarg'"
     ac_need_defaults=false;;
   --he | --h)
     # Conflict between --help and --header
-    { $as_echo "$as_me: error: ambiguous option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; };;
+    as_fn_error $? "ambiguous option: \`$1'
+Try \`$0 --help' for more information.";;
   --help | --hel | -h )
     $as_echo "$ac_cs_usage"; exit ;;
   -q | -quiet | --quiet | --quie | --qui | --qu | --q \
@@ -10565,11 +8445,10 @@ Try \`$0 --help' for more information." >&2
     ac_cs_silent=: ;;
 
   # This is an error.
-  -*) { $as_echo "$as_me: error: unrecognized option: $1
-Try \`$0 --help' for more information." >&2
-   { (exit 1); exit 1; }; } ;;
+  -*) as_fn_error $? "unrecognized option: \`$1'
+Try \`$0 --help' for more information." ;;
 
-  *) ac_config_targets="$ac_config_targets $1"
+  *) as_fn_append ac_config_targets " $1"
      ac_need_defaults=false ;;
 
   esac
@@ -10618,9 +8497,7 @@ do
     "config.h") CONFIG_HEADERS="$CONFIG_HEADERS config.h" ;;
     "Makefile") CONFIG_FILES="$CONFIG_FILES Makefile" ;;
 
-  *) { { $as_echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
-$as_echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
-   { (exit 1); exit 1; }; };;
+  *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
   esac
 done
 
@@ -10642,26 +8519,24 @@ fi
 # after its creation but before its name has been assigned to `$tmp'.
 $debug ||
 {
-  tmp=
+  tmp= ac_tmp=
   trap 'exit_status=$?
-  { test -z "$tmp" || test ! -d "$tmp" || rm -fr "$tmp"; } && exit $exit_status
+  : "${ac_tmp:=$tmp}"
+  { test ! -d "$ac_tmp" || rm -fr "$ac_tmp"; } && exit $exit_status
 ' 0
-  trap '{ (exit 1); exit 1; }' 1 2 13 15
+  trap 'as_fn_exit 1' 1 2 13 15
 }
 # Create a (secure) tmp directory for tmp files.
 
 {
   tmp=`(umask 077 && mktemp -d "./confXXXXXX") 2>/dev/null` &&
-  test -n "$tmp" && test -d "$tmp"
+  test -d "$tmp"
 }  ||
 {
   tmp=./conf$$-$RANDOM
   (umask 077 && mkdir "$tmp")
-} ||
-{
-   $as_echo "$as_me: cannot create a temporary directory in ." >&2
-   { (exit 1); exit 1; }
-}
+} || as_fn_error $? "cannot create a temporary directory in ." "$LINENO" 5
+ac_tmp=$tmp
 
 # Set up the scripts for CONFIG_FILES section.
 # No need to generate them if there are no CONFIG_FILES.
@@ -10669,7 +8544,13 @@ $debug ||
 if test -n "$CONFIG_FILES"; then
 
 
-ac_cr=''
+ac_cr=`echo X | tr X '\015'`
+# On cygwin, bash can eat \r inside `` if the user requested igncr.
+# But we know of no other shell where ac_cr would be empty at this
+# point, so we can use a bashism as a fallback.
+if test "x$ac_cr" = x; then
+  eval ac_cr=\$\'\\r\'
+fi
 ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
 if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
   ac_cs_awk_cr='\\r'
@@ -10677,7 +8558,7 @@ else
   ac_cs_awk_cr=$ac_cr
 fi
 
-echo 'BEGIN {' >"$tmp/subs1.awk" &&
+echo 'BEGIN {' >"$ac_tmp/subs1.awk" &&
 _ACEOF
 
 
@@ -10686,24 +8567,18 @@ _ACEOF
   echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
   echo "_ACEOF"
 } >conf$$subs.sh ||
-  { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
-ac_delim_num=`echo "$ac_subst_vars" | grep -c '$'`
+  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+ac_delim_num=`echo "$ac_subst_vars" | grep -c '^'`
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   . ./conf$$subs.sh ||
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
 
   ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
   if test $ac_delim_n = $ac_delim_num; then
     break
   elif $ac_last_try; then
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -10711,7 +8586,7 @@ done
 rm -f conf$$subs.sh
 
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
-cat >>"\$tmp/subs1.awk" <<\\_ACAWK &&
+cat >>"\$ac_tmp/subs1.awk" <<\\_ACAWK &&
 _ACEOF
 sed -n '
 h
@@ -10725,7 +8600,7 @@ s/'"$ac_delim"'$//
 t delim
 :nl
 h
-s/\(.\{148\}\).*/\1/
+s/\(.\{148\}\)..*/\1/
 t more1
 s/["\\]/\\&/g; s/^/"/; s/$/\\n"\\/
 p
@@ -10739,7 +8614,7 @@ s/.\{148\}//
 t nl
 :delim
 h
-s/\(.\{148\}\).*/\1/
+s/\(.\{148\}\)..*/\1/
 t more2
 s/["\\]/\\&/g; s/^/"/; s/$/"/
 p
@@ -10759,7 +8634,7 @@ t delim
 rm -f conf$$subs.awk
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 _ACAWK
-cat >>"\$tmp/subs1.awk" <<_ACAWK &&
+cat >>"\$ac_tmp/subs1.awk" <<_ACAWK &&
   for (key in S) S_is_set[key] = 1
   FS = ""
 
@@ -10791,23 +8666,29 @@ if sed "s/$ac_cr//" < /dev/null > /dev/null 2>&1; then
   sed "s/$ac_cr\$//; s/$ac_cr/$ac_cs_awk_cr/g"
 else
   cat
-fi < "$tmp/subs1.awk" > "$tmp/subs.awk" \
-  || { { $as_echo "$as_me:$LINENO: error: could not setup config files machinery" >&5
-$as_echo "$as_me: error: could not setup config files machinery" >&2;}
-   { (exit 1); exit 1; }; }
+fi < "$ac_tmp/subs1.awk" > "$ac_tmp/subs.awk" \
+  || as_fn_error $? "could not setup config files machinery" "$LINENO" 5
 _ACEOF
 
-# VPATH may cause trouble with some makes, so we remove $(srcdir),
-# ${srcdir} and @srcdir@ from VPATH if srcdir is ".", strip leading and
+# VPATH may cause trouble with some makes, so we remove sole $(srcdir),
+# ${srcdir} and @srcdir@ entries from VPATH if srcdir is ".", strip leading and
 # trailing colons and then remove the whole line if VPATH becomes empty
 # (actually we leave an empty line to preserve line numbers).
 if test "x$srcdir" = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
-s/:*\$(srcdir):*/:/
-s/:*\${srcdir}:*/:/
-s/:*@srcdir@:*/:/
-s/^\([^=]*=[	 ]*\):*/\1/
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=[	 ]*/{
+h
+s///
+s/^/:/
+s/[	 ]*$/:/
+s/:\$(srcdir):/:/g
+s/:\${srcdir}:/:/g
+s/:@srcdir@:/:/g
+s/^:*//
 s/:*$//
+x
+s/\(=[	 ]*\).*/\1/
+G
+s/\n//
 s/^[^=]*=[	 ]*$//
 }'
 fi
@@ -10819,7 +8700,7 @@ fi # test -n "$CONFIG_FILES"
 # No need to generate them if there are no CONFIG_HEADERS.
 # This happens for instance with `./config.status Makefile'.
 if test -n "$CONFIG_HEADERS"; then
-cat >"$tmp/defines.awk" <<\_ACAWK ||
+cat >"$ac_tmp/defines.awk" <<\_ACAWK ||
 BEGIN {
 _ACEOF
 
@@ -10831,13 +8712,11 @@ _ACEOF
 # handling of long lines.
 ac_delim='%!_!# '
 for ac_last_try in false false :; do
-  ac_t=`sed -n "/$ac_delim/p" confdefs.h`
-  if test -z "$ac_t"; then
+  ac_tt=`sed -n "/$ac_delim/p" confdefs.h`
+  if test -z "$ac_tt"; then
     break
   elif $ac_last_try; then
-    { { $as_echo "$as_me:$LINENO: error: could not make $CONFIG_HEADERS" >&5
-$as_echo "$as_me: error: could not make $CONFIG_HEADERS" >&2;}
-   { (exit 1); exit 1; }; }
+    as_fn_error $? "could not make $CONFIG_HEADERS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -10922,9 +8801,7 @@ cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 _ACAWK
 _ACEOF
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-  { { $as_echo "$as_me:$LINENO: error: could not setup config headers machinery" >&5
-$as_echo "$as_me: error: could not setup config headers machinery" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "could not setup config headers machinery" "$LINENO" 5
 fi # test -n "$CONFIG_HEADERS"
 
 
@@ -10937,9 +8814,7 @@ do
   esac
   case $ac_mode$ac_tag in
   :[FHL]*:*);;
-  :L* | :C*:*) { { $as_echo "$as_me:$LINENO: error: invalid tag $ac_tag" >&5
-$as_echo "$as_me: error: invalid tag $ac_tag" >&2;}
-   { (exit 1); exit 1; }; };;
+  :L* | :C*:*) as_fn_error $? "invalid tag \`$ac_tag'" "$LINENO" 5;;
   :[FH]-) ac_tag=-:-;;
   :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
   esac
@@ -10958,7 +8833,7 @@ $as_echo "$as_me: error: invalid tag $ac_tag" >&2;}
     for ac_f
     do
       case $ac_f in
-      -) ac_f="$tmp/stdin";;
+      -) ac_f="$ac_tmp/stdin";;
       *) # Look for the file first in the build tree, then in the source tree
 	 # (if the path is not absolute).  The absolute path cannot be DOS-style,
 	 # because $ac_f cannot contain `:'.
@@ -10967,12 +8842,10 @@ $as_echo "$as_me: error: invalid tag $ac_tag" >&2;}
 	   [\\/$]*) false;;
 	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
 	   esac ||
-	   { { $as_echo "$as_me:$LINENO: error: cannot find input file: $ac_f" >&5
-$as_echo "$as_me: error: cannot find input file: $ac_f" >&2;}
-   { (exit 1); exit 1; }; };;
+	   as_fn_error 1 "cannot find input file: \`$ac_f'" "$LINENO" 5;;
       esac
       case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
-      ac_file_inputs="$ac_file_inputs '$ac_f'"
+      as_fn_append ac_file_inputs " '$ac_f'"
     done
 
     # Let's still pretend it is `configure' which instantiates (i.e., don't
@@ -10983,7 +8856,7 @@ $as_echo "$as_me: error: cannot find input file: $ac_f" >&2;}
 	`' by configure.'
     if test x"$ac_file" != x-; then
       configure_input="$ac_file.  $configure_input"
-      { $as_echo "$as_me:$LINENO: creating $ac_file" >&5
+      { $as_echo "$as_me:${as_lineno-$LINENO}: creating $ac_file" >&5
 $as_echo "$as_me: creating $ac_file" >&6;}
     fi
     # Neutralize special characters interpreted by sed in replacement strings.
@@ -10995,10 +8868,8 @@ $as_echo "$as_me: creating $ac_file" >&6;}
     esac
 
     case $ac_tag in
-    *:-:* | *:-) cat >"$tmp/stdin" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; } ;;
+    *:-:* | *:-) cat >"$ac_tmp/stdin" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5 ;;
     esac
     ;;
   esac
@@ -11026,47 +8897,7 @@ $as_echo X"$ac_file" |
 	    q
 	  }
 	  s/.*/./; q'`
-  { as_dir="$ac_dir"
-  case $as_dir in #(
-  -*) as_dir=./$as_dir;;
-  esac
-  test -d "$as_dir" || { $as_mkdir_p && mkdir -p "$as_dir"; } || {
-    as_dirs=
-    while :; do
-      case $as_dir in #(
-      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
-      *) as_qdir=$as_dir;;
-      esac
-      as_dirs="'$as_qdir' $as_dirs"
-      as_dir=`$as_dirname -- "$as_dir" ||
-$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
-	 X"$as_dir" : 'X\(//\)[^/]' \| \
-	 X"$as_dir" : 'X\(//\)$' \| \
-	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
-$as_echo X"$as_dir" |
-    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)[^/].*/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\/\)$/{
-	    s//\1/
-	    q
-	  }
-	  /^X\(\/\).*/{
-	    s//\1/
-	    q
-	  }
-	  s/.*/./; q'`
-      test -d "$as_dir" && break
-    done
-    test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || { { $as_echo "$as_me:$LINENO: error: cannot create directory $as_dir" >&5
-$as_echo "$as_me: error: cannot create directory $as_dir" >&2;}
-   { (exit 1); exit 1; }; }; }
+  as_dir="$ac_dir"; as_fn_mkdir_p
   ac_builddir=.
 
 case "$ac_dir" in
@@ -11114,7 +8945,6 @@ cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 # If the template does not know about datarootdir, expand it.
 # FIXME: This hack should be removed a few years after 2.60.
 ac_datarootdir_hack=; ac_datarootdir_seen=
-
 ac_sed_dataroot='
 /datarootdir/ {
   p
@@ -11124,12 +8954,11 @@ ac_sed_dataroot='
 /@docdir@/p
 /@infodir@/p
 /@localedir@/p
-/@mandir@/p
-'
+/@mandir@/p'
 case `eval "sed -n \"\$ac_sed_dataroot\" $ac_file_inputs"` in
 *datarootdir*) ac_datarootdir_seen=yes;;
 *@datadir@*|*@docdir@*|*@infodir@*|*@localedir@*|*@mandir@*)
-  { $as_echo "$as_me:$LINENO: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
 $as_echo "$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&2;}
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
@@ -11139,7 +8968,7 @@ cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
   s&@infodir@&$infodir&g
   s&@localedir@&$localedir&g
   s&@mandir@&$mandir&g
-    s&\\\${datarootdir}&$datarootdir&g' ;;
+  s&\\\${datarootdir}&$datarootdir&g' ;;
 esac
 _ACEOF
 
@@ -11165,27 +8994,24 @@ s&@abs_builddir@&$ac_abs_builddir&;t t
 s&@abs_top_builddir@&$ac_abs_top_builddir&;t t
 $ac_datarootdir_hack
 "
-eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$tmp/subs.awk" >$tmp/out \
-  || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$ac_tmp/subs.awk" \
+  >$ac_tmp/out || as_fn_error $? "could not create $ac_file" "$LINENO" 5
 
 test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
-  { ac_out=`sed -n '/\${datarootdir}/p' "$tmp/out"`; test -n "$ac_out"; } &&
-  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' "$tmp/out"`; test -z "$ac_out"; } &&
-  { $as_echo "$as_me:$LINENO: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&5
+  { ac_out=`sed -n '/\${datarootdir}/p' "$ac_tmp/out"`; test -n "$ac_out"; } &&
+  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' \
+      "$ac_tmp/out"`; test -z "$ac_out"; } &&
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
+which seems to be undefined.  Please make sure it is defined" >&5
 $as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&2;}
+which seems to be undefined.  Please make sure it is defined" >&2;}
 
-  rm -f "$tmp/stdin"
+  rm -f "$ac_tmp/stdin"
   case $ac_file in
-  -) cat "$tmp/out" && rm -f "$tmp/out";;
-  *) rm -f "$ac_file" && mv "$tmp/out" "$ac_file";;
+  -) cat "$ac_tmp/out" && rm -f "$ac_tmp/out";;
+  *) rm -f "$ac_file" && mv "$ac_tmp/out" "$ac_file";;
   esac \
-  || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
  ;;
   :H)
   #
@@ -11194,27 +9020,21 @@ $as_echo "$as_me: error: could not create $ac_file" >&2;}
   if test x"$ac_file" != x-; then
     {
       $as_echo "/* $configure_input  */" \
-      && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs"
-    } >"$tmp/config.h" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
-    if diff "$ac_file" "$tmp/config.h" >/dev/null 2>&1; then
-      { $as_echo "$as_me:$LINENO: $ac_file is unchanged" >&5
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs"
+    } >"$ac_tmp/config.h" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5
+    if diff "$ac_file" "$ac_tmp/config.h" >/dev/null 2>&1; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: $ac_file is unchanged" >&5
 $as_echo "$as_me: $ac_file is unchanged" >&6;}
     else
       rm -f "$ac_file"
-      mv "$tmp/config.h" "$ac_file" \
-	|| { { $as_echo "$as_me:$LINENO: error: could not create $ac_file" >&5
-$as_echo "$as_me: error: could not create $ac_file" >&2;}
-   { (exit 1); exit 1; }; }
+      mv "$ac_tmp/config.h" "$ac_file" \
+	|| as_fn_error $? "could not create $ac_file" "$LINENO" 5
     fi
   else
     $as_echo "/* $configure_input  */" \
-      && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs" \
-      || { { $as_echo "$as_me:$LINENO: error: could not create -" >&5
-$as_echo "$as_me: error: could not create -" >&2;}
-   { (exit 1); exit 1; }; }
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs" \
+      || as_fn_error $? "could not create -" "$LINENO" 5
   fi
  ;;
 
@@ -11224,15 +9044,12 @@ $as_echo "$as_me: error: could not create -" >&2;}
 done # for ac_tag
 
 
-{ (exit 0); exit 0; }
+as_fn_exit 0
 _ACEOF
-chmod +x $CONFIG_STATUS
 ac_clean_files=$ac_clean_files_save
 
 test $ac_write_fail = 0 ||
-  { { $as_echo "$as_me:$LINENO: error: write failure creating $CONFIG_STATUS" >&5
-$as_echo "$as_me: error: write failure creating $CONFIG_STATUS" >&2;}
-   { (exit 1); exit 1; }; }
+  as_fn_error $? "write failure creating $CONFIG_STATUS" "$LINENO" 5
 
 
 # configure is writing to config.log, and then calls config.status.
@@ -11253,10 +9070,10 @@ if test "$no_create" != yes; then
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
-  $ac_cs_success || { (exit 1); exit 1; }
+  $ac_cs_success || as_fn_exit 1
 fi
 if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
-  { $as_echo "$as_me:$LINENO: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
 $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2;}
 fi
 
diff --git a/src/configure.in b/src/configure.in
index db5ae22..ee023d2 100644
--- a/src/configure.in
+++ b/src/configure.in
@@ -1,7 +1,7 @@
 #                   -*- Autoconf -*-
 # Process this file with autoconf to produce a configure script.
 # File: configure.in
-# CVS:  $Id: configure.in,v 1.166 2010/01/13 16:03:58 sbk Exp $
+# CVS:  $Id: configure.in,v 1.166.2.5 2010/04/29 02:32:15 terpstra Exp $
 
 
 AC_PREREQ(2.61)
@@ -88,6 +88,7 @@ use_shared=yes
 use_static=yes
 use_static_tests=no
 use_x86_cache_info=no
+distributed_build=no
 AC_MSG_CHECKING(for architecture)
 AC_ARG_WITH(arch,
 	   [  --with-arch=<arch>		Specify architecture (uname -m)],
@@ -179,7 +180,11 @@ AC_MSG_RESULT($OSVER)
 AC_MSG_CHECKING(for CPU type)
 AC_ARG_WITH(CPU,
             [  --with-CPU=<cpu>		Specify CPU type],
-            [CPU=$withval],
+            [CPU=$withval
+             case "$CPU" in
+               core | core2 | i7 | atom | p4 | p3 | opteron | athlon)      
+                 use_x86_cache_info=yes;;
+             esac],
 	    [
 
 #checking for CPU
@@ -199,7 +204,6 @@ case "$OS" in
            made=GenuineIntel
            family="`cat /proc/cpuinfo | grep family | cut -d: -f2 | cut -d' ' -f2 | sed '2,$d'`"
            model="`cat /proc/cpuinfo | grep model | cut -d: -f2 | cut -d' ' -f2 | sed '2,$d'`"
-           # family 15 is always P4; model 1 is vanilla pre-HT, model 2 is vanilla; model 3 is em64t, 4 is Pentium D, 6 is Xeon D
            if test "$family" = "6"; then
              # model 14 is an ancient Core
              if test "$model" = "14"; then
@@ -211,8 +215,9 @@ case "$OS" in
                CPU=core2
                use_x86_cache_info=yes
              fi
-             # model 26 is Nehalem
-             if test "$model" = "26"; then
+             # models 26, 30, 37, 44, 46 are Nehalem variants
+             if (test "$model" = "26" || test "$model" = "30" || test "$model" = "37" || 
+                 test "$model" = "44" || test "$model" = "46"); then
                CPU=i7
                use_x86_cache_info=yes
              fi
@@ -221,14 +226,10 @@ case "$OS" in
                CPU=atom
                use_x86_cache_info=yes
              fi
+           # family 15 is always P4
            elif test "$family" = "15"; then
-             if (test "$model" = "3" || test "$model" = "4" || test "$model" = "6"); then
-               CPU=em64t
-               use_x86_cache_info=yes
-             elif (test "$model" = "1" || test "$model" = "2"); then
                CPU=p4
                use_x86_cache_info=yes
-             fi
            elif test "$family" = "32"; then
 	       CPU=montecito
 	   elif test "$family" = "31"; then
@@ -243,7 +244,8 @@ case "$OS" in
              elif test "`cat /proc/cpuinfo | grep -i "Pentium III"`" != ""; then
                CPU=p3
                use_x86_cache_info=yes
-	     else CPU=p3
+	     else 
+               CPU=p3
                use_x86_cache_info=yes
              fi
            fi 
@@ -901,7 +903,8 @@ AC_MSG_RESULT($virtualtimer)
 if test "x$perfctr" = "x"; then
 AC_ARG_WITH(perfctr,
             [  --with-perfctr=<5,6,7>	Specify perfctr version number ],
-            [perfctr=$withval],
+            [perfctr=$withval
+             distributed_build=yes],
             [perfctr="no"
 if test "$cross_compiling" = "no" ; then
 	    AC_CHECK_FILE(/sys/class/perfctr,[perfctr=7],[AC_CHECK_FILE(/dev/perfctr,[perfctr=6])])
@@ -933,28 +936,33 @@ esac
 
 AC_ARG_WITH(perfctr_root,
             [  --with-perfctr-root=<path>	Specify path to source tree (for use by developers only) ],
-            [perfctr_root=$withval],
+            [perfctr_root=$withval
+             distributed_build=yes],
             [perfctr_root=""]
             )
 AC_ARG_WITH(perfctr_prefix,
             [  --with-perfctr-prefix=<path>	Specify prefix to installed perfctr distribution ],
-            [perfctr_prefix=$withval],
+            [perfctr_prefix=$withval
+             distributed_build=yes],
             [perfctr_prefix=""]
             )
 AC_ARG_WITH(perfctr_incdir,
            [  --with-perfctr-incdir=<path>	Specify directory of perfctr header files in non-standard location ],
-           [perfctr_incdir=$withval],
+           [perfctr_incdir=$withval
+            distributed_build=yes],
            [perfctr_incdir=""]
             )
 AC_ARG_WITH(perfctr_libdir,
            [  --with-perfctr-libdir=<path>	Specify directory of perfctr library in non-standard location ],
-           [perfctr_libdir=$withval],
+           [perfctr_libdir=$withval
+            distributed_build=yes],
            [perfctr_libdir=""]
             )
 
 AC_ARG_WITH(perfmon,
             [  --with-perfmon=<x.y>		Specify perfmon version number ],
-            [perfmon=$withval],
+            [perfmon=$withval
+             distributed_build=yes],
             [perfmon=0
 	    if test "$cross_compiling" = "no" ; then
 	       AC_CHECK_FILE(/sys/kernel/perfmon/version,[
@@ -987,22 +995,26 @@ fi
 
 AC_ARG_WITH(pfm_root,
            [  --with-pfm-root=<path>	Specify path to source tree (for use by developers only) ],
-           [pfm_root=$withval],
+           [pfm_root=$withval
+            distributed_build=yes],
            [pfm_root=""]
             )
 AC_ARG_WITH(pfm_prefix,
            [  --with-pfm-prefix=<path>	Specify prefix to installed pfm distribution ],
-           [pfm_prefix=$withval],
+           [pfm_prefix=$withval
+            distributed_build=yes],
            [pfm_prefix=""]
             )
 AC_ARG_WITH(pfm_incdir,
            [  --with-pfm-incdir=<path>	Specify directory of pfm header files in non-standard location ],
-           [pfm_incdir=$withval],
+           [pfm_incdir=$withval
+            distributed_build=yes],
            [pfm_incdir=""]
             )
 AC_ARG_WITH(pfm_libdir,
            [  --with-pfm-libdir=<path>	Specify directory of pfm library in non-standard location ],
-           [pfm_libdir=$withval],
+           [pfm_libdir=$withval
+            distributed_build=yes],
            [pfm_libdir=""]
             )
 
@@ -1068,7 +1080,7 @@ fi
 fi
 # Linux perf event end
 
-if test "$perf_events" = "no" -a "$perfctr" = "no" -a "$perfmon" = "0"; then
+if test "$distributed_build" = "no" -a "$perf_events" = "no" -a "$perfctr" = "no" -a "$perfmon" = "0"; then
   AC_MSG_ERROR([No performance monitoring interface available])
 fi
 
@@ -1180,6 +1192,10 @@ if test "$OS" = "solaris"; then
             if(CPC_VER_CURRENT == 2)
             {
                 exit(0);
+            }else
+            {
+                // Also accept libcpc 3 (Solaris 11.2)
+                exit(0);
             }
 
             exit(1);
@@ -1326,6 +1342,9 @@ if test "$OS" = "aix"; then
       power5) PMAPI="/usr/pmapi" ;;
       power6) PMAPI="/usr/pmapi" ;;
       esac
+   else
+	PMAPI="$pmapi"
+   fi
       PMINIT=""
       LIBS="-L$PMAPI/lib -lpmapi"
       CPPFLAGS="$CPPFLAGS -I$PMAPI/include"
@@ -1336,9 +1355,6 @@ if test "$OS" = "aix"; then
 			    AC_MSG_ERROR([libpmapi.a is needed on AIX, please examine config.log and rerun configure with different flags])
 			    ])],[])
    else
-	PMAPI="$pmapi"
-   fi
-else
       case "$pmapi" in
          default) ;;
          *)  
@@ -1441,7 +1457,7 @@ case "$OS" in
 		    else
 		    MAKEVER="$OS"-pfm-"$CPU"
 		 fi ;;
-            opteron|core|core2|i7|atom|em64t|p3)
+            opteron|core|core2|i7|atom|p3)
 		if test "$arch" = "x86_64"; then
 			MAKEVER="$OS"-perfctr-p3
 		else
@@ -1500,7 +1516,6 @@ case "$MAKEVER" in
     linux-perfctr-athlon);;
     linux-perfctr-p3);;
     linux-perfctr-p4);;
-    linux-perfctr-em64t);;
     solaris-ultra);;
     solaris-ultra-64bit);;
     solaris-niagara2|solaris-niagara2-32bit);;
@@ -1832,7 +1847,7 @@ elif test "$MAKEVER" = "bgp"; then
    BGP_SYSDIR=/bgsys/drivers/ppcfloor
    BGP_GNU_LINUX_PATH='${BGP_SYSDIR}/gnu-linux'
    LDFLAGS='-L$(BGP_SYSDIR)/runtime/SPI -lSPI.cna'
-   CFLAGS='-D_BGP -g -gdwarf-2 -O2 -Wall -I. -I$(BGP_SYSDIR)/arch/include -DCOMP_VECTOR=_bgp_vectors'
+   CFLAGS='-g -gdwarf-2 -O2 -Wall -I. -I$(BGP_SYSDIR)/arch/include -DCOMP_VECTOR=_bgp_vectors'
    # Some nice flags to add to CFLAGS when debugging 
    #CFLAGS='$(CFLAGS) -DDEBUG -DMPX_DEBUG -DMPX_DEBUG_TIMER'
    FFLAGS='-g -gdwarf-2 -O2 -Wall -I. -Dlinux'
diff --git a/src/ctests/multiplex1.c b/src/ctests/multiplex1.c
index 2d09b77..d982b37 100644
--- a/src/ctests/multiplex1.c
+++ b/src/ctests/multiplex1.c
@@ -1,6 +1,6 @@
 /* 
 * File:    multiplex.c
-* CVS:     $Id: multiplex1.c,v 1.50 2009/09/10 20:19:48 terpstra Exp $
+* CVS:     $Id: multiplex1.c,v 1.50.6.1 2010/04/29 02:30:46 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    <your name here>
@@ -14,20 +14,26 @@
 
 /* Event to use in all cases; initialized in init_papi() */
 
-unsigned int power6_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
-   PAPI_FP_INS, PAPI_TOT_CYC, PAPI_L1_DCM, PAPI_L1_ICM, 0 };
-unsigned int preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
-   PAPI_FP_INS, PAPI_TOT_INS, PAPI_L1_DCM, PAPI_L1_ICM, 0 };
-static unsigned int PAPI_events[PAPI_MPX_DEF_DEG] = { 0, };
+int solaris_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+	PAPI_BR_MSP, PAPI_TOT_CYC, PAPI_L2_TCM, PAPI_L1_ICM, 0
+};
+int power6_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+	PAPI_FP_INS, PAPI_TOT_CYC, PAPI_L1_DCM, PAPI_L1_ICM, 0
+};
+int preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+	PAPI_FP_INS, PAPI_TOT_INS, PAPI_L1_DCM, PAPI_L1_ICM, 0
+};
+static int PAPI_events[PAPI_MPX_DEF_DEG] = { 0, };
 static int PAPI_events_len = 0;
 
 #define CPP_TEST_FAIL(string, retval) test_fail(__FILE__, __LINE__, string, retval)
 
-void init_papi(unsigned int *out_events, int *len)
+void
+init_papi( int *out_events, int *len )
 {
    int retval;
    int i, real_len = 0;
-   unsigned int *in_events = preset_PAPI_events;
+	int *in_events = preset_PAPI_events;
    const PAPI_hw_info_t *hw_info;
 
    /* Initialize the library */
@@ -39,6 +45,10 @@ void init_papi(unsigned int *out_events, int *len)
    if (hw_info == NULL)
       test_fail(__FILE__, __LINE__, "PAPI_get_hardware_info", 2);
 
+	if ( strstr( hw_info->model_string, "UltraSPARC" ) ) {
+		in_events = solaris_preset_PAPI_events;
+	}
+
    if (strcmp(hw_info->model_string, "POWER6") == 0) {
       in_events = power6_preset_PAPI_events;
       retval = PAPI_set_domain(PAPI_DOM_ALL);
diff --git a/src/ctests/multiplex1_pthreads.c b/src/ctests/multiplex1_pthreads.c
index f9fbee0..7706833 100644
--- a/src/ctests/multiplex1_pthreads.c
+++ b/src/ctests/multiplex1_pthreads.c
@@ -1,6 +1,6 @@
 /* 
 * File:    multiplex1_pthreads.c
-* CVS:     $Id: multiplex1_pthreads.c,v 1.49 2009/11/11 18:47:42 bsheely Exp $
+* CVS:     $Id: multiplex1_pthreads.c,v 1.49.4.1 2010/04/29 02:30:46 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    <your name here>
@@ -12,20 +12,26 @@
 #include <pthread.h>
 #include "papi_test.h"
 
-unsigned int power6_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
-   PAPI_FP_INS, PAPI_TOT_CYC, PAPI_L1_DCM, PAPI_L1_ICM, 0 };
-unsigned int preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
-   PAPI_FP_INS, PAPI_TOT_INS, PAPI_L1_DCM, PAPI_L1_ICM, 0 };
-static unsigned int PAPI_events[PAPI_MPX_DEF_DEG] = { 0, };
+int solaris_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+  PAPI_BR_MSP, PAPI_TOT_CYC, PAPI_L2_TCM, PAPI_L1_ICM, 0
+};
+int power6_preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+	PAPI_FP_INS, PAPI_TOT_CYC, PAPI_L1_DCM, PAPI_L1_ICM, 0
+};
+int preset_PAPI_events[PAPI_MPX_DEF_DEG] = {
+	PAPI_FP_INS, PAPI_TOT_INS, PAPI_L1_DCM, PAPI_L1_ICM, 0
+};
+static int PAPI_events[PAPI_MPX_DEF_DEG] = { 0, };
 static int PAPI_events_len = 0;
 
 #define CPP_TEST_FAIL(string, retval) test_fail(__FILE__, __LINE__, string, retval)
 
-void init_papi_pthreads(unsigned int *out_events, int *len)
+void
+init_papi_pthreads( int *out_events, int *len )
 {
    int retval;
    int i, real_len = 0;
-   unsigned int *in_events = preset_PAPI_events;
+	int *in_events = preset_PAPI_events;
    const PAPI_hw_info_t *hw_info;
 
    /* Initialize the library */
@@ -34,16 +40,13 @@ void init_papi_pthreads(unsigned int *out_events, int *len)
       CPP_TEST_FAIL("PAPI_library_init", retval);
 
    hw_info = PAPI_get_hardware_info();
-
-   /* Initialize the library */
-   retval = PAPI_library_init(PAPI_VER_CURRENT);
-   if (retval != PAPI_VER_CURRENT)
-      CPP_TEST_FAIL("PAPI_library_init", retval);
-
-   hw_info = PAPI_get_hardware_info();
    if (hw_info == NULL)
       test_fail(__FILE__, __LINE__, "PAPI_get_hardware_info", 2);
 
+	if ( strstr( hw_info->model_string, "UltraSPARC" ) ) {
+	  in_events = solaris_preset_PAPI_events;
+        }
+
    if (strcmp(hw_info->model_string, "POWER6") == 0) {
       in_events = power6_preset_PAPI_events;
       retval = PAPI_set_domain(PAPI_DOM_ALL);
@@ -108,7 +111,7 @@ int do_pthreads(void *(*fn) (void *))
       pthread_join(id[i], NULL);
 
    pthread_attr_destroy(&attr);
-
+	pthread_exit( NULL );
    return (SUCCESS);
 }
 
@@ -116,9 +119,13 @@ int do_pthreads(void *(*fn) (void *))
 
 void *case1_pthreads(void *arg)
 {
+	( void ) arg;			 /*unused */
    int retval, i, EventSet = PAPI_NULL;
    long long values[2];
 
+	if ( ( retval = PAPI_register_thread(  ) ) != PAPI_OK )
+		test_fail( __FILE__, __LINE__, "PAPI_register_thread", retval );
+
    if ((retval = PAPI_create_eventset(&EventSet)) != PAPI_OK)
       test_fail(__FILE__, __LINE__, "PAPI_create_eventset", retval);
 
@@ -153,6 +160,9 @@ void *case1_pthreads(void *arg)
    if ((retval = PAPI_cleanup_eventset(EventSet)) != PAPI_OK)   /* JT */
       test_fail(__FILE__, __LINE__, "PAPI_cleanup_eventset", retval);
 
+	if ( ( retval = PAPI_unregister_thread(  ) ) != PAPI_OK )
+		test_fail( __FILE__, __LINE__, "PAPI_unregister_thread", retval );
+
    return ((void *) SUCCESS);
 }
 
@@ -160,9 +170,13 @@ void *case1_pthreads(void *arg)
 
 void *case2_pthreads(void *arg)
 {
+	( void ) arg;			 /*unused */
    int retval, i, EventSet = PAPI_NULL;
    long long values[2];
 
+	if ( ( retval = PAPI_register_thread(  ) ) != PAPI_OK )
+		test_fail( __FILE__, __LINE__, "PAPI_register_thread", retval );
+
    if ((retval = PAPI_create_eventset(&EventSet)) != PAPI_OK)
       test_fail(__FILE__, __LINE__, "PAPI_create_eventset", retval);
 
@@ -208,6 +222,9 @@ void *case2_pthreads(void *arg)
    if ((retval = PAPI_cleanup_eventset(EventSet)) != PAPI_OK)   /* JT */
       test_fail(__FILE__, __LINE__, "PAPI_cleanup_eventset", retval);
 
+	if ( ( retval = PAPI_unregister_thread(  ) ) != PAPI_OK )
+		test_fail( __FILE__, __LINE__, "PAPI_unregister_thread", retval );
+
    return ((void *) SUCCESS);
 }
 
@@ -215,9 +232,13 @@ void *case2_pthreads(void *arg)
 
 void *case3_pthreads(void *arg)
 {
+	( void ) arg;			 /*unused */
    int retval, i, EventSet = PAPI_NULL;
    long long values[2];
 
+	if ( ( retval = PAPI_register_thread(  ) ) != PAPI_OK )
+		test_fail( __FILE__, __LINE__, "PAPI_register_thread", retval );
+
    if ((retval = PAPI_create_eventset(&EventSet)) != PAPI_OK)
       test_fail(__FILE__, __LINE__, "PAPI_create_eventset", retval);
 
@@ -255,6 +276,9 @@ void *case3_pthreads(void *arg)
    if ((retval = PAPI_cleanup_eventset(EventSet)) != PAPI_OK)   /* JT */
       test_fail(__FILE__, __LINE__, "PAPI_cleanup_eventset", retval);
 
+	if ( ( retval = PAPI_unregister_thread(  ) ) != PAPI_OK )
+		test_fail( __FILE__, __LINE__, "PAPI_unregister_thread", retval );
+
    return ((void *) SUCCESS);
 }
 
@@ -262,10 +286,14 @@ void *case3_pthreads(void *arg)
 
 void *case4_pthreads(void *arg)
 {
+	( void ) arg;			 /*unused */
    int retval, i, EventSet = PAPI_NULL;
    long long values[4];
    char out[PAPI_MAX_STR_LEN];
 
+	if ( ( retval = PAPI_register_thread(  ) ) != PAPI_OK )
+		test_fail( __FILE__, __LINE__, "PAPI_register_thread", retval );
+
    if ((retval = PAPI_create_eventset(&EventSet)) != PAPI_OK)
       test_fail(__FILE__, __LINE__, "PAPI_create_eventset", retval);
 
@@ -306,6 +334,9 @@ void *case4_pthreads(void *arg)
    if ((retval = PAPI_cleanup_eventset(EventSet)) != PAPI_OK)   /* JT */
       test_fail(__FILE__, __LINE__, "PAPI_cleanup_eventset", retval);
 
+	if ( ( retval = PAPI_unregister_thread(  ) ) != PAPI_OK )
+		test_fail( __FILE__, __LINE__, "PAPI_unregister_thread", retval );
+
    return ((void *) SUCCESS);
 }
 
diff --git a/src/ctests/native.c b/src/ctests/native.c
index 3f6283b..6f8bf11 100644
--- a/src/ctests/native.c
+++ b/src/ctests/native.c
@@ -86,7 +86,7 @@ extern int TESTS_QUIET;         /* Declared in test_utils.c */
 #elif defined(_BGL)
    static char *native_name[] = { "BGL_UPC_PU0_PREF_STREAM_HIT", "BGL_PAPI_TIMEBASE", "BGL_UPC_PU1_PREF_STREAM_HIT", NULL };
 
-#elif defined(_BGP)
+#elif defined(__bgp__)
    static char *native_name[] = { "PNE_BGP_PU0_JPIPE_LOGICAL_OPS", "PNE_BGP_PU0_JPIPE_LOGICAL_OPS", "PNE_BGP_PU2_IPIPE_INSTRUCTIONS", NULL };
 
 #else
diff --git a/src/ctests/shlib.c b/src/ctests/shlib.c
index a1d512e..708ddc2 100644
--- a/src/ctests/shlib.c
+++ b/src/ctests/shlib.c
@@ -1,6 +1,6 @@
 /* 
 * File:    profile.c
-* CVS:     $Id: shlib.c,v 1.18 2009/09/10 20:19:49 terpstra Exp $
+* CVS:     $Id: shlib.c,v 1.18.6.2 2010/01/27 00:27:26 jagode Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    <your name here>
@@ -59,49 +59,25 @@ int main(int argc, char **argv)
 
 #ifndef NO_DLFCN
    {
-     char *libname = 
-     "libpapi.so";
-     char *libname2 = 
-     "libpapi64.so";
-     char *_libname;
+     char *_libname =
+	   "libm.so";
      void *handle ;
-/*
-     void *handle = dlopen("libm.so", RTLD_LAZY);
-*/
-     int (*num_hwctrs)(void);
+	 double (*pow)(double,double);
      int oldcount;
-     int my_dlerror = 0;
-
-RETRY:
-     if ( !my_dlerror ){
-        printf("\nLoading %s with dlopen().\n",libname);
-        _libname = libname;
-     }
-     else{
-        printf("\nLoading %s with dlopen().\n",libname2);
-        _libname = libname2;
-     }
 
      handle = dlopen (_libname, RTLD_NOW);
      if (!handle) {
 	 printf("dlopen: %s\n",dlerror());
-          if ( !my_dlerror ){
-             my_dlerror = 1;
-	     printf("Trying again.");
-             goto RETRY;
-          }
           printf("Did you forget to set the environmental variable LIBPATH (in AIX) or LD_LIBRARY_PATH (in linux) ?\n");
           test_fail(__FILE__, __LINE__, "dlopen", 1);
      }
      
-     printf("Looking up PAPI_num_counters() \n");
-     num_hwctrs = ( int (*) (void)) dlsym(handle, "PAPI_num_counters");
-     if (num_hwctrs == NULL)  {
+	 pow = (double(*)(double,double)) dlsym(handle, "pow");
+	 if (pow == NULL) {
        printf("dlsym: %s \n", dlerror());
        test_fail(__FILE__, __LINE__, "dlsym", 1);
      }
-     
-     printf ("There are %d hardware counters \n", (*num_hwctrs)());
+	 printf("2^2 = %lf \n",(*pow)(2,2));
  
    oldcount = shinfo->count;
 
diff --git a/src/extras.c b/src/extras.c
index 0520309..f8347d5 100644
--- a/src/extras.c
+++ b/src/extras.c
@@ -4,7 +4,7 @@
 
 /* 
 * File:    extras.c
-* CVS:     $Id: extras.c,v 1.159 2009/12/18 20:24:24 terpstra Exp $
+* CVS:     $Id: extras.c,v 1.159.2.3 2010/04/29 02:32:15 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    dan terpstra
@@ -460,7 +460,7 @@ int _papi_hwi_start_signal(int signal, int need_context, int cidx)
    action.sa_flags = SA_RESTART;
    action.sa_sigaction = (void (*)(int, siginfo_t *, void *)) _papi_hwd[cidx]->dispatch_timer;
    if (need_context)
-#if (defined(_BGL) /*|| defined (_BGP)*/)
+#if (defined(_BGL) /*|| defined (__bgp__)*/)
      action.sa_flags |= SIGPWR;
 #else
      action.sa_flags |= SA_SIGINFO;
@@ -562,32 +562,48 @@ int _papi_hwi_native_name_to_code(char *in, int *out)
 	char name[PAPI_HUGE_STR_LEN]; /* make sure it's big enough */
 	unsigned int i, j;
 
-	for (j=0,i = 0 | PAPI_NATIVE_MASK;j<papi_num_components; j++,i = 0 | PAPI_NATIVE_MASK) {
+	
+	for ( j = 0, i = 0 | PAPI_NATIVE_MASK; j<papi_num_components; j++, i = 0 | PAPI_NATIVE_MASK )
+	{
 		/* first check each component for name_to_code */
 		if (vector_find_dummy( (void*) _papi_hwd[j]->ntv_name_to_code, NULL) == NULL)
+		{
+			/* if ntv_name_to_code is set and != NULL */
 		  retval = _papi_hwd[j]->ntv_name_to_code(in, (unsigned *)out);
-		else {
+		}
+		else 
+		{
 			_papi_hwd[j]->ntv_enum_events(&i, PAPI_ENUM_FIRST);
 			_papi_hwi_lock(INTERNAL_LOCK);
-			do {
+			
+			do 
+			{
 				retval = _papi_hwd[j]->ntv_code_to_name(i, name, sizeof(name));
 /*				printf("name =|%s|\ninput=|%s|\n", name, in); */
-				if (retval == PAPI_OK) {
-					if (strcasecmp(name, in) == 0) {
+				if (retval == PAPI_OK) 
+				{
+					if (strcasecmp(name, in) == 0) 
+					{
 						*out = i | PAPI_COMPONENT_MASK(j);;
 						break;
-					} else {
+					} 
+					else
 						retval = PAPI_ENOEVNT;
 					}
-				} else {
+				else 
+				{
 					*out = 0;
 					retval = PAPI_ENOEVNT;
 					break;
 				}
-			} while ((_papi_hwd[j]->ntv_enum_events(&i, PAPI_ENUM_EVENTS) == PAPI_OK));
+			} 
+			while ( ( _papi_hwd[j]->ntv_enum_events( &i, PAPI_ENUM_EVENTS ) == PAPI_OK ) );
+			
 			_papi_hwi_unlock(INTERNAL_LOCK);
-			if (retval == PAPI_OK) return(retval);
 		}
+		
+		if ( retval == PAPI_OK ) 
+			return( retval );
 	}
 	return (retval);
 }
@@ -675,7 +691,7 @@ int _papi_hwi_get_native_event_info(unsigned int EventCode, PAPI_event_info_t *
 	return (PAPI_ENOEVNT);
 }
 
-#if (!defined(HAVE_FFSLL) || defined(_BGP))
+#if (!defined(HAVE_FFSLL) || defined(__bgp__))
 /* find the first set bit in long long */
 
 int ffsll(long long lli)
diff --git a/src/libpfm-3.y/lib/pfmlib_intel_nhm.c b/src/libpfm-3.y/lib/pfmlib_intel_nhm.c
index b134c3c..e03a7b2 100644
--- a/src/libpfm-3.y/lib/pfmlib_intel_nhm.c
+++ b/src/libpfm-3.y/lib/pfmlib_intel_nhm.c
@@ -172,6 +172,9 @@ pfm_nhm_detect(void)
 	switch(cpu_model) {
 		case 26: /* Nehalem Core i7 */
 		case 30: /* Nehalem Core i5 */
+	        case 37:
+	        case 44:
+                case 46:
 			  break;
 		default:
 			return PFMLIB_ERR_NOTSUPP;
@@ -238,6 +241,9 @@ pfm_nhm_init(void)
 	switch(cpu_model) {
 	case 26:
 	case 30:
+	case 37:
+	case 44:
+        case 46:
 		num_pe = PME_COREI7_EVENT_COUNT;
 		num_unc_pe = PME_COREI7_UNC_EVENT_COUNT;
 		pe = corei7_pe;
diff --git a/src/papi.c b/src/papi.c
index 67cce1e..cff723a 100644
--- a/src/papi.c
+++ b/src/papi.c
@@ -4,7 +4,7 @@
 
 /* 
 * File:    papi.c
-* CVS:     $Id: papi.c,v 1.337 2009/12/18 20:24:24 terpstra Exp $
+* CVS:     $Id: papi.c,v 1.337.2.2 2010/04/29 02:32:15 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    dan terpstra
@@ -1050,7 +1050,7 @@ int PAPI_reset(int EventSet)
 
       }
    } else {
-#ifdef _BGP
+#ifdef __bgp__
    //  For BG/P, we always want to reset the 'real' hardware counters.  The counters
    //  can be controlled via multiple interfaces, and we need to ensure that the values
    //  are truly zero...
@@ -1349,13 +1349,10 @@ int PAPI_set_multiplex(int EventSet)
    if (ESI == NULL)
       papi_return(PAPI_ENOEVST);
 
-   /* if the eventset has no index and no events, return OK
-      otherwise return NOCMP */
+   /* if the eventset has no index return NOCMP */
    cidx = valid_ESI_component(ESI);
-   if (cidx < 0) {
-       if (ESI->NumberOfEvents) papi_return(cidx);
-       papi_return(PAPI_OK);
-   }
+   if (cidx < 0) papi_return(cidx);
+
    if ((ret = mpx_check(EventSet)) != PAPI_OK)
 	papi_return(ret);
 
diff --git a/src/papi.h b/src/papi.h
index 274ef23..5402f25 100644
--- a/src/papi.h
+++ b/src/papi.h
@@ -4,7 +4,7 @@
 
 /* 
 * File:    papi.h
-* CVS:     $Id: papi.h,v 1.193 2010/01/13 15:40:49 terpstra Exp $
+* CVS:     $Id: papi.h,v 1.193.2.2 2010/04/29 02:32:15 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    dan terpstra
@@ -36,8 +36,8 @@
 #define PAPI_VERSION_INCREMENT(x)((x)          & 0xff)
 
 /* This is the official PAPI version */
-/* Big increment for PAPI-C technology pre-release */
-#define PAPI_VERSION  			PAPI_VERSION_NUMBER(4,0,0,0)
+/* The final digit represents the patch count */
+#define PAPI_VERSION  			PAPI_VERSION_NUMBER(4,0,0,3)
 #define PAPI_VER_CURRENT 		(PAPI_VERSION & 0xffff0000)
 
 #ifdef __cplusplus
@@ -646,7 +646,7 @@ read the documentation carefully.  */
 */
 /* MAX_TERMS is the current max value of MAX_COUNTER_TERMS as defined in SUBSTRATEs */
 /* This definition also is HORRIBLE and should be replaced by a dynamic value. -pjm */
-#ifdef _BGP
+#ifdef __bgp__
 #define PAPI_MAX_INFO_TERMS  19 /* should match PAPI_MAX_COUNTER_TERMS defined in papi_internal.h */
 #else
 #define PAPI_MAX_INFO_TERMS 12
diff --git a/src/papiStdEventDefs.h b/src/papiStdEventDefs.h
index 8668ecc..b2cea3c 100644
--- a/src/papiStdEventDefs.h
+++ b/src/papiStdEventDefs.h
@@ -172,7 +172,7 @@ enum {
    PAPI_BGL_TR_DPKT_idx, /*Tree 256 byte packets */
    PAPI_BGL_TR_FULL_idx,  /*UPC cycles (CLOCKx2) tree rcv is full */
 #endif
-#ifdef _BGP
+#ifdef __bgp__
  /* 0x67 */
    PAPI_BGP_TS_32B_idx ,  /*Torus 32B chunks sent */
    PAPI_BGP_TS_DPKT_idx , /*Torus data packets sent */
@@ -296,7 +296,7 @@ enum {
 #define PAPI_BGL_TR_FULL (PAPI_BGL_TR_FULL_idx | PAPI_PRESET_MASK)
 #endif
 
-#ifdef _BGP
+#ifdef __bgp__
 #define PAPI_BGP_TS_32B (PAPI_BGP_TS_32B_idx | PAPI_PRESET_MASK)
 #define PAPI_BGP_TS_DPKT (PAPI_BGP_TS_DPKT_idx | PAPI_PRESET_MASK)
 #endif
diff --git a/src/papi_data.c b/src/papi_data.c
index 16a6a22..ab2935a 100644
--- a/src/papi_data.c
+++ b/src/papi_data.c
@@ -4,7 +4,7 @@
 
 /* 
 * File:    papi_data.c
-* CVS:     $Id: papi_data.c,v 1.35 2009/12/18 20:24:24 terpstra Exp $
+* CVS:     $Id: papi_data.c,v 1.35.2.1 2010/04/29 02:32:15 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    dan terpstra
@@ -178,7 +178,7 @@ const hwi_preset_info_t _papi_hwi_preset_info[PAPI_MAX_PRESET_EVENTS] = {
    /*109*/ {"PAPI_BGL_TS_FULL", "Torus no token UPC cycles", "BGL special event: Torus no token UPC cycles"}, 
    /*110*/ {"PAPI_BGL_TR_DPKT", "Tree 256 byte packets", "BGL special event: Tree 256 byte packets"},
    /*111*/ {"PAPI_BGL_TR_FULL", "UPC cycles (CLOCKx2) tree rcv is full", "BGL special event: UPC cycles (CLOCKx2) tree rcv is full"},
-#elif defined (_BGP)
+#elif defined (__bgp__)
    /*107*/ {"PAPI_BGL_TS_32B", "Torus 32B chunks sent", "BGL special event: Torus 32B chunks sent"},
    /*108*/ {"PAPI_BGL_TR_DPKT", "Tree 256 byte packets", "BGL special event: Tree 256 byte packets"},
    /*109*/ {NULL, NULL, NULL},
@@ -324,7 +324,7 @@ const unsigned int _papi_hwi_preset_type[] = {
    /*109: PAPI_BGL_TS_FULL */  PAPI_PRESET_BIT_MSC, 
    /*110: PAPI_BGL_TR_DPKT */  PAPI_PRESET_BIT_MSC,
    /*111: PAPI_BGL_TR_FULL */  PAPI_PRESET_BIT_MSC,
-#elif defined (_BGP)
+#elif defined (__bgp__)
    /*107: PAPI_BGL_TS_32B */  PAPI_PRESET_BIT_MSC,
    /*108: PAPI_BGL_TR_DPKT */  PAPI_PRESET_BIT_MSC,
    /*109*/ 0,
diff --git a/src/papi_events.csv b/src/papi_events.csv
index bc0e1ca..1d9c08a 100644
--- a/src/papi_events.csv
+++ b/src/papi_events.csv
@@ -103,9 +103,29 @@ PRESET,PAPI_FUL_ICY,NOT_DERIVED,CPU_INSDUAL
 PRESET,PAPI_L2_TCM,NOT_DERIVED,CPU_L2MISSALL
 PRESET,PAPI_L2_TCA,NOT_DERIVED,CPU_L2REQ
 #
+CPU,AMD64 (K7)
+PRESET,PAPI_L1_ICM,NOT_DERIVED,INSTRUCTION_CACHE_MISSES
+PRESET,PAPI_L1_ICA,NOT_DERIVED,INSTRUCTION_CACHE_FETCHES
+PRESET,PAPI_L1_ICR,NOT_DERIVED,INSTRUCTION_CACHE_FETCHES
+PRESET,PAPI_L1_DCM,NOT_DERIVED,DATA_CACHE_MISSES
+PRESET,PAPI_L1_DCA,NOT_DERIVED,DATA_CACHE_ACCESSES
+PRESET,PAPI_L1_DCH,DERIVED_SUB,DATA_CACHE_ACCESSES,DATA_CACHE_MISSES
+PRESET,PAPI_L1_TCA,DERIVED_ADD,DATA_CACHE_ACCESSES,INSTRUCTION_CACHE_FETCHES
+PRESET,PAPI_L1_TCM,DERIVED_ADD,INSTRUCTION_CACHE_MISSES,DATA_CACHE_MISSES
+PRESET,PAPI_L1_TCH,DERIVED_POSTFIX,N0|N1|+|N2|-|N3|-|,DATA_CACHE_ACCESSES,INSTRUCTION_CACHE_FETCHES,DATA_CACHE_MISSES,INSTRUCTION_CACHE_MISSES
+#
+PRESET,PAPI_TLB_DM,NOT_DERIVED,L1_DTLB_AND_L2_DTLB_MISS
+PRESET,PAPI_TLB_IM,NOT_DERIVED,L1_ITLB_MISS_AND_L2_ITLB_MISS
+PRESET,PAPI_TLB_TL,DERIVED_ADD,L1_DTLB_AND_L2_DTLB_MISS,L1_ITLB_MISS_AND_L2_ITLB_MISS
+#
+PRESET,PAPI_BR_INS,NOT_DERIVED,RETIRED_BRANCH_INSTRUCTIONS
+PRESET,PAPI_BR_TKN,NOT_DERIVED,RETIRED_TAKEN_BRANCH_INSTRUCTIONS
+PRESET,PAPI_BR_MSP,NOT_DERIVED,RETIRED_MISPREDICTED_BRANCH_INSTRUCTIONS
+#
+PRESET,PAPI_HW_INT,NOT_DERIVED,INTERRUPTS_TAKEN
+#
 CPU,AMD64
 CPU,AMD64 (unknown model)
-CPU,AMD64 (K7)
 CPU,AMD64 (K8 RevB)
 CPU,AMD64 (K8 RevC)
 CPU,AMD64 (K8 RevD)
@@ -299,7 +319,7 @@ CPU,Intel Nehalem
 PRESET,PAPI_L1_ICM,NOT_DERIVED,L1I:MISSES
 PRESET,PAPI_L1_ICA,NOT_DERIVED,L1I:READS
 PRESET,PAPI_L1_ICH,NOT_DERIVED,L1I:HITS
-#PRESET,PAPI_L1_DCM,NOT_DERIVED,L1D_REPL
+PRESET,PAPI_L1_DCM,NOT_DERIVED,L1D:REPL
 PRESET,PAPI_L1_DCA,NOT_DERIVED,L1D_ALL_REF:ANY
 #PRESET,PAPI_L1_DCH,DERIVED_SUB,L1D_ALL_REF,L1D_REPL
 #PRESET,PAPI_L1_TCM,NOT_DERIVED,L2_RQSTS:SELF:MESI
@@ -1023,6 +1043,7 @@ PRESET,PAPI_L2_TCA,NOT_DERIVED,EC_REF
 PRESET,PAPI_BR_MSP,NOT_DERIVED,DISPATCH0_MISPRED
 PRESET,PAPI_L1_ICH,NOT_DERIVED,IC_HIT
 PRESET,PAPI_L2_TCH,NOT_DERIVED,EC_HIT
+PRESET,PAPI_L2_TCM,DERIVED_SUB,EC_REF,EC_HIT
 #
 CPU,ultra3
 CPU,ultra3i
diff --git a/src/papi_internal.c b/src/papi_internal.c
index 1768404..1a0804c 100644
--- a/src/papi_internal.c
+++ b/src/papi_internal.c
@@ -4,7 +4,7 @@
 
 /* 
 * File:    papi_internal.c
-* CVS:     $Id: papi_internal.c,v 1.138 2010/01/13 18:39:05 terpstra Exp $
+* CVS:     $Id: papi_internal.c,v 1.138.2.1 2010/03/08 22:08:09 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    dan terpstra
@@ -580,6 +580,22 @@ static int add_native_fail_clean(EventSetInfo_t * ESI, int nevt)
    return -1;
 }
 
+/* since update_control_state trashes overflow settings, this puts things
+   back into balance. */
+static int update_overflow(EventSetInfo_t * ESI)
+{
+	int i, retval = PAPI_OK;
+
+	if (ESI->overflow.flags & PAPI_OVERFLOW_HARDWARE) {
+		for (i=0; i<ESI->overflow.event_counter; i++) {
+			retval = _papi_hwd[ESI->CmpIdx]->set_overflow(ESI, 
+				ESI->overflow.EventIndex[i], ESI->overflow.threshold[i]);
+			if (retval != PAPI_OK) break;
+		}
+	}
+	return (retval);
+}
+
 /* this function is called by _papi_hwi_add_event when adding native events 
 nix: pointer to array of native event table indexes from the preset entry
 size: number of native events to add
@@ -771,6 +787,8 @@ int _papi_hwi_add_event(EventSetInfo_t * ESI, int EventCode)
 
    /* Bump the number of events */
    ESI->NumberOfEvents++;
+	/* reinstate the overflows if any */
+	update_overflow( ESI );
 
    return (retval);
 }
@@ -875,14 +893,14 @@ int remove_native_events(EventSetInfo_t * ESI, int *nevt, int size)
    /* If we removed any elements, 
       clear the now empty slots, reinitialize the index, and update the count.
       Then send the info down to the substrate to update the hwd control structure. */
+   retval = PAPI_OK;
    if (zero) {
       retval = _papi_hwd[ESI->CmpIdx]->update_control_state(ESI->ctl_state, native, ESI->NativeCount,
 		ESI->master->context[ESI->CmpIdx]);
-      if (retval != PAPI_OK)
-         return (retval);
+      if (retval == PAPI_OK)
+         retval = update_overflow(ESI);
    }
-
-   return (PAPI_OK);
+   return (retval);
 }
 
 int _papi_hwi_remove_event(EventSetInfo_t * ESI, int EventCode)
diff --git a/src/papi_internal.h b/src/papi_internal.h
index 2f8a93c..7288569 100644
--- a/src/papi_internal.h
+++ b/src/papi_internal.h
@@ -4,7 +4,7 @@
 
 /* 
 * File:    papi_internal.h
-* CVS:     $Id: papi_internal.h,v 1.181 2009/12/18 20:24:24 terpstra Exp $
+* CVS:     $Id: papi_internal.h,v 1.181.2.1 2010/04/29 02:32:15 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    dan terpstra
@@ -166,7 +166,7 @@ extern int papi_num_components;
     Now it's defined globally as 8 for everything. Mainly applies to max terms in
     derived events.
 */
-#ifdef _BGP
+#ifdef __bgp__
 #define PAPI_MAX_COUNTER_TERMS	19
 #else
 #define PAPI_MAX_COUNTER_TERMS	8
diff --git a/src/papi_preset.h b/src/papi_preset.h
index c67e5f5..8067b19 100644
--- a/src/papi_preset.h
+++ b/src/papi_preset.h
@@ -22,7 +22,7 @@ typedef struct hwi_preset_data {  /* preset event data for each defined preset *
    unsigned int mask;
    unsigned int count; */
    int native[PAPI_MAX_COUNTER_TERMS];    /* array of native event code(s) for this preset event */
-#ifdef _BGP
+#ifdef __bgp__
    char operation[PAPI_2MAX_STR_LEN]; /* operation string: +,-,*,/,@(number of metrics), $(constant Mhz), %(1000000.0) */
 #else
    char operation[PAPI_MIN_STR_LEN]; /* operation string: +,-,*,/,@(number of metrics), $(constant Mhz), %(1000000.0) */
diff --git a/src/papi_protos.h b/src/papi_protos.h
index 0db72d9..eb2ad2a 100644
--- a/src/papi_protos.h
+++ b/src/papi_protos.h
@@ -7,7 +7,7 @@
 
 /* 
 * File:    papi_protos.h
-* CVS:     $Id: papi_protos.h,v 1.69 2009/12/18 20:24:24 terpstra Exp $
+* CVS:     $Id: papi_protos.h,v 1.69.2.1 2010/04/29 02:32:15 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    Haihang You
@@ -229,7 +229,7 @@ void _papi_hwd_dispatch_timer(int signal, hwd_siginfo_t * info, void *tmp);
 /* papi_internal.c global papi error function */
 void PAPIERROR(char *format, ...);
 
-#if (!defined(HAVE_FFSLL) || defined(_BGP))
+#if (!defined(HAVE_FFSLL) || defined(__bgp__))
  int ffsll(long long lli);
 #endif
 
diff --git a/src/papi_vector.c b/src/papi_vector.c
index b42b011..fbd0a20 100644
--- a/src/papi_vector.c
+++ b/src/papi_vector.c
@@ -1,6 +1,6 @@
 /*
  * File:    linux.c
- * CVS:     $Id: papi_vector.c,v 1.22 2009/12/18 20:24:24 terpstra Exp $
+ * CVS:     $Id: papi_vector.c,v 1.22.2.1 2010/04/29 02:32:15 terpstra Exp $
  * Author:  Kevin London
  *          london@cs.utk.edu
  * Mods:    Haihang You
@@ -88,7 +88,7 @@ long long vec_dummy_get_real_cycles (void)
   return((long long)cyc);
 }
 
-#if ((defined _BGL) || (defined _BGP))
+#if ((defined _BGL) || (defined __bgp__))
    #include <stdlib.h>
    #include <sys/time.h>
    #include <sys/resource.h>
@@ -97,7 +97,7 @@ long long vec_dummy_get_real_cycles (void)
 long long vec_dummy_get_virt_usec (const hwd_context_t *zero)
 {
   long long retval;
-#if ((defined _BGL) || (defined _BGP))
+#if ((defined _BGL) || (defined __bgp__))
       struct rusage ruse;
       getrusage(RUSAGE_SELF, &ruse);
       retval = (long long)(ruse.ru_utime.tv_sec * 1000000 + ruse.ru_utime.tv_usec);
diff --git a/src/perf_events.c b/src/perf_events.c
index fe0035b..4685560 100644
--- a/src/perf_events.c
+++ b/src/perf_events.c
@@ -1,6 +1,6 @@
 /*
 * File:    perf_events.c
-* CVS:     $Id: perf_events.c,v 1.18 2010/01/14 15:48:00 terpstra Exp $
+* CVS:     $Id: perf_events.c,v 1.18.2.1 2010/01/27 22:26:42 jagode Exp $
 * Author:  Corey Ashford
 *          cjashfor@us.ibm.com
 *          - based upon perfmon.c written by -
@@ -76,6 +76,7 @@ extern papi_vector_t _papi_pe_vector;
 
 extern int _papi_pfm_setup_presets(char *name, int type);
 extern int _papi_pfm_ntv_enum_events(unsigned int *EventCode, int modifier);
+extern int _papi_pfm_ntv_name_to_code(char *ntv_name, unsigned int *EventCode);
 extern int _papi_pfm_ntv_code_to_name(unsigned int EventCode, char *ntv_name, int len);
 extern int _papi_pfm_ntv_code_to_descr(unsigned int EventCode, char *ntv_descr, int len);
 extern int _papi_pfm_ntv_code_to_bits(unsigned int EventCode, hwd_register_t *bits);
@@ -2014,8 +2015,8 @@ int _papi_pe_init_substrate (int cidx)
     }
   SUBDBG ("pfm_get_num_events: %d\n", ncnt);
   MY_VECTOR.cmp_info.num_native_events = ncnt;
-  strcpy (MY_VECTOR.cmp_info.name, "$Id: perf_events.c,v 1.18 2010/01/14 15:48:00 terpstra Exp $");
-  strcpy (MY_VECTOR.cmp_info.version, "$Revision: 1.18 $");
+  strcpy (MY_VECTOR.cmp_info.name, "$Id: perf_events.c,v 1.18.2.1 2010/01/27 22:26:42 jagode Exp $");
+  strcpy (MY_VECTOR.cmp_info.version, "$Revision: 1.18.2.1 $");
   sprintf (buf, "%08x", version);
 
   pfm_get_num_counters ((unsigned int *) &MY_VECTOR.cmp_info.num_cntrs);
@@ -3383,6 +3384,7 @@ papi_vector_t _papi_pe_vector = {
     .allocate_registers =	_papi_pe_allocate_registers,
     .write =	_papi_pe_write,
     .ntv_enum_events =	_papi_pfm_ntv_enum_events,
+	.ntv_name_to_code = _papi_pfm_ntv_name_to_code,
     .ntv_code_to_name =	_papi_pfm_ntv_code_to_name,
     .ntv_code_to_descr =	_papi_pfm_ntv_code_to_descr,
     .ntv_code_to_bits =	_papi_pfm_ntv_code_to_bits,
diff --git a/src/perfmon.c b/src/perfmon.c
index e68806d..86bb3e2 100644
--- a/src/perfmon.c
+++ b/src/perfmon.c
@@ -1,6 +1,6 @@
 /*
 * File:    perfmon.c
-* CVS:     $Id: perfmon.c,v 1.97 2009/11/18 04:37:42 mucci Exp $
+* CVS:     $Id: perfmon.c,v 1.97.4.1 2010/01/27 22:26:42 jagode Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    Brian Sheely
@@ -42,6 +42,7 @@ extern int get_cpu_info(PAPI_hw_info_t * hwinfo);
 extern papi_vector_t _papi_pfm_vector;
 extern int _papi_pfm_setup_presets(char *name, int type);
 extern int _papi_pfm_ntv_enum_events(unsigned int *EventCode, int modifier);
+extern int _papi_pfm_ntv_name_to_code(char *ntv_name, unsigned int *EventCode);
 extern int _papi_pfm_ntv_code_to_name(unsigned int EventCode, char *ntv_name, int len);
 extern int _papi_pfm_ntv_code_to_descr(unsigned int EventCode, char *ntv_descr, int len);
 extern int _papi_pfm_ntv_code_to_bits(unsigned int EventCode, hwd_register_t *bits);
@@ -2216,8 +2217,8 @@ int _papi_pfm_init_substrate(int cidx)
     }
   SUBDBG("pfm_get_num_events: %d\n", ncnt);
   MY_VECTOR.cmp_info.num_native_events = ncnt;
-  strcpy(MY_VECTOR.cmp_info.name, "$Id: perfmon.c,v 1.97 2009/11/18 04:37:42 mucci Exp $");          
-  strcpy(MY_VECTOR.cmp_info.version, "$Revision: 1.97 $");  
+  strcpy(MY_VECTOR.cmp_info.name, "$Id: perfmon.c,v 1.97.4.1 2010/01/27 22:26:42 jagode Exp $");          
+  strcpy(MY_VECTOR.cmp_info.version, "$Revision: 1.97.4.1 $");  
   sprintf(buf,"%08x",version);
 
   pfm_get_num_counters((unsigned int *)&MY_VECTOR.cmp_info.num_cntrs);
@@ -3764,6 +3765,7 @@ papi_vector_t _papi_pfm_vector = {
     .allocate_registers =	_papi_pfm_allocate_registers,
     .write =	_papi_pfm_write,
     .ntv_enum_events =	_papi_pfm_ntv_enum_events,
+	.ntv_name_to_code = _papi_pfm_ntv_name_to_code,
     .ntv_code_to_name =	_papi_pfm_ntv_code_to_name,
     .ntv_code_to_descr =	_papi_pfm_ntv_code_to_descr,
     .ntv_code_to_bits =	_papi_pfm_ntv_code_to_bits,
diff --git a/src/solaris-memory.c b/src/solaris-memory.c
index 639722e..1918cf5 100644
--- a/src/solaris-memory.c
+++ b/src/solaris-memory.c
@@ -5,24 +5,111 @@
 *
 * Mods:    Philip J. Mucci
 *          mucci@cs.utk.edu
+*
+* Mods:    Vince Weaver
+*          vweaver1@eecs.utk.edu
 */
 
 #include "papi.h"
 #include "papi_internal.h"
 
-int get_memory_info(PAPI_hw_info_t * mem_info)
+
+int
+_solaris_get_memory_info( PAPI_hw_info_t * hw, int id )
 {
+        FILE *pipe;
+        char line[BUFSIZ];
+
+	PAPI_mh_level_t *mem = hw->mem_hierarchy.level;
+
+	pipe=popen("prtconf -pv","r");
+        if (pipe==NULL) {
+	   return PAPI_ESYS;
+	}
+
+	while(1) {
+
+	   if (fgets(line,BUFSIZ,pipe)==NULL) break;
+
+           if (strstr(line,"icache-size:")) {
+	      sscanf(line,"%*s %x",&mem[0].cache[0].size);
+	   }
+           if (strstr(line,"icache-line-size:")) {
+	      sscanf(line,"%*s %x",&mem[0].cache[0].line_size);
+	   }
+           if (strstr(line,"icache-associativity:")) {
+	      sscanf(line,"%*s %x",&mem[0].cache[0].associativity);
+	   }
+
+           if (strstr(line,"dcache-size:")) {
+	      sscanf(line,"%*s %x",&mem[0].cache[1].size);
+	   }
+           if (strstr(line,"dcache-line-size:")) {
+	      sscanf(line,"%*s %x",&mem[0].cache[1].line_size);
+	   }
+           if (strstr(line,"dcache-associativity:")) {
+	      sscanf(line,"%*s %x",&mem[0].cache[1].associativity);
+	   }
+
+           if (strstr(line,"ecache-size:")) {
+	      sscanf(line,"%*s %x",&mem[1].cache[0].size);
+	   }
+           if (strstr(line,"ecache-line-size:")) {
+	      sscanf(line,"%*s %x",&mem[1].cache[0].line_size);
+	   }
+           if (strstr(line,"ecache-associativity:")) {
+	      sscanf(line,"%*s %x",&mem[1].cache[0].associativity);
+	   }
+
+           if (strstr(line,"#itlb-entries:")) {
+	      sscanf(line,"%*s %x",&mem[0].tlb[0].num_entries);
+	   }
+           if (strstr(line,"#dtlb-entries:")) {
+	      sscanf(line,"%*s %x",&mem[0].tlb[1].num_entries);
+	   }
+
+	}
+       
+
+        pclose(pipe);
+
+	/* I-Cache -> L1$ instruction */
+	mem[0].cache[0].type = PAPI_MH_TYPE_INST;
+	if (mem[0].cache[0].line_size!=0) mem[0].cache[0].num_lines =
+		mem[0].cache[0].size / mem[0].cache[0].line_size;
+
+	/* D-Cache -> L1$ data */
+	mem[0].cache[1].type =
+		PAPI_MH_TYPE_DATA | PAPI_MH_TYPE_WT | PAPI_MH_TYPE_LRU;
+	if (mem[0].cache[1].line_size!=0) mem[0].cache[1].num_lines =
+		mem[0].cache[1].size / mem[0].cache[1].line_size;
+
+
+	/* ITLB -> TLB instruction */
+	mem[0].tlb[0].type = PAPI_MH_TYPE_INST | PAPI_MH_TYPE_PSEUDO_LRU;
+        /* assume fully associative */
+	mem[0].tlb[0].associativity = mem[0].tlb[0].num_entries;
+
+	/* DTLB -> TLB data */
+	mem[0].tlb[1].type = PAPI_MH_TYPE_DATA | PAPI_MH_TYPE_PSEUDO_LRU;
+        /* assume fully associative */
+	mem[0].tlb[1].associativity = mem[0].tlb[1].num_entries;
+
+	/* L2$ unified */
+	mem[1].cache[0].type = PAPI_MH_TYPE_UNIFIED | PAPI_MH_TYPE_WB
+		| PAPI_MH_TYPE_PSEUDO_LRU;
+	if (mem[1].cache[0].line_size!=0) mem[1].cache[0].num_lines =
+		mem[1].cache[0].size / mem[1].cache[0].line_size;
+
+	/* Indicate we have two levels filled in the hierarchy */
+	hw->mem_hierarchy.levels = 2;
+
    return PAPI_OK;
 }
 
-int _papi_hwd_get_dmem_info(PAPI_dmem_info_t *d)
+int
+_solaris_get_dmem_info( PAPI_dmem_info_t * d )
 {
-	/* This function has been reimplemented 
-		to conform to current interface.
-		It has not been tested.
-		Nor has it been confirmed for completeness.
-		dkt 05-10-06
-	*/
 
    FILE *fd;
    struct psinfo psi;
@@ -35,8 +122,8 @@ int _papi_hwd_get_dmem_info(PAPI_dmem_info_t *d)
    fread((void *) &psi, sizeof(struct psinfo), 1, fd);
    fclose(fd);
 
-   d->pagesize = getpagesize();
-   d->size = ((1024 * psi.pr_rssize) / d->pagesize);
+	d->pagesize = sysconf( _SC_PAGESIZE );
+	d->size = d->pagesize * sysconf( _SC_PHYS_PAGES );
    d->resident = ((1024 * psi.pr_size) / d->pagesize);
    d->high_water_mark = PAPI_EINVAL;
    d->shared = PAPI_EINVAL;
@@ -48,30 +135,4 @@ int _papi_hwd_get_dmem_info(PAPI_dmem_info_t *d)
 
    return (PAPI_OK);
 
-/*  Depending on OS we may need this, so going to leave
- *  the code here for now. -KSL
-   pid_t pid = getpid();
-   psinfo_t info;
-   char pfile[256];
-   long pgsz=getpagesize();
-   int fd;
-
-   sprintf(pfile, "/proc/%05d", pid);
-   if((fd=open(pfile,O_RDONLY)) <0 ) {
-        SUBDBG((stderr,"PAPI_get_dmem_info can't open /proc/%d\n",pid));
-        return(PAPI_ESYS);
-   }
-   if(ioctl(fd, PIOCPSINFO,  &info)<0){
-        return(PAPI_ESYS);
-   }
-   close(fd);
- switch(option){
-   case PAPI_GET_RESSIZE:
-        return(((1024*info.pr_rssize)/pgsz));
-   case PAPI_GET_SIZE:
-        return(((1024*info.pr_size)/pgsz));
-   default:
-        return(PAPI_EINVAL);
-  }
-  */
 }
diff --git a/src/solaris-niagara2.c b/src/solaris-niagara2.c
index 1058d1d..3f778fa 100644
--- a/src/solaris-niagara2.c
+++ b/src/solaris-niagara2.c
@@ -1157,8 +1157,24 @@ _niagara2_read (hwd_context_t * ctx, hwd_control_state_t * ctrl,
   for (i = 0; i < ctrl->count; i++)
     {
       /* Retrieve the counting results of libcpc */
-      __CHECK_ERR_DFLT (cpc_buf_get (cpc, ctrl->counter_buffer, ctrl->idx[i],
-				     &ctrl->result[i]));
+      int ret = cpc_buf_get (cpc, ctrl->counter_buffer, ctrl->idx[i],
+				     &ctrl->result[i]);
+      if(ret < 0)
+      {
+#ifdef SYNTHETIC_EVENTS_SUPPORTED
+        // Ignore this failure if this was a synthetic event. It might be more
+        // appropriate to simply not not call cpc_buf_get in this case, but I'm
+        // not confident I fully understand all implications of skipping the
+        // call. For some reason Solaris 11.1 didn't fail here but 11.2 does.
+        // It seems Oracle's made some changes to libcpc.
+        const int syn_barrier = _niagara2_vector.cmp_info.num_native_events
+          - __t2_store.syn_evt_count;
+        if (!ctrl->code[i].event_code >= syn_barrier)
+#endif
+        {
+          __CHECK_ERR_DFLT(ret);
+        }
+      }
 
       /* As libcpc uses uint64_t and PAPI uses int64_t, we need to normalize
          the result back to a value that PAPI can handle, otherwise the result
diff --git a/src/solaris-ultra.c b/src/solaris-ultra.c
index f08d7c8..cd91742 100644
--- a/src/solaris-ultra.c
+++ b/src/solaris-ultra.c
@@ -1,6 +1,6 @@
 /* 
 * File:    solaris-ultra.c
-* CVS:     $Id: solaris-ultra.c,v 1.125 2009/11/23 19:24:42 bsheely Exp $
+* CVS:     $Id: solaris-ultra.c,v 1.125.4.1 2010/04/29 02:32:15 terpstra Exp $
 * Author:  Philip Mucci
 *          mucci@cs.utk.edu
 * Mods:    Kevin London
@@ -10,7 +10,8 @@
 * Mods:    Larry Meadows(helped us to build the native table dynamically) 
 * Mods:    Brian Sheely
 *          bsheely@eecs.utk.edu 
-*              
+* Mods:    Vince Weaver
+*          vweaver1@eecs.utk.edu 
 */
 
 /* to understand this program, first you should read the user's manual
@@ -34,13 +35,15 @@
 static void action(void *arg, int regno, const char *name, uint8_t bits);
 
 /* Probably could dispense with this and just use native_table */
-typedef struct ctr_info {
+typedef struct ctr_info
+{
     char *name;	/* Counter name */
     int bits[2];	/* bits for register */
     int bitmask; /* 1 = pic0; 2 = pic1; 3 = both */
 } ctr_info_t;
 
-typedef struct einfo {
+typedef struct einfo
+{
     unsigned int papi_event;
     char *event_str;
 } einfo_t;
@@ -91,6 +94,8 @@ static einfo_t us2info[] = {
    {PAPI_L2_TCA, "EC_ref"},
 };
 
+papi_vector_t _solaris_vector;
+
 static native_info_t *native_table;
 static hwi_search_t *preset_table;
 
@@ -106,22 +111,26 @@ static int cpuver;
 static int pcr_shift[2];
 
 extern papi_mdi_t _papi_hwi_system_info;
+extern int _solaris_get_memory_info( PAPI_hw_info_t * hw, int id );
+extern int _solaris_get_dmem_info( PAPI_dmem_info_t * d );
 
 hwi_search_t *preset_search_map;
-/*static native_info_t *native_table;*/
 
 #ifdef DEBUG
-static void dump_cmd(papi_cpc_event_t * t)
+static void
+dump_cmd( papi_cpc_event_t * t )
 {
    SUBDBG("cpc_event_t.ce_cpuver %d\n", t->cmd.ce_cpuver);
    SUBDBG("ce_tick %llu\n", t->cmd.ce_tick);
-   SUBDBG("ce_pic[0] %llu ce_pic[1] %llu\n", t->cmd.ce_pic[0], t->cmd.ce_pic[1]);
+	SUBDBG( "ce_pic[0] %llu ce_pic[1] %llu\n", t->cmd.ce_pic[0],
+			t->cmd.ce_pic[1] );
    SUBDBG("ce_pcr 0x%llx\n", t->cmd.ce_pcr);
    SUBDBG("flags %x\n", t->flags);
 }
 #endif
 
-static void dispatch_emt(int signal, siginfo_t * sip, void *arg)
+static void
+dispatch_emt( int signal, siginfo_t * sip, void *arg )
 {
    int event_counter;
    _papi_hwi_context_t ctx;
@@ -140,15 +149,15 @@ static void dispatch_emt(int signal, siginfo_t * sip, void *arg)
       ESI = (EventSetInfo_t *) thread->running_eventset;
       int cidx = ESI->CmpIdx;
 
-      if ((ESI == NULL) || ((ESI->state & PAPI_OVERFLOWING) == 0))
-	{
+		if ( ( ESI == NULL ) || ( ( ESI->state & PAPI_OVERFLOWING ) == 0 ) ) {
 	  OVFDBG("Either no eventset or eventset not set to overflow.\n");
 	  return;
 	}
 
-      if (ESI->master != thread)
-	{
-	  PAPIERROR("eventset->thread 0x%lx vs. current thread 0x%lx mismatch",ESI->master,thread);
+		if ( ESI->master != thread ) {
+			PAPIERROR
+				( "eventset->thread 0x%lx vs. current thread 0x%lx mismatch",
+				  ESI->master, thread );
 	  return;
 	}
 
@@ -187,9 +196,11 @@ static void dispatch_emt(int signal, siginfo_t * sip, void *arg)
             overflow_vector = 1;
             /* reset the threshold */
             if (t == 0)
-               sample->cmd.ce_pic[0] = UINT64_MAX - ESI->overflow.threshold[0];
+					sample->cmd.ce_pic[0] =
+						UINT64_MAX - ESI->overflow.threshold[0];
             else
-               sample->cmd.ce_pic[0] = UINT64_MAX - ESI->overflow.threshold[1];
+					sample->cmd.ce_pic[0] =
+						UINT64_MAX - ESI->overflow.threshold[1];
          }
          readvalue = sample->cmd.ce_pic[1];
          if (readvalue >= 0) {
@@ -199,25 +210,28 @@ static void dispatch_emt(int signal, siginfo_t * sip, void *arg)
             overflow_vector ^= 1 << 1;
             /* reset the threshold */
             if (t == 0)
-               sample->cmd.ce_pic[1] = UINT64_MAX - ESI->overflow.threshold[1];
+					sample->cmd.ce_pic[1] =
+						UINT64_MAX - ESI->overflow.threshold[1];
             else
-               sample->cmd.ce_pic[1] = UINT64_MAX - ESI->overflow.threshold[0];
+					sample->cmd.ce_pic[1] =
+						UINT64_MAX - ESI->overflow.threshold[0];
          }
          SUBDBG("overflow_vector, = %d\n", overflow_vector);
          /* something is wrong here */
-         if (overflow_vector == 0)
-	   {
+			if ( overflow_vector == 0 ) {
 	     PAPIERROR("BUG! overflow_vector is 0, dropping interrupt");
 	     return;
 	   }
       }
 
       /* Call the regular overflow function in extras.c */
-      if (thread->running_eventset[cidx]->overflow.flags & PAPI_OVERFLOW_FORCE_SW) {
+		if ( thread->running_eventset[cidx]->overflow.
+			 flags & PAPI_OVERFLOW_FORCE_SW ) {
 	//address = GET_OVERFLOW_ADDRESS(ctx);
-         _papi_hwi_dispatch_overflow_signal((void*)&ctx, address, NULL, overflow_vector, 0, &thread, cidx);
-      }
-      else {
+			_papi_hwi_dispatch_overflow_signal( ( void * ) &ctx, address, NULL,
+												overflow_vector, 0, &thread,
+												cidx );
+		} else {
 	PAPIERROR("Additional implementation needed in dispatch_emt!");
       }
 
@@ -233,7 +247,8 @@ static void dispatch_emt(int signal, siginfo_t * sip, void *arg)
    }
 }
 
-static int scan_prtconf(char *cpuname, int len_cpuname, int *hz, int *ver)
+static int
+scan_prtconf( char *cpuname, int len_cpuname, int *hz, int *ver )
 {
    /* This code courtesy of our friends in Germany. Thanks Rudolph Berrendorf! */
    /* See the PCL home page for the German version of PAPI. */
@@ -290,7 +305,8 @@ static int scan_prtconf(char *cpuname, int len_cpuname, int *hz, int *ver)
                     (sscanf(line, "%s %x", cmd, &ihz) == 2)) {
             matched |= 0x4;
             SUBDBG("Found ihz=%d. (0x%2.2x)\n", ihz,matched);
-         } else if (!strcmp(cmd, "name:") && (sscanf(line, "%s %s", cmd, name) == 2)) {
+			} else if ( !strcmp( cmd, "name:" ) &&
+						( sscanf( line, "%s %s", cmd, name ) == 2 ) ) {
             matched |= 0x8;
             SUBDBG("Found name: %s. (0x%2.2x)\n", name,matched); 
          }
@@ -298,7 +314,8 @@ static int scan_prtconf(char *cpuname, int len_cpuname, int *hz, int *ver)
       if ((matched & 0xF) == 0xF)
          break;
    }
-   SUBDBG("Parsing found name=%s, speed=%dHz, version=%d\n", name, ihz, version);
+	SUBDBG( "Parsing found name=%s, speed=%dHz, version=%d\n", name, ihz,
+			version );
 
    if (matched ^ 0x0F)
       ihz = -1;
@@ -313,7 +330,8 @@ static int scan_prtconf(char *cpuname, int len_cpuname, int *hz, int *ver)
    /* End stolen code */
 }
 
-static int set_domain(hwd_control_state_t * this_state, int domain)
+static int
+set_domain( hwd_control_state_t * this_state, int domain )
 {
    papi_cpc_event_t *command = &this_state->counter_cmd;
    cpc_event_t *event = &command->cmd;
@@ -339,7 +357,8 @@ static int set_domain(hwd_control_state_t * this_state, int domain)
    return (PAPI_OK);
 }
 
-static int set_granularity(hwd_control_state_t * this_state, int domain)
+static int
+set_granularity( hwd_control_state_t * this_state, int domain )
 {
    switch (domain) {
    case PAPI_GRN_PROCG:
@@ -358,12 +377,14 @@ static int set_granularity(hwd_control_state_t * this_state, int domain)
 /* Utility functions */
 
 /* This is a wrapper arount fprintf(stderr,...) for cpc_walk_events() */
-void print_walk_names(void *arg, int regno, const char *name, uint8_t bits)
+void
+print_walk_names( void *arg, int regno, const char *name, uint8_t bits )
 {
    SUBDBG(arg, regno, name, bits);
 }
 
-static int get_system_info(void)
+static int
+get_system_info( void )
 {
    int retval;
    pid_t pid;
@@ -403,7 +424,8 @@ static int get_system_info(void)
 
          for (i = 0; i < cpc_getnpic(cpuver); i++) {
 	   SUBDBG("\n%6s %-40s %8s\n", "Reg", "Symbolic name", "Code");
-            cpc_walk_names(cpuver, i, "%6d %-40s %02x\n", print_walk_names);
+				cpc_walk_names( cpuver, i, "%6d %-40s %02x\n",
+								print_walk_names );
          }
          SUBDBG("\n");
       }
@@ -416,11 +438,6 @@ static int get_system_info(void)
    if ((retval = build_tables()) != PAPI_OK)
       return retval;
 
-   ThreadInfo_t *thread = _papi_hwi_lookup_thread();
-   EventSetInfo_t *ESI = (EventSetInfo_t *)thread->running_eventset;
-
-   /****** NOTE: The use of _papi_hwd[ESI->CmpIdx] in the following code may not be the correct implementation *****/
-
    preset_search_map = preset_table;
    if (cpuver <= CPC_ULTRA2) {
       SUBDBG("cpuver (==%d) <= CPC_ULTRA2 (==%d)\n", cpuver, CPC_ULTRA2);
@@ -430,8 +447,8 @@ static int get_system_info(void)
       SUBDBG("cpuver (==%d) <= CPC_ULTRA3x (==%d)\n", cpuver, LASTULTRA3);
       pcr_shift[0] = CPC_ULTRA_PCR_PIC0_SHIFT;
       pcr_shift[1] = CPC_ULTRA_PCR_PIC1_SHIFT;
-      _papi_hwd[ESI->CmpIdx]->cmp_info.hardware_intr = 1;
-      _papi_hwd[ESI->CmpIdx]->cmp_info.hardware_intr_sig = SIGEMT;
+		_solaris_vector.cmp_info.hardware_intr = 1;
+		_solaris_vector.cmp_info.hardware_intr_sig = SIGEMT;
    } else
       return (PAPI_ESBSTR);
 
@@ -448,7 +465,8 @@ static int get_system_info(void)
       return (PAPI_ESYS);
    {
       int retval;
-      struct {
+		struct
+		{
          long cmd;
          long flags;
       } cmd;
@@ -478,18 +496,22 @@ static int get_system_info(void)
    }
 
    if (realpath(psi.pr_psargs,pname))
-     strncpy(_papi_hwi_system_info.exe_info.fullname, pname, PAPI_HUGE_STR_LEN);
+		strncpy( _papi_hwi_system_info.exe_info.fullname, pname,
+				 PAPI_HUGE_STR_LEN );
    else
-     strncpy(_papi_hwi_system_info.exe_info.fullname, psi.pr_psargs, PAPI_HUGE_STR_LEN);
+		strncpy( _papi_hwi_system_info.exe_info.fullname, psi.pr_psargs,
+				 PAPI_HUGE_STR_LEN );
 
    /* please don't use pr_fname here, because it can only store less that 
       16 characters */
-   strcpy(_papi_hwi_system_info.exe_info.address_info.name,basename(_papi_hwi_system_info.exe_info.fullname));
+	strcpy( _papi_hwi_system_info.exe_info.address_info.name,
+			basename( _papi_hwi_system_info.exe_info.fullname ) );
 
-   SUBDBG("Full Executable is %s\n", _papi_hwi_system_info.exe_info.fullname);
+	SUBDBG( "Full Executable is %s\n",
+			_papi_hwi_system_info.exe_info.fullname );
 
    /* Executable regions, reading /proc/pid/maps file */
-   retval = _papi_hwd_update_shlib_info();
+	retval = _ultra_hwd_update_shlib_info(  );
 
    /* Hardware info */
 
@@ -501,7 +523,8 @@ static int get_system_info(void)
    if (retval == -1)
       return (PAPI_ESBSTR);
 
-   strcpy(_papi_hwi_system_info.hw_info.model_string, cpc_getcciname(cpuver));
+	strcpy( _papi_hwi_system_info.hw_info.model_string,
+			cpc_getcciname( cpuver ) );
    _papi_hwi_system_info.hw_info.model = cpuver;
    strcpy(_papi_hwi_system_info.hw_info.vendor_string, "SUN");
    _papi_hwi_system_info.hw_info.vendor = PAPI_VENDOR_SUN;
@@ -516,11 +539,12 @@ static int get_system_info(void)
    if (retval < 0)
       return (PAPI_ESBSTR);
 
-   _papi_hwd[ESI->CmpIdx]->cmp_info.num_cntrs = retval;
-   _papi_hwd[ESI->CmpIdx]->cmp_info.fast_real_timer = 1;
-   _papi_hwd[ESI->CmpIdx]->cmp_info.fast_virtual_timer = 1;
-   _papi_hwd[ESI->CmpIdx]->cmp_info.default_domain = PAPI_DOM_USER;
-   _papi_hwd[ESI->CmpIdx]->cmp_info.available_domains = PAPI_DOM_USER|PAPI_DOM_KERNEL;
+	_solaris_vector.cmp_info.num_cntrs = retval;
+	_solaris_vector.cmp_info.fast_real_timer = 1;
+	_solaris_vector.cmp_info.fast_virtual_timer = 1;
+	_solaris_vector.cmp_info.default_domain = PAPI_DOM_USER;
+	_solaris_vector.cmp_info.available_domains =
+		PAPI_DOM_USER | PAPI_DOM_KERNEL;
 
    /* Setup presets */
 
@@ -560,12 +584,13 @@ build_tables(void)
     if (ISLEVEL(DEBUG_SUBSTRATE)) {
     for (i = 0; i < nctrs; ++i) {
 	SUBDBG("%s: bits (%x,%x) pics %x\n", ctrs[i].name, ctrs[i].bits[0],
-	    ctrs[i].bits[1],
-	    ctrs[i].bitmask);
-    } }
+					ctrs[i].bits[1], ctrs[i].bitmask );
+		}
+	}
 #endif
     /* Build the native event table */
-    if ((native_table = papi_malloc(nctrs*sizeof(native_info_t))) == 0) {
+	if ( ( native_table =
+		   papi_malloc( nctrs * sizeof ( native_info_t ) ) ) == 0 ) {
 	papi_free(ctrs);
 	return PAPI_ENOMEM;
     }
@@ -587,12 +612,10 @@ build_tables(void)
     if (cpuver <= CPC_ULTRA2) {
 	n = sizeof(us2info) / sizeof(einfo_t);
 	ep = us2info;
-    }
-    else if (cpuver <= LASTULTRA3) {
+	} else if ( cpuver <= LASTULTRA3 ) {
 	n = sizeof(us3info) / sizeof(einfo_t);
 	ep = us3info;
-    }
-    else
+	} else
 	return PAPI_ESBSTR;
     preset_table = papi_malloc((n+1)*sizeof(hwi_search_t));
     npresets = 0;
@@ -615,8 +638,12 @@ build_tables(void)
 		preset_table[i].data.derived,
 		preset_table[i].data.native[0],
 		preset_table[i].data.native[1]);
-    } }
+		}
+	}
 #endif
+
+	_solaris_vector.cmp_info.num_native_events = nctrs;
+
     return PAPI_OK;
 }
 
@@ -634,6 +661,8 @@ srch_event(char *e1)
     return i;
 }
 
+/* we should read from the CSV file and make this all unnecessary */
+
 static void
 add_preset(hwi_search_t *tab, int *np, einfo_t e)
 {
@@ -654,7 +683,8 @@ add_preset(hwi_search_t *tab, int *np, einfo_t e)
      * native events, or the difference of two native events.
      * This could be extended with a real parser (hint).
      */
-    while (isspace(*p)) ++p;
+	while ( isspace( *p ) )
+		++p;
     q = p;
     i = 0;
     while (isalnum(*p) || (*p == '_')) {
@@ -668,7 +698,8 @@ add_preset(hwi_search_t *tab, int *np, einfo_t e)
 	op = *p++;
     else
 	op = 0;
-    while (isspace(*p)) ++p;
+	while ( isspace( *p ) )
+		++p;
     q = p;
     i = 0;
     while (isalnum(*p) || (*p == '_')) {
@@ -690,7 +721,8 @@ add_preset(hwi_search_t *tab, int *np, einfo_t e)
 	tab[*np].data.derived = 0;
 	tab[*np].data.native[0] = PAPI_NATIVE_MASK | ne;
 	tab[*np].data.native[1] = PAPI_NULL;
-	memset(tab[*np].data.operation, 0, sizeof(tab[*np].data.operation));
+		memset( tab[*np].data.operation, 0,
+				sizeof ( tab[*np].data.operation ) );
 	++*np;
 	return;
     }
@@ -702,6 +734,7 @@ add_preset(hwi_search_t *tab, int *np, einfo_t e)
     tab[*np].data.derived = (op == '-') ? DERIVED_SUB : DERIVED_ADD;
     tab[*np].data.native[0] = PAPI_NATIVE_MASK | ne;
     tab[*np].data.native[1] = PAPI_NATIVE_MASK | ne2;
+	tab[*np].data.native[2] = PAPI_NULL;
     memset(tab[*np].data.operation, 0, sizeof(tab[*np].data.operation));
     ++*np;
 }
@@ -734,7 +767,8 @@ action(void *arg, int regno, const char *name, uint8_t bits)
    inherit performance register information and propagate the values up
    upon child exit and parent wait. */
 
-static int set_inherit(EventSetInfo_t * global, int arg)
+static int
+set_inherit( EventSetInfo_t * global, int arg )
 {
    return (PAPI_ESBSTR);
 
@@ -758,7 +792,8 @@ static int set_inherit(EventSetInfo_t * global, int arg)
 #endif
 }
 
-static int set_default_domain(hwd_control_state_t * ctrl_state, int domain)
+static int
+set_default_domain( hwd_control_state_t * ctrl_state, int domain )
 {
    /* This doesn't exist on this platform */
 
@@ -768,80 +803,30 @@ static int set_default_domain(hwd_control_state_t * ctrl_state, int domain)
    return (set_domain(ctrl_state, domain));
 }
 
-static int set_default_granularity(hwd_control_state_t * current_state, int granularity)
+static int
+set_default_granularity( hwd_control_state_t * current_state, int granularity )
 {
    return (set_granularity(current_state, granularity));
 }
 
 rwlock_t lock[PAPI_MAX_LOCK];
 
-static void lock_init(void)
+static void
+lock_init( void )
 {
   memset(lock,0x0,sizeof(rwlock_t)*PAPI_MAX_LOCK);
 }
 
-int _papi_hwd_shutdown_substrate(void)
+int
+_ultra_hwd_shutdown_substrate( void )
 {
    (void) cpc_rele();
    return (PAPI_OK);
 }
 
-/* This implementation may not be correct */
-papi_vector_t _solaris_vector = {
-	.cmp_info = {
-		/* default component information (unspecified values are initialized to 0) */
-		.num_cntrs = MAX_COUNTERS, /* Number of counters the substrate supports */
-		.num_mpx_cntrs = PAPI_MPX_DEF_DEG,
-		.default_domain = PAPI_DOM_USER,
-		.available_domains = PAPI_DOM_USER|PAPI_DOM_KERNEL,
-		.default_granularity = PAPI_GRN_THR,
-		.available_granularities = PAPI_GRN_THR,
-		.hardware_intr_sig = PAPI_INT_SIGNAL,
-
-		/* component specific cmp_info initializations */
-		.fast_real_timer = 1,
-		.fast_virtual_timer = 1,
-		.attach = 1,
-		.attach_must_ptrace = 1,
-	},
-
-	/* sizes of framework-opaque component-private structures */
-	.size = {
-		.context = sizeof(hwd_context_t),
-		.control_state = sizeof(hwd_control_state_t),
-		.reg_value = sizeof(hwd_register_t),
-		.reg_alloc = sizeof(hwd_reg_alloc_t),
-	},
-
-	/* function pointers in this component */
-	.init_control_state = _papi_hwd_init_control_state,
-	.start = _papi_hwd_start,
-	.stop =	_papi_hwd_stop,
-	.read =	_papi_hwd_read,
-	.shutdown_substrate = _papi_hwd_shutdown_substrate,
-	.ctl = _papi_hwd_ctl,
-	.update_control_state =	_papi_hwd_update_control_state,
-	.reset = _papi_hwd_reset,
-	.set_overflow =	_papi_hwd_set_overflow,
-	/*.stop_profiling = _papi_hwd_stop_profiling,*/
-	.ntv_enum_events = _papi_hwd_ntv_enum_events,
-	.ntv_code_to_name = _papi_hwd_ntv_code_to_name,
-	.ntv_code_to_descr = _papi_hwd_ntv_code_to_descr,
-	.ntv_code_to_bits = _papi_hwd_ntv_code_to_bits,
-	.ntv_bits_to_info = _papi_hwd_ntv_bits_to_info,
-	.init_substrate = _papi_hwd_init_substrate,
-	.dispatch_timer = _papi_hwd_dispatch_timer,
-	.get_real_usec = _papi_hwd_get_real_usec,
-	.get_real_cycles = _papi_hwd_get_real_cycles,
-	.get_virt_cycles = _papi_hwd_get_virt_cycles,
-	.get_virt_usec = _papi_hwd_get_virt_usec,
-
-	/* OS dependent local routines */
-	.update_shlib_info = _papi_hwd_update_shlib_info,
-	.get_system_info = get_system_info
-};
 
-int _papi_hwd_init_substrate(int cidx)
+int
+_ultra_hwd_init_substrate( int cidx )
 {
    int retval;
 
@@ -855,18 +840,28 @@ int _papi_hwd_init_substrate(int cidx)
    if (retval)
       return (retval);
 
+	/* Setup memory info */
+        retval =
+	  MY_VECTOR.get_memory_info( &_papi_hwi_system_info.hw_info,
+				     0 );
+        if ( retval )
+	  return ( retval );
+
+
    lock_init();
 
    SUBDBG("Found %d %s %s CPU's at %f Mhz.\n",
           _papi_hwi_system_info.hw_info.totalcpus,
           _papi_hwi_system_info.hw_info.vendor_string,
-          _papi_hwi_system_info.hw_info.model_string, _papi_hwi_system_info.hw_info.mhz);
+			_papi_hwi_system_info.hw_info.model_string,
+			_papi_hwi_system_info.hw_info.mhz );
 
    return (PAPI_OK);
 }
 
 /* reset the hardware counter */
-int _papi_hwd_reset(hwd_context_t * ctx, hwd_control_state_t * ctrl)
+int
+_ultra_hwd_reset( hwd_context_t * ctx, hwd_control_state_t * ctrl )
 {
    int retval;
 
@@ -882,7 +877,9 @@ int _papi_hwd_reset(hwd_context_t * ctx, hwd_control_state_t * ctrl)
 }
 
 
-int _papi_hwd_read(hwd_context_t * ctx, hwd_control_state_t * ctrl, long long ** events, int flags)
+int
+_ultra_hwd_read( hwd_context_t * ctx, hwd_control_state_t * ctrl,
+				long long **events, int flags )
 {
    int retval;
 
@@ -895,60 +892,111 @@ int _papi_hwd_read(hwd_context_t * ctx, hwd_control_state_t * ctrl, long long **
    return PAPI_OK;
 }
 
-int _papi_hwd_ctl(hwd_context_t * ctx, int code, _papi_int_option_t * option)
+int
+_ultra_hwd_ctl( hwd_context_t * ctx, int code, _papi_int_option_t * option )
 {
 
    switch (code) {
    case PAPI_DEFDOM:
-      return (set_default_domain(option->domain.ESI->ctl_state, option->domain.domain));
+		return ( set_default_domain
+				 ( option->domain.ESI->ctl_state, option->domain.domain ) );
    case PAPI_DOMAIN:
-      return (set_domain(option->domain.ESI->ctl_state, option->domain.domain));
+		return ( set_domain
+				 ( option->domain.ESI->ctl_state, option->domain.domain ) );
    case PAPI_DEFGRN:
       return (set_default_granularity
-              (option->domain.ESI->ctl_state, option->granularity.granularity));
+				 ( option->domain.ESI->ctl_state,
+				   option->granularity.granularity ) );
    case PAPI_GRANUL:
       return (set_granularity
-              (option->granularity.ESI->ctl_state, option->granularity.granularity));
+				 ( option->granularity.ESI->ctl_state,
+				   option->granularity.granularity ) );
    default:
       return (PAPI_EINVAL);
    }
 }
 
-void _papi_hwd_dispatch_timer(int signal, siginfo_t * si, void *info)
+void
+_ultra_hwd_dispatch_timer( int signal, siginfo_t * si, void *context )
 {
+
    _papi_hwi_context_t ctx;
-   ThreadInfo_t *t = _papi_hwi_lookup_thread();
+  ThreadInfo_t *master = NULL;
+  int isHardware = 0;
    caddr_t address;
-   ctx.si = si;
-   ctx.ucontext = (hwd_ucontext_t *)info;
-   int cidx;//HACK this needs to be set
-   int fd = si->si_fd;
+  int cidx = MY_VECTOR.cmp_info.CmpIdx;
 
-   if (t == NULL) {
-      PAPIERROR("t == NULL in _papi_hwd_dispatch_timer for fd %d!", fd);
-      return;
+   ctx.si = si;
+  ctx.ucontext = ( ucontext_t * ) context;
+
+  _papi_hwi_dispatch_overflow_signal( ( void * ) &ctx, address, &isHardware,
+				      0, 0, &master,
+				      MY_VECTOR.cmp_info.CmpIdx );
+
+  /* We are done, resume interrupting counters */
+  if ( isHardware ) {
+    //    errno = vperfctr_iresume( master->context[cidx]->perfctr );
+    //if ( errno < 0 ) {
+    //  PAPIERROR( "vperfctr_iresume errno %d", errno );
+    //}
     }
 
-   if (t->running_eventset[cidx] == NULL) {
-      PAPIERROR("t->running_eventset == NULL in _papi_hwd_dispatch_timer for fd %d!", fd);
+
+#if 0
+        EventSetInfo_t *ESI = NULL;
+        ThreadInfo_t *thread = NULL;
+        int overflow_vector = 0;
+        hwd_control_state_t *ctrl = NULL;
+        long_long results[MAX_COUNTERS];
+        int i;
+        _papi_hwi_context_t ctx;
+	caddr_t address;
+	int cidx = _solaris_vector.cmp_info.CmpIdx;
+
+        ctx.si = si;
+        ctx.ucontext = ( hwd_ucontext_t * ) info;
+
+	thread = _papi_hwi_lookup_thread(  );
+
+	if ( thread == NULL ) {
+		PAPIERROR( "thread == NULL in _papi_hwd_dispatch_timer");
       return;
     }
 
-   if (t->running_eventset[cidx]->overflow.flags == 0) {
-      PAPIERROR("t->running_eventset->overflow.flags == 0 in _papi_hwd_dispatch_timer for fd %d!", fd);
-      return;
+        ESI = ( EventSetInfo_t * ) thread->running_eventset[cidx];
+
+
+	if ( ESI == NULL || ESI->master != thread || ESI->ctl_state == NULL ||
+	     ( ( ESI->state & PAPI_OVERFLOWING ) == 0 ) ) {
+
+	  if ( ESI == NULL )
+	     PAPIERROR( "ESI is NULL\n");
+
+	  if ( ESI->master != thread )
+	     PAPIERROR( "Thread mismatch, ESI->master=%x thread=%x\n",
+		        ESI->master, thread );
+
+	  if ( ESI->ctl_state == NULL )
+	     PAPIERROR( "Counter state invalid\n");
+
+	  if ( ( ( ESI->state & PAPI_OVERFLOWING ) == 0 ) )
+	    PAPIERROR( "Overflow flag missing");
     }
 
-   if (t->running_eventset[cidx]->overflow.flags & PAPI_OVERFLOW_FORCE_SW) {
+	ctrl = ESI->ctl_state;
+
+	if ( thread->running_eventset[cidx]->overflow.flags & PAPI_OVERFLOW_FORCE_SW ) {
       address = GET_OVERFLOW_ADDRESS(ctx);
-      _papi_hwi_dispatch_overflow_signal((void *)&ctx, address, NULL, 0, 0, &t, cidx);
-   }
-   else {
+		_papi_hwi_dispatch_overflow_signal( ( void * ) &ctx, address, NULL, 0,
+											0, &thread, cidx );
+       } else {
      PAPIERROR("Need to implement additional code in _papi_hwd_dispatch_timer!");
    }
+#endif
 }
 
-int _papi_hwd_set_overflow(EventSetInfo_t * ESI, int EventIndex, int threshold)
+int
+_ultra_hwd_set_overflow( EventSetInfo_t * ESI, int EventIndex, int threshold )
 {
    hwd_control_state_t *this_state = ESI->ctl_state;
    papi_cpc_event_t *arg = &this_state->counter_cmd;
@@ -957,10 +1005,13 @@ int _papi_hwd_set_overflow(EventSetInfo_t * ESI, int EventIndex, int threshold)
    if (threshold == 0) {
       if (this_state->overflow_num == 1) {
          arg->flags ^= CPC_BIND_EMT_OVF;
-   if (sigaction(_papi_hwd[ESI->CmpIdx]->cmp_info.hardware_intr_sig, NULL, NULL) == -1)
+			if ( sigaction
+				 ( _solaris_vector.cmp_info.hardware_intr_sig, NULL,
+				   NULL ) == -1 )
             return (PAPI_ESYS);
          this_state->overflow_num = 0;
-      } else this_state->overflow_num--;
+		} else
+			this_state->overflow_num--;
 
    } else {
       struct sigaction act;
@@ -970,7 +1021,9 @@ int _papi_hwd_set_overflow(EventSetInfo_t * ESI, int EventIndex, int threshold)
       act.sa_sigaction = dispatch_emt;
       memset(&act.sa_mask, 0x0, sizeof(act.sa_mask));
       act.sa_flags = SA_RESTART | SA_SIGINFO;
-      if (sigaction(_papi_hwd[ESI->CmpIdx]->cmp_info.hardware_intr_sig, &act, NULL) == -1)
+		if ( sigaction
+			 ( _solaris_vector.cmp_info.hardware_intr_sig, &act,
+			   NULL ) == -1 )
          return (PAPI_ESYS);
 
       arg->flags |= CPC_BIND_EMT_OVF;
@@ -984,6 +1037,14 @@ int _papi_hwd_set_overflow(EventSetInfo_t * ESI, int EventIndex, int threshold)
    return (PAPI_OK);
 }
 
+
+_ultra_shutdown( hwd_context_t * ctx )
+{
+
+  return PAPI_OK;
+}
+
+
 /*
 int _papi_hwd_stop_profiling(ThreadInfo_t * master, EventSetInfo_t * ESI)
 {
@@ -992,7 +1053,8 @@ int _papi_hwd_stop_profiling(ThreadInfo_t * master, EventSetInfo_t * ESI)
 }
 */
 
-void *_papi_hwd_get_overflow_address(void *context)
+void *
+_ultra_hwd_get_overflow_address( void *context )
 {
    void *location;
    ucontext_t *info = (ucontext_t *) context;
@@ -1001,13 +1063,13 @@ void *_papi_hwd_get_overflow_address(void *context)
    return (location);
 }
 
-int _papi_hwd_start(hwd_context_t * ctx, hwd_control_state_t * ctrl)
+int
+_ultra_hwd_start( hwd_context_t * ctx, hwd_control_state_t * ctrl )
 {
    int retval;
 
    /* reset the hardware counter */
-   if (ctrl->overflow_num==0)
-   {
+	if ( ctrl->overflow_num == 0 ) {
       ctrl->counter_cmd.cmd.ce_pic[0] = 0;
       ctrl->counter_cmd.cmd.ce_pic[1] = 0;
    }
@@ -1019,27 +1081,37 @@ int _papi_hwd_start(hwd_context_t * ctx, hwd_control_state_t * ctrl)
    return (PAPI_OK);
 }
 
-int _papi_hwd_stop(hwd_context_t * ctx, hwd_control_state_t * ctrl)
+int
+_ultra_hwd_stop( hwd_context_t * ctx, hwd_control_state_t * ctrl )
 {
    cpc_bind_event(NULL, 0);
    return PAPI_OK;
 }
 
-int _papi_hwd_remove_event(hwd_register_map_t * chosen, unsigned int hardware_index,
-                           hwd_control_state_t * out)
+int
+_ultra_hwd_remove_event( hwd_register_map_t * chosen,
+						unsigned int hardware_index, hwd_control_state_t * out )
 {
    return PAPI_OK;
 }
 
-int _papi_hwd_encode_native(char *name, int *code)
+int
+_ultra_hwd_encode_native( char *name, int *code )
 {
    return (PAPI_OK);
 }
 
-int _papi_hwd_ntv_enum_events(unsigned int *EventCode, int modifer)
+int
+_ultra_hwd_ntv_enum_events( unsigned int *EventCode, int modifier )
 {
    int index = *EventCode & PAPI_NATIVE_AND_MASK;
 
+	if ( modifier == PAPI_ENUM_FIRST ) {
+	   *EventCode = PAPI_NATIVE_MASK + 1;
+
+	   return PAPI_OK;
+	}
+
    if (cpuver <= CPC_ULTRA2) {
       if (index < MAX_NATIVE_EVENT_USII - 1) {
          *EventCode = *EventCode + 1;
@@ -1056,41 +1128,51 @@ int _papi_hwd_ntv_enum_events(unsigned int *EventCode, int modifer)
    return (PAPI_ENOEVNT);
 }
 
-int _papi_hwd_ntv_code_to_name(unsigned int EventCode, char *hwd_name, int len)
+int
+_ultra_hwd_ntv_code_to_name( unsigned int EventCode, char *ntv_name, int len )
 {
-  /* HACK This implementation probably isn't correct! */
-   int nidx;
 
-   nidx = EventCode ^ PAPI_NATIVE_MASK;
-   if (nidx >= 0 && nidx < PAPI_MAX_NATIVE_EVENTS)
-     return (native_table[nidx].encoding[0]);
+        int event_code = EventCode & PAPI_NATIVE_AND_MASK;
 
-   return -1;
+	if ( event_code >= 0 && event_code < nctrs ) {
+	  strlcpy( ntv_name, native_table[event_code].name, len );
+	  return PAPI_OK;
+	}
+	return PAPI_ENOEVNT;
 }
 
-int _papi_hwd_ntv_code_to_descr(unsigned int EventCode, char *hwd_descr, int len)
+
+int
+_ultra_hwd_ntv_code_to_descr( unsigned int EventCode, char *hwd_descr, int len )
 {
-  return (_papi_hwd_ntv_code_to_name(EventCode, hwd_descr, len));
+	return ( _ultra_hwd_ntv_code_to_name( EventCode, hwd_descr, len ) );
 }
 
-static void copy_value(unsigned int val, char *nam, char *names, unsigned int *values, int len)
+static void
+copy_value( unsigned int val, char *nam, char *names, unsigned int *values,
+			int len )
 {
    *values = val;
    strncpy(names, nam, len);
    names[len-1] = 0;
 }
 
-int _papi_hwd_ntv_bits_to_info(hwd_register_t *bits, char *names,
+int
+_ultra_hwd_ntv_bits_to_info( hwd_register_t * bits, char *names,
                                unsigned int *values, int name_len, int count)
 {
    int i = 0;
-   copy_value(bits->event[0], "US Ctr 0", &names[i*name_len], &values[i], name_len);
-   if (++i == count) return(i);
-   copy_value(bits->event[1], "US Ctr 1", &names[i*name_len], &values[i], name_len);
+	copy_value( bits->event[0], "US Ctr 0", &names[i * name_len], &values[i],
+				name_len );
+	if ( ++i == count )
+		return ( i );
+	copy_value( bits->event[1], "US Ctr 1", &names[i * name_len], &values[i],
+				name_len );
    return(++i);
 }
 
-int _papi_hwd_ntv_code_to_bits(unsigned int EventCode, hwd_register_t * bits)
+int
+_ultra_hwd_ntv_code_to_bits( unsigned int EventCode, hwd_register_t * bits )
 {
    int index = EventCode & PAPI_NATIVE_AND_MASK;
 
@@ -1102,14 +1184,16 @@ int _papi_hwd_ntv_code_to_bits(unsigned int EventCode, hwd_register_t * bits)
       if(index >= MAX_NATIVE_EVENT) {
          return(PAPI_ENOEVNT);
       }
-   } else return(PAPI_ENOEVNT);
+	} else
+		return ( PAPI_ENOEVNT );
 
    bits->event[0] = native_table[index].encoding[0];
    bits->event[1] = native_table[index].encoding[1];
    return(PAPI_OK);
 }
 
-int _papi_hwd_init_control_state(hwd_control_state_t * ptr)
+int
+_ultra_hwd_init_control_state( hwd_control_state_t * ptr )
 {
    ptr->counter_cmd.flags = 0x0;
    ptr->counter_cmd.cmd.ce_cpuver = cpuver;
@@ -1117,15 +1201,15 @@ int _papi_hwd_init_control_state(hwd_control_state_t * ptr)
    ptr->counter_cmd.cmd.ce_pic[0] = 0;
    ptr->counter_cmd.cmd.ce_pic[1] = 0;
 
-   ThreadInfo_t *thread = _papi_hwi_lookup_thread();
-   EventSetInfo_t *ESI = (EventSetInfo_t *) thread->running_eventset;
-   set_domain(ptr, _papi_hwd[ESI->CmpIdx]->cmp_info.default_domain);
-   set_granularity(ptr, _papi_hwd[ESI->CmpIdx]->cmp_info.default_granularity);
+	set_domain( ptr, _solaris_vector.cmp_info.default_domain );
+	set_granularity( ptr, _solaris_vector.cmp_info.default_granularity );
    return PAPI_OK;
 }
 
-int _papi_hwd_update_control_state(hwd_control_state_t * this_state,
-                    NativeInfo_t * native, int count, hwd_context_t * zero)
+int
+_ultra_hwd_update_control_state( hwd_control_state_t * this_state,
+								NativeInfo_t * native, int count,
+								hwd_context_t * zero )
 {
    int nidx1, nidx2, hwcntr;
    uint64_t tmp, cmd0, cmd1, pcr;
@@ -1215,27 +1299,34 @@ int _papi_hwd_update_control_state(hwd_control_state_t * this_state,
    return (PAPI_OK);
 }
 
-long long _papi_hwd_get_real_usec(void)
+long long
+_ultra_hwd_get_real_usec( void )
 {
    return ((long long) gethrtime() / (long long) 1000);
 }
 
-long long _papi_hwd_get_real_cycles(void)
+long long
+_ultra_hwd_get_real_cycles( void )
 {
-   return(_papi_hwd_get_real_usec() * (long long) _papi_hwi_system_info.hw_info.mhz);
+	return ( _ultra_hwd_get_real_usec(  ) *
+			 ( long long ) _papi_hwi_system_info.hw_info.mhz );
 }
 
-long long _papi_hwd_get_virt_usec(const hwd_context_t * zero)
+long long
+_ultra_hwd_get_virt_usec( const hwd_context_t * zero )
 {
    return ((long long) gethrvtime() / (long long) 1000);
 }
 
-long long _papi_hwd_get_virt_cycles(const hwd_context_t * zero)
+long long
+_ultra_hwd_get_virt_cycles( const hwd_context_t * zero )
 {
-   return (((long long) gethrvtime() / (long long) 1000) * (long long) _papi_hwi_system_info.hw_info.mhz);
+	return ( ( ( long long ) gethrvtime(  ) / ( long long ) 1000 ) *
+			 ( long long ) _papi_hwi_system_info.hw_info.mhz );
 }
 
-int _papi_hwd_update_shlib_info(void)
+int
+_ultra_hwd_update_shlib_info( void )
 {
    /*??? system call takes very long */
 
@@ -1246,7 +1337,8 @@ int _papi_hwd_update_shlib_info(void)
 
    FILE *f=NULL;
    int t_index=0, i;
-   struct map_record {
+	struct map_record
+	{
       long address;
       int size;
       int flags;
@@ -1259,7 +1351,8 @@ int _papi_hwd_update_shlib_info(void)
 
    sprintf(cmd_line, "/bin/pmap %d > %s",(int)getpid(), fname);
    if (system(cmd_line) != 0) {
-      PAPIERROR("Could not run %s to get shared library address map",cmd_line);
+		PAPIERROR( "Could not run %s to get shared library address map",
+				   cmd_line );
       return(PAPI_OK);
    }
 
@@ -1275,13 +1368,14 @@ int _papi_hwd_update_shlib_info(void)
    head = curr = NULL;
    while (fgets(line, 256, f) != NULL) {
       /* discard the last line */
-      if (strncmp(line, " total", 6) != 0 )
-      {
+		if ( strncmp( line, " total", 6 ) != 0 ) {
          sscanf(line, "%s %s %s %s", address, size, flags, objname);
-         if (objname[0] == '/' )  
-         {
-            tmpr = (struct map_record *)papi_malloc(sizeof(struct map_record));
-            if (tmpr==NULL) return(-1);
+			if ( objname[0] == '/' ) {
+				tmpr =
+					( struct map_record * )
+					papi_malloc( sizeof ( struct map_record ) );
+				if ( tmpr == NULL )
+					return ( -1 );
             tmpr->next = NULL;
             if (curr ) {
                curr->next = tmpr;
@@ -1293,10 +1387,9 @@ int _papi_hwd_update_shlib_info(void)
 
             SUBDBG("%s\n", objname);
 
-            if ( (strstr(flags, "read") && strstr(flags, "exec")) || (strstr(flags, "r") && strstr(flags, "x")) )
-            {
-              if ( !(strstr(flags, "write")||strstr(flags, "w")) )  /* text segment */
-               { 
+				if ( ( strstr( flags, "read" ) && strstr( flags, "exec" ) ) ||
+					 ( strstr( flags, "r" ) && strstr( flags, "x" ) ) ) {
+					if ( !( strstr( flags, "write" ) || strstr( flags, "w" ) ) ) {	/* text segment */
                   t_index++;
                   tmpr->flags =1;
                } else {
@@ -1312,21 +1405,22 @@ int _papi_hwd_update_shlib_info(void)
          
       }
    }
-   tmp = (PAPI_address_map_t *) papi_calloc(t_index-1, sizeof(PAPI_address_map_t));
+	tmp =
+		( PAPI_address_map_t * ) papi_calloc( t_index - 1,
+											  sizeof ( PAPI_address_map_t ) );
 
-   if (tmp == NULL)
-     { PAPIERROR("Error allocating shared library address map"); return(PAPI_ENOMEM); }
+	if ( tmp == NULL ) {
+		PAPIERROR( "Error allocating shared library address map" );
+		return ( PAPI_ENOMEM );
+	}
    
    t_index = -1;
    tmpr = curr = head;
    i=0;
-   while (curr != NULL )
-   {
+	while ( curr != NULL ) {
       if (strcmp(_papi_hwi_system_info.exe_info.address_info.name,
-                          basename(curr->objname))== 0 )
-      {
-         if ( curr->flags ) 
-         {
+					 basename( curr->objname ) ) == 0 ) {
+			if ( curr->flags ) {
             _papi_hwi_system_info.exe_info.address_info.text_start =
                                       (caddr_t) curr->address;
             _papi_hwi_system_info.exe_info.address_info.text_end =
@@ -1338,17 +1432,20 @@ int _papi_hwd_update_shlib_info(void)
                                       (caddr_t) (curr->address + curr->size);
          }
       } else {
-         if ( curr->flags ) 
-         {
+			if ( curr->flags ) {
             t_index++;
             tmp[t_index].text_start = (caddr_t) curr->address;
-            tmp[t_index].text_end =(caddr_t) (curr->address+curr->size);
-               strncpy(tmp[t_index].name, curr->objname,PAPI_HUGE_STR_LEN-1 );
+				tmp[t_index].text_end =
+					( caddr_t ) ( curr->address + curr->size );
+				strncpy( tmp[t_index].name, curr->objname,
+						 PAPI_HUGE_STR_LEN - 1 );
                tmp[t_index].name[PAPI_HUGE_STR_LEN-1]='\0';
          } else {
-               if (t_index <0 )  continue;
+				if ( t_index < 0 )
+					continue;
                tmp[t_index].data_start = (caddr_t) curr->address;
-               tmp[t_index].data_end = (caddr_t) (curr->address+ curr->size);
+				tmp[t_index].data_end =
+					( caddr_t ) ( curr->address + curr->size );
          }
       }
       tmpr = curr->next;
@@ -1371,7 +1468,8 @@ int _papi_hwd_update_shlib_info(void)
 #if 0
 /* once the bug in dladdr is fixed by SUN, (now dladdr caused deadlock when
    used with pthreads) this function can be used again */
-int _papi_hwd_update_shlib_info(void)
+int
+_papi_hwd_update_shlib_info( void )
 {
    char fname[80], name[PAPI_HUGE_STR_LEN];
    prmap_t newp;
@@ -1383,8 +1481,7 @@ int _papi_hwd_update_shlib_info(void)
 
    sprintf(fname, "/proc/%d/map", getpid());
    map_f = fopen(fname, "r");
-   if (!map_f)
-     { 
+	if ( !map_f ) {
 	 PAPIERROR("fopen(%s) returned < 0", fname); 
 	 return(PAPI_OK); 
      }
@@ -1403,7 +1500,8 @@ int _papi_hwd_update_shlib_info(void)
          strcpy(name,dlip.dli_fname);
          if (strcmp(_papi_hwi_system_info.exe_info.address_info.name, 
                           basename(name))== 0 ) {
-            if ((newp.pr_mflags & MA_EXEC) && (newp.pr_mflags & MA_READ) ) {
+				if ( ( newp.pr_mflags & MA_EXEC ) &&
+					 ( newp.pr_mflags & MA_READ ) ) {
                if ( !(newp.pr_mflags & MA_WRITE)) {
                   _papi_hwi_system_info.exe_info.address_info.text_start = 
                                       (caddr_t) newp.pr_vaddr;
@@ -1421,10 +1519,14 @@ int _papi_hwd_update_shlib_info(void)
 
    }
    rewind(map_f);
-   tmp = (PAPI_address_map_t *) papi_calloc(t_index-1, sizeof(PAPI_address_map_t));
+	tmp =
+		( PAPI_address_map_t * ) papi_calloc( t_index - 1,
+											  sizeof ( PAPI_address_map_t ) );
 
-   if (tmp == NULL)
-     { PAPIERROR("Error allocating shared library address map"); return(PAPI_ENOMEM); }
+	if ( tmp == NULL ) {
+		PAPIERROR( "Error allocating shared library address map" );
+		return ( PAPI_ENOMEM );
+	}
    t_index=-1;
    while ( fread(&newp, sizeof(prmap_t), 1, map_f) > 0 ) {
       vaddr = (void*)(1+(newp.pr_vaddr)); // map base address
@@ -1437,13 +1539,17 @@ int _papi_hwd_update_shlib_info(void)
             if ( !(newp.pr_mflags & MA_WRITE)) {
                t_index++;
                tmp[t_index].text_start = (caddr_t) newp.pr_vaddr;
-               tmp[t_index].text_end =(caddr_t) (newp.pr_vaddr+newp.pr_size);
-               strncpy(tmp[t_index].name, dlip.dli_fname,PAPI_HUGE_STR_LEN-1 );
+					tmp[t_index].text_end =
+						( caddr_t ) ( newp.pr_vaddr + newp.pr_size );
+					strncpy( tmp[t_index].name, dlip.dli_fname,
+							 PAPI_HUGE_STR_LEN - 1 );
                tmp[t_index].name[PAPI_HUGE_STR_LEN-1]='\0';
             } else {
-               if (t_index <0 )  continue;
+					if ( t_index < 0 )
+						continue;
                tmp[t_index].data_start = (caddr_t) newp.pr_vaddr;
-               tmp[t_index].data_end = (caddr_t) (newp.pr_vaddr+newp.pr_size);
+					tmp[t_index].data_end =
+						( caddr_t ) ( newp.pr_vaddr + newp.pr_size );
             }
          }
       }
@@ -1459,3 +1565,79 @@ int _papi_hwd_update_shlib_info(void)
    return(PAPI_OK);
 }
 #endif
+
+
+papi_vector_t _solaris_vector = {
+	.cmp_info = {
+				 .num_cntrs = MAX_COUNTERS,
+				 .num_mpx_cntrs = PAPI_MPX_DEF_DEG,
+				 .default_domain = PAPI_DOM_USER,
+				 .available_domains = PAPI_DOM_USER | PAPI_DOM_KERNEL,
+				 .default_granularity = PAPI_GRN_THR,
+				 .available_granularities = PAPI_GRN_THR,
+				 .fast_real_timer = 1,
+				 .fast_virtual_timer = 1,
+				 .attach = 1,
+				 .attach_must_ptrace = 1,
+				 .itimer_sig = PAPI_INT_MPX_SIGNAL,
+                                 .itimer_num = PAPI_INT_ITIMER,
+                                 .itimer_ns = PAPI_INT_MPX_DEF_US * 1000,
+                                 .itimer_res_ns = 1,
+				 .hardware_intr = 0,
+				 .hardware_intr_sig = PAPI_INT_SIGNAL,
+				 .precise_intr = 0,
+				 }
+	,
+
+	/* substrate data structure sizes */
+	.size = {
+			 .context = sizeof ( hwd_context_t ),
+			 .control_state = sizeof ( hwd_control_state_t ),
+			 .reg_value = sizeof ( hwd_register_t ),
+			 .reg_alloc = sizeof ( hwd_reg_alloc_t ),
+			 }
+	,
+
+	/* substrate interface functions */
+	.init_control_state = _ultra_hwd_init_control_state,
+	.start = _ultra_hwd_start,
+	.stop = _ultra_hwd_stop,
+	.read = _ultra_hwd_read,
+        /* .write */
+        .shutdown = _ultra_shutdown,
+	.shutdown_substrate = _ultra_hwd_shutdown_substrate,
+	.ctl = _ultra_hwd_ctl,
+        /* .bpt_map_set        */
+        /* .bpt_map_avail      */
+        /* .bpt_map_exclusive  */
+        /* .bpt_map_shared     */
+        /* .bpt_map_preempt    */
+        /* .bpt_map_update     */
+	/* .allocate_registers */
+	.update_control_state = _ultra_hwd_update_control_state,
+        /* .set_domain */
+	.reset = _ultra_hwd_reset,
+	.set_overflow = _ultra_hwd_set_overflow,
+	/* .set_profile */
+	/* .stop_profiling = _papi_hwd_stop_profiling, */
+        /* .add_prog_event */
+	.ntv_enum_events = _ultra_hwd_ntv_enum_events,
+        /* .ntv_name_to_code */
+	.ntv_code_to_name = _ultra_hwd_ntv_code_to_name,
+	.ntv_code_to_descr = _ultra_hwd_ntv_code_to_descr,
+	.ntv_code_to_bits = _ultra_hwd_ntv_code_to_bits,
+	.ntv_bits_to_info = _ultra_hwd_ntv_bits_to_info,
+	.init_substrate = _ultra_hwd_init_substrate,
+	.dispatch_timer = _ultra_hwd_dispatch_timer,
+	.get_real_usec = _ultra_hwd_get_real_usec,
+	.get_real_cycles = _ultra_hwd_get_real_cycles,
+	.get_virt_cycles = _ultra_hwd_get_virt_cycles,
+	.get_virt_usec = _ultra_hwd_get_virt_usec,
+
+	/* OS dependent local routines */
+        .get_memory_info = _solaris_get_memory_info,
+        .get_dmem_info = _solaris_get_dmem_info,
+	.update_shlib_info = _ultra_hwd_update_shlib_info,
+	.get_system_info = get_system_info
+};
+
diff --git a/src/utils/native_avail.c b/src/utils/native_avail.c
index fafab05..260cad8 100644
--- a/src/utils/native_avail.c
+++ b/src/utils/native_avail.c
@@ -124,7 +124,7 @@ static void space_pad(char *str, int spaces) {
 }
 
 static void print_event(PAPI_event_info_t *info, int offset) {
-	int i, j = 0;
+	unsigned int i, j = 0;
 	char str[EVT_LINE + EVT_LINE];
 
 	/* indent by offset */
@@ -139,13 +139,13 @@ static void print_event(PAPI_event_info_t *info, int offset) {
 
 	while (j <= strlen(info->long_descr))
 	{
-		i = EVT_LINE - strlen(str) - 2;
+		i = EVT_LINE - (unsigned int)strlen(str) - 2;
 		if (i > 0)
 		{
 			strncat(str, &info->long_descr[j], i);
 			j +=i;
-			i = strlen(str);
-			space_pad(str, EVT_LINE - i - 1);
+			i = (unsigned int)strlen(str);
+			space_pad(str, EVT_LINE - (int)i - 1);
 			strcat(str, "|");
 		}
 		printf("%s\n",str);
@@ -233,10 +233,12 @@ int main(int argc, char **argv)
 				}
 			}
 		}
-		else printf("Sorry, an event by the name '%s' could not be found.\n Is it typed correctly?\n\n",flags.name);
+		else {
+			printf("Sorry, an event by the name '%s' could not be found.\n Is it typed correctly?\n\n",flags.name);
 		exit(1);
 	}
-
+	}
+	else {
 	printf("%-12s %s  | %s |\n","Event Code","Symbol","Long Description");
 	printf
 		("--------------------------------------------------------------------------------\n");
@@ -312,6 +314,7 @@ int main(int argc, char **argv)
 
 	printf ("--------------------------------------------------------------------------------\n");
 	printf("Total events reported: %d\n", j);
+	}
 	test_pass(__FILE__, NULL, 0);
 	exit(0);
 }
